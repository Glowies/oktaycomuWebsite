!function(a,b,c,d,e,f,g,h,i,j){var k={};!function(a){"use strict";var c={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}};!function(){var a=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(a){return!1}}();a||(hasOwnProp=Object.prototype.hasOwnProperty,hasOwnProp&&(Object.defineProperty=function(a,b,c){if("object"!=typeof a)throw new TypeError("Object.defineProperty called in non-object");if("object"!=typeof c)throw new TypeError("Property description must be an object: "+c);return hasOwnProp.call(c,"get")||hasOwnProp.call(c,"set"),b+="",a[b]=c.value,a}))}();var d=function(d,e){e&&(e.name="Autodesk Creative Platform Runtime Library",e.description="Implicit Capabilities and Client-Side Runtime",e.resources=[]);var f=function(a,b,c,d){this.name=a,this.version=b,this.os=c,this.helpInfo=d},h=new g,i={detect:function(){var a=function(a){h.setUA(a);var b=h.getBrowser(),c;if(b){var d=h.getOS();c=new f(b.name.toLowerCase(),b.version,d.name.toLowerCase())}return c},b=function(a,b){var c=/(\.0)+[^\.]*$/;a=(a+"").replace(c,"").split("."),b=(b+"").replace(c,"").split(".");for(var d,e=Math.min(a.length,b.length),f=0;e>f;f++)if(d=parseInt(a[f],10)-parseInt(b[f],10),0!==d)return d;return a.length-b.length},c;if(navigator&&navigator.userAgent){var d={ie:{name:"IE",downloadLink:"http://windows.microsoft.com/en-us/internet-explorer/download-ie"},chrome:{name:"Chrome",downloadLink:"https://www.google.com/intl/en-US/chrome/browser/"},firefox:{name:"Firefox",downloadLink:"https://www.mozilla.org/en-US/firefox/new/"},safari:{name:"Safari",downloadLink:"http://support.apple.com/downloads/#internet"}};c=a(navigator.userAgent);var e='style="height: 100%; width: 100%; background-color: rgb(248, 248, 248); display: table;"',g='style="display:table-cell; vertical-align: middle; text-align:center;"',i='style="font-size: 18px; font-weight: bold; color: #949494; padding: 5px 0;"',j='style="font-size: 14px; color: #b8b8b8; padding: 2px 0;"';c.helpInfo="<div "+e+">"+"<div "+g+">"+'<div style="display:inline-block; text-align:left;">',c.helpInfo+=c.name?"ios"===c.os?"<span "+i+">Your device does not support WebGL.</span>"+"<br/><span "+j+">To view this page, please visit us from a desktop WebGL-enabled browser.</span>":"android"===c.os?"<span "+i+">To view this page, please install a WebGL compatiable browser (like Firefox) from your favorite app store.</span>":"safari"===c.name&&b(c.version,"6.0.4")>0?"<span "+i+">To experience rich 3D contents, you need to enable WebGL.</span>"+"<br/><span "+j+'>To switch it on, enable the developer menu and check the "Enable WebGL" option.</span>':"chrome"===c.name?"<span "+i+"> To experience rich 3D contents, you need to have the latest "+d[c.name].name+" and WebGL enabled.</span>"+"<br/><span "+j+'>1. Please take a moment to <a href="'+d[c.name].downloadLink+'" target="_blank" style="color: #4cb1e6;" >install</a>  the latest version.</span>'+"<br/><span "+j+'>2. Type "chrome://flags/" into the address bar, look for "Disable WebGL" option, make sure it is disabled and relaunch the browser.</span>':"firefox"===c.name?"<span "+i+"> To experience rich 3D contents, you need to have the latest "+d[c.name].name+" and WebGL enabled.</span>"+"<br/><span "+j+'>1. Please take a moment to <a href="'+d[c.name].downloadLink+'" target="_blank" style="color: #4cb1e6;" >install</a>  the latest version.</span>'+"<br/><span "+j+'>2. Type "about:config" into the address bar, and set the "webgl.disabled" variable to False.</span>':"ie"===c.name&&b(c.version,"10")<0?'<div style="text-align:center;"><span '+i+"> To experience rich 3D contents, you need to have the latest "+d[c.name].name+".</span>"+"<br/><span "+j+'>Please take a moment to <a href="'+d[c.name].downloadLink+'" target="_blank" style="color: #4cb1e6;" >install</a>  the latest version.</span></div>':"ie"===c.name||"safari"===c.name?"<span "+i+"> To experience rich 3D contents, you need to have the latest "+d[c.name].name+".</span>"+"<br/><span "+j+'>Please take a moment to <a href="'+d[c.name].downloadLink+'" target="_blank" style="color: #4cb1e6;" >install</a>  the latest version.</span>':"<span "+i+">To experience rich 3D contents, you need to have a WebGL compatiable browser.</span>"+"<br/><span "+j+'>Please take a moment to install one like <a href="'+d.chrome.downloadLink+'" target="_blank" style="color: #4cb1e6;" >Google Chrome</a>.</span>':"<span "+i+">To experience rich 3D contents, you need to have a WebGL compatiable browser.</span>"+"<br/><span "+j+'>Please take a moment to install one like <a href="'+d.chrome.downloadLink+'" target="_blank" style="color: #4cb1e6;" >Google Chrome</a>.</span>',c.helpInfo+="</div></div></div>"}return c}},j=function(){this.libraries={},this.variables={}};j.prototype={loadLibrary:function(b,d){try{var e="creativePlatformLibrary"+d.id+"rev"+d.version;if(!a[e])return!1;a[e](b,d),this.secureLibrary(d);var f=this.libraries[d.id];void 0==f&&(f={},this.libraries[d.id]=f),f[d.version]=d,c.log("Runtime: Loaded Library: "+d.id)}catch(g){return c.error("Runtime: Exception while loading a library ("+d.id+"): "+g),!1}return!0},secureLibrary:function(a){for(var b=[{key:"name",value:""},{key:"description",value:""},{key:"resources",value:[]}],c=0;c<b.length;c++){var d=b[c],e=a[d.key]||d.value;delete a[d.key],Object.defineProperty(a,d.key,{writable:!1,enumerable:!0,configurable:!1,value:e})}}};var d=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new j});var a=function(a){return function(b){var c=a.getVariable(["host","elementId"]);if(c){var d=document.getElementById(c);if(d){var e=i.detect();e&&(d.innerHTML=e.helpInfo)}}throw new Error(b)}}(this);this.setVariable(["callbacks","panic"],a)};d.prototype={library:function(a,b){return this._impl.libraries[a]?this._impl.libraries[a][b]:void 0},libraryExports:function(a,b){var c=this.library(a,b);return c?c.exports:void 0},loadLibrary:function(a){return this._impl.loadLibrary(this,a)},findLibrary:function(a){var b=function(a,b){return b.exportedSymbol?a.hasOwnProperty(b.exportedSymbol):!1},d=[];for(var e in this._impl.libraries)for(var f=this._impl.libraries[e],g=Object.keys(f),h=0;h<g.length;h++){var i=f[g[h]],j=i.exports;b(j,a)&&d.push(i)}return d.length>1&&c.error("Runtime: More than one library is found by findLibrary"),d.length>0?d[0]:void 0},module:function(a){return void 0},getVariable:function(a,b){for(var c=this._impl.variables[a[0]],d=1;d<a.length&&c;d++)c=c[a[d]];return void 0===c&&void 0!==b&&(c=b,this.setVariable(a,b)),c},setVariable:function(a,b){for(var c=this._impl.variables,d=0;d<a.length-1;d++){var e=a[d],f=c[e];f||(f={},c[e]=f),c=f}void 0!==b?c[a[a.length-1]]=b:delete c[a[a.length-1]]}};var k=function(a){this.environment=a},e=function(a,b,c){Object.defineProperty(this,"id",{writable:!1,enumerable:!0,configurable:!1,value:b}),Object.defineProperty(this,"version",{writable:!1,enumerable:!0,configurable:!1,value:c}),Object.defineProperty(this,"exports",{writable:!1,enumerable:!0,configurable:!1,value:{}}),Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new k(a)})};e.prototype={resourceFile:function(a){var b=this.resourceURL(a),c=b.substring(b.lastIndexOf("/")+1);return new t({url:b,name:c})},resourceURL:function(a){var b=this._impl.environment.getVariable(["disconnected","enabled"]);if(!0===b){var c=this._impl.environment.getVariable(["runtime","libraries"])||[];b=!1;for(var d=0;d<c.length;d++)if(c[d].id===this.id&&c[d].version===this.version){b=!0;break}}if(!0===b){var e=this.id+"_"+this.version+"_"+a,f=this._impl.environment.getVariable(["resources","map"]);if(f){var g=f[a]||f[e];if(g)return g}var h=this._impl.environment.getVariable(["resources","root"]);return h+e}var i=this._impl.environment.getVariable(["urls","api"]);return i+"/libraries/"+this.id+"/"+this.version+"/item/"+a},imageURL:function(a){if("string"!=typeof a)return void 0;var b=1;if(window&&"number"==typeof window.devicePixelRatio&&(b=window.devicePixelRatio),b>1){var c=/(([0-9]+)x([0-9]+))(\.[^.]+$)/,d=c.exec(a);if(d){var e=parseInt(d[2])*b,f=parseInt(d[3])*b,g=a.replace(new RegExp(d[0]+"$"),e.toString()+"x"+f.toString()+d[4]),h=this._impl.environment.getVariable(["resources","map"]);if(h){var i=this.id+"_"+this.version+"_"+g,j=h[g]||h[i];if(j)return j}for(var k=this.resources||[],l=0,m=k.length;m>l;l++)if(g===k[l].name){a=g;break}}}return this.resourceURL(a)},resourceText:function(b,c){var d=function(a,b,d){c(a)},e=function(a,b,d){c(void 0)},f=this.resourceURL(b);return a.creativePlatformRuntime?(a.creativePlatformRuntime._impl._ajax({url:f,type:"GET",dataType:"text",success:d,error:e}),void 0):(c(void 0),void 0)},resourceDataView:function(b,c){var d=function(a,b,d){if(a){var e=new DataView(a);c(e)}},e=function(a,b,d){c(void 0)};if(!a.creativePlatformRuntime)return c(void 0),void 0;var f=this.resourceURL(b);a.creativePlatformRuntime._impl._ajax({url:f,type:"GET",dataType:"binary",success:d,error:e})}};var l=0,m=1,n=2,o=3,p=4,q=function(){this._creativePlatformEnvironment=new d,this._libraryStates={},this._libraryDependencies={},this._pendingCallbacks=[],this._creativePlatformEnvironment.setVariable(["urls","api"],"https://api.tinkercad.com")};q.prototype={_libraryKey:function(a){return a.id+"-"+a.version},_ajax:function(a,b){var c=null,d={};if("object"==typeof a?(d=a,a=void 0):b&&(d=b),d.url=d.url||a,d.type=(d.type||"GET").toUpperCase(),d.dataType=d.dataType||"text",d.success&&(d.success=d.success),d.error&&(d.error=d.error),d.retryOnError=d.retryOnError||!1,d.retryDelay=d.retryDelay||1e3,d.retryTimeout=d.retryTimeout||6e4,"script"===d.dataType){var e=document.createElement("script");return e.setAttribute("type","text/javascript"),e.async=!0,e.src=d.url,d.success&&(e.onload=d.success),d.error&&(e.onerror=d.error),document.getElementsByTagName("head")[0].appendChild(e),void 0}if(c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.headers)for(var f=0;f<d.headers.length;f++)c.setRequestHeader(d.headers[f].header,d.headers[f].value);c.onreadystatechange=function(){if(4===c.readyState){var a=c.status>=200&&c.status<300||304===c.status,b="";if(a){if(204===c.status)b="nocontent";else if(304===c.status)b="notmodified";else{var e={json:function(){if(window.JSON&&window.JSON.parse)return window.JSON.parse(this.responseText);var a=this.responseText.replace(/^\s+|\s+$/g,"");return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?new Function("return "+a)():{}},xml:function(){return this.responseText},text:function(){return this.responseText},binary:function(){return this.response}};b=e[d.dataType].apply(this,[])}d.success(b,c.status,c)}else{b="error";var f=function(){return d._retryStarttime?(Date.now()-new Date(d._retryStarttime))/1e3>=d.retryTimeout/1e3?!0:!1:!1};d.retryOnError&&503===c.status&&!f()?window.setTimeout(function(){d._retryStarttime||(d._retryStarttime=Date.now()),ajaxRequest(d)},d.retryDelay):d.error(c,c.status,b)}}},c.open(d.type,d.url,!0),"binary"==d.dataType&&(c.responseType="arraybuffer"),c.send(d.data)},addPendingDependency:function(a,b,c){var d={libraries:a,onsuccess:b,onerror:c,notified:!1};this._pendingCallbacks.push(d)},resolveLibrary:function(a){if(a.status===l||a.status===p)return a.status;for(var b=a.status===o,c=0;c<a.dependencies.length&&b;c++){var d=a.dependencies[c],f=this._libraryKey(d),g=this._libraryStates[f],h=this.resolveLibrary(g);if(h===p)return a.status=p,a.status;h!==l&&(b=!1)}if(b){var i=new e(this._creativePlatformEnvironment,a.library.id,a.library.version);this._creativePlatformEnvironment.loadLibrary(i)?(a.status=l,a.exports=this._creativePlatformEnvironment.libraryExports(a.library.id,a.library.version)):a.status=p}return a.status},resolveLibraries:function(){for(var a in this._libraryStates){var b=this._libraryStates[a];this.resolveLibrary(b)}},evaluatePendingDependencies:function(){this.resolveLibraries();for(var a=[],b=0;b<this._pendingCallbacks.length;b++){for(var d=this._pendingCallbacks[b],e=d.libraries,f=!0,g=[],h=0;h<e.length;h++){var i=e[h],j=this._libraryStates[this._libraryKey(i)];if(void 0===j)f=!1;else{if(j.status===p){if(d.onerror){c.error("Runtime: Notifying client of require failure.");var k=this._creativePlatformEnvironment.getVariable(["callbacks","panic"]);k&&k("Failed to load library ("+i.id+") version ("+i.version+")!"),d.onerror()}d.notified=!0;break}j.status===l?g.push(j.exports):f=!1}}f?d.notified||(d.onsuccess&&(c.log("Runtime: Notifying client of require success."),d.onsuccess.apply(window,g)),d.notified=!0):a.push(d)}return this._pendingCallbacks=a,this._pendingCallbacks.length},requestLibrary:function(a){var b=this._libraryKey(a),d=this._libraryStates[b];if(void 0===d){var d={status:m,dependencies:[],library:a};this._libraryStates[b]=d;var e=function(a,b){return function(d,e,f){c.error("Runtime: Failed to download library dependencies for ("+a.id+") version ("+a.version+")"),b._libraryStates[b._libraryKey(a)].status=p,b.evaluatePendingDependencies()}}(a,this),f=function(a,b){return function(d,e,f){c.log("Runtime: Received dependencies for ("+a.id+") version ("+a.version+")");var g=b._libraryKey(a);b._libraryStates[g].dependencies=d.libraries,b._libraryStates[g].status=n;for(var h=0;h<d.libraries.length;h++){var i=d.libraries[h];b.requestLibrary(i)}var j=function(a,b){return function(d,e,f){c.error("Runtime: Failed to download library script for ("+a.id+") version ("+a.version+")"),b._libraryStates[b._libraryKey(a)].status=p,b.evaluatePendingDependencies()}}(a,b),k=function(a,b){return function(d,e,f){c.log("Runtime: Received library script for ("+a.id+") version ("+a.version+")"),b._libraryStates[b._libraryKey(a)].status=o,b.evaluatePendingDependencies()}}(a,b),l=b._creativePlatformEnvironment.getVariable(["target"]),m=b._creativePlatformEnvironment.getVariable(["resources","minified"],!0),q=m?"/library.min.js":"/library.js";l&&(q=q+"?target="+l);var r=b._creativePlatformEnvironment.getVariable(["urls","api"])+"/libraries/"+a.id+"/"+a.version+q;b._ajax({url:r,type:"GET",dataType:"script",retryOnError:!0,success:k,error:j})}}(a,this),g=this._creativePlatformEnvironment.getVariable(["urls","api"])+"/libraries/"+a.id+"/"+a.version+"/dependencies";this._ajax({url:g,dataType:"json",type:"GET",retryOnError:!0,success:f,error:e})}},_rpcSerializer:function(){return{parse:function(a){for(var b={},c=Object.keys(a),d=c.length,e=0;d>e;e++){var f=a[c[e]];if("string"==typeof f)b[c[e]]=JSON.parse(f);else if(void 0===f)b[c[e]]=null;else if(f._dataView){var g;try{g=new Blob([f._dataView])}catch(h){"InvalidStateError"==h.name&&(g=new Blob([f._dataView.buffer]))}f.fileURL=URL.createObjectURL(g),delete f._dataView,b[c[e]]=f}}return b},stringify:function(a,b){for(var c={},d=Object.keys(a),e=d.length,f=[],g=0;e>g;g++){var h=a[d[g]];if(h instanceof t){var i={key:d[g],value:h};f.push(i)}else c[d[g]]=JSON.stringify(h)}var j=f.length;if(0===j)return b(c),void 0;for(var k=function(a,d,e){return function(f){var g=d.toJSON();delete g.fileURL,g._dataView=f,c[a]=g,j===e+1&&b(c)}},g=0;j>g;g++){var l=f[g].value,m=f[g].key;l.readAsDataView(k(m,l,g))}}}},_getRpc:function(){return this._rpc||(this._rpc=new b.Rpc({remote:this._creativePlatformEnvironment.getVariable(["urls","api"])+"/sandbox",lazy:!1,props:{frameborder:"0",width:"0",height:"0",tabindex:"-1",title:"empty",hidden:"true",style:{position:"absolute",top:"-2000px",left:"0px",display:"none"}}},{remote:{executeInSandbox:{},reloadInSandbox:{}},serializer:{parse:function(a){return a},stringify:function(a){return a}}})),this._rpc},_require:function(a,b,c){this.addPendingDependency(a,b,c);var d=this.evaluatePendingDependencies();if(d>0)for(var e=0;e<a.length;e++)this.requestLibrary(a[e])},_reload:function(a,b,c){var d=this._libraryKey(a),e=this._libraryStates[d];e?(delete this._libraryStates[d],this._require(a,b,c)):c&&c()},_execute:function(a,b,d){function e(a,b){if(b){var c={error:{exception:{description:a}}};b(c)}}b=b||function(){},d=d||function(){};var f=function(a,f){return function(){var g=!1,h=function(){g||(g=!0,d.apply(this,arguments))},i=function(){g||(g=!0,b.apply(this,arguments))};if(!f)return e("The payload is undefined",h),void 0;try{var j=function(){var b={},d=a.getVariable(["outcomes","panic"]);d&&(c.log("Panic Exit: "+d),b.error=d+"\n");var e=a.getVariable(["outcomes","logs"]);e&&e.length>0&&(b.log=e.join("\n")+"\n");var f=a.getVariable(["outcomes","warnings"]);f&&f.length>0&&(b.warning=f.join("\n")+"\n");var g=a.getVariable(["outcomes","points"]);if(g&&g.length>0){for(var h=[],i,j=0,k=g.length;k>j;j++)i="P "+g[j].join(" "),h.push(i);b.debug=h.join("\n")+"\n"}var l=a.getVariable(["outcomes","lines"]);if(l&&l.length>0){b.debug=b.debug||"";for(var m=[],i,j=0,k=l.length;k>j;j++)i="L "+l[j].join(" "),m.push(i);b.debug+=m.join("\n")+"\n"}var n=a.getVariable(["outcomes","triangles"]);if(n&&n.length>0){b.debug=b.debug||"";for(var o=[],i,j=0,k=n.length;k>j;j++)i="T "+n[j].join(" "),o.push(i);b.debug+=o.join("\n")+"\n"}return b};a.setVariable(["callbacks","panic"],function(a,b){var c=b?b:new Error(a),d=j();d.error=a,d.stack=c.stack,d.exception=c.exception;var e={status:400,error:d};h(e)});var k=a.libraryExports(f.id,f.version);if(!k)return e("Failed to execute the library ("+f.id+","+f.version+")",h),void 0;for(var l=f.executionMethod,m=f.executionAsynchronous,n=f.scope||[],o=k,p=0;p<n.length&&o;p++){var q=n[p],r=q.symbol;if(o=q.symbolIsMethod&&"function"==typeof o[r]?o[r]():o[r],0==p){var s=a.getVariable(["proxies",q.symbol]);s&&(o=s(o))}}if(o&&"function"!=typeof o[l])return e("Missing execution method",h),void 0;if(f.environment){var t=f.environment;for(var u in t)a.setVariable([u],t[u])}var v=f.executionParams||{},w=function(a){var b={};void 0!==a&&(a&&"function"==typeof a.toJSON?b=a.toJSON():b.output=a),b.info=j(),i(b)};if(m){var x;if(x=f.executionParams?o[l](v,w):o[l](w),void 0!==x){var y=a.getVariable(["outcomes","warnings"],[]),z="Unexpected value returned by "+l+"(";f.executionParams&&(z+="params, "),z+="callback).  The callback should be used for asynchronous functions.",y.push(z)}}else{var x=o[l](v);w(x)}return}catch(A){var B=a.getVariable(["callbacks","panic"]);B&&B("Failed to execute the library",A)}}}(this._creativePlatformEnvironment,a),g=function(a){return function(){e("Failed to load library ("+a.id+","+a.version+")",d)}}(a),h={id:a.id,version:a.version};this._require([h],f,g)}};var r=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new q}),Object.defineProperty(this,"environment",{enumerable:!1,configurable:!1,value:this._impl._creativePlatformEnvironment})};r.prototype={require:function(a,b,c){this._impl._require(a,b,c)},loadLibrary:function(a){var b=new e(this.environment,a.id,a.version);return this.environment.loadLibrary(b)?!0:!1},findLibrary:function(a){return this.environment.findLibrary(a)},reload:function(a,b,c){b=b||function(){},c=c||function(){},this._impl._getRpc().reloadInSandbox(a,b,c)},execute:function(a,b,c){if(b=b||function(){},c=c||function(){},a&&a.executionParams){var d=this,e=!1,f=a.scope;f&&f.length>0&&(e="shapeConfigurator"===f[0].symbol||"shapeModifier"===f[0].symbol),e?this.rpcSerializer().stringify(a.executionParams.params,function(e){delete a.executionParams.params,d.rpcSerializer().stringify(a.executionParams,function(f){f.params=e,a.executionParams=f,d._impl._getRpc().executeInSandbox(a,b,c)})}):this.rpcSerializer().stringify(a.executionParams,function(e){a.executionParams=e,d._impl._getRpc().executeInSandbox(a,b,c)})}else this._impl._getRpc().executeInSandbox(a,b,c)},canExecute:function(a,b){if("function"==typeof b){var c=function(a,c,d){var e=a.modules;if(!e)return b(!0),void 0;for(var f=0,g=e.length;g>f;f++)if(e[f].optional!==!0)return b(!1),void 0;b(!0)},d=function(a,c,d){b(!1)},e=this.environment.getVariable(["urls","api"])+"/libraries/"+a.id+"/"+a.version+"/dependencies";this._impl._ajax({url:e,type:"GET",dataType:"json",success:c,error:d})}},createFile:function(a){return new t(a)},rpcSerializer:function(){return this._impl._rpcSerializer()}};var s=function(a){this._json=JSON.parse(JSON.stringify(a)),this._url=a.url,this._fileURL=a.fileURL,this._regex=/\/[^\/^-]*-([^\/]*\.\w*)\/\d/,this._name=a.name,this._dataViewResponse=void 0,this._text=void 0};s.prototype={_nameFromURL:function(){var a;return this._url&&(a=this._regex.exec(this._url),a&&a.length>1?a=decodeURIComponent(a[1]):(a=this._url.substring(this._url.lastIndexOf("/")+1),a=decodeURIComponent(a))),a},_namefromFile:function(){return this._fileURL.substring(this._fileURL.lastIndexOf("#")+1)},name:function(){return this._name||(this._name=this._fileURL?decodeURIComponent(this._namefromFile()):decodeURIComponent(this._nameFromURL())),this._name},_readURLAsDataView:function(b,c){if(this._dataViewResponse)return b(new DataView(this._dataViewResponse)),void 0;c=c||this._url;var d=this,e=function(a,c,e){a&&(d._dataViewResponse=a,b(new DataView(d._dataViewResponse)))},f=function(a,c,d){b(void 0)};if(!a.creativePlatformRuntime)return b(void 0),void 0;var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(a){200==this.status||0===this.status&&this.response?e(this.response):f(this.response)},g.send()},_readURLAsText:function(b,c){if(this._text)return b(this._text),void 0;c=c||this._url;var d=this,e=function(a,c,e){d._text=a,b(a)},f=function(a,c,d){b(void 0)};if(!a.creativePlatformRuntime)return b(void 0),void 0;var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="text",g.onload=function(a){200==this.status||0===this.status&&this.response?e(this.response):f(this.response)},g.send()},_readLocalFileAsDataView:function(a){this._readURLAsDataView(a,this._fileURL)},_readLocalFileAsText:function(a){this._readURLAsText(a,this._fileURL)},readAsDataView:function(a){this._fileURL?this._readLocalFileAsDataView(a):this._readURLAsDataView(a)},readAsText:function(a){this._fileURL?this._readLocalFileAsText(a):this._readURLAsText(a)},toJSON:function(){var a=JSON.parse(JSON.stringify(this._json));return a.url&&a.url.length>0&&delete a.fileURL,a}};var t=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new s(a)}),Object.defineProperty(this,"name",{writable:!1,enumerable:!0,configurable:!1,value:this._impl.name()})};t.prototype={readAsText:function(a){this._impl.readAsText(a)},readAsDataView:function(a){this._impl.readAsDataView(a)},toJSON:function(){return this._impl.toJSON()}},a.creativePlatformRuntime=new r,a.creativePlatformRuntime.environment.setVariable(["parameters","file","deserializer"],function(a){return a?a instanceof t?a:new t(a):void 0})};d(void 0,void 0)}("undefined"==typeof k?window:k);var l=k.creativePlatformRuntime;l.environment.setVariable(["disconnected","enabled"],!0),l.environment.setVariable(["resources","root"],"./");var m=[];m.push({id:"1vxKXGNaLtr",version:0}),m.push({id:"aZS9YbvfqUX",version:0}),m.push({id:"c0HjtqUm7Wz",version:0}),m.push({id:"0vW3XxB8WwN",version:0}),m.push({id:"aLVZT9dTtGG",version:0}),m.push({id:"cTLKjc2L7R7",version:4}),l.environment.setVariable(["runtime","libraries"],m);for(var n=0;n<a.length;n++)l.environment.setVariable(a[n].key,a[n].value);!function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(a,c){function d(b){var c=a.getVariable(["execution","scale"]);if(c&&Array.isArray(c)&&3===c.length){var d=0;d=c[0]>d?c[0]:d,d=c[1]>d?c[1]:d,d=c[2]>d?c[2]:d,0==d&&(d=1),d>100&&(d=100),1e-4>d&&(d=1e-4),b/=d}return b}function e(){var b=a.getVariable(["execution","tessTolerance"]);return void 0===b&&(b=d(.05),a.setVariable(["execution","tessTolerance"],b)),b}function f(a,b){return Math.abs(a-b)<1e-6}function g(a,b){"function"==typeof a?(a.prototype.toString=function(){return b},a.toString=function(){return""},a.toLocaleString=function(){return""},a.toValue=function(){return""}):"object"==typeof a&&(a.toString=function(){return b})}function i(a,b,c,d){d=d||function(){},Array.isArray(c)||(c=[c]);var e=[];b._impl._isWindingOrderCorrect()||e.push("source mesh");for(var f=0;f<c.length;f++)c[f]instanceof R||hb.panic(A),c[f]._impl._isWindingOrderCorrect()||e.push("meshes["+f+"]");if(e.length>0){var g="Inward pointing normals detected by right hand rule on meshes ("+e.join(",")+").";hb.warning(g)}for(var h=j(b),i,k=0;k<c.length;k++)i=j(c[k]),h=h[a](i);var m=l(h);m=V.repair(m,[U.NONMANIFOLD_EDGES]),d(m)}function j(a){if(void 0!==a.attributes.bsp&&void 0!==a.attributes.bsp.data)return a.attributes.bsp.data;void 0===a.attributes.bsp&&a.change.bind(m);var b=k(a),c={data:b};return a.attributes.bsp=c,b}function k(a){function b(a,b){var c=[e[3*a],e[3*a+1],e[3*a+2]];return new h.Vertex(c,b)}function c(a){var b=3*d[3*a],c=3*d[3*a+1],f=3*d[3*a+2],g=[e[b],e[b+1],e[b+2]],i=[e[c],e[c+1],e[c+2]],j=[e[f],e[f+1],e[f+2]],k=new h.Vector([i[0]-g[0],i[1]-g[1],i[2]-g[2]]),l=new h.Vector([j[0]-g[0],j[1]-g[1],j[2]-g[2]]),m=k.cross(l).unit();return m}for(var d=a._impl._triangles,e=a._impl._vertices,f=d.length/3,g=[],i,j=0;f>j;j++)i=c(j),g.push(new h.Polygon([b(d[3*j],i),b(d[3*j+1],i),b(d[3*j+2],i)]));var k=h.fromPolygons(g);return k}function l(a){function b(a){var b=a.pos;return[b.x,b.y,b.z]}for(var c=a.toPolygons(),d=new R,e,f,g=0,h=c.length;h>g;g++){e=c[g].vertices,f=e[0];for(var i=1,j=e.length-1;j>i;i++)d.triangle(b(f),b(e[i]),b(e[i+1]))}var k={data:a};return d.attributes.bsp=k,d}function m(a){if(a.data instanceof R){var b=a.data;delete b.attributes.bsp.data}}function n(a){if(a.data instanceof R){var b=a.data;delete b.attributes.edges.data}}function o(a){if(a.data instanceof R){var b=a.data;delete b.attributes.bounds.data}}function p(a){if(a.data instanceof R){var b=a.data;delete b.attributes.boundaries.data}}function q(){if(!lb){var b=a.module("tess");lb=b?b.Tess2:D.Tess2}return lb}function r(a,b){a&&(this._type=a,this._listeners=[],b&&(this._target=b))}function s(){this._type=void 0,this._target=void 0,this._data=void 0,this._bubbles=!0,this._cancelable=!0,this._timeStamp=new Date,this._originalEvent=void 0,Object.defineProperty(this,"target",{get:function(){return this._target},enumerable:!0}),Object.defineProperty(this,"type",{get:function(){return this._type},enumerable:!0}),Object.defineProperty(this,"data",{get:function(){return this._data},enumerable:!0}),Object.defineProperty(this,"bubbles",{get:function(){return this._bubbles},enumerable:!0}),Object.defineProperty(this,"cancelable",{get:function(){return this._cancelable},enumerable:!0}),Object.defineProperty(this,"timestamp",{get:function(){return this._timeStamp},enumerable:!0}),Object.defineProperty(this,"originalEvent",{get:function(){return this._originalEvent},enumerable:!0})}function t(a){var b=["parameters","presets","evaluate","preview","validate","configuration","randomize"];E.call(this,a,b)}function u(a){var b=["parameters","presets","evaluate","validate","configuration","randomize","shape"];E.call(this,a,b)}function v(a){var b=["parameters","evaluate"];E.call(this,a,b)}function w(a,b){this._localToParent=a,this._mesh=b}function x(a,b){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,value:new w(a,b)})}var y=a.module("libxmljs"),z={exports:{}};c&&(c.name="Autodesk Creative Platform Core",c.description="A broad and deep collection of 2D and 3D capabilities.",c.resources=[{id:"5HOLk65hYHM",name:"coordinate-system.png"},{id:"aqswKA2Js3T",name:"parameters.png"},{id:"1Ljg7qh9Htg",name:"cluster.png"},{id:"4QkaJCDf4Nr",name:"heart-from-canvas-flipped.png"},{id:"68mj4nuVDoF",name:"heart-from-canvas.png"},{id:"2vFXsCHSe8E",name:"customshape-category.png"},{id:"37BkpbF00y8",name:"cube-scripteditor.png"},{id:"hQf8B2vTnJl",name:"cube-twisted.png"},{id:"gWtIZlhXWAG",name:"cube.png"},{id:"finmSeq29y0",name:"customshape-scripteditor.png"},{id:"kXvMrBkvNoO",name:"dodecahedron-construction.png"},{id:"dTpcHUm02yH",name:"dodecahedron-debug-lines.png"},{id:"l3ErqZsE910",name:"icosahedron-scripteditor.png"},{id:"f6qkzuAn2y6",name:"matrix2.gif"},{id:"6EbpqJbk3mZ",name:"matrix2elements.gif"},{id:"jLuUMPvxtvG",name:"matrix2rotation.gif"},{id:"honrGXc4E23",name:"matrix3.gif"},{id:"cW9G5w4CcBC",name:"matrix3elements.gif"},{id:"fL2nQccUud5",name:"octahedron.png"},{id:"dAXPZiN9Pzy",name:"platonic-family-portrait.png"},{id:"9zV30z4SvN9",name:"platonics-2rows.png"},{id:"4Ah9qJ8FCt8",name:"pythagorean.gif"},{id:"859QAaOn3Kd",name:"scripteditor-examples-menu.png"},{id:"g7MbBXP3cDP",name:"sphere-lod1.png"},{id:"2gKfcIjNPha",name:"tetrahedron-editor-params.png"},{id:"cM4B529Vgm2",name:"tetrahedron-params.png"},{id:"5W1bX8Vy3GB",name:"tetrahedron.png"},{id:"bTp5dwuGwii",name:"bridge_boundaries_origin.png"},{id:"khlYlzcmmMu",name:"bridge_boundaries_result.png"},{id:"0iySnPeGQBZ",name:"debug_triangles.png"}]);var A="Unexpected arguments. Please refer to documentation.",B=function(){var b=a.getVariable(["execution","weldThreshold"]);return void 0===b&&(b=d(1e-5),a.setVariable(["execution","weldThreshold"],b)),b},C={};c.exports.Conversions=C,g(C,"Conversions");var D="undefined"==typeof window?z.exports:window,E=function(a,b){this._original=a,a&&b&&b.forEach(function(b){a[b]&&(this["_"+b]||(this["_"+b]=function(){this._original[b].apply(this._original,arguments)}),this[b]=this["_"+b])},this),this._parameterDefinitions=void 0};E.prototype={_validateParameters:function(a){var b={id:!0,displayName:!0,displayIcon:!1,type:!0,validate:!1,invalid:!1,visible:!1,"default":!0},c={bool:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},"int":{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},"float":{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},length:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1,displayUnit:!1},angle:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},list:{listValues:!0,listLabels:!1,listImages:!1,listClasses:!1,pageSize:!1},sketch:{},string:{singleLine:!1,maxLength:!1},file:{accept:!0,config:!1,maxSize:!1,"default":!1}};for(var d in c)for(var e in b)void 0===c[d][e]&&(c[d][e]=b[e]);a instanceof Array&&a.forEach(function(a){var b=c[a.type];if(void 0===b)hb.panic("Unknown Parameter Type: ["+a.type+"].  Valid types are: "+Object.keys(c));else{for(var d in b)!0===b[d]&&void 0===a[d]&&hb.panic("Required Attribute ["+d+"] missing for parameter ["+(a.id||a.displayName)+"]");for(var d in a)void 0===b[d]&&hb.panic("Unrecognized Attribute ["+d+"] defined for parameter ["+(a.id||a.displayName)+"].  Valid attributes are: "+Object.keys(b))}})},_deserializeParameters:function(b,c){b.forEach(function(b){var d=a.getVariable(["parameters",b.type,"deserializer"]);if(d)try{c[b.id]=d(c[b.id])}catch(e){hb.warning("A problem occurred while deserializing parameter ["+b.id+"]")}})},_unpackParameters:function(a,c){if(this._original.parameters)if(void 0===this._parameterDefinitions){b.log("Fetching Parameter Definitions");var d=this;this._parameters(function(b){d._parameterDefinitions=b,d._deserializeParameters(d._parameterDefinitions,a),c(a)})}else b.log("Re-using Parameter Definitions"),this._deserializeParameters(this._parameterDefinitions,a),c(a);else c(a)},_parameters:function(a){var b=this;b._original.parameters(function(c){b._validateParameters(c),a(c)})}};var F=["presets","evaluate","preview","validate","configuration","randomize"];if(F.forEach(function(a){E.prototype["_"+a]=function(){this._original[a].apply(this._original,arguments)}}),g(E,"BaseProxy"),!y&&"undefined"!=typeof window){var G={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},H=function(a){this.domDocument=a
};H.prototype={root:function(){if(this.domDocument.hasChildNodes())for(var a=this.domDocument.childNodes,b,c=0;c<a.length;c++)if(b=a[c],b.nodeType===G.ELEMENT_NODE)return new J(b);return void 0},get:function(a,b){var c=this.domDocument,d=this.domDocument,e=c.evaluate(a,d,function(a){return b},XPathResult.ANY_TYPE,null),f=e.iterateNext();return f?new J(f):void 0},toString:function(){return XMLSerializer?(new XMLSerializer).serializeToString(this.domDocument):""}};var I=function(a){this.nsuri=a};I.prototype={href:function(){return this.nsuri}};var J=function(a){this.domElement=a};J.prototype={name:function(){return this.domElement.nodeName},type:function(){var a=G;switch(this.domElement.nodeType){case a.ELEMENT_NODE:return"element";case a.ATTRIBUTE_NODE:return"attribute";case a.TEXT_NODE:return"text";case a.CDATA_SECTION_NODE:return"cdata";case a.ENTITY_REFERENCE_NODE:return"entity_ref";case a.ENTITY_NODE:return"entity";case a.PROCESSING_INSTRUCTION_NODE:return"pi";case a.COMMENT_NODE:return"comment";case a.DOCUMENT_NODE:return"document";case a.DOCUMENT_TYPE_NODE:return"document_type";case a.DOCUMENT_FRAGMENT_NODE:return"document_frag";case a.NOTATION_NODE:return"notation"}return""},childNodes:function(){for(var a=[],b=this.domElement.childNodes,c=0,d=b.length;d>c;c++)a.push(new J(b[c]));return a},attrs:function(){for(var a=[],b=this.domElement.attributes,c=0,d=b.length;d>c;c++)a.push(new K(b[c]));return a},attr:function(){if(1===arguments.length){var a=arguments[0];if("object"==typeof a){for(var b in a)this.domElement.setAttribute(b,a[b]);return this}if("string"==typeof a)return this.domElement.getAttribute(a)}else if(2===arguments.length){var c=arguments[0],d=arguments[1];return this.domElement.setAttribute(c,d),this}},node:function(a){var b=this.domElement.ownerDocument,c=b.createElement(a);return this.domElement.appendChild(c),new J(c)},addChild:function(a){return this.domElement.appendChild(a.domElement),this},text:function(){return 0===arguments.length?this.domElement.textContent:(this.domElement.textContent=arguments[0].toString(),this)},namespace:function(){var a=this.domElement.namespaceURI;return new I(a)},get:function(a,b){var c=this.domElement.ownerDocument,d=this.domElement,e=c.evaluate(a,d,function(a){return b},XPathResult.ANY_TYPE,null),f=e.iterateNext();return f?new J(f):void 0}};var K=function(a){this.domAttribute=a};K.prototype={name:function(){return this.domAttribute.name},value:function(){return this.domAttribute.value}};var L=function(){this.domParser=null,window&&window.DOMParser&&(this.domParser=new window.DOMParser)};L.prototype={parseXml:function(a){if(this.domParser){a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var b=this.domParser.parseFromString(a,"text/xml");return new H(b)}return void 0}},y=new L}var M=function(){};M.prototype={debug:function(){}};var N={_logBuffer:a.getVariable(["outcomes","logs"],[]),_pointBuffer:a.getVariable(["outcomes","points"],[]),_lineBuffer:a.getVariable(["outcomes","lines"],[]),_trianglesBuffer:a.getVariable(["outcomes","triangles"],[]),_currentColor:[.9,.25,.15,1],_setColor:function(a){if(Array.isArray(a)&&4===a.length)for(var b=this._currentColor,c=0,d=0,e=a.length;e>d;d++)c=a[d],c=0>c?0:c,c=c>1?1:c,b[d]=c;return this},_addLine:function(a){if(Array.isArray(a)&&6===a.length){var b=a.concat(this._currentColor);this._lineBuffer.push(b)}return this},_addPoint:function(a){if(Array.isArray(a)&&3===a.length){var b=a.concat(this._currentColor);this._pointBuffer.push(b)}return this},_addLog:function(a){return this._logBuffer.push(a),this},_addTriangles:function(a,b){for(var c=a.length,d=b.length,e=[c,d],f=0;c>f;f++)e.push(a[f]);for(var f=0;d>f;f++)e.push(b[f]);for(var f=0,g=this._currentColor.length;g>f;f++)e.push(this._currentColor[f]);return this._trianglesBuffer.push(e),this},_hasNaN:function(a){if(!Array.isArray(a))return!1;for(var b=0,c=a.length;c>b;b++)if(isNaN(a[b]))return!0;return!1}},O={color:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];!Array.isArray(b)||3!==b.length&&4!==b.length||(a=b);break;case 3:case 4:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&(3===a.length&&a.push(1),N._setColor(a)),this},log:function(a){return a&&"function"==typeof a.toString&&N._addLog(a.toString()),this},line:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];Array.isArray(b)&&6===b.length&&(a=b);break;case 2:var c=arguments[0],d=arguments[1];Array.isArray(c)&&3===c.length&&Array.isArray(d)&&3===d.length&&(a=c.concat(d));break;case 6:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&N._addLine(a),this},show:function(a){return a&&"function"==typeof a.debug&&a.debug(),this},triangles:function(a,b){var c=a.length;if(a&&c>0)if(b=b||[],a[0]instanceof Y){for(var d=[],e=0;c>e;e++){var f=a[e];d.push(f.x,f.y,f.z)}N._addTriangles(d,b)}else N._addTriangles(a,b);return this},point:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];Array.isArray(b)&&3===b.length&&(a=b);break;case 3:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&N._addPoint(a),this}};Object.defineProperty(O,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:N}),c.exports.Debug=O,g(O,"Debug");var P={EvenOdd:0,NonZero:1,Positive:2,Negative:3,AbsGreaterOrEqualTwo:4};g(P,"WindingRule"),c.exports.WindingRule=P;var Q=function(){this._vertices=[],this._triangles=[],this._vertexSet={}};Q.prototype={_hash:function(a,b,c){var d=1/B();return Math.floor(a*d+.5)+"#"+Math.floor(b*d+.5)+"#"+Math.floor(c*d+.5)},_addVertex:function(a,b,c){var d=this._hash(a,b,c),e=this._vertexSet[d];return void 0===e&&(this._vertices.push(a,b,c),e=this._vertices.length/3-1,this._vertexSet[d]=e),e},_bounds:function(){for(var a=this._vertices,b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=-Number.MAX_VALUE,g=-Number.MAX_VALUE,h,i,j,k=0,l=a.length/3;l>k;k++)h=a[3*k],i=a[3*k+1],j=a[3*k+2],b>h?b=h:h>e&&(e=h),c>i?c=i:i>f&&(f=i),d>j?d=j:j>g&&(g=j);var m=void 0;return e>b&&f>c&&g>d&&(m=[b,c,d,e,f,g]),m},_triangleNormal:function(a,b,c){var d=3*c,e=3*a[d],f=3*a[d+1],g=3*a[d+2],h=b[e],i=b[e+1],j=b[e+2],k=b[f],l=b[f+1],m=b[f+2],n=b[g],o=b[g+1],p=b[g+2],q=k-h,r=l-i,s=m-j,t=n-h,u=o-i,v=p-j,w=r*v-s*u,x=s*t-q*v,y=q*u-r*t,z=Math.sqrt(w*w+x*x+y*y);return z>0&&(w/=z,x/=z,y/=z),[w,x,y]},_isWindingOrderCorrect:function(){function a(a){return 3&1<<a}function b(a,b,c){var d=a[b];return d?d[c]:void 0}function c(a,b,c,d){var e=a[b];e||(e=a[b]={}),e[c]=d}function d(a,b){var c=[],d=a[b];if(d)for(var e in d)c.push(d[e]);for(var e in a)a[e][b]&&c.push(a[e][b]);for(var f=[],g,h=c.length-1;h>=0;h--)g=c[h].t1,-1===f.indexOf(g)&&f.push(g),g=c[h].t2,b&&-1===f.indexOf(g)&&f.push(g);return f}for(var e=this._triangles,f=this._vertices,g={},h=e.length/3,i,j,k,l,m,n={x:Number.MIN_VALUE,v:-1},o,p,q=0;h>q;q++)for(var r=0;3>r;r++)if(j=e[3*q+r],k=e[3*q+a(r)],l=k>j?j:k,m=j>k?j:k,o=f[3*j]>f[3*k]?j:k,p=f[3*o],p>n.x&&(n.x=p,n.v=o),void 0===(i=b(g,l,m)))i={},i.t1=q,i.t1v=r,c(g,l,m,i);else{if(i.complete)return!1;if(i.t2=q,i.t2v=r,i.complete=1,e[3*i.t1+i.t1v]===e[3*i.t2+i.t2v])return!1}if(-1!==n.v){for(var s=d(g,n.v),t=new $(1,0,0),u,v,w,q=s.length-1;q>=0;q--)if(u=this._triangleNormal(e,f,s[q]),v=t.dot(u),-1e-5>v||v>1e-5){w=s[q];break}if(w){var x=3*e[3*w],y=3*e[3*w+1],z=3*e[3*w+2],A={x:(f[x]+f[y]+f[z])/3,y:(f[x+1]+f[y+1]+f[z+1])/3,z:(f[x+2]+f[y+2]+f[z+2])/3},B,C=w,D={x:1,y:0,z:0};p=A.x;for(var E=q-1;E>=0;E--){var F=3*s[E],x=3*e[F],y=3*e[F+1],z=3*e[F+2],G={x:f[x],y:f[x+1],z:f[x+2]},H={x:f[y],y:f[y+1],z:f[y+2]},I={x:f[z],y:f[z+1],z:f[z+2]};B=this._hitTriangle(A,D,G,H,I),B&&B.x>p&&(p=B.x,C=s[E])}if(u=this._triangleNormal(e,f,C),v=t.dot(u),0>v)return!1}}return!0},_addTriangle:function(a,b,c){a!==b&&b!==c&&c!==a&&this._triangles.push(a,b,c)},_removeTriangle:function(a){this._triangles.splice(3*a,3)},_hitTriangle:function(a,b,c,d,e){function g(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),c=b>0?1/b:0;a.x*=c,a.y*=c,a.z*=c}function h(a,b,c,d){var e=new $(d.x-c.x,d.y-c.y,d.z-c.z),f=new $(a.x-c.x,a.y-c.y,a.z-c.z),g=new $(b.x-c.x,b.y-c.y,b.z-c.z),h=e.cross(f),i=e.cross(g);return h.dot(i)>=0?!0:!1}var i={x:a.x,y:a.y,z:a.z},j={x:b.x+i.x,y:b.y+i.y,z:b.z+i.z},k,l,m,n,o,p,q,r={x:0,y:0,z:0},s={x:0,y:0,z:0},t={x:0,y:0,z:0},u={x:0,y:0,z:0};if(u.x=(d.y-c.y)*(e.z-c.z)-(d.z-c.z)*(e.y-c.y),u.y=(d.z-c.z)*(e.x-c.x)-(d.x-c.x)*(e.z-c.z),u.z=(d.x-c.x)*(e.y-c.y)-(d.y-c.y)*(e.x-c.x),g(u),k=-u.x*c.x-u.y*c.y-u.z*c.z,p=u.x*(j.x-i.x)+u.y*(j.y-i.y)+u.z*(j.z-i.z),f(p,0))return null;if(q=-(k+u.x*i.x+u.y*i.y+u.z*i.z)/p,0>q)return null;var v={x:0,y:0,z:0};return v.x=i.x+q*(j.x-i.x),v.y=i.y+q*(j.y-i.y),v.z=i.z+q*(j.z-i.z),h(v,e,c,d)&&h(v,c,d,e)&&h(v,d,e,c)?v:null},_bridgeBoundaries:function(a,b){function c(a,b,c,e){var g=function(a,b,c,d){b!==c&&c!==d&&d!==b&&a.push(b,c,d)},h,i,j,k;a.length>=c.length?(h=a,i=b,j=c,k=e):(h=c,i=e,j=a,k=b);var l=h.length/3,m=j.length/3,n=0,o=0,p=function(a){var b=a;return b=n>0&&a==i?i:0>=a?l-1:a-1},q=function(a){var b=a;return b=o>0&&a==k?k:a>=m-1?0:a+1},r=4,s=1/r,t=[],u=[];h.forEach(function(a){t.push(a)}),j.forEach(function(a){t.push(a)});var v=i,w=k,x=p(v),y=q(w),z=v,A=w,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]);B=3*w,C=3*y;for(var E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2]),F=l,G=0;;){var H=1;if(H=f(E,0)?f(D,0)?1:r:D/E,H>r)0!==E?g(u,F+y,F+A,G+v):(g(u,G+z,G+x,F+w),z=x,x=p(x),n++),A=y,y=q(y),o++,B=3*w,C=3*y,E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2]);else if(s>H)0!==D?g(u,G+z,G+x,F+w):(g(u,F+y,F+A,G+v),A=y,y=q(y),o++),z=x,x=p(x),n++,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]);else{B=3*z,C=3*y;var I=d(h[B],h[B+1],h[B+2],j[C],j[C+1],j[C+2]);B=3*x,C=3*A;var J=d(h[B],h[B+1],h[B+2],j[C],j[C+1],j[C+2]);I>J?(g(u,G+z,G+x,F+A),g(u,G+x,F+y,F+A)):(g(u,G+z,G+x,F+y),g(u,G+z,F+y,F+A)),v=x,w=y,z=x,x=p(x),A=y,y=q(y),n++,o++,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]),B=3*w,C=3*y,E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2])}if(n+o>l+m)break}return{vertices:t,indices:u}}var d=function(a,b,c,d,e,f){return(a-d)*(a-d)+(b-e)*(b-e)+(c-f)*(c-f)},e=function(a){var b=a.mesh._impl._vertices,c=a.vertexIndices;c[0]==c[c.length-1]&&c.pop();for(var d=[],e=0,f=c.length;f>e;e++){var g=3*c[e];d.push(b[g],b[g+1],b[g+2])}return d},g=function(a,b){for(var c=b[0],e=b[1],f=b[2],g={index:-1,distance:Number.MAX_VALUE,point:-1},h=0;h<a.length;h++)for(var i=a[h],j=0;j<i.length/3;j++){var k=3*j,l=i[k],m=i[k+1],n=i[k+2],o=d(c,e,f,l,m,n);o<=g.distance&&(g.index=h,g.distance=o,g.point=j)}return g},h=function(a,b){var c,d,e;a.length<=b.length?(c=a,d=b,e=!1):(c=b,d=a,e=!0);for(var h=[];;){if(0===c.length||0===d.length)break;var i=c.pop();if(0!==i.length){var j=g(d,i);if(!(j.index<0)){var k=d[j.index];d.splice(j.index,1),f(j.distance,0)||0!==k.length&&(e?h.push({our:k,ourIndex:j.point,their:i,theirIndex:0}):h.push({our:i,ourIndex:0,their:k,theirIndex:j.point}))}}}return h},i=a.map(function(a){return e(a)}),j=b.map(function(a){return e(a)}),k=h(i,j),l=[];return k.forEach(function(a){var b=c(a.their,a.theirIndex,a.our,a.ourIndex);l.push(b)}),l}};var R=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Q}),Object.defineProperty(this,"attributes",{writable:!1,enumerable:!0,configurable:!1,value:{}}),Object.defineProperty(this,"change",{writable:!1,enumerable:!0,configurable:!1,value:new r("changed")})};R.prototype={triangle:function(){var a=this._impl;switch(arguments.length){case 1:if(Array.isArray(arguments[0])&&9===arguments[0].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[0][3],arguments[0][4],arguments[0][5]),d=a._addVertex(arguments[0][6],arguments[0][7],arguments[0][8]);a._addTriangle(b,c,d)}else hb.panic(A);break;case 3:if(Array.isArray(arguments[0])&&3===arguments[0].length&&Array.isArray(arguments[1])&&3===arguments[1].length&&Array.isArray(arguments[2])&&3===arguments[2].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[1][0],arguments[1][1],arguments[1][2]),d=a._addVertex(arguments[2][0],arguments[2][1],arguments[2][2]);a._addTriangle(b,c,d)}else hb.panic(A);break;case 9:var b=a._addVertex(arguments[0],arguments[1],arguments[2]),c=a._addVertex(arguments[3],arguments[4],arguments[5]),d=a._addVertex(arguments[6],arguments[7],arguments[8]);a._addTriangle(b,c,d);break;default:hb.panic(A)}return this.change.fire(this),this},quad:function(){var a=this._impl;switch(arguments.length){case 1:if(Array.isArray(arguments[0])&&12===arguments[0].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[0][3],arguments[0][4],arguments[0][5]),d=a._addVertex(arguments[0][6],arguments[0][7],arguments[0][8]),e=a._addVertex(arguments[0][9],arguments[0][10],arguments[0][11]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(A);break;case 4:if(Array.isArray(arguments[0])&&3===arguments[0].length&&Array.isArray(arguments[1])&&3===arguments[1].length&&Array.isArray(arguments[2])&&3===arguments[2].length&&Array.isArray(arguments[3])&&3===arguments[3].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[1][0],arguments[1][1],arguments[1][2]),d=a._addVertex(arguments[2][0],arguments[2][1],arguments[2][2]),e=a._addVertex(arguments[3][0],arguments[3][1],arguments[3][2]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(A);break;case 12:if("number"==typeof arguments[0]&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&"number"==typeof arguments[3]&&"number"==typeof arguments[4]&&"number"==typeof arguments[5]&&"number"==typeof arguments[6]&&"number"==typeof arguments[7]&&"number"==typeof arguments[8]&&"number"==typeof arguments[9]&&"number"==typeof arguments[10]&&"number"==typeof arguments[11]){var b=a._addVertex(arguments[0],arguments[1],arguments[2]),c=a._addVertex(arguments[3],arguments[4],arguments[5]),d=a._addVertex(arguments[6],arguments[7],arguments[8]),e=a._addVertex(arguments[9],arguments[10],arguments[11]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(A);break;default:hb.panic(A)}return this.change.fire(this),this},transform:function(a){var b;Array.isArray(a)&&16===a.length?b=new ab(a):a instanceof ab?b=a:hb.panic(A),this._impl._vertexSet={};for(var c=b.elements,d=this._impl,e=d._vertices.length/3,f,g,h,i,j,k,l,m,n=0;e>n;n++)l=3*n,f=d._vertices[l],g=d._vertices[l+1],h=d._vertices[l+2],i=f*c[0]+g*c[4]+h*c[8]+c[12],j=f*c[1]+g*c[5]+h*c[9]+c[13],k=f*c[2]+g*c[6]+h*c[10]+c[14],d._vertices[l]=i,d._vertices[l+1]=j,d._vertices[l+2]=k,m=d._hash(i,j,k),d._vertexSet[m]=n;return this.change.fire(this),this},indexedTriangles:function(a,b){if(Array.isArray(a)&&Array.isArray(b)&&0===a.length%3&&0===b.length%3){for(var c=this._impl,d=a.length,e=b.length,f=[],g=0,h=0;d>g;g+=3,h++){var i=c._addVertex(a[g],a[g+1],a[g+2]);f[h]=i}for(var j=f.length,k=0;e>k;k++){var l=b[k];(l>j-1||0>l)&&hb.panic("The vertex index is out of range"),c._triangles.push(f[l])}}else hb.panic(A);return this.change.fire(this),this},combine:function(a){Array.isArray(a)||(a=[a]);for(var b,c=0;c<a.length;c++)b=a[c],b instanceof R||hb.panic("The supplied data meshes["+c+"] is not a Mesh3D object."),this.indexedTriangles(b._impl._vertices,b._impl._triangles);return this.change.fire(this),this},flipNormals:function(){for(var a=this._impl._triangles,b=a.length,c=0;b>c;c+=3){var d=a[c+1];a[c+1]=a[c+2],a[c+2]=d}return this},clone:function(){var a=new R,b=this._impl._triangles,c=this._impl._vertices,d=this._impl._vertexSet;a._impl._triangles=b.slice(0),a._impl._vertices=c.slice(0);var e=a._impl._vertexSet;for(var f in d)e[f]=d[f];return a},unite:function(a,b){return i("union",this,a,b)},subtract:function(a,b){return i("subtract",this,a,b)},intersect:function(a,b){return i("intersect",this,a,b)},edges:function(){if(void 0!==this.attributes.edges&&void 0!==this.attributes.edges.data)return this.attributes.edges.data;void 0===this.attributes.edges&&this.change.bind(n);var a=[],b=new $,c=new $,d=function(a){var d={edge:a,marked:!1},e=a.sym;if(e)if(S.isPositiveEdge(a))if(e.faces.length>1||a.faces.length>1)d.marked=!0;else{var f=a.faces[0],g=e.faces[0],h=a.body.mesh._impl,i=h._triangleNormal(h._triangles,h._vertices,f),j=h._triangleNormal(h._triangles,h._vertices,g);b.x=i[0],b.y=i[1],b.z=i[2],c.x=j[0],c.y=j[1],c.z=j[2];var k=.819152;b.dot(c)<k&&(d.marked=!0)}else d.marked=!1;else d.marked=!0;return d},e=function(b){b.marked&&a.push(b.edge.v0,b.edge.v1)},f=S.body(this);S.eachEdge(f,S.filterObject(d,e));var g={data:a};return this.attributes.edges=g,a},bounds:function(){if(void 0!==this.attributes.bounds&&void 0!==this.attributes.bounds.data)return this.attributes.bounds.data;void 0===this.attributes.bounds&&this.change.bind(o);var a=this._impl._bounds(),b=void 0;if(a){b=new ob(new Y(a[0],a[1],a[2]),new Y(a[3],a[4],a[5]));var c={data:b};this.attributes.bounds=c}return b},boundaries:function(){if(void 0!==this.attributes.boundaries&&void 0!==this.attributes.boundaries.data)return O.log("cached boundaries data is used"),this.attributes.boundaries.data;void 0===this.attributes.boundaries&&this.change.bind(p);var a=[],b=function(a){var b={edge:a,marked:!1},c=a.sym;return c||(b.marked=!0),b},c=function(b){b.marked&&a.push({v0:b.edge.v0,v1:b.edge.v1})},d=S.body(this);S.eachEdge(d,S.filterObject(b,c));var e=S.edgeBoundaries(d,a),f={data:e};return this.attributes.boundaries=f,e},boundariesByTriangles:function(a){var b=this._impl._vertices,c=this._impl._triangles,d=new R;d._impl._vertices=b.slice(0),d._impl._triangles=[];for(var e=0,f=a.length;f>e;e++){var g=3*a[e];d._impl._triangles.push(c[g],c[g+1],c[g+2])}var h=d.boundaries();return h},trianglesByTriangle:function(a,b){b=b?!0:!1;var c=this._impl._triangles,d=3*a,e={};e[c[d]]=!0,e[c[d+1]]=!0,e[c[d+2]]=!0;var f=S.body(this),g={},h=function(a){g[a]=!0;for(var d=3*a,i=[c[d],c[d+1],c[d+2]],j=2,k=0;3>k;j=k++){var l=i[j],m=i[k],n=e[l],o=e[m],p=b&&n&&o||!b&&(n||o);if(p){var q=S.edgeOfVertices(f,l,m),r=S.edgeOfVertices(f,m,l),s=[];q&&s.push.apply(s,q.faces),r&&s.push.apply(s,r.faces),s.forEach(function(a){g[a]||h(a)})}}};return h(a),delete g[a],Object.keys(g)},trianglesByVertex:function(a){var b=[],c={},d=function(b){var c={edge:b,marked:!1},d=b.sym;return d&&b.v0===a?c.marked=!0:d||b.v1!==a&&b.v0!==a||(c.marked=!0),c},e=function(a){a.marked&&a.edge.faces.forEach(function(a){c[a]||b.push(a),c[a]=!0})},f=S.body(this);return S.eachEdge(f,S.filterObject(d,e)),b},trianglesByEdge:function(a,b){var c=S.body(this),d=S.edgeOfVertices(c,a,b);return d?d.faces:[]},vertexByIndex:function(a){var b=this._impl._vertices;if(a>=b.length/3)return void 0;var c=3*a;return[b[c],b[c+1],b[c+2]]},triangleByIndex:function(a){var b=this._impl._triangles;if(a>=b.length/3)return void 0;var c=3*a,d=[b[c],b[c+1],b[c+2]];return d},select:function(a){var b=function(a,b){return a.distance-b.distance};if(!a||!a.ray)return null;for(var c=[],d=a.ray,e=d.origin,f=d.direction,g=this._impl._triangles,h=this._impl._vertices,i=[],j=0,k=h.length;k>j;j+=3){var l={x:h[j],y:h[j+1],z:h[j+2]};i.push(l)}for(var j=0,m=g.length;m>j;j+=3){var n=g[j],o=g[j+1],p=g[j+2],q=this._impl._hitTriangle(e,f,i[n],i[o],i[p]);if(q){var r=(q.x-e.x)*(q.x-e.x)+(q.y-e.y)*(q.y-e.y)+(q.z-e.z)*(q.z-e.z);c.push({triangle:j/3,point:q,distance:r})}}if(0===c.length)return null;c.sort(b);var s=c[0],t=new tb(this,[s.triangle]);return t.distance=Math.sqrt(s.distance),t.collision=new Y(s.point.x,s.point.y,s.point.z),t.selector=a,a.selections.push(t),t},removeTriangles:function(a){var b=a.triangleIndices.slice(0);b.sort(function(a,b){return a-b});for(var c=b.length-1;c>=0;c--)this._impl._removeTriangle(b[c]);this.change.fire(this)},combineByBoundaries:function(a,b){if(!a)return O.panic("Another mesh is empty."),this;if(this.combine([a]),!b)return O.log("Neither ours and theirs is supplied, this function will fallback to combine."),this;var c=b.ours||[],d=b.theirs||[];if(0===c.length&&0===d.length)return O.log("Neither ours and theirs is supplied, this function will fallback to combine."),this;if(d=0===d.length?a.boundaries():d,0===d.length)return this;var e=this._impl._bridgeBoundaries(c,d),f=this;return e.forEach(function(a){f.indexedTriangles(a.vertices,a.indices)}),this.change.fire(this),this},triangles:function(){return this._impl._triangles.slice(0)},toJSON:function(){var a={};return a.vertices=this._impl._vertices,a.triangles=this._impl._triangles,a},debug:function(){O.triangles(this._impl._vertices,this._impl._triangles)}};var S={body:function(a){if(void 0!==a.attributes.body&&void 0!==a.attributes.body.data)return a.attributes.body.data;void 0===a.attributes.body&&a.change.bind(this._bodyCacheHandler);var b=this._makeBody(a),c={data:b};return a.attributes.body=c,b},filterObject:function(a,b){var c={filter:a,callback:b};return c},eachEdge:function(a,b){var c=a.edgeHash,d=Object.keys(c);d.forEach(function(a){var d=c[a],e=b.filter,f=b.callback,g=e(d);f(g)})},edgeOfVertices:function(a,b,c){return a.edgeHash[this._hashOfEdge({v0:b,v1:c})]},edgeBoundaries:function(a,b){for(var c=function(a){for(var b=[],c=[];;){if(a.length<1)break;var d=[],e=a.pop();d.push(e);for(var f=!1;!f;){for(var g=!1,h=a.length-1;h>=0;h--){var i=a[h];if(i.v0===d[d.length-1].v1){a.splice(h,1),d.push(i),g=!0,i.v1===d[0].v0&&(f=!0);break}}var j=!1;if(!g){var k=d.pop();c.push(k),a.length>0&&0===d.length&&(j=!0,e=a.pop(),d.push(e))}if(0===a.length&&!j)break}b.push(d)}return b},d=c(b),e=[],f=0;f<d.length;f++){var g=d[f],h=new ub;h.mesh=a.mesh;for(var i=0;i<g.length;i++){var j=g[i];h.vertexIndices.push(j.v0)}e.push(h)}return e},isPositiveEdge:function(a){return a.v0<a.v1},_bodyCacheHandler:function(a){if(a.data instanceof R){var b=a.data;delete b.attributes.body.data}},_makeBody:function(a){var b={mesh:a,edgeHash:{}},c=b.mesh;if(!c)return null;for(var d=c._impl._vertices,e=c._impl._triangles,f=0,g=e.length;g>f;f+=3){for(var h=[e[f],e[f+1],e[f+2]],i=[],j=f/3,k=0;3>k;k++){var l=h[k],m=h[(k+1)%3],n=this._hashOfEdge({v0:l,v1:m}),o=b.edgeHash[n];if(o)o.faces.push(j);else{var o={body:b,v0:l,v1:m,sym:null,faces:[j]};b.edgeHash[n]=o}i.push(o)}for(var p=0,q=i.length;q>p;p++){var o=i[p],r=this._hashOfEdge({v0:o.v1,v1:o.v0}),s=b.edgeHash[r];o.sym=s,s&&(s.sym=o)}}return b},_hashOfEdge:function(a){var b,c,d=a.v0,e=a.v1,f=e>d;return f?(b=d,c=e):(b=e,c=d),b+"-"+c+":"+f}};g(R,"Mesh3D"),c.exports.Mesh3D=R;var T=function(){function a(a){}function b(a){}function c(a,b){return Math.abs(a-b)<1e-6}function d(a){for(var b=[],c=[],d=a._impl._triangles,e=0,f=d.length/3;f>e;e++)c.push([d[3*e],d[3*e+1],d[3*e+2]]);for(var g=a._impl._vertices,e=0,h=g.length/3;h>e;e++)b.push(new $(g[3*e],g[3*e+1],g[3*e+2]));return{faces:c,points:b}}function e(a,b,c){this.guid=a,this.p0=b,this.p1=c,this.faces=[]}function f(){this.edgeMap={}}function g(){this.idToSetMap={},this.pointToIDMap={},this.lastID=0}function h(a,b){var c=a.dot(b),d=Math.abs(Math.abs(c)-1);return 1e-5>d}function i(a,b,c){var d=b.clone().subtract(a),e=c.clone().scale(d.dot(c));return d.subtract(e).length()<1e-5}function j(b,c){var d=[],e;for(e in c){var f=c[e],g=[],j;for(j in f){var k=f[j],l=b.points[k.p0],m=b.points[k.p1],n=null,o,p;k.unitV=m.clone().subtract(l).normalize();for(var q in g){var r=g[q].p0V,s=g[q].unitV;if(h(k.unitV,s)&&i(l,r,s)){n=g[q],o=l.clone().subtract(r).dot(s),p=m.clone().subtract(r).dot(s);break}}n||(o=0,p=m.clone().subtract(l).dot(k.unitV),n={unitV:k.unitV,p0V:l,points:{}},g.push(n)),n.points[k.p0]||(n.points[k.p0]={index:k.p0,distance:o,followingEdges:[]}),n.points[k.p1]||(n.points[k.p1]={index:k.p1,distance:p,followingEdges:[]}),a(n),a(o!=p),p>o?n.points[k.p0].followingEdges.push(k):n.points[k.p1].followingEdges.push(k)}d=d.concat(g)}return d}function k(b,c){var d,e;for(d in b){e=b[d];var f=[],g;for(g in e.points)a(e.points[g].followingEdges.length<=2),f.push(e.points[g]);f.sort(function(a,b){return a.distance-b.distance});var h;for(h=0;h<f.length;++h){var i,j,k=f[h];if(k.followingEdges.length&&(1!=k.followingEdges.length||2!=k.followingEdges[0].faces.length)&&2==k.followingEdges.length){a(2==k.followingEdges.length),a(k.followingEdges[0].faces.length==k.followingEdges[1].faces.length),a(1==k.followingEdges[0].faces.length),a(h+2<f.length);var l=f[h+1],m=k.followingEdges[0],n=k.followingEdges[1];a(m.p0==k.index||m.p1==k.index),a(n.p0==k.index||n.p1==k.index),a(m.p0==l.index||m.p1==l.index||n.p0==l.index||n.p1==l.index);var o,p;n.p0==l.index||n.p1==l.index?(o=m,p=n):(o=n,p=m);var q;q=o.p0==k.index?o.p1:o.p0,a(1==o.faces.length);for(var r=o.faces[0],s=-1,t=0;t<r.length;++t){var u=(t+1)%r.length,v=r[t],w=r[u];if(!(v!=o.p0&&v!=o.p1||w!=o.p0&&w!=o.p1)){s=t;break}}a(-1!=s),r.splice(s+1,0,l.index),p.faces.push(r),k.followingEdges[0]==o?k.followingEdges.splice(0,1):(a(k.followingEdges[1]==o),k.followingEdges.splice(1,1)),a(q!=k.index);var x=c.edgeForPoints(l.index,q);x?x.faces.push(r):(x=c.addEdge(l.index,q,r),l.followingEdges.push(x)),c.deleteEdge(o)}}}}function l(b){for(var d=[],e=0;e<b.faces.length;++e){var f=b.faces[e];if(3!=f.length){a(f.length>3),f.length>4&&(f=f.slice());for(var g=[],h=0;h<f.length;++h){var i=b.points[f[h]],j=b.points[f[(h+1)%f.length]];g.push(j.clone().subtract(i).normalize())}for(var k=[],h=0;h<f.length;++h){var l=g[h].dot(g[(h+1)%g.length]);k.push(l)}for(var m=function(){for(var b=-2,d=-1,e=!1,g=0;g<f.length;++g){var h=k[g];if(-1==d||h>=b||e&&c(1,h))b=h,d=g;else if(e)return g;c(1,h)&&(e=!0)}return a(b>-1),d},n=m();f.length>3;){var o=(n+1)%f.length,p=(n+2)%f.length;d.push([f[n],f[o],f[p]]),f.splice(o,1),f.length>3&&(k.splice(o,1),n=m())}d.push(f)}else d.push(f)}return{points:b.points,faces:d}}function m(a){var c=d(a),e=new f,h;for(h in c.faces)e.addFace(c.faces[h]);var i=e.edgeList(),m=[];for(h in i){var n=i[h];2!=n.faces.length&&m.push(n)}if(!m.length)return b("Design is clean."),void 0;var o=new g,n;for(n in m)o.addEdge(m[n]);var p=o.setList(),q=j(c,p);return b("Found "+m.length+" non-manifold edge(s), "+p.length+" connected set(s), "+q.length+" individual problem sets."),k(q,e),l(c)}function n(a){var c=new Date;b("RepairNonmanifoldEdges begin: input triangles "+a._impl._triangles.length/3);var d=m(a),e;return d?(e=new R,d.faces.map(function(a,b){var c=a.map(function(a){return d.points[a]});e.triangle(c[0].x,c[0].y,c[0].z,c[1].x,c[1].y,c[1].z,c[2].x,c[2].y,c[2].z)})):e=a,b("RepairNonmanifoldEdges end: used "+(new Date-c)+" ms, output triangles "+e._impl._triangles.length/3),e}return f.prototype.edgeForGuid=function(a){return a in this.edgeMap?this.edgeMap[a]:null},f.prototype.guidForEdge=function(a,b){if(a>b){var c=a;a=b,b=c}return a+"edge"+b},f.prototype.edgeForPoints=function(a,b){return this.edgeForGuid(this.guidForEdge(a,b))},f.prototype.addFace=function(a){for(var b=0;b<a.length;++b)this.addEdge(a[b],a[(b+1)%a.length],a)},f.prototype.addEdge=function(b,c,d){a(d);var f=this.guidForEdge(b,c),g=this.edgeForGuid(f);return g||(g=this.edgeMap[f]=new e(f,b,c)),a(g.faces.length<2),g.faces.push(d),g},f.prototype.deleteEdge=function(b){var c=this.guidForEdge(b.p0,b.p1);a(c in this.edgeMap),a(b==this.edgeMap[c]),delete this.edgeMap[c]},f.prototype.edgeList=function(){var a=[];for(var b in this.edgeMap)a.push(this.edgeMap[b]);return a},g.prototype.setList=function(){var a=[];for(var b in this.idToSetMap)a.push(this.idToSetMap[b]);return a},g.prototype.newSetID=function(){return++this.lastID},g.prototype.addEdge=function(a){var b,c;a.p0 in this.pointToIDMap?(c=this.pointToIDMap[a.p0],b=this.idToSetMap[c],b.push(a),a.p1 in this.pointToIDMap?c!=this.pointToIDMap[a.p1]&&this.mergeSetsForEdge(a):this.pointToIDMap[a.p1]=c):a.p1 in this.pointToIDMap?(c=this.pointToIDMap[a.p1],b=this.idToSetMap[c],b.push(a),this.pointToIDMap[a.p0]=c):(c=this.newSetID(),this.idToSetMap[c]=[a],this.pointToIDMap[a.p0]=this.pointToIDMap[a.p1]=c)},g.prototype.mergeSetsForEdge=function(b){var c=this.pointToIDMap[b.p0],d=this.pointToIDMap[b.p1],e=this.idToSetMap[c],f=this.idToSetMap[d];for(var g in f){var h=f[g];a(this.pointToIDMap[h.p0]==c||this.pointToIDMap[h.p0]==d),this.pointToIDMap[h.p0]=c,a(this.pointToIDMap[h.p1]==c||this.pointToIDMap[h.p1]==d),this.pointToIDMap[h.p1]=c,e.push(h)}delete this.idToSetMap[d]},n}(),U={NONMANIFOLD_EDGES:1},V={repair:function(a,b){return-1!==b.indexOf(U.NONMANIFOLD_EDGES)?T(a):void 0}},W=function(a,b){this.index=a||0,this.path=b};W.prototype={remove:function(){return this.path._impl._removeCurve(this.index),this},next:function(){var a=this.path._impl._nextCurve(this.index);return this.path.curveAt(a)},prev:function(){var a=this.path._impl._prevCurve(this.index);return this.path.curveAt(a)},isRemoved:function(){return this.path._impl._isRemoved(this.index)}};var X=function(a,b){this.x=a,this.y=b};X.prototype={clone:function(){return new X(this.x,this.y)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)},move:function(a,b){return a instanceof Z?(this.x+=a.x,this.y+=a.y):Array.isArray(a)&&2===a.length?(this.x+=a[0],this.y+=a[1]):"number"==typeof a&&"number"==typeof b?(this.x+=a,this.y+=b):hb.panic(A),this},rotate:function(a,b,c){var d=0,e=0;"number"!=typeof a&&hb.panic(A),void 0!==b&&(b instanceof X?(d=b.x,e=b.y):Array.isArray(b)&&2===b.length?(d=b[0],e=b[1]):"number"==typeof b&&"number"==typeof c?(d=b,e=c):hb.panic(A));var f=Math.cos(a),g=Math.sin(a),h=f*(this.x-d)-g*(this.y-e)+d,i=g*(this.x-d)+f*(this.y-e)+e;return this.x=h,this.y=i,this},distanceTo:function(a){var b=(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y);return Math.sqrt(b)},scale:function(a,b){if(a instanceof Z)this.x*=a.x,this.y*=a.y;else if(Array.isArray(a)&&2===a.length)this.x*=a[0],this.y*=a[1];else if("number"==typeof a){var c=a;"number"==typeof b&&(c=b),this.x*=a,this.y*=c}else hb.panic(A);return this},transform:function(a){if(Array.isArray(a)&&9===a.length){var b=this.x*a[0]+this.y*a[3]+a[6],c=this.x*a[1]+this.y*a[4]+a[7];this.x=b,this.y=c}else if(a instanceof _){var b=this.x*a.elements[0]+this.y*a.elements[3]+a.elements[6],c=this.x*a.elements[1]+this.y*a.elements[4]+a.elements[7];this.x=b,this.y=c}else hb.panic(A);return this},debug:function(){O.point(this.x,this.y,0)}},g(X,"Point2D"),c.exports.Point2D=X;var Y=function(a,b,c){this.x=a,this.y=b,this.z=c};Y.prototype={clone:function(){return new Y(this.x,this.y,this.z)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)&&f(this.z,a.z)},transform:function(a){if(Array.isArray(a)&&16===a.length){var b=this.x*a[0]+this.y*a[4]+this.z*a[8]+a[12],c=this.x*a[1]+this.y*a[5]+this.z*a[9]+a[13],d=this.x*a[2]+this.y*a[6]+this.z*a[10]+a[14];this.x=b,this.y=c,this.z=d}else if(a instanceof ab){var e=a.elements,b=this.x*e[0]+this.y*e[4]+this.z*e[8]+e[12],c=this.x*e[1]+this.y*e[5]+this.z*e[9]+e[13],d=this.x*e[2]+this.y*e[6]+this.z*e[10]+e[14];this.x=b,this.y=c,this.z=d}else hb.panic(A);return this},distanceTo:function(a){var b=(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z);return Math.sqrt(b)},debug:function(){O.point(this.x,this.y,this.z)}},g(Y,"Point3D"),c.exports.Point3D=Y;var Z=function(a,b){this.x=a,this.y=b};Z.prototype={clone:function(){return new Z(this.x,this.y)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=b*this.x-c*this.y,e=c*this.x+b*this.y;return this.x=d,this.y=e,this},normalize:function(){var a=this.length();return 0!==a&&(this.x/=a,this.y/=a),this},angle:function(a){var b=0,c=this.length(),d=a.length();if(0!==c&&0!==d){var e=this.dot(a),f=e/(c*d);b=Math.acos(f);var g=this.cross(a);0>g&&(b=-b)}return b},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},scale:function(a,b){if(a instanceof Z)this.x*=a.x,this.y*=a.y;else if(Array.isArray(a)&&2===a.length)this.x*=a[0],this.y*=a[1];else if("number"==typeof a){var c=a;"number"==typeof b&&(c=b),this.x*=a,this.y*=c}else hb.panic(A);return this},transform:function(a){if(Array.isArray(a)&&9===a.length){var b=this.x*a[0]+this.y*a[3],c=this.x*a[1]+this.y*a[4];this.x=b,this.y=c}else if(a instanceof _){var b=this.x*a.elements[0]+this.y*a.elements[3],c=this.x*a.elements[1]+this.y*a.elements[4];
this.x=b,this.y=c}else hb.panic(A);return this},debug:function(){O.line(0,0,0,this.x,this.y,0)}},g(Z,"Vector2D"),c.exports.Vector2D=Z;var $=function(a,b,c){this.x=a,this.y=b,this.z=c};$.prototype={clone:function(){return new $(this.x,this.y,this.z)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)&&f(this.z,a.z)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},transform:function(a){if(Array.isArray(a)&&16===a.length){var b=this.x*a[0]+this.y*a[4]+this.z*a[8],c=this.x*a[1]+this.y*a[5]+this.z*a[9],d=this.x*a[2]+this.y*a[6]+this.z*a[10];this.x=b,this.y=c,this.z=d}else if(a instanceof ab){var e=a.elements,b=this.x*e[0]+this.y*e[4]+this.z*e[8],c=this.x*e[1]+this.y*e[5]+this.z*e[9],d=this.x*e[2]+this.y*e[6]+this.z*e[10];this.x=b,this.y=c,this.z=d}else hb.panic(A);return this},normalize:function(){var a=this.length();return 0!==a&&(this.x/=a,this.y/=a,this.z/=a),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},cross:function(a){var b=[];return Array.isArray(a)&&3===a.length?(b[0]=this.y*a[2]-this.z*a[1],b[1]=this.z*a[0]-this.x*a[2],b[2]=this.x*a[1]-this.y*a[0]):a instanceof $?(b[0]=this.y*a.z-this.z*a.y,b[1]=this.z*a.x-this.x*a.z,b[2]=this.x*a.y-this.y*a.x):hb.panic(A),new $(b[0],b[1],b[2])},dot:function(a){return Array.isArray(a)&&3===a.length?this.x*a[0]+this.y*a[1]+this.z*a[2]:a instanceof $?this.x*a.x+this.y*a.y+this.z*a.z:(hb.panic(A),void 0)},scale:function(a,b,c){if(a instanceof $)this.x*=a.x,this.y*=a.y,this.z*=a.z;else if(Array.isArray(a)&&3===a.length)this.x*=a[0],this.y*=a[1],this.z*=a[2];else if("number"==typeof a){var d=a,e=a;"number"==typeof b&&"number"==typeof c&&(d=b,e=c),this.x*=a,this.y*=d,this.z*=e}else hb.panic(A);return this},subtract:function(a){return Array.isArray(a)&&3===a.length?(this.x-=a[0],this.y-=a[1],this.z-=a[2]):a instanceof $?(this.x-=a.x,this.y-=a.y,this.z-=a.z):hb.panic(A),this},add:function(a){return Array.isArray(a)&&3===a.length?(this.x+=a[0],this.y+=a[1],this.z+=a[2]):a instanceof $?(this.x+=a.x,this.y+=a.y,this.z+=a.z):hb.panic(A),this},debug:function(){O.line(0,0,0,this.x,this.y,this.z)}},g($,"Vector3D"),c.exports.Vector3D=$;var _=function(a){Array.isArray(a)&&9===a.length?this.elements=a:void 0==a?this.elements=[1,0,0,0,1,0,0,0,1]:hb.panic(A)};_.prototype={clone:function(){return new _(this.elements.slice())},equals:function(a){return f(this.elements[0],a.elements[0])&&f(this.elements[1],a.elements[1])&&f(this.elements[2],a.elements[2])&&f(this.elements[3],a.elements[3])&&f(this.elements[4],a.elements[4])&&f(this.elements[5],a.elements[5])&&f(this.elements[6],a.elements[6])&&f(this.elements[7],a.elements[7])&&f(this.elements[8],a.elements[8])},determinant:function(){return this.elements[0]*this.elements[4]*this.elements[8]+this.elements[1]*this.elements[5]*this.elements[6]+this.elements[2]*this.elements[3]*this.elements[7]-this.elements[2]*this.elements[4]*this.elements[6]-this.elements[1]*this.elements[3]*this.elements[8]-this.elements[0]*this.elements[5]*this.elements[7]},invert:function(){var a=this.determinant();if(0!==a){var b=[];b[0]=this.elements[4]*this.elements[8]-this.elements[5]*this.elements[7],b[1]=this.elements[2]*this.elements[7]-this.elements[1]*this.elements[8],b[2]=this.elements[1]*this.elements[5]-this.elements[2]*this.elements[4],b[3]=this.elements[5]*this.elements[6]-this.elements[3]*this.elements[8],b[4]=this.elements[0]*this.elements[8]-this.elements[2]*this.elements[6],b[5]=this.elements[2]*this.elements[3]-this.elements[0]*this.elements[5],b[6]=this.elements[3]*this.elements[7]-this.elements[4]*this.elements[6],b[7]=this.elements[1]*this.elements[6]-this.elements[0]*this.elements[7],b[8]=this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3];for(var c=1/a,d=0;d<this.elements.length;d++)this.elements[d]=c*b[d]}return this},transform:function(a){var b=[];a instanceof _?b=a.elements:Array.isArray(a)&&9===a.length?b=a:hb.panic(A);var c=this.elements.slice();return this.elements[0]=c[0]*b[0]+c[1]*b[3]+c[2]*b[6],this.elements[1]=c[0]*b[1]+c[1]*b[4]+c[2]*b[7],this.elements[2]=c[0]*b[2]+c[1]*b[5]+c[2]*b[8],this.elements[3]=c[3]*b[0]+c[4]*b[3]+c[5]*b[6],this.elements[4]=c[3]*b[1]+c[4]*b[4]+c[5]*b[7],this.elements[5]=c[3]*b[2]+c[4]*b[5]+c[5]*b[8],this.elements[6]=c[6]*b[0]+c[7]*b[3]+c[8]*b[6],this.elements[7]=c[6]*b[1]+c[7]*b[4]+c[8]*b[7],this.elements[8]=c[6]*b[2]+c[7]*b[5]+c[8]*b[8],this},identity:function(){return this.elements=[1,0,0,0,1,0,0,0,1],this},scaling:function(a,b){return a instanceof Z?(this.elements[0]=a.x,this.elements[4]=a.y):Array.isArray(a)&&2===a.length?(this.elements[0]=a[0],this.elements[4]=a[1]):"number"==typeof a&&"number"==typeof b?(this.elements[0]=a,this.elements[4]=b):hb.panic(A),this},translation:function(a,b){return a instanceof Z?(this.elements[6]=a.x,this.elements[7]=a.y):Array.isArray(a)&&2===a.length?(this.elements[6]=a[0],this.elements[7]=a[1]):"number"==typeof a&&"number"==typeof b?(this.elements[6]=a,this.elements[7]=b):hb.panic(A),this},rotation:function(a,b,c){var d=0,e=0;"number"!=typeof a&&hb.panic(A),void 0!==b&&(b instanceof X?(d=b.x,e=b.y):Array.isArray(b)&&2===b.length?(d=b[0],e=b[1]):"number"==typeof b&&"number"==typeof c?(d=b,e=c):hb.panic(A)),(0!==d||0!==e)&&this.transform([1,0,0,0,1,0,-d,-e,1]);var f=Math.cos(a),g=Math.sin(a);return this.transform([f,g,0,-g,f,0,0,0,1]),(0!==d||0!==e)&&this.transform([1,0,0,0,1,0,d,e,1]),this}},g(_,"Matrix2D"),c.exports.Matrix2D=_;var ab=function(a){Array.isArray(a)&&16===a.length?this.elements=a:void 0==a?this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:hb.panic(A)};ab.prototype={clone:function(){return new ab(this.elements.slice())},equals:function(a){return f(this.elements[0],a.elements[0])&&f(this.elements[1],a.elements[1])&&f(this.elements[2],a.elements[2])&&f(this.elements[3],a.elements[3])&&f(this.elements[4],a.elements[4])&&f(this.elements[5],a.elements[5])&&f(this.elements[6],a.elements[6])&&f(this.elements[7],a.elements[7])&&f(this.elements[8],a.elements[8])&&f(this.elements[9],a.elements[9])&&f(this.elements[10],a.elements[10])&&f(this.elements[11],a.elements[11])&&f(this.elements[12],a.elements[12])&&f(this.elements[13],a.elements[13])&&f(this.elements[14],a.elements[14])&&f(this.elements[15],a.elements[15])},determinant:function(){var a=[],b=[],c=this.elements;return b[0]=c[10]*c[15]-c[11]*c[14],b[1]=c[9]*c[15]-c[11]*c[13],b[2]=c[9]*c[14]-c[10]*c[13],b[3]=c[8]*c[15]-c[11]*c[12],b[4]=c[8]*c[14]-c[10]*c[12],b[5]=c[8]*c[13]-c[9]*c[12],a[0]=c[5]*b[0]-c[6]*b[1]+c[7]*b[2],a[1]=c[6]*b[3]-c[4]*b[0]-c[7]*b[4],a[2]=c[4]*b[1]-c[5]*b[3]+c[7]*b[5],a[3]=c[5]*b[4]-c[4]*b[2]-c[6]*b[5],c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},invert:function(){var a=[],b=[],c=this.elements;b[0]=c[10]*c[15]-c[11]*c[14],b[1]=c[9]*c[15]-c[11]*c[13],b[2]=c[9]*c[14]-c[10]*c[13],b[3]=c[8]*c[15]-c[11]*c[12],b[4]=c[8]*c[14]-c[10]*c[12],b[5]=c[8]*c[13]-c[9]*c[12],a[0]=c[5]*b[0]-c[6]*b[1]+c[7]*b[2],a[4]=c[6]*b[3]-c[4]*b[0]-c[7]*b[4],a[8]=c[4]*b[1]-c[5]*b[3]+c[7]*b[5],a[12]=c[5]*b[4]-c[4]*b[2]-c[6]*b[5],a[1]=c[2]*b[1]-c[1]*b[0]-c[3]*b[2],a[5]=c[0]*b[0]-c[2]*b[3]+c[3]*b[4],a[9]=c[1]*b[3]-c[0]*b[1]-c[3]*b[5],a[13]=c[0]*b[2]-c[1]*b[4]+c[2]*b[5],b[6]=c[2]*c[7]-c[3]*c[6],b[7]=c[1]*c[7]-c[3]*c[5],b[8]=c[1]*c[6]-c[2]*c[5],b[9]=c[0]*c[7]-c[3]*c[4],b[10]=c[0]*c[6]-c[2]*c[4],b[11]=c[0]*c[5]-c[1]*c[4],a[2]=c[13]*b[6]-c[14]*b[7]+c[15]*b[8],a[6]=c[14]*b[9]-c[12]*b[6]-c[15]*b[10],a[10]=c[12]*b[7]-c[13]*b[9]+c[15]*b[11],a[14]=c[13]*b[10]-c[12]*b[8]-c[14]*b[11],a[3]=c[10]*b[7]-c[9]*b[6]-c[11]*b[8],a[7]=c[8]*b[6]-c[10]*b[9]+c[11]*b[10],a[11]=c[9]*b[9]-c[8]*b[7]-c[11]*b[11],a[15]=c[8]*b[8]-c[9]*b[10]+c[10]*b[11];var d=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];if(0!==d)for(var e=1/d,f=0;16>f;f++)this.elements[f]=a[f]*e;return this},transform:function(a){var b=[];a instanceof ab?b=a.elements:Array.isArray(a)&&16===a.length?b=a:hb.panic(A);var c=this.elements.slice();return this.elements[0]=c[0]*b[0]+c[1]*b[4]+c[2]*b[8]+c[3]*b[12],this.elements[1]=c[0]*b[1]+c[1]*b[5]+c[2]*b[9]+c[3]*b[13],this.elements[2]=c[0]*b[2]+c[1]*b[6]+c[2]*b[10]+c[3]*b[14],this.elements[3]=c[0]*b[3]+c[1]*b[7]+c[2]*b[11]+c[3]*b[15],this.elements[4]=c[4]*b[0]+c[5]*b[4]+c[6]*b[8]+c[7]*b[12],this.elements[5]=c[4]*b[1]+c[5]*b[5]+c[6]*b[9]+c[7]*b[13],this.elements[6]=c[4]*b[2]+c[5]*b[6]+c[6]*b[10]+c[7]*b[14],this.elements[7]=c[4]*b[3]+c[5]*b[7]+c[6]*b[11]+c[7]*b[15],this.elements[8]=c[8]*b[0]+c[9]*b[4]+c[10]*b[8]+c[11]*b[12],this.elements[9]=c[8]*b[1]+c[9]*b[5]+c[10]*b[9]+c[11]*b[13],this.elements[10]=c[8]*b[2]+c[9]*b[6]+c[10]*b[10]+c[11]*b[14],this.elements[11]=c[8]*b[3]+c[9]*b[7]+c[10]*b[11]+c[11]*b[15],this.elements[12]=c[12]*b[0]+c[13]*b[4]+c[14]*b[8]+c[15]*b[12],this.elements[13]=c[12]*b[1]+c[13]*b[5]+c[14]*b[9]+c[15]*b[13],this.elements[14]=c[12]*b[2]+c[13]*b[6]+c[14]*b[10]+c[15]*b[14],this.elements[15]=c[12]*b[3]+c[13]*b[7]+c[14]*b[11]+c[15]*b[15],this},identity:function(){return this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},scaling:function(a,b,c){return a instanceof $?(this.elements[0]=a.x,this.elements[5]=a.y,this.elements[10]=a.z):Array.isArray(a)&&3===a.length?(this.elements[0]=a[0],this.elements[5]=a[1],this.elements[10]=a[2]):"number"==typeof a&&"undefined"==typeof b?(this.elements[0]=a,this.elements[5]=a,this.elements[10]=a):"number"==typeof a&&"number"==typeof b&&"number"==typeof c?(this.elements[0]=a,this.elements[5]=b,this.elements[10]=c):hb.panic(A),this},translation:function(a,b,c){return a instanceof $?(this.elements[12]=a.x,this.elements[13]=a.y,this.elements[14]=a.z):Array.isArray(a)&&3===a.length?(this.elements[12]=a[0],this.elements[13]=a[1],this.elements[14]=a[2]):"number"==typeof a&&"undefined"==typeof b?(this.elements[12]=a,this.elements[13]=a,this.elements[14]=a):"number"==typeof a&&"number"==typeof b&&"number"==typeof c?(this.elements[12]=a,this.elements[13]=b,this.elements[14]=c):hb.panic(A),this},rotationX:function(a){"number"!=typeof a&&hb.panic(A);var b=Math.sin(a),c=Math.cos(a);return this.elements[5]=c,this.elements[6]=b,this.elements[9]=-b,this.elements[10]=c,this},rotationY:function(a){"number"!=typeof a&&hb.panic(A);var b=Math.sin(a),c=Math.cos(a);return this.elements[0]=c,this.elements[2]=-b,this.elements[8]=b,this.elements[10]=c,this},rotationZ:function(a){"number"!=typeof a&&hb.panic(A);var b=Math.sin(a),c=Math.cos(a);return this.elements[0]=c,this.elements[1]=b,this.elements[4]=-b,this.elements[5]=c,this},coordinateSystem:function(a,b,c,d){return this.elements[0]=b.x,this.elements[1]=b.y,this.elements[2]=b.z,this.elements[3]=0,this.elements[4]=c.x,this.elements[5]=c.y,this.elements[6]=c.z,this.elements[7]=0,this.elements[8]=d.x,this.elements[9]=d.y,this.elements[10]=d.z,this.elements[11]=0,this.elements[12]=a.x,this.elements[13]=a.y,this.elements[14]=a.z,this.elements[15]=1,this},toJSON:function(){return this.elements}},g(ab,"Matrix3D"),c.exports.Matrix3D=ab;var bb=function(a,b){W.call(this,a,b),Object.defineProperty(this,"start",{get:function(){return this.path._impl._startPointOfCurve(this.index)},set:function(a){return this.path._impl._startPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"end",{get:function(){return this.path._impl._endPointOfCurve(this.index)},set:function(a){return this.path._impl._endPointOfCurve(this.index,a)},enumerable:!0})};bb.prototype=new W,g(bb,"Line2D"),bb.prototype.distanceTo=function(a){var b=function(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)},c=this.start,d=this.end,e=b(c,d);if(0===e)return Math.sqrt(b(c,a));var f=((a.x-c.x)*(d.x-c.x)+(a.y-c.y)*(d.y-c.y))/e;return 0>f?Math.sqrt(b(a,c)):f>1?Math.sqrt(b(a,d)):Math.sqrt(b(a,{x:c.x+f*(d.x-c.x),y:c.y+f*(d.y-c.y)}))},bb.prototype.move=function(a,b){return this.start=this.start.move(a,b),this.end=this.end.move(a,b),this},bb.prototype.transform=function(a){return this.start=this.start.transform(a),this.end=this.end.transform(a),this},c.exports.Line2D=bb;var cb=function(a,b){W.call(this,a,b),Object.defineProperty(this,"start",{get:function(){return this.path._impl._startPointOfCurve(this.index)},set:function(a){return this.path._impl._startPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"end",{get:function(){return this.path._impl._endPointOfCurve(this.index)},set:function(a){return this.path._impl._endPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"controlPoints",{get:function(){return this.path._impl._controlPointsOfCurve(this.index)},set:function(a){return this.path._impl._controlPointsOfCurve(this.index,a)},enumerable:!0})};cb.prototype=new W,g(cb,"Bezier2D"),cb.prototype.distanceTo=function(a,b){var c=b?b:B(),d=Number.MAX_VALUE,e={};e.dist=d;var f=this.start,g=this.end,h=this.controlPoints,i=h.length,j={},k={};if(1===i){var l=h[0];j.x=f.x+2/3*(l.x-f.x),j.y=f.y+2/3*(l.y-f.y),k.x=g.x+2/3*(l.x-g.x),k.y=g.y+2/3*(l.y-g.y)}else 2===i?(j=h[0],k=h[1]):hb.panic("Bezier2D has an unsupported number of control points.");return this.path._impl._bezierDistToPoint(e,c,f.x,f.y,j.x,j.y,k.x,k.y,g.x,g.y,a.x,a.y,0),e.dist},cb.prototype.move=function(a,b){this.start=this.start.move(a,b),this.end=this.end.move(a,b);for(var c=this.controlPoints,d=[],e=0;e<c.length;e++)d.push(c[e].move(a,b));return this.controlPoints=d,this},cb.prototype.rotate=function(a,b,c){this.start=this.start.rotate(a,b,c),this.end=this.end.rotate(a,b,c);for(var d=this.controlPoints,e=[],f=0;f<d.length;f++)e.push(d[f].rotate(a,b,c));return this.controlPoints=e,this},cb.prototype.transform=function(a){this.start=this.start.transform(a),this.end=this.end.transform(a);for(var b=this.controlPoints,c=[],d=0;d<b.length;d++)c.push(b[d].transform(a));return this.controlPoints=c,this},c.exports.Bezier2D=cb;var db=function(){this._curveData=[],this._curveStarts=[]};db.prototype={_toPolygons:function(a){for(var b=a||e(),c=[],d=[],f=this._curveData,g={},h=0;h<this._curveStarts.length;h++){var i=this._curveStarts[h];switch(f[i]){case fb.MoveTo||fb.MoveToEx:d.length>2&&c.push(d),d=[],g.x=f[i+1],g.y=f[i+2],d.push(g.x,g.y);break;case fb.LineTo:g.x=f[i+1],g.y=f[i+2],d.push(g.x,g.y);break;case fb.QuadraticCurveTo:var j={},k={},l={},m={};j.x=f[i+1],j.y=f[i+2],m.x=f[i+3],m.y=f[i+4],k.x=g.x+2/3*(j.x-g.x),k.y=g.y+2/3*(j.y-g.y),l.x=m.x+2/3*(j.x-m.x),l.y=m.y+2/3*(j.y-m.y),this._cubicBezierRecursive(d,b,g.x,g.y,k.x,k.y,l.x,l.y,m.x,m.y,0),g.x=m.x,g.y=m.y;break;case fb.BezierCurveTo:this._cubicBezierRecursive(d,b,g.x,g.y,f[i+1],f[i+2],f[i+3],f[i+4],f[i+5],f[i+6],0),g.x=f[i+5],g.y=f[i+6]}}return d.length>0&&c.push(d),c},_distPtToSeg:function(a,b,c,d,e,f){var g=e-c,h=f-d,i=a-c,j=b-d,k=g*g+h*h,l=g*i+h*j;return k>0&&(l/=k),0>l?l=0:l>1&&(l=1),i=c+l*g-a,j=d+l*h-b,i*i+j*j},_cubicBezierRecursive:function(a,b,c,d,e,f,g,h,i,j,k){if(!(k>18)){var l=.5*(c+e),m=.5*(d+f),n=.5*(e+g),o=.5*(f+h),p=.5*(g+i),q=.5*(h+j),r=.5*(l+n),s=.5*(m+o),t=.5*(n+p),u=.5*(o+q),v=.5*(r+t),w=.5*(s+u),x=this._distPtToSeg(v,w,c,d,i,j);x>b*b?(this._cubicBezierRecursive(a,b,c,d,l,m,r,s,v,w,k+1),this._cubicBezierRecursive(a,b,v,w,t,u,p,q,i,j,k+1)):a.push(i,j)}},_bezierDistToPoint:function(a,b,c,d,e,f,g,h,i,j,k,l,m){if(!(m>18)){var n=.5*(c+e),o=.5*(d+f),p=.5*(e+g),q=.5*(f+h),r=.5*(g+i),s=.5*(h+j),t=.5*(n+p),u=.5*(o+q),v=.5*(p+r),w=.5*(q+s),x=.5*(t+v),y=.5*(u+w),z=Math.sqrt((x-k)*(x-k)+(y-l)*(y-l));if(b>z)return a.dist=z,void 0;z<a.dist&&(a.dist=z),this._bezierDistToPoint(a,b,c,d,n,o,t,u,x,y,k,l,m+1),this._bezierDistToPoint(a,b,x,y,v,w,r,s,i,j,k,l,m+1)}},_coincideWithEndPoint:function(a,b){var c=new X(a,b),d=this._curveStarts.length-1;if(d>-1){var e=this._curveStarts[d],f=-1;switch(this._curveData[e]){case fb.LineTo||fb.MoveTo||fb.MoveToEx:f=e+1;break;case fb.QuadraticCurveTo:f=e+3;break;case fb.BezierCurveTo:f=e+5}if(f>-1){var g=new X(this._curveData[f],this._curveData[f+1]);if(c.distanceTo(g)<B())return!0}}return!1},_isRemoved:function(a){if(0>a||a>this._curveStarts.length-1)return!0;var b=this._curveStarts[a],c=this._curveData[b];return c===fb.MoveTo||c===fb.MoveToEx?!0:!1},_removeCurve:function(a){var b=this._curveStarts[a],c=this._curveData;switch(c[b]){case fb.LineTo:c[b]=fb.MoveTo;break;case fb.QuadraticCurveTo:c[b]=fb.MoveToEx,c[b+1]=c[b+3],c[b+2]=c[b+4],c[b+3]=2,c[b+4]=0;break;case fb.BezierCurveTo:c[b]=fb.MoveToEx,c[b+1]=c[b+5],c[b+2]=c[b+6],c[b+3]=4,c[b+4]=0,c[b+5]=0,c[b+6]=0}},_nextCurve:function(a){var b=a?a:-1,c=this._curveStarts.length;if(a>=c)return-1;for(var d=this._curveData,e=b+1;c>e;e++){var b=this._curveStarts[e];if(d[b]===fb.LineTo||d[b]===fb.QuadraticCurveTo||d[b]===fb.BezierCurveTo)return e}return-1},_prevCurve:function(a){var b=this._curveStarts.length,c=a?a:b;if(a>=b||1>a)return-1;for(var d=this._curveData,e=c-1;e>-1;e--){var c=this._curveStarts[e];if(d[c]===fb.LineTo||d[c]===fb.QuadraticCurveTo||d[c]===fb.BezierCurveTo)return e}return-1},_endPosOfCurve:function(a){var b=this._curveStarts[a],c=this._curveData[b],d=-1;return c===fb.LineTo||c===fb.MoveTo||c===fb.MoveToEx?d=b+1:c===fb.QuadraticCurveTo?d=b+3:c===fb.BezierCurveTo&&(d=b+5),d},_isClosed:function(){var a=this._curveStarts.length,b=this._curveData;if(a>1){var c=this._endPosOfCurve(0),d=this._endPosOfCurve(a-1);if(b[c]===b[d]&&b[c+1]===b[d+1])return!0}return!1},_endPointOfCurve:function(a,b){var c=this._endPosOfCurve(a);if(!(0>c||c>this._curveData.length-2)){if(b){var d=this._curveStarts.length;if((0===a||d-1===a)&&this._isClosed()){var e=this._endPosOfCurve(d-1-a);this._curveData[e]=b.x,this._curveData[e+1]=b.y}return this._curveData[c]=b.x,this._curveData[c+1]=b.y,void 0}return new X(this._curveData[c],this._curveData[c+1])}},_startPointOfCurve:function(a,b){var c=a-1;if(!(0>c||c>this._curveStarts.length-1))return this._endPointOfCurve(c,b)},_controlPointsOfCurve:function(a,b){var c=this,d=function(a){var b=c._curveStarts[a],d=c._curveData[b],e=-1,f=0;return d===fb.QuadraticCurveTo?(e=b+1,f=1):d===fb.BezierCurveTo&&(e=b+1,f=2),[e,f]},e=d(a);if(-1!==e[0]){if(!b){for(var f=[],g=e[1],h=0;g>h;h++)f.push(new X(this._curveData[e[0]+2*h],this._curveData[e[0]+2*h+1]));return f}if(b.length===e[1])for(var h=0;h<b.length;h++)this._curveData[e[0]+2*h]=b[h].x,this._curveData[e[0]+2*h+1]=b[h].y}}};var eb=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new db}),a&&a.data&&a.starts&&(this._impl._curveData=a.data.slice(0),this._impl._curveStarts=a.starts.slice(0))};eb.prototype={moveTo:function(a,b){(2!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1])&&hb.panic(A);var c=this._impl;return c._coincideWithEndPoint(a,b)||(c._curveStarts.push(c._curveData.length),c._curveData.push(fb.MoveTo),c._curveData.push(a,b)),this},lineTo:function(a,b){if(2!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1])return hb.warning(A),this;var c=this._impl;return c._coincideWithEndPoint(a,b)||(c._curveStarts.push(c._curveData.length),c._curveData.push(fb.LineTo),c._curveData.push(a,b)),this},bezierCurveTo:function(a,b,c,d,e,f){(6!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2]||"number"!=typeof arguments[3]||"number"!=typeof arguments[4]||"number"!=typeof arguments[5])&&hb.panic(A);var g=this._impl;return g._coincideWithEndPoint(e,f)||(g._curveStarts.push(g._curveData.length),g._curveData.push(fb.BezierCurveTo),g._curveData.push(a,b,c,d,e,f)),this},quadraticCurveTo:function(a,b,c,d){(4!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2]||"number"!=typeof arguments[3])&&hb.panic(A);var e=this._impl;return e._coincideWithEndPoint(c,d)||(e._curveStarts.push(e._curveData.length),e._curveData.push(fb.QuadraticCurveTo),e._curveData.push(a,b,c,d)),this},close:function(){for(var a=this._impl,b=a._curveStarts.length,c=b-1;c>=0;c--){var d=a._curveStarts[c];if(fb.MoveTo===a._curveData[d]){if(b-1!==c){this.lineTo(a._curveData[d+1],a._curveData[d+2]);break}break}}return this},toPolygons:function(a){return this._impl._toPolygons(a)},curvesByPoint:function(a,b){for(var c=[],d=this.firstCurve();d;){var e=!1,f=d.distanceTo(a);if(b>=f)e=!0;else if(d instanceof cb)for(var g=d.controlPoints,h=g.length,i=0;h>i;i++)if(f=a.distanceTo(g[i]),b>=f){e=!0;break}if(e){var j={dist:f,curve:d};c.push(j)}d=d.next()}c.sort(function(a,b){return b.dist-a.dist});for(var i=0;i<c.length;i++)c[i]=c[i].curve;return c},curveAt:function(a){var b=this._impl;if(0>a||a>b._curveStarts.length-1)return void 0;var c=b._curveStarts[a],d=b._curveData[c],e=void 0;return d===fb.LineTo?e=new bb(a,this):(d===fb.QuadraticCurveTo||d===fb.BezierCurveTo)&&(e=new cb(a,this)),e},firstCurve:function(){var a=this._impl._nextCurve();return this.curveAt(a)},lastCurve:function(){var a=this._impl._prevCurve();return this.curveAt(a)},toJSON:function(){return{data:this._impl._curveData,starts:this._impl._curveStarts}},transform:function(a){var b;Array.isArray(a)&&9===a.length?b=new _(a):a instanceof _?b=a:hb.panic(A);for(var c=new X(0,0),d=this._impl._curveStarts,e=this._impl._curveData,f=0;f<d.length;f++){var g=d[f];switch(e[g]){case fb.LineTo:case fb.MoveTo:case fb.MoveToEx:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y;break;case fb.QuadraticCurveTo:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y,c.x=e[g+3],c.y=e[g+4],c.transform(b),e[g+3]=c.x,e[g+4]=c.y;break;case fb.BezierCurveTo:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y,c.x=e[g+3],c.y=e[g+4],c.transform(b),e[g+3]=c.x,e[g+4]=c.y,c.x=e[g+5],c.y=e[g+6],c.transform(b),e[g+5]=c.x,e[g+6]=c.y}}return this},clone:function(){var a=new eb;return a._impl._curveData=this._impl._curveData.slice(0),a._impl._curveStarts=this._impl._curveStarts.slice(0),a}};var fb={MoveTo:"M",LineTo:"L",QuadraticCurveTo:"Q",BezierCurveTo:"B",MoveToEx:"E"};g(eb,"Path2D"),c.exports.Path2D=eb;var gb={_warningBuffer:a.getVariable(["outcomes","warnings"],[]),_panicString:void 0,_addWarning:function(a){return this._warningBuffer.push(a),this},_panic:function(b){a.setVariable(["outcomes","panic"],b);var c=a.getVariable(["callbacks","panic"]);return c&&c(b),this}},hb={warning:function(a){return a&&"function"==typeof a.toString&&gb._addWarning(a.toString()),this},panic:function(a){return a&&"function"==typeof a.toString&&gb._panic(a.toString()),this}};Object.defineProperty(hb,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:gb}),c.exports.Plugin=hb,g(hb,"Plugin");var ib={extrude:function(a,b){2===arguments.length&&(Array.isArray(arguments[0])||arguments[0]instanceof rb)&&"number"==typeof arguments[1]||hb.panic(A);var c=yb.extrude({geometry:a,distance:b,start:!0,end:!0,sides:!0}),d=new kb(c);return d},make:function(a){var b=new kb(a);return b}};c.exports.Solid=ib,g(ib,"Solid");var jb=function(a){this._mesh=a},kb=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new jb(a)}),Object.defineProperty(this,"mesh",{get:function(){return this._impl._mesh},enumerable:!0})};kb.prototype={transform:function(a){return this._impl._mesh.transform(a),this},toJSON:function(){var a=this._impl._mesh,b={};if(a){var c=a.bounds();if(c){var d=c.min,e=c.max;b.Verts=a._impl._vertices,b.Tris=a._impl._triangles,b.Bounds=[d.x,d.y,d.z,e.x,e.y,e.z]}}return b}},g(kb,"Solid3D"),c.exports.Solid3D=kb;var lb=void 0,mb={circleDivisions:function(a){("number"!=typeof a||a<B())&&hb.panic(A);var b=2*Math.acos(a/(a+mb.tolerance())),c=parseInt(Math.ceil(2*Math.PI/b));return c=4*parseInt((c+3)/4),4>c?4:c},tolerance:function(){return e()},boundariesFromContours:function(a,b){var c=void 0==b?P.NonZero:b,d=xb._extractBoundaryContours(a,c);return d},polygonsFromBoundaries:function(a){var b=xb._extractPolygons(a,P.NonZero),c=b.vertices,d=[],e=[],f=0,g=b.elements,h=g.length;for(f=0;h>f;f+=6){d.push(g[f],g[f+1],g[f+2]);for(var i=0;3>i;i++)if(-1==g[f+i+3]){var j=g[f+i],k=g[f+(i+1)%3];e.push(j),e.push(k)}}return{vertices:c,triangleIndices:d,boundaryIndices:e}}};c.exports.Tess=mb,g(mb,"Tess");var nb=function(a,b){this.min=a,this.max=b};nb.prototype={length:function(){return this.max.x-this.min.x},width:function(){return this.max.y-this.min.y},center:function(){return new X(.5*(this.max.x+this.min.x),.5*(this.max.y+this.min.y))},clone:function(){var a=this.min.clone(),b=this.max.clone();return new nb(a,b)},debug:function(){var a=this.min.x,b=this.min.y,c=this.max.x,d=this.max.y;O.line(a,b,0,c,b,0),O.line(c,b,0,c,d,0),O.line(c,d,0,a,d,0),O.line(a,d,0,a,b,0)}},g(nb,"Box2D"),c.exports.Box2D=nb;var ob=function(a,b){this.min=a,this.max=b};ob.prototype={length:function(){return Math.max(this.max.x-this.min.x,0)},width:function(){return Math.max(this.max.y-this.min.y,0)},height:function(){return Math.max(this.max.z-this.min.z,0)},center:function(){return new Y(.5*(this.max.x+this.min.x),.5*(this.max.y+this.min.y),.5*(this.max.z+this.min.z))},clone:function(){var a=this.min.clone(),b=this.max.clone();return new ob(a,b)},debug:function(){var a=this.min.x,b=this.min.y,c=this.min.z,d=this.max.x,e=this.max.y,f=this.max.z;O.line(a,b,c,d,b,c),O.line(d,b,c,d,e,c),O.line(d,e,c,a,e,c),O.line(a,e,c,a,b,c),O.line(a,b,f,d,b,f),O.line(d,b,f,d,e,f),O.line(d,e,f,a,e,f),O.line(a,e,f,a,b,f),O.line(d,b,c,d,b,f),O.line(a,b,f,a,b,c),O.line(d,e,c,d,e,f),O.line(a,e,f,a,e,c)}},g(ob,"Box3D"),c.exports.Box3D=ob;var pb=function(a,b){this.origin=a,this.direction=b};pb.prototype={clone:function(){var a=this.direction.clone(),b=this.origin.clone();return new pb(b,a)},debug:function(){var a=this.direction,b=this.origin;O.line(b.x,b.y,b.z,b.x+a.x,b.y+a.y,b.z+a.z)}},g(pb,"Ray3D"),c.exports.Ray3D=pb;var qb=function(){this.paths=[]};qb.prototype={_bounds:function(){for(var a=Number.MAX_VALUE,b=-Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,e=0,f=this.paths.length;f>e;e++)for(var g=this.paths[e].toPolygons(),h=0,i=g.length;i>h;h++)for(var j=g[h],k=0,l=j.length;l>k;k+=2){var m=j[k],n=j[k+1];a>m&&(a=m),m>b&&(b=m),c>n&&(c=n),n>d&&(d=n)}var o=void 0;return b>a&&d>c&&(o=new nb(new X(a,c),new X(b,d))),o}};var rb=function(a){if(Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new qb}),Object.defineProperty(this,"paths",{get:function(){var a=this._impl.paths.slice(0);return a},enumerable:!0}),a)if(Array.isArray(a))for(var b=this._impl.paths,c=0,d=a.length;d>c;c++){var e=a[c];e instanceof eb&&b.push(e)}else if(a instanceof rb)for(var b=a._impl.paths,f=this._impl.paths,c=0;c<b.length;c++)f.push(b[c].clone());else for(var g=0;g<a.paths.length;g++){var h=new eb(a.paths[g]);this._impl.paths.push(h)}};rb.prototype={bounds:function(){return this._impl._bounds()},toPolygons:function(a){for(var b=[],c=this._impl.paths,d=0;d<c.length;d++)for(var e=c[d].toPolygons(a),f=0;f<e.length;f++)b.push(e[f]);return b},toJSON:function(){for(var a=[],b=this._impl.paths,c=0;c<b.length;c++)a.push(b[c].toJSON());return{paths:a}},transform:function(a){for(var b=this._impl.paths,c=0;c<b.length;c++){var d=b[c];d.transform(a)}return this},clone:function(){for(var a=new rb,b=this._impl.paths,c=a._impl.paths,d=0;d<b.length;d++)c.push(b[d].clone());return a},projectBoundary:function(a,b){a instanceof ub&&b instanceof ab||hb.panic(A);var c=a.mesh,d=a.vertexIndices,e=b.elements,f=function(a){var b=c.vertexByIndex(a),d={x:b[0],y:b[1],z:b[2]},f=d.x*e[0]+d.y*e[4]+d.z*e[8]+e[12],g=d.x*e[1]+d.y*e[5]+d.z*e[9]+e[13];return{x:f,y:g}},g=new eb,h=f(d[0]);g.moveTo(h.x,h.y);for(var i=1,j=d.length;j>i;i++)h=f(d[i]),g.lineTo(h.x,h.y);return d[0]!=d[d.length-1]&&(h=f(d[0]),g.lineTo(h.x,h.y)),this._impl.paths.push(g),this},combine:function(a){var b=this._impl.paths;if(Array.isArray(a))for(var c=0,d=a.length;d>c;c++)Array.prototype.push.apply(b,a[c]._impl.paths);else Array.prototype.push.apply(b,a._impl.paths);return this}},Object.defineProperty(rb.prototype,"windingRule",{enumerable:!0,configurable:!1,get:function(){return void 0!==this._impl.windingRule?this._impl.windingRule:P.NonZero},set:function(a){var b=!1;for(var c in P)if(P[c]===a){b=!0;break}b||hb.panic("Invalid windingRule value."),this._impl.windingRule=a}}),g(rb,"Sketch2D"),c.exports.Sketch2D=rb,a.setVariable(["parameters","sketch","deserializer"],function(a){return new rb(a)});var sb=function(){this.selector=null,this.distance=Number.MAX_VALUE,this.collision=null},tb=function(a,b){sb.call(this),this.mesh=a,this.triangleIndices=b};tb.prototype={boundaries:function(){return this.mesh.boundariesByTriangles(this.triangleIndices)},expandByCoplanar:function(a){if(!this.mesh||!this.triangleIndices||0===this.triangleIndices.length)return this;void 0===a&&(a=1e-5);for(var b=this.triangleIndices[0],c=[b],d={},e=[],f=this.mesh,g=f._impl,h=g._vertices,i=g._triangles,j=g._triangleNormal(i,h,b),k=new $(j[0],j[1],j[2]),l=new $,m,n;c.length>0;){m=c.shift(),d[m]=!0,e.push(m);for(var o=f.trianglesByTriangle(m,!0),p=0;p<o.length;p++){var q=o[p];if(!d[q]){var r=g._triangleNormal(i,h,q);l.x=r[0],l.y=r[1],l.z=r[2],k.dot(l)>1-a&&c.push(q),d[q]=!0}}}return this.triangleIndices=e,this},clone:function(){return new tb(this.mesh,this.triangleIndices)},debug:function(){for(var a=[],b=this.triangleIndices,c=this.mesh,d=0;d<b.length;d++){var e=c.triangleByIndex(b[d]),f=c.vertexByIndex(e[0]),g=c.vertexByIndex(e[1]),h=c.vertexByIndex(e[2]);a.push(f[0],f[1],f[2],g[0],g[1],g[2],h[0],h[1],h[2])}O.triangles(a)}},g(tb,"Mesh3DSelection"),c.exports.Mesh3DSelection=tb;var ub=function(){this.vertexIndices=[],this.mesh=null};ub.prototype={debug:function(){if(this.mesh&&!(this.vertexIndices.length<3)){var a=this.mesh._impl._vertices,b=this.vertexIndices.slice(0);b[0]!=b[b.length-1]&&b.push(b[0]);for(var c=0,d=b.length-1;d>c;c++){var e=3*b[c],f=3*b[c+1];O.line(a[e],a[e+1],a[e+2],a[f],a[f+1],a[f+2])}}}},g(ub,"Mesh3DBoundary"),c.exports.Mesh3DBoundary=ub;var vb=function(){};vb.prototype={select:function(a){}};var wb=function(){this.ray=null,this.selections=[]};wb.prototype={selectionsByDistance:function(){var a=function(a,b){return a.distance>b.distance};return this.selections.sort(a),this.selections},debug:function(){this.ray.debug();for(var a=0,b=this.selections.length;b>a;a++)this.selections[a].debug()}},g(wb,"Selector"),c.exports.Selector=wb;var xb={_toContours:function(a){for(var b=[],c=0,d=a.length;d>c;c++)for(var e=a[c],f=e.toPolygons(),g=0,h=f.length;h>g;g++)b.push(f[g]);return b},_extractBoundaryContours:function(a,b){var c=q(),d=c.BOUNDARY_CONTOURS,e=2,f=2,g={contours:a,windingRule:b,elementType:c.BOUNDARY_CONTOURS,polySize:e,vertexSize:f,normal:[0,0,1]},h=c.tesselate(g);if(a=[],!h)return a;for(var i=h.vertexCount,j=h.vertices,k=h.elements,l=j.length,m=k.length,n=e,o=0;m>o;o+=n){for(var p=k[o],r=k[o+1],s=[],t=p*f,u=0;f*r>u;u++)s.push(j[t+u]);a.push(s)}return a},_extractPolygons:function(a,b){var c=q(),d={contours:a,windingRule:b,elementType:c.CONNECTED_POLYGONS,polySize:3,vertexSize:2,normal:[0,0,1]};return c.tesselate(d)},_contourBounds:function(a){for(var b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,e=-Number.MAX_VALUE,f=0,g=a.length;g>f;f+=2){var h=a[f],i=a[f+1];b=Math.min(b,h),c=Math.min(c,i),d=Math.max(d,h),e=Math.max(e,i)}return[b,c,d,e]},_contourContainment:function(a,b){function c(a,b,c){for(var d=!1,e=verts.length/2,f=0,g=e-1;e>f;g=f++){var h=c[2*f],i=c[2*f+1],j=c[2*g],k=c[2*g+1],l=i>b!=k>b&&(j-h)*(b-i)/(k-i)+h>a;l&&(d=!d)}return d}function d(a,b,c,d,e,f,g,h){var i=[c-a,d-b],j=[g-e,h-f],k=[e-a,f-b],l=k[0]*i[1]-k[1]*i[0],m=k[0]*j[1]-k[1]*j[0],n=i[0]*j[1]-i[1]*j[0];if(0==l&&0==n)return 0>e-a!=0>e-c!=0>g-a!=0>g-c||0>f-b!=0>f-d!=0>h-b!=0>h-d;if(0==n)return!1;var o=l/n,p=m/n;return p>=0&&1>=p&&o>=0&&1>=o}function e(a,b,c,d,e,f,g,h){return a>e&&b>f&&g>c&&h>d?1:-1}for(var f=this._contourBounds(a),g=0,h=b.length;h>g;g++){var i=b[g],j=this._contourBounds(i),k=e(f[0],f[1],f[2],f[3],j[0],j[1],j[2],j[3]);if(!(1==k&&c(j[0],j[1],a)&&c(j[0],j[3],a)&&c(j[2],j[3],a)&&c(j[2],j[1],a)))for(var l=0,m=a.length;m>l;l+=2)for(var n=0,o=i.length;o>n;n+=2){var p=d(a[l],a[l+1],a[l+2],a[l+3],i[n],i[n+1],i[n+2],i[n+3]);if(p)return-1}}return 1},_extrudeFromPolygons:function(a,b,c,d,e,f,g,h){for(var i=[],j=[],k=Math.max(0,d),l=Math.min(0,d),m=2,n=3,o=b.length,p=c.length,q=2*n,r=0;o>r;r+=m)i.push(b[r],b[r+1],k);if(0>d&&e||d>=0&&f)for(var s=0;p>s;s+=q)h?j.push(c[s+2],c[s+1],c[s]):j.push(c[s],c[s+1],c[s+2]);
for(var r=0;o>r;r+=m)i.push(b[r],b[r+1],l);if(0>d&&f||d>=0&&e)for(var s=0;p>s;s+=q)h?j.push(c[s]+a,c[s+1]+a,c[s+2]+a):j.push(c[s+2]+a,c[s+1]+a,c[s]+a);if(g)for(var s=0;p>s;s+=q)for(var t=0;3>t;t++)if(-1==c[s+t+3]){var u=c[s+t],v=c[s+(t+1)%3];h?(j.push(v,v+a,u+a),j.push(u,v,u+a)):(j.push(u+a,v+a,v),j.push(u+a,v,u))}return{vertices:i,indices:j}},_emboss:function(a,b,c){var d=this,e=q(),f={_extrudeInBorder:function(a,b,c){for(var e=d._extractPolygons(b,P.EvenOdd),f=this._extrudePolygons(e,c),g=0;g<a.length;g++)b.push(a[g]);e=d._extractPolygons(b,P.EvenOdd);var h=this._toPolygons(e);return[{vertices:f.vertices,indices:f.indices},{vertices:h.vertices,indices:h.indices}]},_toPolygons:function(a){if(!a)return{vertices:[],indices:[]};for(var b=a.vertices,c=a.elements,d=[],e=[],f=2,g=3,h=b.length,i=c.length,j=2*g,k=0;h>k;k+=f)d.push(b[k],b[k+1],0);for(var l=0;i>l;l+=j)e.push(c[l],c[l+1],c[l+2]);return{vertices:d,indices:e}},_extrudePolygons:function(a,b){if(!a)return{vertices:[],indices:[]};var c=a.vertexCount,e=a.vertices,f=a.elements;return d._extrudeFromPolygons(c,e,f,b,!1,!0,!0,0>b)}};return f._extrudeInBorder(a,b,c)}},yb={extrude:function(a){var b=a.geometry,c=a.distance,d=a.start,e=a.end,f=a.sides,g,h;b instanceof rb?(g=b.paths,h=b.windingRule):Array.isArray(b)&&b.length>0&&b[0]instanceof eb&&(g=b),void 0===g&&hb.panic("The input geometry is invalid.");var i=xb._toContours(g);0===i.length&&hb.panic("No valid contours found on input geometry."),void 0===h&&(h=P.NonZero),i=xb._extractBoundaryContours(i,h),0===i.length&&hb.panic("No valid contours found on input geometry.");var j=xb._extractPolygons(i,P.NonZero),k=j.vertexCount,l=j.vertices,m=j.elements;0===m.length&&hb.panic("The input geometry does not have valid profiles.");var n=xb._extrudeFromPolygons(k,l,m,c,d,e,f);return(new R).indexedTriangles(n.vertices,n.indices)},emboss:function(a){var b=a.boundary,c=a.design,d=a.distance;b instanceof rb||hb.panic("The input boundary is not a Sketch2D object.");var e=xb._toContours(b.paths);c instanceof rb||hb.panic("The input design is not a Sketch2D object.");var f=xb._toContours(c.paths);f.length<1&&hb.panic("The input design is invalid."),e=xb._extractBoundaryContours(e,b.windingRule),f=xb._extractBoundaryContours(f,c.windingRule),0===f.length&&hb.panic("No valid contours found on input design.");var g=xb._emboss(e,f,d),h=new R;return g.forEach(function(a){h.indexedTriangles(a.vertices,a.indices)}),h}};g(yb,"Creation"),c.exports.Creation=yb,C.toSketch2DFromSVG=function(a){if(!a||a.length<5)return O.log("parseSVG: input string is empty (data len "+a.byteLength+")"),void 0;if(a=a.replace(/^[\s\uFEFF\xA0]+/g,""),0===a.length)return O.log("parseSVG: input string has only whitespace"),void 0;var b=a.substr(0,5);if("<?xml"!==b)return O.log("parseSVG: input string is not XML (missing header)"),void 0;var c=new zb,d=c.buildSvg(),e=new c.Context(d,y,eb),f=d.loadXml(e,a);return f||hb.panic("Failed to parse the svg data."),0==e.paths.length&&hb.panic("The imported SVG data seems to be empty."),new rb(e.paths)},C.toSketch2DFromText=function(a,b,c){if(!a||!b)return void 0;if(0===a.replace(/^\s+|\s+$/g,"").length)return void 0;if("string"==typeof b){if(c&&("number"!=typeof c||f(c,0)||0>c))return void 0;b=new Eb(b,c)}for(var d=[],e=0,g=(new _).identity(),h=0,i=a.length;i>h;h++){var j=a[h],k=b.glyphPaths(j);if(e&&k.length){g.translation(e,0);for(var l=0,m=k.length;m>l;l++)k[l].transform(g)}Array.prototype.push.apply(d,k),e+=b.glyphAdvance(j)}return new rb(d)},C.toMesh3DFromSTL=function(a){a instanceof DataView||hb.panic("The input STL data is not a DataView object.");var b=new R;return Ab.parseBinarySTL(a,b)?b:Ab.parseAsciiSTL(a,b)?b:void 0},C.toAsciiSTLFromMesh3D=function(a){a instanceof R||hb.panic("The input data is not a Mesh3D object.");var b=a._impl._vertices,c=a._impl._triangles,d="";d+="solid ascii\n";for(var e=c.length,f=0;e>f;f+=3){var g=3*c[f],h=3*c[f+1],i=3*c[f+2],j=a._impl._triangleNormal(c,b,f);d+="  facet normal "+j[0]+" "+j[1]+" "+j[2]+"\n",d+="    outer loop\n",d+="      vertex "+b[g]+" "+b[g+1]+" "+b[g+2]+"\n",d+="      vertex "+b[h]+" "+b[h+1]+" "+b[h+2]+"\n",d+="      vertex "+b[i]+" "+b[i+1]+" "+b[i+2]+"\n",d+="    endloop\n",d+="  endfacet\n"}return d+="endsolid\n"},C.toBinarySTLFromMesh3D=function(a){a instanceof R||hb.panic("The input data is not a Mesh3D object.");for(var b=a._impl._vertices,c=a._impl._triangles,d=new ArrayBuffer(84+50*(c.length/3)),e=new DataView(d),f=0;80>f;f++)e.setInt8(f,0);var g=!0;e.setUint32(80,c.length/3,g);for(var h=84,i,j,k=c.length,f=0;k>f;f+=3){i=a._impl._triangleNormal(c,b,f/3),e.setFloat32(h,i[0],g),h+=4,e.setFloat32(h,i[1],g),h+=4,e.setFloat32(h,i[2],g),h+=4;for(var l=0;3>l;l++)j=3*c[f+l],e.setFloat32(h,b[j],g),h+=4,e.setFloat32(h,b[j+1],g),h+=4,e.setFloat32(h,b[j+2],g),h+=4;e.setUint16(h,0,g),h+=2}return d},C.toBase64FromArrayBuffer=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(a),e=d.byteLength,f=e%3,g=e-f,h,i,j,k,l,m=0;g>m;m+=3)l=d[m]<<16|d[m+1]<<8|d[m+2],h=(16515072&l)>>18,i=(258048&l)>>12,j=(4032&l)>>6,k=63&l,b+=c[h]+c[i]+c[j]+c[k];return 1==f?(l=d[g],h=(252&l)>>2,i=(3&l)<<4,b+=c[h]+c[i]+"=="):2==f&&(l=d[g]<<8|d[g+1],h=(64512&l)>>10,i=(1008&l)>>4,j=(15&l)<<2,b+=c[h]+c[i]+c[j]+"="),b},C.toArrayBufferFromBase64=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=b.indexOf(a.charAt(a.length-1)),d=b.indexOf(a.charAt(a.length-2)),e=3*(a.length/4);64==c&&e--,64==d&&e--;var f=new ArrayBuffer(e),g=new Uint8Array(f),h,i,j,k,l,m,n,o=0,p=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),o=0;e>o;o+=3)k=b.indexOf(a.charAt(p++)),l=b.indexOf(a.charAt(p++)),m=b.indexOf(a.charAt(p++)),n=b.indexOf(a.charAt(p++)),h=k<<2|l>>4,i=(15&l)<<4|m>>2,j=(3&m)<<6|n,g[o]=h,64!=m&&(g[o+1]=i),64!=n&&(g[o+2]=j);return f};var zb=function(){function a(b){this.ok=!1,"#"==b.charAt(0)&&(b=b.substr(1,6)),b=b.replace(/ /g,""),b=b.toLowerCase();var c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var d in c)b==d&&(b=c[d]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],f=0;f<e.length;f++){var g=e[f].re,h=e[f].process,i=g.exec(b);if(i){var j=h(i);this.r=j[0],this.g=j[1],this.b=j[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var b=new Array,d=0;d<e.length;d++)for(var f=e[d].example,g=0;g<f.length;g++)b[b.length]=f[g];for(var h in c)b[b.length]=h;var i=document.createElement("ul");i.setAttribute("id","rgbcolor-examples");for(var d=0;d<b.length;d++)try{var j=document.createElement("li"),k=new a(b[d]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+k.toHex()+"; "+"color:"+k.toHex(),l.appendChild(document.createTextNode("test"));var m=document.createTextNode(" "+b[d]+" -> "+k.toRGB()+" -> "+k.toHex());j.appendChild(l),j.appendChild(m),i.appendChild(j)}catch(n){}return i}}function b(a,b,c){this.xmlParser=b,this.Path2D=c,this.paths=[],this.transformStack=[],this.styleStack=[],this.transformation=d.create(),this.bbox=new a.BoundingBox,this.lastPt=[0,0],d.identity(this.transformation),this.setDefaults=function(){this.strokeStyle="#000000",this.fillStyle="#000000",this.globalAlpha=1,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="rgba(0,0,0,0)",this.globalCompositeOperation="source-over",this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic"},this.setDefaults(),this.getStyleObj=function(){var a={};return a.strokeStyle=this.strokeStyle,a.fillStyle=this.fillStyle,a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.lineCap=this.lineCap,a.lineJoin=this.lineJoin,a.miterLimit=this.miterLimit,a.shadowOffsetX=this.shadowOffsetX,a.shadowOffsetY=this.shadowOffsetY,a.shadowBlur=this.shadowBlur,a.shadowColor=this.shadowColor,a.globalCompositeOperation=this.globalCompositeOperation,a.font=this.font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a},this.curPath=function(){return this.paths[this.paths.length-1]},this.save=function(a,b){var c=d.create();d.set(c,this.transformation),this.transformStack.push(c);var e=this.getStyleObj();this.styleStack.push(e)},this.restore=function(a,b){this.transformation=this.transformStack.pop();var c=this.transformation,d=this.styleStack.pop()},this.beginPath=function(){this.paths.push(new this.Path2D)},this.closePath=function(){var a=this.curPath();a.close()},this.clip=function(){O.log("! clip not implemented")},this.stroke=function(){},this.fill=function(){},this.moveTo=function(a,b){var c=[a,b];d.transformPoint(c,this.transformation,c);var e=this.curPath();e.moveTo(c[0],-c[1]),this.bbox.addPoint(c[0],-c[1]),this.lastPt[0]=c[0],this.lastPt[1]=-c[1]},this.lineTo=function(a,b){var c=[a,b];d.transformPoint(c,this.transformation,c);var e=this.curPath();e.lineTo(c[0],-c[1]),this.bbox.addPoint(c[0],-c[1]),this.lastPt[0]=c[0],this.lastPt[1]=-c[1]},this.quadraticCurveTo=function(a,b,c,e){var f=[c,e];d.transformPoint(f,this.transformation,f);var g=[a,b];d.transformPoint(g,this.transformation,g);var h=this.curPath();h.quadraticCurveTo(g[0],-g[1],f[0],-f[1]),this.bbox.addQuadraticCurve(this.lastPt[0],this.lastPt[1],g[0],-g[1],f[0],-f[1]),this.lastPt[0]=f[0],this.lastPt[1]=-f[1]},this.bezierCurveTo=function(a,b,c,e,f,g){var h=[f,g];d.transformPoint(h,this.transformation,h);var i=[a,b];d.transformPoint(i,this.transformation,i);var j=[c,e];d.transformPoint(j,this.transformation,j);var k=this.curPath();k.bezierCurveTo(i[0],-i[1],j[0],-j[1],h[0],-h[1]),this.bbox.addBezierCurve(this.lastPt[0],this.lastPt[1],i[0],-i[1],j[0],-j[1],h[0],-h[1]),this.lastPt[0]=h[0],this.lastPt[1]=-h[1]},this.rotate=function(a){var b=d.create([Math.cos(a),Math.sin(a),0,-Math.sin(a),Math.cos(a),0,0,0,1]);d.multiply(this.transformation,this.transformation,b)},this.scale=function(a,b){var c=d.create([a,0,0,0,b,0,0,0,1]);d.multiply(this.transformation,this.transformation,c)},this.setTransform=function(a,b,c,e,f,g){var h=d.create([a,c,f,b,e,g,0,0,1]);d.transpose(h,h),this.transformation=h},this.translate=function(a,b){var c=d.create([1,0,0,0,1,0,a,b,1]);d.multiply(this.transformation,this.transformation,c)},this.transform=function(a,b,c,e,f,g){var h=d.create([a,b,0,c,e,0,f,g,1]);d.multiply(this.transformation,this.transformation,h)},this.arc=function(a,b,c,d,e,f){function g(a){return a*a}for(var h=Math.ceil(4*(Math.abs(e-d)/Math.PI)),i=0;h>i;i++){var j=c,k=c,l=d+i*(e-d)/h,m=d+(i+1)*(e-d)/h,n=Math.sin(m-l)*(Math.sqrt(4+3*g(Math.tan((m-l)/2)))-1)/3,o=0,p=Math.cos(o),q=Math.sin(o),r=a+j*p*Math.cos(l)-k*q*Math.sin(l),s=b+j*q*Math.cos(l)+k*p*Math.sin(l),t=a+j*p*Math.cos(m)-k*q*Math.sin(m),u=b+j*q*Math.cos(m)+k*p*Math.sin(m),v=r+n*(-j*p*Math.sin(l)-k*q*Math.cos(l)),w=s+n*(-j*q*Math.sin(l)+k*p*Math.cos(l)),x=t-n*(-j*p*Math.sin(m)-k*q*Math.cos(m)),y=u-n*(-j*q*Math.sin(m)+k*p*Math.cos(m));this.bezierCurveTo(v,w,x,y,t,u)}}}function c(){var b={};return b.opts={},b.FRAMERATE=30,b.MAX_VIRTUAL_PIXELS=3e4,b.init=function(a){b.Definitions={},b.Styles={},b.Animations=[],b.Images=[],b.ctx=a,b.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},b.init(),b.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},b.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},b.Property=function(c,d){this.name=c,this.value=d,this.hasValue=function(){return null!=this.value&&""!==this.value},this.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},this.valueOrDefault=function(a){return this.hasValue()?this.value:a},this.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};var e=this;this.Color={addOpacity:function(c){var d=e.value;if(null!=c&&""!=c){var f=new a(e.value);f.ok&&(d="rgba("+f.r+", "+f.g+", "+f.b+", "+c+")")}return new b.Property(e.name,d)}},this.Definition={getDefinition:function(){var a=e.value.replace(/^(url\()?#([^\)]+)\)?$/,"$2");return b.Definitions[a]},isUrl:function(){return 0==e.value.indexOf("url(")},getFillStyle:function(a){var b=this.getDefinition();return null}},this.Length={DPI:function(a){return 96},EM:function(a){var c=12,d=new b.Property("fontSize",b.Font.Parse(b.ctx.font).fontSize);return d.hasValue()&&(c=d.Length.toPixels(a)),c},toPixels:function(a){if(!e.hasValue())return 0;var c=e.value+"";return c.match(/em$/)?e.numValue()*this.EM(a):c.match(/ex$/)?e.numValue()*this.EM(a)/2:c.match(/px$/)?e.numValue():c.match(/pt$/)?1.25*e.numValue():c.match(/pc$/)?15*e.numValue():c.match(/cm$/)?e.numValue()*this.DPI(a)/2.54:c.match(/mm$/)?e.numValue()*this.DPI(a)/25.4:c.match(/in$/)?e.numValue()*this.DPI(a):c.match(/%$/)?e.numValue()*b.ViewPort.ComputeSize(a):e.numValue()}},this.Time={toMilliseconds:function(){if(!e.hasValue())return 0;var a=e.value+"";return a.match(/s$/)?1e3*e.numValue():a.match(/ms$/)?e.numValue():e.numValue()}},this.Angle={toRadians:function(){if(!e.hasValue())return 0;var a=e.value+"";return a.match(/deg$/)?e.numValue()*(Math.PI/180):a.match(/grad$/)?e.numValue()*(Math.PI/200):a.match(/rad$/)?e.numValue():e.numValue()*(Math.PI/180)}}},b.Font=new function(){this.Styles=["normal","italic","oblique","inherit"],this.Variants=["normal","small-caps","inherit"],this.Weights=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900","inherit"],this.CreateFont=function(a,c,d,e,f,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",b.ctx.font);return{fontFamily:f||h.fontFamily,fontSize:e||h.fontSize,fontStyle:a||h.fontStyle,fontWeight:d||h.fontWeight,fontVariant:c||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var a=this;this.Parse=function(c){for(var d={},e=b.trim(b.compressSpaces(c||"")).split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<e.length;h++)f.fontStyle||-1==a.Styles.indexOf(e[h])?f.fontVariant||-1==a.Variants.indexOf(e[h])?f.fontWeight||-1==a.Weights.indexOf(e[h])?f.fontSize?"inherit"!=e[h]&&(g+=e[h]):("inherit"!=e[h]&&(d.fontSize=e[h].split("/")[0]),f.fontStyle=f.fontVariant=f.fontWeight=f.fontSize=!0):("inherit"!=e[h]&&(d.fontWeight=e[h]),f.fontStyle=f.fontVariant=f.fontWeight=!0):("inherit"!=e[h]&&(d.fontVariant=e[h]),f.fontStyle=f.fontVariant=!0):("inherit"!=e[h]&&(d.fontStyle=e[h]),f.fontStyle=!0);return""!=g&&(d.fontFamily=g),d}},b.ToNumberArray=function(a){for(var c=b.trim(b.compressSpaces((a||"").replace(/,/g," "))).split(" "),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);return c},b.Point=function(a,b){this.x=a,this.y=b,this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c}},b.CreatePoint=function(a){var c=b.ToNumberArray(a);return new b.Point(c[0],c[1])},b.CreatePath=function(a){for(var c=b.ToNumberArray(a),d=[],e=0;e<c.length;e+=2)d.push(new b.Point(c[e],c[e+1]));return d},b.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var i=[a,b],j=[c,d],k=[e,f],l=[g,h];this.addPoint(i[0],i[1]),this.addPoint(l[0],l[1]);for(var m=0;1>=m;m++){var n=function(a){return Math.pow(1-a,3)*i[m]+3*Math.pow(1-a,2)*a*j[m]+3*(1-a)*Math.pow(a,2)*k[m]+Math.pow(a,3)*l[m]},o=6*i[m]-12*j[m]+6*k[m],p=-3*i[m]+9*j[m]-9*k[m]+3*l[m],q=3*j[m]-3*i[m];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(0>r)){var s=(-o+Math.sqrt(r))/(2*p);s>0&&1>s&&(0==m&&this.addX(n(s)),1==m&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);t>0&&1>t&&(0==m&&this.addX(n(t)),1==m&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;u>0&&1>u&&(0==m&&this.addX(n(u)),1==m&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},b.Transform=function(a){var c=this;this.Type={},this.Type.translate=function(a){this.p=b.CreatePoint(a),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(a){var c=b.ToNumberArray(a);this.angle=new b.Property("angle",c[0]),this.cx=c[1]||0,this.cy=c[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.Angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.Angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(a){this.p=b.CreatePoint(a),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(a){this.m=b.ToNumberArray(a),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(a){this.base=c.Type.matrix,this.base(a),this.angle=new b.Property("angle",a)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.Angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.Angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var d=b.trim(b.compressSpaces(a)).split(/\s(?=[a-z])/),e=0;e<d.length;e++){var f=d[e].split("(")[0],g=d[e].split("(")[1].replace(")",""),h=new this.Type[f](g);this.transforms.push(h)}},b.AspectRatio=function(a,c,d,e,f,g,h,i,j,k){c=b.compressSpaces(c),c=c.replace(/^defer\s/,"");var l=c.split(" ")[0]||"xMidYMid",m=c.split(" ")[1]||"meet",n=d/e,o=f/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(e*=p,g*=p),"slice"==m&&(e*=q,g*=q),j=new b.Property("refX",j),k=new b.Property("refY",k),j.hasValue()&&k.hasValue()?a.translate(-p*j.Length.toPixels("x"),-p*k.Length.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(d/2-e/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,f/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(d-e,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,f-g)),"none"==l?a.scale(n,o):"meet"==m?a.scale(p,p):"slice"==m&&a.scale(q,q),a.translate(null==h?0:-h,null==i?0:-i)},b.Element={},b.Element.ElementBase=function(a){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(a,c){var d=this.attributes[a];return null!=d?d:(d=new b.Property(a,""),c===!0&&(this.attributes[a]=d),d)},this.style=function(a,c){var d=this.styles[a];if(null!=d)return d;var e=this.attribute(a);if(null!=e&&e.hasValue())return e;var f=this.parent;if(null!=f){var g=f.style(a);if(null!=g&&g.hasValue())return g}return d=new b.Property(a,""),c===!0&&(this.styles[a]=d),d},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value&&0!=this.style("fill-opacity").numValueOrDefault(1)&&0!=this.style("stroke-opacity").numValueOrDefault(1)){if(a.save(),this.setContext(a),this.attribute("mask").hasValue()){var b=this.attribute("mask").Definition.getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").Definition.getDefinition();null!=c&&c.apply(a,this)}else this.renderChildren(a);this.clearContext(a),a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(a,c){var d=a;c&&(d=b.CreateElement(a)),d.parent=this,this.children.push(d)},this.getBoundingBox=function(){for(var a=new b.BoundingBox,c=0;c<this.children.length;c++)a.addBoundingBox(this.children[c].getBoundingBox());return a},a&&"element"==a.type()){for(var c=a.name(),d=a.childNodes(),e=0,f=d.length;f>e;e++){var g=d[e];if("element"==g.type()&&this.addChild(g,!0),"text"==a.name()&&"text"==g.type()){var h=g.text()||g.nodeValue||g.text||"";h&&""!=b.trim(b.compressSpaces(h))&&this.addChild(new b.Element.tspan(g),!1)}}for(var i=a.attrs(),e=0;e<i.length;e++){var j=i[e],k=j.name(),l=j.value();this.attributes[k]=new b.Property(k,l)}var m=b.Styles[c];if(null!=m)for(var n in m)this.styles[n]=m[n];if(this.attribute("class").hasValue())for(var o=b.compressSpaces(this.attribute("class").value).split(" "),p=0;p<o.length;p++){if(m=b.Styles["."+o[p]],null!=m)for(var n in m)this.styles[n]=m[n];if(m=b.Styles[c+"."+o[p]],null!=m)for(var n in m)this.styles[n]=m[n]}if(this.attribute("style").hasValue())for(var m=this.attribute("style").value.split(";"),e=0;e<m.length;e++)if(""!=b.trim(m[e])){var q=m[e].split(":"),n=b.trim(q[0]),r=b.trim(q[1]);this.styles[n]=new b.Property(n,r)}this.attribute("id").hasValue()&&null==b.Definitions[this.attribute("id").value]&&(b.Definitions[this.attribute("id").value]=this)}},b.Element.RenderedElementBase=function(a){this.base=b.Element.ElementBase,this.base(a),this.setContext=function(a){if(this.style("fill").Definition.isUrl()){var c=this.style("fill").Definition.getFillStyle(this);null!=c&&(a.fillStyle=c)}else if(this.style("fill").hasValue()){var d=this.style("fill");this.style("fill-opacity").hasValue()&&(d=d.Color.addOpacity(this.style("fill-opacity").value)),a.fillStyle="none"==d.value?"rgba(0,0,0,0)":d.value}if(this.style("stroke").Definition.isUrl()){var c=this.style("stroke").Definition.getFillStyle(this);null!=c&&(a.strokeStyle=c)}else if(this.style("stroke").hasValue()){var e=this.style("stroke");this.style("stroke-opacity").hasValue()&&(e=e.Color.addOpacity(this.style("stroke-opacity").value)),a.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value}if(this.style("stroke-width").hasValue()&&(a.lineWidth=this.style("stroke-width").Length.toPixels()),this.style("stroke-linecap").hasValue()&&(a.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(a.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(a.miterLimit=this.style("stroke-miterlimit").value),"undefined"!=typeof a.font&&(a.font=b.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").Length.toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var f=new b.Transform(this.attribute("transform").value);f.apply(a)}this.style("opacity").hasValue()&&(a.globalAlpha=this.style("opacity").numValue())}},b.Element.RenderedElementBase.prototype=new b.Element.ElementBase,b.Element.PathElementBase=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.path=function(a){return null!=a&&a.beginPath(),new b.BoundingBox},this.renderChildren=function(a){this.path(a),""!=a.fillStyle&&a.fill(),""!=a.strokeStyle&&a.stroke();var b=this.getMarkers();if(null!=b){if(this.style("marker-start").Definition.isUrl()){var c=this.style("marker-start").Definition.getDefinition();c.render(a,b[0][0],b[0][1])}if(this.style("marker-mid").Definition.isUrl())for(var c=this.style("marker-mid").Definition.getDefinition(),d=1;d<b.length-1;d++)c.render(a,b[d][0],b[d][1]);if(this.style("marker-end").Definition.isUrl()){var c=this.style("marker-end").Definition.getDefinition();c.render(a,b[b.length-1][0],b[b.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},b.Element.PathElementBase.prototype=new b.Element.RenderedElementBase,b.Element.svg=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseClearContext=this.clearContext,this.clearContext=function(a){this.baseClearContext(a),b.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(a){a.strokeStyle="rgba(0,0,0,0)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,this.baseSetContext(a),this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&a.translate(this.attribute("x").Length.toPixels("x"),this.attribute("y").Length.toPixels("y"));var c=b.ViewPort.width(),d=b.ViewPort.height();if("undefined"==typeof this.root&&this.attribute("width").hasValue()&&this.attribute("height").hasValue()){c=this.attribute("width").Length.toPixels("x"),d=this.attribute("height").Length.toPixels("y");var e=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(e=-this.attribute("refX").Length.toPixels("x"),f=-this.attribute("refY").Length.toPixels("y")),a.beginPath(),a.moveTo(e,f),a.lineTo(c,f),a.lineTo(c,d),a.lineTo(e,d),a.closePath(),a.clip()}if(b.ViewPort.SetCurrent(c,d),this.attribute("viewBox").hasValue()){var g=b.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];c=g[2],d=g[3],b.AspectRatio(a,this.attribute("preserveAspectRatio").value,b.ViewPort.width(),c,b.ViewPort.height(),d,h,i,this.attribute("refX").value,this.attribute("refY").value),b.ViewPort.RemoveCurrent(),b.ViewPort.SetCurrent(g[2],g[3])}}},b.Element.svg.prototype=new b.Element.RenderedElementBase,b.Element.rect=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=this.attribute("x").Length.toPixels("x"),d=this.attribute("y").Length.toPixels("y"),e=this.attribute("width").Length.toPixels("x"),f=this.attribute("height").Length.toPixels("y"),g=this.attribute("rx").Length.toPixels("x"),h=this.attribute("ry").Length.toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),null!=a&&(a.beginPath(),a.moveTo(c+g,d),a.lineTo(c+e-g,d),a.quadraticCurveTo(c+e,d,c+e,d+h),a.lineTo(c+e,d+f-h),a.quadraticCurveTo(c+e,d+f,c+e-g,d+f),a.lineTo(c+g,d+f),a.quadraticCurveTo(c,d+f,c,d+f-h),a.lineTo(c,d+h),a.quadraticCurveTo(c,d,c+g,d),a.closePath()),new b.BoundingBox(c,d,c+e,d+f)}},b.Element.rect.prototype=new b.Element.PathElementBase,b.Element.circle=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("cx").Length.toPixels("x"),e=this.attribute("cy").Length.toPixels("y"),f=this.attribute("r").Length.toPixels("x"),g=this.attribute("r").Length.toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(d,e-g),a.bezierCurveTo(d+c*f,e-g,d+f,e-c*g,d+f,e),a.bezierCurveTo(d+f,e+c*g,d+c*f,e+g,d,e+g),a.bezierCurveTo(d-c*f,e+g,d-f,e+c*g,d-f,e),a.bezierCurveTo(d-f,e-c*g,d-c*f,e-g,d,e-g),a.closePath()),new b.BoundingBox(d-f,e-g,d+f,e+g)}},b.Element.circle.prototype=new b.Element.PathElementBase,b.Element.ellipse=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("rx").Length.toPixels("x"),e=this.attribute("ry").Length.toPixels("y"),f=this.attribute("cx").Length.toPixels("x"),g=this.attribute("cy").Length.toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(f,g-e),a.bezierCurveTo(f+c*d,g-e,f+d,g-c*e,f+d,g),a.bezierCurveTo(f+d,g+c*e,f+c*d,g+e,f,g+e),a.bezierCurveTo(f-c*d,g+e,f-d,g+c*e,f-d,g),a.bezierCurveTo(f-d,g-c*e,f-c*d,g-e,f,g-e),a.closePath()),new b.BoundingBox(f-d,g-e,f+d,g+e)
}},b.Element.ellipse.prototype=new b.Element.PathElementBase,b.Element.line=function(a){this.base=b.Element.PathElementBase,this.base(a),this.getPoints=function(){return[new b.Point(this.attribute("x1").Length.toPixels("x"),this.attribute("y1").Length.toPixels("y")),new b.Point(this.attribute("x2").Length.toPixels("x"),this.attribute("y2").Length.toPixels("y"))]},this.path=function(a){var c=this.getPoints();return null!=a&&(a.beginPath(),a.moveTo(c[0].x,c[0].y),a.lineTo(c[1].x,c[1].y)),new b.BoundingBox(c[0].x,c[0].y,c[1].x,c[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},b.Element.line.prototype=new b.Element.PathElementBase,b.Element.polyline=function(a){this.base=b.Element.PathElementBase,this.base(a),this.points=b.CreatePath(this.attribute("points").value),this.path=function(a){var c=new b.BoundingBox(this.points[0].x,this.points[0].y);null!=a&&(a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)c.addPoint(this.points[d].x,this.points[d].y),null!=a&&a.lineTo(this.points[d].x,this.points[d].y);return c},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},b.Element.polyline.prototype=new b.Element.PathElementBase,b.Element.polygon=function(a){this.base=b.Element.polyline,this.base(a),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},b.Element.polygon.prototype=new b.Element.polyline,b.Element.path=function(a){this.base=b.Element.PathElementBase,this.base(a);var c=this.attribute("d").value;c=c.replace(/,/gm," "),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([0-9])([+\-])/gm,"$1 $2"),c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),c=b.compressSpaces(c),c=b.trim(c),this.PathParser=new function(a){this.tokens=a.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new b.Point(0,0),this.control=new b.Point(0,0),this.current=new b.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){return this.command==this.command.toLowerCase()},this.getToken=function(){return this.i=this.i+1,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var a=new b.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(a)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var a=new b.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return a},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x=this.current.x+a.x,a.y=this.current.y+a.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c),this.path=function(a){var c=this.PathParser;c.reset();var d=new b.BoundingBox;for(null!=a&&a.beginPath();!c.isEnd();)switch(c.nextCommand(),c.command.toUpperCase()){case"M":var e=c.getAsCurrentPoint();for(c.addMarker(e),d.addPoint(e.x,e.y),null!=a&&a.moveTo(e.x,e.y),c.start=c.current;!c.isCommandOrEnd();){var e=c.getAsCurrentPoint();c.addMarker(e,c.start),d.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y)}break;case"L":for(;!c.isCommandOrEnd();){var f=c.current,e=c.getAsCurrentPoint();c.addMarker(e,f),d.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y)}break;case"H":for(;!c.isCommandOrEnd();){var g=new b.Point((c.isRelativeCommand()?c.current.x:0)+c.getScalar(),c.current.y);c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=a&&a.lineTo(c.current.x,c.current.y)}break;case"V":for(;!c.isCommandOrEnd();){var g=new b.Point(c.current.x,(c.isRelativeCommand()?c.current.y:0)+c.getScalar());c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=a&&a.lineTo(c.current.x,c.current.y)}break;case"C":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getReflectedControlPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getReflectedControlPoint();c.control=j;var k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":for(;!c.isCommandOrEnd();){var h=c.current,l=c.getScalar(),m=c.getScalar(),n=c.getScalar()*(Math.PI/180),o=c.getScalar(),p=c.getScalar(),k=c.getAsCurrentPoint(),q=new b.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new b.Point(s*l*q.y/m,s*-m*q.x/l),u=new b.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0),0==p&&B>0&&(B-=2*Math.PI),1==p&&0>B&&(B+=2*Math.PI);var C=new b.Point(u.x-l*Math.cos((y+B)/2),u.y-m*Math.sin((y+B)/2));if(c.addMarkerAngle(C,(y+B)/2+(0==p?1:-1)*Math.PI/2),c.addMarkerAngle(k,B+(0==p?1:-1)*Math.PI/2),d.addPoint(k.x,k.y),null!=a){var w=l>m?l:m,D=l>m?1:l/m,E=l>m?m/l:1;a.translate(u.x,u.y),a.rotate(n),a.scale(D,E),a.arc(0,0,w,y,y+B,1-p),a.scale(1/D,1/E),a.rotate(-n),a.translate(-u.x,-u.y)}}break;case"Z":null!=a&&a.closePath(),c.current=c.start}return d},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},b.Element.path.prototype=new b.Element.PathElementBase,b.Element.marker=function(a){this.base=b.Element.ElementBase,this.base(a),this.baseRender=this.render,this.render=function(a,c,d){a.translate(c.x,c.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(d),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(a.lineWidth,a.lineWidth),a.save();var e=new b.Element.svg;e.attributes.viewBox=new b.Property("viewBox",this.attribute("viewBox").value),e.attributes.refX=new b.Property("refX",this.attribute("refX").value),e.attributes.refY=new b.Property("refY",this.attribute("refY").value),e.attributes.width=new b.Property("width",this.attribute("markerWidth").value),e.attributes.height=new b.Property("height",this.attribute("markerHeight").value),e.attributes.fill=new b.Property("fill",this.attribute("fill").valueOrDefault("black")),e.attributes.stroke=new b.Property("stroke",this.attribute("stroke").valueOrDefault("none")),e.children=this.children,e.render(a),a.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(1/a.lineWidth,1/a.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(-d),a.translate(-c.x,-c.y)}},b.Element.marker.prototype=new b.Element.ElementBase,b.Element.defs=function(a){this.base=b.Element.ElementBase,this.base(a),this.render=function(a){}},b.Element.defs.prototype=new b.Element.ElementBase,b.Element.font=function(a){this.base=b.Element.ElementBase,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"font-face"==d.type?(this.fontFace=d,d.style("font-family").hasValue()&&(b.Definitions[d.style("font-family").value]=this)):"missing-glyph"==d.type?this.missingGlyph=d:"glyph"==d.type&&(""!=d.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[d.unicode]&&(this.glyphs[d.unicode]=[]),this.glyphs[d.unicode][d.arabicForm]=d):this.glyphs[d.unicode]=d)}},b.Element.font.prototype=new b.Element.ElementBase,b.Element.fontface=function(a){this.base=b.Element.ElementBase,this.base(a),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},b.Element.fontface.prototype=new b.Element.ElementBase,b.Element.missingglyph=function(a){this.base=b.Element.path,this.base(a),this.horizAdvX=0},b.Element.missingglyph.prototype=new b.Element.path,b.Element.glyph=function(a){this.base=b.Element.path,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},b.Element.glyph.prototype=new b.Element.path,b.Element.text=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.style("dominant-baseline").hasValue()&&(a.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(a.textBaseline=this.style("alignment-baseline").value)},this.renderChildren=function(a){for(var b=this.style("text-anchor").valueOrDefault("start"),c=this.attribute("x").Length.toPixels("x"),d=this.attribute("y").Length.toPixels("y"),e=0;e<this.children.length;e++){var f=this.children[e];f.attribute("x").hasValue()?f.x=f.attribute("x").Length.toPixels("x"):(f.attribute("dx").hasValue()&&(c+=f.attribute("dx").Length.toPixels("x")),f.x=c);var g=f.measureText(a);if("start"!=b&&(0==e||f.attribute("x").hasValue())){for(var h=g,i=e+1;i<this.children.length;i++){var j=this.children[i];if(j.attribute("x").hasValue())break;h+=j.measureText(a)}f.x-="end"==b?h:h/2}c=f.x+g,f.attribute("y").hasValue()?f.y=f.attribute("y").Length.toPixels("y"):(f.attribute("dy").hasValue()&&(d+=f.attribute("dy").Length.toPixels("y")),f.y=d),d=f.y,f.render(a)}}},b.Element.text.prototype=new b.Element.RenderedElementBase,b.Element.TextElementBase=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),"undefined"!=typeof a.glyphs[d]&&(e=a.glyphs[d][f],null==e&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d]))}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(a){var c=this.parent.style("font-family").Definition.getDefinition();if(null==c)""!=a.strokeStyle&&a.strokeText(b.compressSpaces(this.getText()),this.x,this.y),""!=a.fillStyle&&a.fillText(b.compressSpaces(this.getText()),this.x,this.y);else{var d=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),e=this.parent.style("font-style").valueOrDefault(b.Font.Parse(b.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=b.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h),j=d/c.fontFace.unitsPerEm;a.translate(this.x,this.y),a.scale(j,-j);var k=a.lineWidth;a.lineWidth=a.lineWidth*c.fontFace.unitsPerEm/d,"italic"==e&&a.transform(1,0,.4,1,0,0),i.render(a),"italic"==e&&a.transform(1,0,-.4,1,0,0),a.lineWidth=k,a.scale(1/j,-1/j),a.translate(-this.x,-this.y),this.x+=d*(i.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureText=function(a){var c=this.parent.style("font-family").Definition.getDefinition();if(null!=c){var d=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),e=0,f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=b.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h);e+=(i.horizAdvX||c.horizAdvX)*d/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(e+=g[h])}return e}var j=b.compressSpaces(this.getText());if(!a.measureText)return 10*j.length;a.save(),this.setContext(a);var k=a.measureText(j).width;return a.restore(),k}},b.Element.TextElementBase.prototype=new b.Element.RenderedElementBase,b.Element.tspan=function(a){this.base=b.Element.TextElementBase,this.base(a),this.text=a.text()||"",this.getText=function(){return this.text}},b.Element.tspan.prototype=new b.Element.TextElementBase,b.Element.g=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.getBoundingBox=function(){for(var a=new b.BoundingBox,c=0;c<this.children.length;c++)a.addBoundingBox(this.children[c].getBoundingBox());return a}},b.Element.g.prototype=new b.Element.RenderedElementBase,b.Element.symbol=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){if(this.baseSetContext(a),this.attribute("viewBox").hasValue()){var c=b.ToNumberArray(this.attribute("viewBox").value),d=c[0],e=c[1];width=c[2],height=c[3],b.AspectRatio(a,this.attribute("preserveAspectRatio").value,this.attribute("width").Length.toPixels("x"),width,this.attribute("height").Length.toPixels("y"),height,d,e),b.ViewPort.SetCurrent(c[2],c[3])}}},b.Element.symbol.prototype=new b.Element.RenderedElementBase,b.Element.style=function(a){this.base=b.Element.ElementBase,this.base(a);var c=a.childNodes()[0].nodeValue+(a.childNodes().length>1?a.childNodes()[1].nodeValue:"");c=c.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),c=b.compressSpaces(c);for(var d=c.split("}"),e=0;e<d.length;e++)if(""!=b.trim(d[e]))for(var f=d[e].split("{"),g=f[0].split(","),h=f[1].split(";"),i=0;i<g.length;i++){var j=b.trim(g[i]);if(""!=j){for(var k={},l=0;l<h.length;l++){var m=h[l].indexOf(":"),n=h[l].substr(0,m),o=h[l].substr(m+1,h[l].length-m);null!=n&&null!=o&&(k[b.trim(n)]=new b.Property(b.trim(n),b.trim(o)))}if(b.Styles[j]=k,"@font-face"==j)for(var p=k["font-family"].value.replace(/"/g,""),q=k.src.value.split(","),r=0;r<q.length;r++)if(q[r].indexOf('format("svg")')>0)for(var s=q[r].indexOf("url"),t=q[r].indexOf(")",s),u=q[r].substr(s+5,t-s-6),v=b.parseXml(b.ajax(u)),w=v.getElementsByTagName("font"),x=0;x<w.length;x++){var y=b.CreateElement(w[x]);b.Definitions[p]=y}}}},b.Element.style.prototype=new b.Element.ElementBase,b.Element.use=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").Length.toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").Length.toPixels("y"))},this.getDefinition=function(){var a=this.attribute("xlink:href").Definition.getDefinition();return this.attribute("width").hasValue()&&(a.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(a.attribute("height",!0).value=this.attribute("height").value),a},this.path=function(a){var b=this.getDefinition();null!=b&&b.path(a)},this.renderChildren=function(a){var b=this.getDefinition();null!=b&&b.render(a)}},b.Element.use.prototype=new b.Element.RenderedElementBase,b.Element.clipPath=function(a){this.base=b.Element.ElementBase,this.base(a),this.apply=function(a){for(var b=0;b<this.children.length;b++)this.children[b].path&&(this.children[b].path(a),a.clip())},this.render=function(a){O.log("no op")}},b.Element.clipPath.prototype=new b.Element.ElementBase,b.Element.title=function(a){},b.Element.title.prototype=new b.Element.ElementBase,b.Element.desc=function(a){},b.Element.desc.prototype=new b.Element.ElementBase,b.missingElements=[],b.Element.MISSING=function(a){-1===b.missingElements.indexOf(a.name())&&b.missingElements.push(a.name())},b.Element.MISSING.prototype=new b.Element.ElementBase,b.CreateElement=function(a){var c=a.name().replace(/^[^:]+:/,"");c=c.replace(/\-/g,"");var d=null;return d="undefined"!=typeof b.Element[c]?new b.Element[c](a):new b.Element.MISSING(a),d.type=a.name(),d},b.loadXml=function(a,c){var d=a.xmlParser,e=d.parseXml(c);return b.loadXmlDoc(a,e)},b.loadXmlDoc=function(a,c){if(b.init(a),!c||!c.root)return!1;var d=b.CreateElement(c.root());d.root=!0;var e=100,f=100;return d.style("width").hasValue()&&(e=d.style("width").Length.toPixels("x")),d.style("height").hasValue()&&(f=d.style("height").Length.toPixels("y")),b.ViewPort.Clear(),b.ViewPort.SetCurrent(e,f),d.render(a),!0},b}var d={};d.create=function(a){var b=new Array(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]),b},d.set=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},d.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},d.transpose=function(a,b){if(b==a){var c=b[1],d=b[2],e=b[5];return b[1]=b[3],b[2]=b[6],b[3]=c,b[5]=b[7],b[6]=d,b[7]=e,b}return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],a},d.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},d.transformPoint=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d+b[3]*e+b[6],a[1]=b[1]*d+b[4]*e+b[7],a},this.buildSvg=c,this.Context=b},Ab={parseAsciiSTL:function(a,b){for(var c=!1,d=0,e=a.byteLength,f=[0,0,0,0,0,0,0,0,0],g=0;e>d;){for(var h="";e>d;){var i=a.getUint8(d);if(d++,(10===i||13===i)&&h.length>0)break;h+=String.fromCharCode(i>127?65533:i)}h=h.replace(/\s+/g," "),h=h.trim();var j=h.split(" ");if(!c){if(j.length<1||"solid"!==j[0])return O.log("parseAsciiSTL: could not find header on first line"),!1;c=!0}if(4===j.length&&"vertex"===j[0]){var k=parseFloat(j[1]),l=parseFloat(j[2]),m=parseFloat(j[3]);if(isNaN(k)||isNaN(l)||isNaN(m))return O.log("parseAsciiSTL(): Invalid floating point value: ["+j[1]+","+j[2]+","+j[3]+"]"),!1;f[3*g+0]=k,f[3*g+1]=l,f[3*g+2]=m,g++,g>=3&&(b.triangle(f),g=0)}}return!0},parseBinarySTL:function(a,b){if(a.byteLength<84)return!1;var c=80,d=a.getUint32(c,!0),e=84+50*d;if(a.byteLength<e)return!1;c+=4;for(var f=[0,0,0,0,0,0,0,0,0],g=0,h=0;d>h;h++){c+=12;for(var i=0;3>i;i++)g=3*i,f[g]=a.getFloat32(c,!0),f[g+1]=a.getFloat32(c+4,!0),f[g+2]=a.getFloat32(c+8,!0),c+=12;b.triangle(f),c+=2}return!0}};r.prototype={constructor:r,bind:function(a){a&&this._listeners.push(a)},unbind:function(a){if(a){for(var b=this._listeners.length,c=0;b>c;c++)if(this._listeners[c]===a){this._listeners.splice(c,1);break}}else this._listeners=[]},fire:function(a,b){var c=this._listeners.length;if(c>0){var d=new s;d._target=this._target||this,d._type=this._type,d._data=a,b&&(d._originalEvent=b);for(var e=0;c>e;e++)this._listeners[e].call(this,d)}}},s.prototype={constructor:s},c.exports.EventSource=r,g(r,"EventSource");var Bb=function(a,b){this._json=a,b instanceof ab&&(this.localToParent=b)};Bb.prototype={_localToParent:function(){if(0===arguments.length)return this.localToParent?this.localToParent:this._localToWorld();if(this.localToParent){var a=arguments[0],b;a instanceof ab?b=a:Array.isArray(a)&&16===a.length?b=new ab(a):hb.panic(A);var c=b.clone().transform(this.localToParent.invert());this.localToParent=b.clone();var d=function(a,b){var c=b.clone().transform(new ab(a.TM));a.TM=c.elements;for(var e=a.children,f=0,g=e.length;g>f;f++)d(a.children[f],b)};d(this._json,c)}else this._localToWorld(arguments[0])},_localToWorld:function(){if(0===arguments.length)return this._json?new ab(this._json.TM):void 0;if(this._json){var a=arguments[0],b;a instanceof ab?b=a.elements:Array.isArray(a)&&16===a.length?b=a:hb.panic(A),this._json.TM=b}}};var Cb=function(a,b){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Bb(a,b)})};Cb.prototype={toJSON:function(){return this._impl._json},shapeByPath:function(a){if(Array.isArray(a)||hb.panic(A),a.length<1)return this;for(var b=this._impl._json,c=0,d=a.length,e,f;b&&d>c;){if(!b.children||b.children.length<=a[c])return void 0;f=b,b=b.children[a[c]],c++,c===d&&(e=b)}if(e){var g=new ab(f.TM.slice(0)),h=new ab(e.TM.slice(0)),i=h.transform(g.invert());return new Cb(e,i)}return void 0},assignGenerator:function(a){var b=this._impl._json;b&&(b.children=[],b.geom.params||(b.geom.params={}),b.pluginType="library",b.pluginId=a.libraryId,b.pluginRev=a.libraryRev,b.params=a.params,b.scale=[1,1,1])},setGeneratorParameter:function(a,b){var c=this._impl._json;c&&c.geom&&(c.geom.params||(c.geom.params={}),c.geom.params[a]=b)},setModifierParameter:function(a,b,c){0>a&&hb.panic(A);var d=this._impl._json;d&&d.mods&&(a>=d.mods.length&&hb.panic(A),d.mods[a].params||(d.mods[a].params={}),d.mods[a].params[b]=c)}},Object.defineProperty(Cb.prototype,"localToParent",{get:function(){return this._impl._localToParent()},set:function(a){return this._impl._localToParent(a)}}),g(Cb,"Shape"),c.exports.Shape=Cb;var Db=function(){var a=function(a,b){var c=a.get("xmlns:font-face",b.href());c.attr({"font-family":a.attr("id")});var d=a.get("xmlns:missing-glyph",b.href());d||(d=a.node("missing-glyph"));var e=d.attr("d");if(!e){for(var f=["?"," "],g=void 0,h=0;h<f.length;h++){var i='xmlns:glyph[@unicode="'+f[h]+'"]';if(g=a.get(i,b.href()))break}g&&(d.attr({"horiz-adv-x":g.attr("horiz-adv-x")}),d.attr({d:g.attr("d")}))}};return function(b){var c=y.parseXml(b);c&&c.root||hb.panic("The input is not a valid SVG font.");var d=c.root().namespace(),e=c.get("/xmlns:svg/xmlns:defs/xmlns:font",d.href()),f=e.attr("id");a(e,d);var g=new zb,h=g.buildSvg(),i=new g.Context(h,y,eb);h.init(i),h.CreateElement(c.root());var j=h.Definitions[f];j||hb.panic("The input is not a valid SVG font."),h.ViewPort.Clear(),h.ViewPort.SetCurrent(100,100),this._fontFamily=f,this._font=j,this._svg=h,this._context=i}}();Db.prototype=function(){var a=function(a,b){return a.glyphs[b]||a.missingGlyph};return{_glyphAdvance:function(b,c){var d=a(this._font,b);return c*(d.horizAdvX||this._font.horizAdvX)/this._font.fontFace.unitsPerEm},_glyphPaths:function(b,c){var d=this._context,e=this._font,f=a(this._font,b);d.save();var g=c/e.fontFace.unitsPerEm;d.translate(0,c),d.scale(g,-g),f.render(d);var h=d.paths;return d.paths=[],d.restore(),h}}}();var Eb=function(a,b){this.size=b||25,Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Db(a)})};Eb.prototype={glyphAdvance:function(a){return"string"!=typeof a||1!==a.length?void 0:this._impl._glyphAdvance(a,this.size)},glyphPaths:function(a){return"string"!=typeof a||1!==a.length?void 0:this._impl._glyphPaths(a,this.size)}},g(Eb,"Font"),c.exports.Font=Eb,t.prototype=new E,t.prototype._evaluate=function(a,b){var c=this._original;this._unpackParameters(a,function(d){c.evaluate(a,b)})},a.setVariable(["proxies","shapeGenerator"],function(a){if(a.__proxy)return a.__proxy;var b=new t(a);return a.__proxy=b,b}),g(t,"ShapeGeneratorProxy"),u.prototype=new E,u.prototype._evaluate=function(a,b){a.shape instanceof Cb||(a.shape="string"==typeof a.shape?new Cb(JSON.parse(a.shape)):new Cb(a.shape));var c=this._original;this._unpackParameters(a.params,function(d){a.params=d,c.evaluate(a,b)})},a.setVariable(["proxies","shapeConfigurator"],function(a){if(a.__proxy)return a.__proxy;var b=new u(a);return a.__proxy=b,b}),g(u,"ShapeConfiguratorProxy"),v.prototype=new E,v.prototype._evaluate=function(a,b){try{var c=[],d=a.instances;d.forEach(function(a){var b;if(a instanceof x)b=a;else{var d,e;"string"==typeof a&&(a=JSON.parse(a));var d=new ab(a.localToParent),e=new R;e.indexedTriangles(a.mesh.vertices,a.mesh.triangles),b=new x(d,e);for(var f=Object.keys(a),g=0;g<f.length;g++){var h=f[g];"mesh"!==h&&"localToParent"!==h&&(b[h]=a[h])}}c.push(b)}),a.instances.length=0,a.instances=c}catch(e){hb.warning("A problem occurred while deserializing context.instances")}var f=this._original;this._unpackParameters(a.params,function(c){a.params=c,f.evaluate(a,b)})},a.setVariable(["proxies","shapeModifier"],function(a){if(a.__proxy)return a.__proxy;var b=new v(a);return a.__proxy=b,b}),g(v,"ShapeModifierProxy"),x.prototype={toJSON:function(){var a={};return a.localToParent=this._impl._localToParent.toJSON(),a.mesh=this._impl._mesh.toJSON(),a}},Object.defineProperty(x.prototype,"localToParent",{set:function(a){this._impl._localToParent=a},get:function(){return this._impl._localToParent},enumerable:!0}),Object.defineProperty(x.prototype,"mesh",{get:function(){return this._impl._mesh},enumerable:!0}),g(x,"Instance"),c.exports.Instance=x;var Fb="##key",Gb=function(){var a=1;return function(b){if(!b[Fb]){var c="##uniqueKey"+(a++).toString();Object.defineProperty(b,Fb,{writable:!1,enumerable:!1,configurable:!1,value:c})}return b[Fb]}}(),Hb=function(){this._data={}};Hb.prototype={_add:function(a){if("object"!=typeof a)return!1;var b=Gb(a);return this._data[b]?!1:(this._data[b]=a,!0)},_remove:function(a){if("object"!=typeof a)return!1;var b=a[Fb];return b&&this._data[b]?(delete this._data[b],!0):!1},_clear:function(){this._data={}},_size:function(){return Object.keys(this._data).length},_toArray:function(){var a=this._data,b=Object.keys(a),c=b.length,d,e=[];for(d=0;c>d;d++)e.push(a[b[d]]);return e}};var Ib=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Hb}),this.itemAdded=new r("itemadded"),this.itemRemoved=new r("itemremoved")};Ib.prototype={add:function(a){return this._impl._add(a)&&this.itemAdded.fire(a),this},remove:function(a){return this._impl._remove(a)?(this.itemRemoved.fire(a),!0):!1},clear:function(){for(var a=this._impl._data,b=Object.keys(a),c=b.length,d=0;c>d;d++)this.remove(a[b[d]]);return this._impl._clear(),this},size:function(){return this._impl._size()},toArray:function(){return this._impl._toArray()}},c.exports.RefSet=Ib,g(Ib,"RefSet")};a.creativePlatformLibrary1vxKXGNaLtrrev0=c}("undefined"==typeof k?window:k),function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(c,f){function g(){var a={};Object.defineProperty(this,"items",{get:function(){return a},enumerable:!0}),this.hover=new i.EventSource("hover"),this.click=new i.EventSource("click");var b=this;kc(window).resize(function(){b.update(),window.setTimeout(function(){b.update()},500)}),window.setTimeout(function(){b.update()},500)}function h(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this.parent=a.parent?kc(a.parent):kc("body"),this.id=a.id,this.type=a.type,this.target=kc(a.target),this.direction=a.direction,this.css=a.css,this.iconcss=a.iconcss;var b=this;m.extend(this),kc(this._element).hover(function(){kc(b.target).addClass("ui-hover-target-hover"),kc(b._element).addClass("ui-hoverarea-item-hover")},function(){kc(b.target).removeClass("ui-hover-target-hover"),kc(b._element).removeClass("ui-hoverarea-item-hover")}),this.itemhover=new i.EventSource("itemhover"),this.itemclick=new i.EventSource("itemclick"),kc(this._element).hover(function(a){b.itemhover.fire(b,a)}),kc(this._element).click(function(a){b.itemclick.fire(b,a)}),this.update()}var i=c.libraryExports("1vxKXGNaLtr",0),j={},k=null;f&&(f.name="Autodesk Creative Platform UI Toolkit",f.description="Comprehensive set of reusable HTML5 controls and templates",f.resources=[{id:"gHWG9uWl87e",name:"core.css"},{id:"gsxjRGSdB1t",name:"core-sprite1.png"},{id:"7qjfMGq1dUt",name:"example-logo.png"},{id:"bAznT3KNk0P",name:"example-logo-1.png"},{id:"9kjxbRkb3Fg",name:"example-logo-2.png"},{id:"jo4vOHKkZbg",name:"example-logo-3.png"},{id:"aUB96jivLsf",name:"example-logo-4.png"},{id:"lpskZy35jqS",name:"example-logo-5.png"},{id:"5AVq1kgMAuJ",name:"example-logo-6.png"},{id:"bJyMcjOL4rh",name:"example-logo-7.png"},{id:"6kXjtkkecOE",name:"example-logo-8.png"},{id:"9Msi11eIBRz",name:"robot-main-image.png"},{id:"4bI6D76DZEv",name:"robot-part-0.png"},{id:"8XpShR8ppPW",name:"robot-part-1.png"},{id:"05Exgy4pdoP",name:"robot-part-2.png"},{id:"5IVMZn3tmk4",name:"robot-part-3.png"},{id:"73biEtB2zgM",name:"robot-part-4.png"},{id:"dzH4SlWMkFm",name:"robot-part-5.png"},{id:"crX3EY2kQ9t",name:"robot-part-6.png"},{id:"7wuQ0vKZb4X",name:"robot-map-image.png"},{id:"eNUXHkS64GG",name:"randomize-button.png"},{id:"gg7kPMXYisP",name:"content-builder.css"},{id:"hg4uUVY6UJB",name:"content-builder-sprite1.png"}]),function(){var a=e.template,b=e.templates=e.templates||{};b["2dsketch"]=a(function(a,b,c,d,e){function f(a,b){var d;return(d=c.css)?d=d.call(a,{hash:{},data:b}):(d=a.css,d=typeof d===j?d.apply(a):d),k(d)}function g(a,b){var e="",f;return e+="\n				",f=l.invokePartial(d.checkbox,"checkbox",a,c,d,b),(f||0===f)&&(e+=f),e+="\n			"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var h="",i,j="function",k=this.escapeExpression,l=this;return h+='<div id="',(i=c.id)?i=i.call(b,{hash:{},data:e}):(i=b.id,i=typeof i===j?i.apply(b):i),h+=k(i)+'" style="width:',(i=c.width)?i=i.call(b,{hash:{},data:e}):(i=b.width,i=typeof i===j?i.apply(b):i),h+=k(i)+";height:",(i=c.height)?i=i.call(b,{hash:{},data:e}):(i=b.height,i=typeof i===j?i.apply(b):i),h+=k(i)+';" class="',i=c["if"].call(b,b.css,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(h+=i),h+=' ui-sketch">\n	<canvas id="',(i=c.id)?i=i.call(b,{hash:{},data:e}):(i=b.id,i=typeof i===j?i.apply(b):i),h+=k(i)+'Canvas" width="',(i=c.width)?i=i.call(b,{hash:{},data:e}):(i=b.width,i=typeof i===j?i.apply(b):i),h+=k(i)+'" height="',(i=c.height)?i=i.call(b,{hash:{},data:e}):(i=b.height,i=typeof i===j?i.apply(b):i),h+=k(i)+'"></canvas>\n	<div class="ui-sketch-settings" title="Edit sketch settings">\n		<div class="ui-sketch-settings-con">\n			',i=c["with"].call(b,b.checkbox,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(h+=i),h+="\n		</div>\n	</div>\n</div>"
}),b.accordion=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===i?e.apply(a):e),d+=j(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-accordion',h=c["if"].call(b,b.css,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+='"></div>\n'}),b.accordionitem=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f="",g,h="function",i=this.escapeExpression;return f+='<div id="',(g=c.id)?g=g.call(b,{hash:{},data:e}):(g=b.id,g=typeof g===h?g.apply(b):g),f+=i(g)+'" class="ui-accordion-item">\n	<div class="ui-accordion-item-icon"></div>\n	<div class="ui-accordion-item-header">',(g=c.header)?g=g.call(b,{hash:{},data:e}):(g=b.header,g=typeof g===h?g.apply(b):g),f+=i(g)+'</div>\n	<div class="ui-accordion-item-content">',(g=c.content)?g=g.call(b,{hash:{},data:e}):(g=b.content,g=typeof g===h?g.apply(b):g),f+=i(g)+"</div>\n</div>\n"}),b.button=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===o?e.apply(a):e),d+=p(e)}function g(a,b){var d="",e,f,g;return d+="\n		",g={hash:{},inverse:q.noop,fn:q.program(4,h,b),data:b},e=c.compare||a.compare,f=e?e.call(a,(e=a.icon,null==e||e===!1?e:e.position),"eq","left",g):r.call(a,"compare",(e=a.icon,null==e||e===!1?e:e.position),"eq","left",g),(f||0===f)&&(d+=f),d+="\n		",g={hash:{},inverse:q.noop,fn:q.program(6,i,b),data:b},e=c.compare||a.compare,f=e?e.call(a,(e=a.icon,null==e||e===!1?e:e.position),"eq","right",g):r.call(a,"compare",(e=a.icon,null==e||e===!1?e:e.position),"eq","right",g),(f||0===f)&&(d+=f),d+="\n		",g={hash:{},inverse:q.noop,fn:q.program(8,j,b),data:b},e=c.compare||a.compare,f=e?e.call(a,(e=a.icon,null==e||e===!1?e:e.position),"eq","top",g):r.call(a,"compare",(e=a.icon,null==e||e===!1?e:e.position),"eq","top",g),(f||0===f)&&(d+=f),d+="\n		",g={hash:{},inverse:q.noop,fn:q.program(10,k,b),data:b},e=c.compare||a.compare,f=e?e.call(a,(e=a.icon,null==e||e===!1?e:e.position),"eq","bottom",g):r.call(a,"compare",(e=a.icon,null==e||e===!1?e:e.position),"eq","bottom",g),(f||0===f)&&(d+=f),d+="\n	"}function h(a,b){var d="",e,f;return d+='\n			<img src="'+p((e=a.icon,e=null==e||e===!1?e:e.url,typeof e===o?e.apply(a):e))+'" class="ui-button-icon ui-button-icon-left" style="width:'+p((e=a.icon,e=null==e||e===!1?e:e.width,typeof e===o?e.apply(a):e))+"px; height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;"></img>\n			<span class="ui-button-text ui-button-text" style="height:'+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+"px; line-height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;">',(f=c.text)?f=f.call(a,{hash:{},data:b}):(f=a.text,f=typeof f===o?f.apply(a):f),d+=p(f)+"</span>\n		"}function i(a,b){var d="",e,f;return d+='\n			<span class="ui-button-text ui-button-text" style="height:'+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+"px; line-height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;">',(f=c.text)?f=f.call(a,{hash:{},data:b}):(f=a.text,f=typeof f===o?f.apply(a):f),d+=p(f)+'</span>\n			<img src="'+p((e=a.icon,e=null==e||e===!1?e:e.url,typeof e===o?e.apply(a):e))+'" class="ui-button-icon ui-button-icon-right" style="width:'+p((e=a.icon,e=null==e||e===!1?e:e.width,typeof e===o?e.apply(a):e))+"px; height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;"></img>\n		'}function j(a,b){var d="",e,f;return d+='\n			<img src="'+p((e=a.icon,e=null==e||e===!1?e:e.url,typeof e===o?e.apply(a):e))+'" class="ui-button-icon ui-button-icon-top" style="width:'+p((e=a.icon,e=null==e||e===!1?e:e.width,typeof e===o?e.apply(a):e))+"px; height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;"></img>\n			<span class="ui-button-text ui-button-text" style="display:block;">',(f=c.text)?f=f.call(a,{hash:{},data:b}):(f=a.text,f=typeof f===o?f.apply(a):f),d+=p(f)+"</span>\n		"}function k(a,b){var d="",e;return d+='\n			<span class="ui-button-text ui-button-text" style="display:block;">',(e=c.text)?e=e.call(a,{hash:{},data:b}):(e=a.text,e=typeof e===o?e.apply(a):e),d+=p(e)+'</span>\n			<img src="'+p((e=a.icon,e=null==e||e===!1?e:e.url,typeof e===o?e.apply(a):e))+'" class="ui-button-icon ui-button-icon-top" style="width:'+p((e=a.icon,e=null==e||e===!1?e:e.width,typeof e===o?e.apply(a):e))+"px; height:"+p((e=a.icon,e=null==e||e===!1?e:e.height,typeof e===o?e.apply(a):e))+'px;"></img>\n		'}function l(a,b){var d="",e;return d+="\n		",(e=c.text)?e=e.call(a,{hash:{},data:b}):(e=a.text,e=typeof e===o?e.apply(a):e),d+=p(e)+"	\n	"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var m="",n,o="function",p=this.escapeExpression,q=this,r=c.helperMissing;return m+='<button id="',(n=c.id)?n=n.call(b,{hash:{},data:e}):(n=b.id,n=typeof n===o?n.apply(b):n),m+=p(n)+'" class="ui-button',n=c["if"].call(b,b.css,{hash:{},inverse:q.noop,fn:q.program(1,f,e),data:e}),(n||0===n)&&(m+=n),m+='">\n	',n=c["if"].call(b,b.icon,{hash:{},inverse:q.program(12,l,e),fn:q.program(3,g,e),data:e}),(n||0===n)&&(m+=n),m+="\n</button>\n"}),b.checkbox=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+='<label class="ui-checkbox-label ',e=c["if"].call(a,a.labelCss,{hash:{},inverse:p.noop,fn:p.program(2,g,b),data:b}),(e||0===e)&&(d+=e),d+='" for="',(e=c.id)?e=e.call(a,{hash:{},data:b}):(e=a.id,e=typeof e===n?e.apply(a):e),d+=o(e)+'">',(e=c.text)?e=e.call(a,{hash:{},data:b}):(e=a.text,e=typeof e===n?e.apply(a):e),d+=o(e)+"</label>"}function g(a,b){var d;return(d=c.labelCss)?d=d.call(a,{hash:{},data:b}):(d=a.labelCss,d=typeof d===n?d.apply(a):d),o(d)}function h(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===n?e.apply(a):e),d+=o(e)}function i(a,b){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j="",k,l,m,n="function",o=this.escapeExpression,p=this,q=c.helperMissing;return m={hash:{},inverse:p.noop,fn:p.program(1,f,e),data:e},k=c.compare||b.compare,l=k?k.call(b,b.labelPosition,"eq","left",m):q.call(b,"compare",b.labelPosition,"eq","left",m),(l||0===l)&&(j+=l),j+='<input id="',(l=c.id)?l=l.call(b,{hash:{},data:e}):(l=b.id,l=typeof l===n?l.apply(b):l),j+=o(l)+'" type="checkbox" class="ui-checkbox',l=c["if"].call(b,b.css,{hash:{},inverse:p.noop,fn:p.program(4,h,e),data:e}),(l||0===l)&&(j+=l),j+='" ',l=c["if"].call(b,b.checked,{hash:{},inverse:p.noop,fn:p.program(6,i,e),data:e}),(l||0===l)&&(j+=l),j+="></input>",m={hash:{},inverse:p.noop,fn:p.program(1,f,e),data:e},k=c.compare||b.compare,l=k?k.call(b,b.labelPosition,"neq","left",m):q.call(b,"compare",b.labelPosition,"neq","left",m),(l||0===l)&&(j+=l),j}),b.dialog=a(function(a,b,c,d,e){function f(a,b){var d;return(d=c.css)?d=d.call(a,{hash:{},data:b}):(d=a.css,d=typeof d===k?d.apply(a):d),l(d)}function g(a,b){return'style="display:none;"'}function h(a,b){var d;return(d=c.contentcss)?d=d.call(a,{hash:{},data:b}):(d=a.contentcss,d=typeof d===k?d.apply(a):d),l(d)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i="",j,k="function",l=this.escapeExpression,m=this;return i+='<div id="',(j=c.id)?j=j.call(b,{hash:{},data:e}):(j=b.id,j=typeof j===k?j.apply(b):j),i+=l(j)+'" class="ui-dialog ',j=c["if"].call(b,b.css,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(j||0===j)&&(i+=j),i+='">\n	<div class="ui-dialog-close" ',j=c["if"].call(b,b.hideClose,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(i+=j),i+='></div>\n	<div class="ui-dialog-content" ',j=c["if"].call(b,b.contentcss,{hash:{},inverse:m.noop,fn:m.program(5,h,e),data:e}),(j||0===j)&&(i+=j),i+='"></div>\n	<div class="ui-dialog-footer" ',j=c["if"].call(b,b.hideFooter,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(j||0===j)&&(i+=j),i+="></div>\n</div>\n"}),b.docklayout=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===t?e.apply(a):e),d+=u(e)}function g(a,b){var d="",e,f;return d+='<div class="ui-dock-layout-left">',f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.left,null==e||e===!1?e:e.resizable),{hash:{},inverse:v.noop,fn:v.program(4,h,b),data:b}),(f||0===f)&&(d+=f),d+="</div>"}function h(a,b){return'<div class="ui-dock-layout-left-resizer"><div>....</div></div>'}function i(a,b){var d="",e,f;return d+='<div class="ui-dock-layout-center">',f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.center,null==e||e===!1?e:e.top),{hash:{},inverse:v.noop,fn:v.program(7,j,b),data:b}),(f||0===f)&&(d+=f),f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.center,null==e||e===!1?e:e.middle),{hash:{},inverse:v.noop,fn:v.program(10,l,b),data:b}),(f||0===f)&&(d+=f),f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.center,null==e||e===!1?e:e.bottom),{hash:{},inverse:v.noop,fn:v.program(12,m,b),data:b}),(f||0===f)&&(d+=f),d+="</div>"}function j(a,b){var d="",e,f;return d+='<div class="ui-dock-layout-top">',f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.center,e=null==e||e===!1?e:e.top,null==e||e===!1?e:e.resizable),{hash:{},inverse:v.noop,fn:v.program(8,k,b),data:b}),(f||0===f)&&(d+=f),d+="</div>"}function k(a,b){return'<div class="ui-dock-layout-top-resizer"><div>....</div></div>'}function l(a,b){return'<div class="ui-dock-layout-middle"></div>'}function m(a,b){var d="",e,f;return d+='<div class="ui-dock-layout-bottom">',f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.center,e=null==e||e===!1?e:e.bottom,null==e||e===!1?e:e.resizable),{hash:{},inverse:v.noop,fn:v.program(13,n,b),data:b}),(f||0===f)&&(d+=f),d+="</div>"}function n(a,b){return'<div class="ui-dock-layout-bottom-resizer"><div>....</div></div>'}function o(a,b){var d="",e,f;return d+='<div class="ui-dock-layout-right">',f=c["if"].call(a,(e=a.dock,e=null==e||e===!1?e:e.right,null==e||e===!1?e:e.resizable),{hash:{},inverse:v.noop,fn:v.program(16,p,b),data:b}),(f||0===f)&&(d+=f),d+="</div>"}function p(a,b){return'<div class="ui-dock-layout-right-resizer"><div>....</div></div>'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var q="",r,s,t="function",u=this.escapeExpression,v=this;return q+='<div id="',(r=c.id)?r=r.call(b,{hash:{},data:e}):(r=b.id,r=typeof r===t?r.apply(b):r),q+=u(r)+'" class="ui-dock-layout ',r=c["if"].call(b,b.css,{hash:{},inverse:v.noop,fn:v.program(1,f,e),data:e}),(r||0===r)&&(q+=r),q+='">\n	',s=c["if"].call(b,(r=b.dock,null==r||r===!1?r:r.left),{hash:{},inverse:v.noop,fn:v.program(3,g,e),data:e}),(s||0===s)&&(q+=s),s=c["if"].call(b,(r=b.dock,null==r||r===!1?r:r.center),{hash:{},inverse:v.noop,fn:v.program(6,i,e),data:e}),(s||0===s)&&(q+=s),s=c["if"].call(b,(r=b.dock,null==r||r===!1?r:r.right),{hash:{},inverse:v.noop,fn:v.program(15,o,e),data:e}),(s||0===s)&&(q+=s),q+="\n</div>"}),b.dropdown=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===p?e.apply(a):e),d+=q(e)}function g(a,b){var d;return(d=c.tabindex)?d=d.call(a,{hash:{},data:b}):(d=a.tabindex,d=typeof d===p?d.apply(a):d),q(d)}function h(a,b){var d;return(d=c.title)?d=d.call(a,{hash:{},data:b}):(d=a.title,d=typeof d===p?d.apply(a):d),q(d)}function i(a,b){var d="",e;return d+="\n			",e=c["if"].call(a,a.text,{hash:{},inverse:r.program(13,m,b),fn:r.program(8,j,b),data:b}),(e||0===e)&&(d+=e),d+="\n		"}function j(a,b){var d="",e;return d+="\n				",e=c["if"].call(a,a.selected,{hash:{},inverse:r.program(11,l,b),fn:r.program(9,k,b),data:b}),(e||0===e)&&(d+=e),d+="\n			"}function k(a,b){var c="",d;return c+='\n					<li id="'+q((d=a.value,typeof d===p?d.apply(a):d))+'_Li" tag="'+q((d=a.value,typeof d===p?d.apply(a):d))+'" selected="selected" title="'+q((d=a.text,typeof d===p?d.apply(a):d))+'">'+q((d=a.text,typeof d===p?d.apply(a):d))+"</li>\n				"}function l(a,b){var c="",d;return c+='\n					<li id="'+q((d=a.value,typeof d===p?d.apply(a):d))+'_Li" tag="'+q((d=a.value,typeof d===p?d.apply(a):d))+'" title="'+q((d=a.text,typeof d===p?d.apply(a):d))+'">'+q((d=a.text,typeof d===p?d.apply(a):d))+"</li>\n				"}function m(a,b){var c="";return c+='\n				<li id="'+q(typeof a===p?a.apply(a):a)+'_Li" tag="'+q(typeof a===p?a.apply(a):a)+'" title="'+q(typeof a===p?a.apply(a):a)+'">'+q(typeof a===p?a.apply(a):a)+"</li>\n			"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var n="",o,p="function",q=this.escapeExpression,r=this;return n+='<div id="',(o=c.id)?o=o.call(b,{hash:{},data:e}):(o=b.id,o=typeof o===p?o.apply(b):o),n+=q(o)+'" class="ui-dropdown',o=c["if"].call(b,b.css,{hash:{},inverse:r.noop,fn:r.program(1,f,e),data:e}),(o||0===o)&&(n+=o),n+='" tabindex="',o=c["if"].call(b,b.tabindex,{hash:{},inverse:r.noop,fn:r.program(3,g,e),data:e}),(o||0===o)&&(n+=o),n+='">\n    <div id="ui-dropdown-icon" class="ui-dropdown-icon">▼</div>\n	<input id="ui-dropdown-input',(o=c.id)?o=o.call(b,{hash:{},data:e}):(o=b.id,o=typeof o===p?o.apply(b):o),n+=q(o)+'" class="ui-dropdown-input" title="',o=c["if"].call(b,b.title,{hash:{},inverse:r.noop,fn:r.program(5,h,e),data:e}),(o||0===o)&&(n+=o),n+='" tabindex="0" readonly="readonly">\n	<ul id="ui-dropdown-list',(o=c.id)?o=o.call(b,{hash:{},data:e}):(o=b.id,o=typeof o===p?o.apply(b):o),n+=q(o)+'" class="ui-dropdown-list">\n		',o=c.each.call(b,b.items,{hash:{},inverse:r.noop,fn:r.program(7,i,e),data:e}),(o||0===o)&&(n+=o),n+="\n	</ul>\n</div>\n"}),b.error=a(function(a,b,c,d,e){function f(a,b){return'style="display:block"'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-error">\n    <div class="ui-icon-container">\n        <div class="ui-icon-error"></div>\n    </div>\n    <div class="ui-verticalLine" />\n    <div class="ui-description-container">\n        <div class="ui-error-title" ',h=c["if"].call(b,b.title,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+=">",(h=c.title)?h=h.call(b,{hash:{},data:e}):(h=b.title,h=typeof h===i?h.apply(b):h),g+=j(h)+'</div>\n        <div class="ui-error-desc">',(h=c.description)?h=h.call(b,{hash:{},data:e}):(h=b.description,h=typeof h===i?h.apply(b):h),g+=j(h)+'</div>  \n    </div>\n    <div class="ui-dialog-close ui-error-dialog-close"></div>\n</div>\n'}),b.feedback=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===m?e.apply(a):e),d+=n(e)}function g(a,b){var e="",f;return e+="\n			",f=o.invokePartial(d.rating,"rating",a,c,d,b),(f||0===f)&&(e+=f),e+="\n		"}function h(a,b){return"none;"}function i(a,b){return"block;"}function j(a,b){var e="",f;return e+="\n			",f=o.invokePartial(d.textarea,"textarea",a,c,d,b),(f||0===f)&&(e+=f),e+="\n		"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var k="",l,m="function",n=this.escapeExpression,o=this;return k+='<div id="',(l=c.id)?l=l.call(b,{hash:{},data:e}):(l=b.id,l=typeof l===m?l.apply(b):l),k+=n(l)+'" class="ui-feedback ',l=c["if"].call(b,b.css,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(l||0===l)&&(k+=l),k+='">\n	<div>\n		',l=c["with"].call(b,b.rating,{hash:{},inverse:o.noop,fn:o.program(3,g,e),data:e}),(l||0===l)&&(k+=l),k+='\n		<div class="ui-feedback-updatepanel">\n			<span class="ui-feedback-label" style="display:',l=c["if"].call(b,b.isEdit,{hash:{},inverse:o.program(7,i,e),fn:o.program(5,h,e),data:e}),(l||0===l)&&(k+=l),k+='">( Not Rated )</span>\n			<span class="ui-feedback-button" style="display:',l=c["if"].call(b,b.isEdit,{hash:{},inverse:o.program(5,h,e),fn:o.program(7,i,e),data:e}),(l||0===l)&&(k+=l),k+='">( <a id="save" href="#" style="display:none;" title="Save feedback">Save</a><div class="ui-feedback-buttonpipe"> | </div><a id="clear" href="#" title="Delete feedback">Delete</a> )</span>\n		</div>\n	</div>\n	<div style="clear:both;padding-top:5px;">\n		',l=c["with"].call(b,b.comment,{hash:{},inverse:o.noop,fn:o.program(9,j,e),data:e}),(l||0===l)&&(k+=l),k+="\n	</div>\n</div>"}),b.fileupload=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===i?e.apply(a):e),d+=j(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-fileupload ',h=c["if"].call(b,b.css,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+='">\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'content" class="ui-file-content">\n		<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'contenttext" class="ui-file-content-text"></div>\n	</div>\n	<div class="ui-file-progress-container"><div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'progress" class="ui-file-progress" style="display:none;"></div></div>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'buttonContainer" class="ui-file-button-container"></div>\n	<input id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'file" type="file" style="display:none;">\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'message" class="ui-file-message"></div>\n</div>\n'}),b.hoverarea=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===l?e.apply(a):e),d+=m(e)}function g(a,b){var d="",e;return d+=" ",(e=c.iconcss)?e=e.call(a,{hash:{},data:b}):(e=a.iconcss,e=typeof e===l?e.apply(a):e),d+=m(e)}function h(a,b){return"ui-hoverarea-icon"}function i(a,b){var d="",e;return d+=" ",(e=c.direction)?e=e.call(a,{hash:{},data:b}):(e=a.direction,e=typeof e===l?e.apply(a):e),d+=m(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j="",k,l="function",m=this.escapeExpression,n=this;return j+='<div id="',(k=c.id)?k=k.call(b,{hash:{},data:e}):(k=b.id,k=typeof k===l?k.apply(b):k),j+=m(k)+'" class="ui-hoverarea ',k=c["if"].call(b,b.css,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(k||0===k)&&(j+=k),j+='"><div class="',k=c["if"].call(b,b.iconcss,{hash:{},inverse:n.program(5,h,e),fn:n.program(3,g,e),data:e}),(k||0===k)&&(j+=k),j+='"></div><div class="ui-hoverarea-direction ',k=c["if"].call(b,b.direction,{hash:{},inverse:n.noop,fn:n.program(7,i,e),data:e}),(k||0===k)&&(j+=k),j+='"></div></div>'}),b.imageedit=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===i?e.apply(a):e),d+=j(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-imageedit ',h=c["if"].call(b,b.css,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+='" style="height:',(h=c.height)?h=h.call(b,{hash:{},data:e}):(h=b.height,h=typeof h===i?h.apply(b):h),g+=j(h)+"px; width:",(h=c.width)?h=h.call(b,{hash:{},data:e}):(h=b.width,h=typeof h===i?h.apply(b):h),g+=j(h)+'px;">\n	<canvas id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'canvas" height="',(h=c.height)?h=h.call(b,{hash:{},data:e}):(h=b.height,h=typeof h===i?h.apply(b):h),g+=j(h)+'" width="',(h=c.width)?h=h.call(b,{hash:{},data:e}):(h=b.width,h=typeof h===i?h.apply(b):h),g+=j(h)+'" style="border:1px solid black;"></canvas>\n	<img id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'image" style="display:none;" /><br/>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'zoomContainer" title="Scale" class="ui-image-edit-zoomcontainer"></div>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'rotateContainer" title="Rotate" class="ui-image-edit-rotatecontainer"></div>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'rotateLeft" title="Rotate -90°" class="ui-image-edit-rotate-left"></div>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'rotateRight" title="Rotate 90°" class="ui-image-edit-rotate-right"></div>\n	<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'close" class="ui-image-edit-close"></div>\n</div>'}),b.imagemap=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===i?e.apply(a):e),d+=j(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-imagemap ',h=c["if"].call(b,b.css,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+='">\n	<div class="ui-imagemap-container">\n		<img id=\'',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+"-main-image' class='ui-imagemap-item' src='",(h=c.mainimage)?h=h.call(b,{hash:{},data:e}):(h=b.mainimage,h=typeof h===i?h.apply(b):h),g+=j(h)+"'></img>\n		<img id='",(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+"-hover-image' class='ui-imagemap-item ui-imagemap-hover'></img>\n		<img id='",(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+"-active-image' class='ui-imagemap-item ui-imagemap-active'></img>\n		<canvas id='",(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+"-canvas-image' class='ui-imagemap-canvas-image'></canvas>\n	</div>\n</div>"}),b.itemslider=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===i?e.apply(a):e),d+=j(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g="",h,i="function",j=this.escapeExpression,k=this;return g+='<div id="',(h=c.id)?h=h.call(b,{hash:{},data:e}):(h=b.id,h=typeof h===i?h.apply(b):h),g+=j(h)+'" class="ui-itemslider',h=c["if"].call(b,b.css,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(h||0===h)&&(g+=h),g+='">\n    <div id="previousSlide" slideid="" class="ui-itempreviousslide"><div class="ui-itemslideicon"></div></div>\n	<div class="ui-itemslidercontainer ui-itemnavigation-show"></div>\n	<div id="nextSlide" slideid="" class="ui-itemnextslide"><div class="ui-itemslideicon"></div></div>\n</div><div style="clear:both;"></div>\n'}),b.libraryfeedback=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===p?e.apply(a):e),d+=q(e)}function g(a,b){var d="",e;return d+='\n		<div class="ui-libraryfeedback-row1">\n			<div class="ui-libraryfeedback-col1">All</div>\n			<div class="ui-libraryfeedback-col2">\n				',e=c["with"].call(a,a.rating,{hash:{},inverse:r.noop,fn:r.program(4,h,b),data:b}),(e||0===e)&&(d+=e),d+='\n			</div>\n		</div>\n		<div class="ui-libraryfeedback-row2">\n			<div class="ui-libraryfeedback-col1">You</div>\n			<div id="feedbackControlLinks" class="ui-libraryfeedback-col2 ui-libraryfeedback-margin">\n				<a class="ui-libraryfeedback-give" href="#" style="display:',e=c["if"].call(a,a.isEdit,{hash:{},inverse:r.program(8,j,b),fn:r.program(6,i,b),data:b}),(e||0===e)&&(d+=e),d+='">Give Feedback!</a>\n				<a class="ui-libraryfeedback-update" href="#" style="display:',e=c["if"].call(a,a.isEdit,{hash:{},inverse:r.program(6,i,b),fn:r.program(8,j,b),data:b}),(e||0===e)&&(d+=e),d+='">Update Feedback</a>\n			</div>\n			<div id="feedbackControl" class="ui-libraryfeedback-col2" style="display:none;">\n				',e=c["with"].call(a,a.feedback,{hash:{},inverse:r.noop,fn:r.program(10,k,b),data:b}),(e||0===e)&&(d+=e),d+="\n			</div>\n		</div>\n	"}function h(a,b){var e="",f;return e+="\n					",f=r.invokePartial(d.rating,"rating",a,c,d,b),(f||0===f)&&(e+=f),e+="\n				"}function i(a,b){return"none;"}function j(a,b){return"block;"}function k(a,b){var e="",f;return e+="\n					",f=r.invokePartial(d.feedback,"feedback",a,c,d,b),(f||0===f)&&(e+=f),e+="\n				"}function l(a,b){var d="",e;return d+="\n		",e=c["with"].call(a,a.rating,{hash:{},inverse:r.noop,fn:r.program(13,m,b),data:b}),(e||0===e)&&(d+=e),d+="\n	"}function m(a,b){var e="",f;return e+="\n			",f=r.invokePartial(d.rating,"rating",a,c,d,b),(f||0===f)&&(e+=f),e+="\n		"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var n="",o,p="function",q=this.escapeExpression,r=this;return n+='<div id="',(o=c.id)?o=o.call(b,{hash:{},data:e}):(o=b.id,o=typeof o===p?o.apply(b):o),n+=q(o)+'" class="ui-libraryfeedback ',o=c["if"].call(b,b.css,{hash:{},inverse:r.noop,fn:r.program(1,f,e),data:e}),(o||0===o)&&(n+=o),n+='">\n	',o=c["if"].call(b,b.isUserId,{hash:{},inverse:r.program(12,l,e),fn:r.program(3,g,e),data:e}),(o||0===o)&&(n+=o),n+="\n</div>"}),b.libraryfeedbackpopup=a(function(a,b,c,d,e){function f(a,b){var d="",e,f,j;return d+='\n	    <li>\n			<div class="ui-feedbackpopup-feedbackavatar"><a class="ui-feedbackpopup-user" target="_blank" href="',(e=c.userprofilelink)?e=e.call(a,{hash:{},data:b}):(e=a.userprofilelink,e=typeof e===m?e.apply(a):e),d+=n(e)+'"><img src="',(e=c.avtar)?e=e.call(a,{hash:{},data:b}):(e=a.avtar,e=typeof e===m?e.apply(a):e),d+=n(e)+'" /></a></div>\n			<div class="ui-feedbackpopup-details">\n				',e=c["with"].call(a,a.rating,{hash:{},inverse:l.noop,fn:l.program(2,g,b),data:b}),(e||0===e)&&(d+=e),d+='\n				<div class="ui-feedbackpopup-ratingstring">('+n((e=a.rating,e=null==e||e===!1?e:e.rating,typeof e===m?e.apply(a):e))+" out of 5 Stars)</div>\n				",j={hash:{},inverse:l.program(6,i,b),fn:l.program(4,h,b),data:b},e=c.compare||a.compare,f=e?e.call(a,a.feedback,"eq","",j):o.call(a,"compare",a.feedback,"eq","",j),(f||0===f)&&(d+=f),d+='\n				<div class="ui-feedbackpopup-time">',(f=c.datetime)?f=f.call(a,{hash:{},data:b}):(f=a.datetime,f=typeof f===m?f.apply(a):f),d+=n(f)+"</div>\n			</div>\n	    </li>\n	"}function g(a,b){var e="",f;return e+="\n					",f=l.invokePartial(d.rating,"rating",a,c,d,b),(f||0===f)&&(e+=f),e+="\n				"}function h(a,b){var d="",e;return d+='\n					<div class="ui-feedbackpopup-comments"><a class="ui-feedbackpopup-user" target="_blank" href="',(e=c.userprofilelink)?e=e.call(a,{hash:{},data:b}):(e=a.userprofilelink,e=typeof e===m?e.apply(a):e),d+=n(e)+'"><b>',(e=c.username)?e=e.call(a,{hash:{},data:b}):(e=a.username,e=typeof e===m?e.apply(a):e),d+=n(e)+"</b></a></div>\n				"}function i(a,b){var d="",e;return d+='\n					<div class="ui-feedbackpopup-comments"><a class="ui-feedbackpopup-user" target="_blank" href="',(e=c.userprofilelink)?e=e.call(a,{hash:{},data:b}):(e=a.userprofilelink,e=typeof e===m?e.apply(a):e),d+=n(e)+'"><b>',(e=c.username)?e=e.call(a,{hash:{},data:b}):(e=a.username,e=typeof e===m?e.apply(a):e),d+=n(e)+'</b></a> provided feedback: "',(e=c.feedback)?e=e.call(a,{hash:{},data:b}):(e=a.feedback,e=typeof e===m?e.apply(a):e),d+=n(e)+'"</div>\n				'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var j="",k,l=this,m="function",n=this.escapeExpression,o=c.helperMissing;return j+='<ul class="ui-feedbackpopup-ul">\n	',k=c.each.call(b,b,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(k||0===k)&&(j+=k),j+='\n</ul>\n<a class="ui-feedbackpopup-showall" id="lnkshowall" href="#">Show all...</a>'}),b.panel=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===l?e.apply(a):e),d+=m(e)}function g(a,b){var d="",e;return d+='\n	<div class="ui-panel-header" ',e=c.unless.call(a,a.title,{hash:{},inverse:n.noop,fn:n.program(4,h,b),data:b}),(e||0===e)&&(d+=e),d+='>\n		<span class="ui-panel-header-title">',(e=c.title)?e=e.call(a,{hash:{},data:b}):(e=a.title,e=typeof e===l?e.apply(a):e),d+=m(e)+"</span>\n		",e=c["if"].call(a,a.collapsible,{hash:{},inverse:n.noop,fn:n.program(6,i,b),data:b}),(e||0===e)&&(d+=e),d+='\n	</div><img class="ui-panel-icon"></img><div class="ui-panel-content"></div>'}function h(a,b){return'style="display:none;"'}function i(a,b){return'<div class="ui-panel-header-collapse-button"></div>'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j="",k,l="function",m=this.escapeExpression,n=this;return j+='<div id="',(k=c.id)?k=k.call(b,{hash:{},data:e}):(k=b.id,k=typeof k===l?k.apply(b):k),j+=m(k)+'" class="ui-panel ',k=c["if"].call(b,b.css,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(k||0===k)&&(j+=k),j+='">\n	',k=c.unless.call(b,b.suppressheader,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(k||0===k)&&(j+=k),j+="</div>"}),b.popup=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===j?e.apply(a):e),d+=k(e)}function g(a,b){var d="",e;return d+=" ",(e=c.cornercss)?e=e.call(a,{hash:{},data:b}):(e=a.cornercss,e=typeof e===j?e.apply(a):e),d+=k(e)}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h="",i,j="function",k=this.escapeExpression,l=this;return h+='<div id="',(i=c.id)?i=i.call(b,{hash:{},data:e}):(i=b.id,i=typeof i===j?i.apply(b):i),h+=k(i)+'" class="ui-popup ',i=c["if"].call(b,b.css,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(h+=i),h+='">\n	',(i=c.content)?i=i.call(b,{hash:{},data:e}):(i=b.content,i=typeof i===j?i.apply(b):i),(i||0===i)&&(h+=i),h+='\n	<div class="ui-popup-corner ',i=c["if"].call(b,b.cornercss,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(h+=i),h+='">\n		<div id="corner" class="ui-popup-arrowblack"></div>\n    	<div id="corner" class="ui-popup-arrowwhite"></div>\n	</div>\n</div>'}),b.progressbar=a(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f="",g,h="function",i=this.escapeExpression;return f+='<div id="',(g=c.id)?g=g.call(b,{hash:{},data:e}):(g=b.id,g=typeof g===h?g.apply(b):g),f+=i(g)+'" class="ui-progressdialog">\n    <div id="infinite">\n        <div class="ui-indicator-container">\n            <div class="ui-infinite-indicator"></div>\n        </div>\n        <div class="ui-verticalLine" />\n        <div class="ui-description-container">\n            <div class="ui-progressdialog-title">',(g=c.progressTitle)?g=g.call(b,{hash:{},data:e}):(g=b.progressTitle,g=typeof g===h?g.apply(b):g),f+=i(g)+'</div>\n            <div class="ui-progressdialog-desc">',(g=c.progressDesc)?g=g.call(b,{hash:{},data:e}):(g=b.progressDesc,g=typeof g===h?g.apply(b):g),f+=i(g)+'</div>  \n        </div>\n    </div>\n    <div id="finite">\n        <div class="ui-progressdialog-title">',(g=c.progressTitle)?g=g.call(b,{hash:{},data:e}):(g=b.progressTitle,g=typeof g===h?g.apply(b):g),f+=i(g)+'</div>\n        <div class="ui-progressdialog-desc">',(g=c.progressDesc)?g=g.call(b,{hash:{},data:e}):(g=b.progressDesc,g=typeof g===h?g.apply(b):g),f+=i(g)+'</div>\n        <div class="ui-progressbar">\n            <div class="ui-progressbar-background">\n                <div class="ui-progressbar-fill"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),b.rating=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===s?e.apply(a):e),d+=t(e)}function g(a,b){var d="",e,f,g;return d+='\n		<div class="ui-rating">\n			',g={hash:{},inverse:u.noop,fn:u.program(4,h,b),data:b},e=c.times||a.times,f=e?e.call(a,a.rating,g):v.call(a,"times",a.rating,g),(f||0===f)&&(d+=f),d+="\n			",g={hash:{},inverse:u.noop,fn:u.program(6,i,b),data:b},e=c.times||a.times,f=e?e.call(a,a.max,g):v.call(a,"times",a.max,g),(f||0===f)&&(d+=f),d+="\n			",g={hash:{},inverse:u.program(11,l,b),fn:u.program(8,j,b),data:b},e=c.compare||a.compare,f=e?e.call(a,a.reviewCount,"eq",0,g):v.call(a,"compare",a.reviewCount,"eq",0,g),(f||0===f)&&(d+=f),d+="\n		</div>\n	"
}function h(a,b){return'\n				<div class="inline-div rating-stars-marked">★</div>'}function i(a,b){return'\n				<div class="inline-div rating-stars-unmarked">★</div>\n			'}function j(a,b){var d="",e;return d+="\n				<div ",e=c["if"].call(a,a.hideReviewCount,{hash:{},inverse:u.noop,fn:u.program(9,k,b),data:b}),(e||0===e)&&(d+=e),d+=' class="inline-div rating-count"><a id="',(e=c.id)?e=e.call(a,{hash:{},data:b}):(e=a.id,e=typeof e===s?e.apply(a):e),d+=t(e)+'ratingCount" href="#"></a></div>\n			'}function k(a,b){return'style="display:none;"'}function l(a,b){var d="",e,f,g;return d+="\n				",g={hash:{},inverse:u.program(14,n,b),fn:u.program(12,m,b),data:b},e=c.compare||a.compare,f=e?e.call(a,a.reviewCount,"eq",1,g):v.call(a,"compare",a.reviewCount,"eq",1,g),(f||0===f)&&(d+=f),d+="\n			"}function m(a,b){var d="",e;return d+="\n					<div ",e=c["if"].call(a,a.hideReviewCount,{hash:{},inverse:u.noop,fn:u.program(9,k,b),data:b}),(e||0===e)&&(d+=e),d+=' class="inline-div rating-count"><a id="',(e=c.id)?e=e.call(a,{hash:{},data:b}):(e=a.id,e=typeof e===s?e.apply(a):e),d+=t(e)+'ratingCount" href="#">(',(e=c.reviewCount)?e=e.call(a,{hash:{},data:b}):(e=a.reviewCount,e=typeof e===s?e.apply(a):e),d+=t(e)+" Review)</a></div>\n				"}function n(a,b){var d="",e;return d+="\n					<div ",e=c["if"].call(a,a.hideReviewCount,{hash:{},inverse:u.noop,fn:u.program(9,k,b),data:b}),(e||0===e)&&(d+=e),d+=' class="inline-div rating-count"><a id="',(e=c.id)?e=e.call(a,{hash:{},data:b}):(e=a.id,e=typeof e===s?e.apply(a):e),d+=t(e)+'ratingCount" href="#">(',(e=c.reviewCount)?e=e.call(a,{hash:{},data:b}):(e=a.reviewCount,e=typeof e===s?e.apply(a):e),d+=t(e)+" Reviews)</a></div>\n				"}function o(a,b){var d="",e,f,g;return d+='\n		<fieldset id="ratings',(e=c.id)?e=e.call(a,{hash:{},data:b}):(e=a.id,e=typeof e===s?e.apply(a):e),d+=t(e)+'" class="ui-rating">\n			',g={hash:{},inverse:u.noop,fn:u.programWithDepth(17,p,b,a),data:b},e=c.reversefor||a.reversefor,f=e?e.call(a,a.max,0,1,g):v.call(a,"reversefor",a.max,0,1,g),(f||0===f)&&(d+=f),d+="\n		</fieldset>	\n	"}function p(a,b,c){var d="",e;return d+='\n				<input type="radio" id="ctrl'+t((e=c.id,typeof e===s?e.apply(a):e))+"star"+t(typeof a===s?a.apply(a):a)+'" name="rating'+t((e=c.id,typeof e===s?e.apply(a):e))+'" value="'+t(typeof a===s?a.apply(a):a)+'" /><label for="ctrl'+t((e=c.id,typeof e===s?e.apply(a):e))+"star"+t(typeof a===s?a.apply(a):a)+'">★</label>\n			'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var q="",r,s="function",t=this.escapeExpression,u=this,v=c.helperMissing;return q+='<div id="',(r=c.id)?r=r.call(b,{hash:{},data:e}):(r=b.id,r=typeof r===s?r.apply(b):r),q+=t(r)+'" class="',r=c["if"].call(b,b.css,{hash:{},inverse:u.noop,fn:u.program(1,f,e),data:e}),(r||0===r)&&(q+=r),q+='">\n	',r=c["if"].call(b,b.readonly,{hash:{},inverse:u.program(16,o,e),fn:u.program(3,g,e),data:e}),(r||0===r)&&(q+=r),q+="\n</div>\n\n"}),b.slider=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===l?e.apply(a):e),d+=m(e)}function g(a,b){return"ui-slider-area-has-text"}function h(a,b){return'<div class="ui-slider-text"></div>'}function i(a,b){var e="",f;return e+="\n			",f=n.invokePartial(d.textbox,"textbox",a,c,d,b),(f||0===f)&&(e+=f),e+="\n	"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var j="",k,l="function",m=this.escapeExpression,n=this;return j+='<div id="',(k=c.id)?k=k.call(b,{hash:{},data:e}):(k=b.id,k=typeof k===l?k.apply(b):k),j+=m(k)+'" class="ui-slider ',k=c["if"].call(b,b.css,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(k||0===k)&&(j+=k),j+='">\n	<div class="ui-slider-area ',k=c["if"].call(b,b.showtext,{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(k||0===k)&&(j+=k),j+='">\n		<a class="ui-slider-handle"><div class="ui-slider-icon"></div></a>\n		<div class="ui-slider-background"></div>\n	</div>\n	',k=c["if"].call(b,b.showtext,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(k||0===k)&&(j+=k),j+="\n	",k=c["with"].call(b,b.input,{hash:{},inverse:n.noop,fn:n.program(7,i,e),data:e}),(k||0===k)&&(j+=k),j+="\n</div>"}),b.tab=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===r?e.apply(a):e),d+=s(e)}function g(a,b){return" style='display:none;'"}function h(a,b){var d="",e,f;return d+="<div id='"+s((e=a.tabid,typeof e===r?e.apply(a):e))+"_TabHeader' class='ui-tabbutton ",f=c["if"].call(a,a.headerCss,{hash:{},inverse:t.noop,fn:t.program(6,i,b),data:b}),(f||0===f)&&(d+=f),f=c["if"].call(a,a.isSelected,{hash:{},inverse:t.noop,fn:t.program(8,j,b),data:b}),(f||0===f)&&(d+=f),d+="' Tab='"+s((e=a.tabid,typeof e===r?e.apply(a):e))+"' ",f=c["if"].call(a,a.isSelected,{hash:{},inverse:t.noop,fn:t.program(10,k,b),data:b}),(f||0===f)&&(d+=f),d+=">",f=c["if"].call(a,a.headerImageStyle,{hash:{},inverse:t.noop,fn:t.program(12,l,b),data:b}),(f||0===f)&&(d+=f),d+=s((e=a.headerText,typeof e===r?e.apply(a):e))+"</div>"}function i(a,b){var c="",d;return c+=" "+s((d=a.headerCss,typeof d===r?d.apply(a):d))}function j(a,b){return" ui-tabbuttonselected"}function k(a,b){return"Selected='true'"}function l(a,b){var c="",d;return c+="<div class='"+s((d=a.headerImageStyle,typeof d===r?d.apply(a):d))+"'></div>"}function m(a,b){var d="",e,f;return d+="\n			<div id='"+s((e=a.tabid,typeof e===r?e.apply(a):e))+"' class='ui-tabcontent ",f=c["if"].call(a,a.contentCss,{hash:{},inverse:t.noop,fn:t.program(15,n,b),data:b}),(f||0===f)&&(d+=f),d+=" ",f=c["if"].call(a,a.tabContent,{hash:{},inverse:t.noop,fn:t.program(17,o,b),data:b}),(f||0===f)&&(d+=f),d+="' ",f=c.unless.call(a,a.isSelected,{hash:{},inverse:t.noop,fn:t.program(3,g,b),data:b}),(f||0===f)&&(d+=f),d+=">\n				"+s((e=a.tabContent,typeof e===r?e.apply(a):e))+"\n			</div>\n		"}function n(a,b){var c="",d;return c+=" "+s((d=a.contentCss,typeof d===r?d.apply(a):d))}function o(a,b){return" ui-tabcontentborder"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var p="",q,r="function",s=this.escapeExpression,t=this;return p+="<div id='",(q=c.id)?q=q.call(b,{hash:{},data:e}):(q=b.id,q=typeof q===r?q.apply(b):q),p+=s(q)+"' class='ui-tab ",q=c["if"].call(b,b.css,{hash:{},inverse:t.noop,fn:t.program(1,f,e),data:e}),(q||0===q)&&(p+=q),p+="'>\n	<div class='ui-tabheaderlabel' ",q=c.unless.call(b,b.tabHeader,{hash:{},inverse:t.noop,fn:t.program(3,g,e),data:e}),(q||0===q)&&(p+=q),p+=">",(q=c.tabHeader)?q=q.call(b,{hash:{},data:e}):(q=b.tabHeader,q=typeof q===r?q.apply(b):q),p+=s(q)+"</div>\n	<div class='ui-tabheadercontainer'>\n		",q=c.each.call(b,b.tabs,{hash:{},inverse:t.noop,fn:t.program(5,h,e),data:e}),(q||0===q)&&(p+=q),p+="\n	</div>\n	<div class='ui-tabcontainer'>\n		",q=c.each.call(b,b.tabs,{hash:{},inverse:t.noop,fn:t.program(14,m,e),data:e}),(q||0===q)&&(p+=q),p+="\n	</div>\n</div>"}),b.taglist=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===o?e.apply(a):e),d+=p(e)}function g(a,b){var d="",e;return d+="\n		<li val='",e=c["if"].call(a,a.value,{hash:{},inverse:q.program(6,i,b),fn:q.program(4,h,b),data:b}),(e||0===e)&&(d+=e),d+="' class=\"ui-tagitem ",e=c["if"].call(a,a.selected,{hash:{},inverse:q.noop,fn:q.program(8,j,b),data:b}),(e||0===e)&&(d+=e),d+='">',e=c["if"].call(a,a.text,{hash:{},inverse:q.program(12,l,b),fn:q.program(10,k,b),data:b}),(e||0===e)&&(d+=e),d+='<a class="ui-tagitem-close">x</a></li>\n	'}function h(a,b){var c;return p((c=a.value,typeof c===o?c.apply(a):c))}function i(a,b){return p(typeof a===o?a.apply(a):a)}function j(a,b){return" selected "}function k(a,b){var c="",d;return c+=" "+p((d=a.text,typeof d===o?d.apply(a):d))+" "}function l(a,b){var c="";return c+=" "+p(typeof a===o?a.apply(a):a)+" "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var m="",n,o="function",p=this.escapeExpression,q=this;return m+='<ul id="',(n=c.id)?n=n.call(b,{hash:{},data:e}):(n=b.id,n=typeof n===o?n.apply(b):n),m+=p(n)+'" class="ui-taglist',n=c["if"].call(b,b.css,{hash:{},inverse:q.noop,fn:q.program(1,f,e),data:e}),(n||0===n)&&(m+=n),m+='">\n	',n=c.each.call(b,b.tags,{hash:{},inverse:q.noop,fn:q.program(3,g,e),data:e}),(n||0===n)&&(m+=n),m+='\n    <li class="ui-tag-new">\n    	<input id="txtNewTag',(n=c.id)?n=n.call(b,{hash:{},data:e}):(n=b.id,n=typeof n===o?n.apply(b):n),m+=p(n)+'" type="text" class="ui-tag-input">\n    </li>\n</ul>'}),b.textarea=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===j?e.apply(a):e),d+=k(e)}function g(a,b){var d="",e;return d+=' maxlength="',(e=c.maxlength)?e=e.call(a,{hash:{},data:b}):(e=a.maxlength,e=typeof e===j?e.apply(a):e),d+=k(e)+'"'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h="",i,j="function",k=this.escapeExpression,l=this;return h+='<textarea id="',(i=c.id)?i=i.call(b,{hash:{},data:e}):(i=b.id,i=typeof i===j?i.apply(b):i),h+=k(i)+'" type="text" placeholder="',(i=c.placeholder)?i=i.call(b,{hash:{},data:e}):(i=b.placeholder,i=typeof i===j?i.apply(b):i),h+=k(i)+'" class="ui-textarea',i=c["if"].call(b,b.css,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(h+=i),h+='" ',i=c["if"].call(b,b.maxlength,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(h+=i),h+=">",(i=c.text)?i=i.call(b,{hash:{},data:e}):(i=b.text,i=typeof i===j?i.apply(b):i),h+=k(i)+"</textarea>"}),b.textbox=a(function(a,b,c,d,e){function f(a,b){var d="",e;return d+=" ",(e=c.css)?e=e.call(a,{hash:{},data:b}):(e=a.css,e=typeof e===j?e.apply(a):e),d+=k(e)}function g(a,b){var d="",e;return d+=' maxlength="',(e=c.maxlength)?e=e.call(a,{hash:{},data:b}):(e=a.maxlength,e=typeof e===j?e.apply(a):e),d+=k(e)+'"'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h="",i,j="function",k=this.escapeExpression,l=this;return h+='<input id="',(i=c.id)?i=i.call(b,{hash:{},data:e}):(i=b.id,i=typeof i===j?i.apply(b):i),h+=k(i)+'" type="text" class="ui-textbox',i=c["if"].call(b,b.css,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(i||0===i)&&(h+=i),h+='" placeholder="',(i=c.placeholder)?i=i.call(b,{hash:{},data:e}):(i=b.placeholder,i=typeof i===j?i.apply(b):i),h+=k(i)+'" value="',(i=c.text)?i=i.call(b,{hash:{},data:e}):(i=b.text,i=typeof i===j?i.apply(b):i),h+=k(i)+'" ',i=c["if"].call(b,b.maxlength,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(i||0===i)&&(h+=i),h+="></input>"})}();var l=function(){return{loadCSS:function(a,b,c,d){if(a){var e=0;"string"==typeof a&&(a=[a]);for(var g=function(g){d=void 0!==d?d:!0,d&&(g=-1!==g.indexOf("?")?g+"&_t="+Date.now():g+"?_t="+Date.now());var h=document.createElement("link");h.href=g,h.type="text/css",h.rel="stylesheet",c&&(h.id=f.id+"-"+c),kc("head").append(h),h.addEventListener&&(h.addEventListener("load",function(){e++,e===a.length&&b&&b(!0)},!1),h.addEventListener("error",function(){b&&b(!1)},!1))},h=0;h<a.length;h++)/[?&]type=/.test(a[h])?g(a[h]):g(a[h]+"?type=compiled")}},loadTheme:function(a,b,c){this.loadCSS(f.resourceURL(a+".css"),b,a,void 0!==c?c:!0),kc.each(f.exports.Themes,function(b,c){c!==a&&kc("link[type='text/css'][id='"+f.id+"-"+c+"']").remove()})},currentTheme:function(){var a;return kc.each(f.exports.Themes,function(b,c){kc("link[type='text/css'][id='"+f.id+"-"+c+"']").size()>0&&(a=b)}),a},isNumber:function(a){return!isNaN(parseInt(a,10))},bindEvent:function(a,b,c){if(null!=a){var d=this;kc(a).bind(b,function(){c.apply(d,arguments)})}},unbindEvent:function(a,b){null!=a&&kc(a).unbind(b)},ajax:function(a){var b=c.getVariable(["urls","api"]);return a.url=b+a.url,a.dataType=a.dataType||"json",a.xhrFields={withCredentials:!0},kc.ajax(a)},createObjectUrl:function(a){var b=";base64,",c=null;if(-1==a.indexOf(b)){var d=a.split(","),e=d[0].split(":")[1],f=d[1];c=new Blob([f],{type:e})}else{for(var d=a.split(b),e=d[0].split(":")[1],f=window.atob(d[1]),g=f.length,h=new Uint8Array(g),i=0;g>i;++i)h[i]=f.charCodeAt(i);c=new Blob([h],{type:e})}var j=window.URL||window.webkitURL;return j.createObjectURL(c)},unloadFileFromMemory:function(a){var b=window.URL||window.webkitURL;b.revokeObjectURL(a)},setCookie:function(a,b,c,d){var e="";if(c){-1==c&&(c=365);var f=new Date;f.setTime(f.getTime()+1e3*60*60*24*c),e="; expires="+f.toGMTString()}d&&(d="; domain="+d),document.cookie=a+"="+escape(b)+e+"; path=/ "+(d||"")},getCookie:function(a){for(var b=document.cookie.split(";"),c=b.length,d=0;c>d;d++){var e=b[d].trim();if(!(e.indexOf(a)<0)){var f=e.substr(e.indexOf("=")+1);if(e=e.substr(0,e.indexOf("=")),a==e)return unescape(f)}}},deleteCookie:function(a,b){Autodesk.CookieManager.setCookie(a,"",-1,b)}}}();f.exports.Themes={Tinkercad:"core",Andes:"andes",AndesVanilla:"andes-vanilla",DivineHammer:"divine-hammer",ContentBuilder:"content-builder"},e.registerHelper("times",function(a,b){for(var c="",d=0;a>d;++d)c+=b.fn(d);return c}),e.registerHelper("for",function(a,b,c,d){for(var e="",f=a;b>f;f+=c)e+=d.fn(f);return e}),e.registerHelper("reversefor",function(a,b,c,d){for(var e="",f=a;f>b;f-=c)e+=d.fn(f);return e}),e.registerHelper("compare",function(a,b,c,d){var e={eq:function(a,b){return a==b},neq:function(a,b){return a!=b}};return Object.prototype.hasOwnProperty.call(e,b)?e[b].call(this,a,c)?d.fn(this):d.inverse(this):d.inverse(this)}),e.registerHelper("math",function(a,b,c,d){return a=parseFloat(a),c=parseFloat(c),{"+":a+c,"-":a-c,"*":a*c,"/":a/c,"%":a%c}[b]});var m=function(){};m.prototype={_extend:function(a){var b=this,c=Object.getOwnPropertyNames(this.prototype);return c.forEach(function(c){if(a.__proto__)a.__proto__.hasOwnProperty(c)||Object.defineProperty(a.__proto__,c,Object.getOwnPropertyDescriptor(b.prototype,c));else{var d=Object.getPrototypeOf(a);d.hasOwnProperty(c)||Object.defineProperty(d,c,Object.getOwnPropertyDescriptor(b.prototype,c))}}),a},initialize:function(){this.keydown=new i.EventSource("keydown"),this._bindEvent("keydown"),this.keypress=new i.EventSource("keypress"),this._bindEvent("keypress"),this.keyup=new i.EventSource("keyup"),this._bindEvent("keyup"),this.click=new i.EventSource("onclick"),this._bindEvent("click"),this.dblclick=new i.EventSource("dblclick"),this._bindEvent("dblclick"),this.focusout=new i.EventSource("focusout"),this._bindEvent("focusout"),this.hover=new i.EventSource("hover"),this._bindEvent("hover"),this.mouseenter=new i.EventSource("mouseenter"),this._bindEvent("mouseenter"),this.mouseout=new i.EventSource("mouseout"),this._bindEvent("mouseout"),this.mousemove=new i.EventSource("mousemove"),this._bindEvent("mousemove"),this.mousedown=new i.EventSource("mousedown"),this._bindEvent("mousedown"),this.mouseup=new i.EventSource("mouseup"),this._bindEvent("mouseup"),Object.defineProperty(this,"id",{get:function(){return kc(this._element).attr("id")},enumerable:!0}),Object.defineProperty(this,"parentElement",{get:function(){return kc(this._element).parent()},enumerable:!0}),Object.defineProperty(this,"isDisabled",{get:function(){return kc(this._element).attr("disabled")?!0:!1},enumerable:!0}),Object.defineProperty(this,"innerHTML",{get:function(){return kc(this._element).html()},set:function(a){kc(this._element).html(a)},enumerable:!0}),kc(this._element).parent().addClass("l"+f.id+f.version),this.onInitialize.call(this)},_bindEvent:function(a){var b=this;kc(this._element).bind(a,function(c){b[a]&&b[a].fire&&b[a].fire(null,c)})},getAttribute:function(a){return a?kc(this._element).attr(a):void 0},setAttribute:function(a,b){return a?(kc(this._element).attr(a,b),this):void 0},addClass:function(a){return kc(this._element).addClass(a),this},removeClass:function(a){return kc(this._element).removeClass(a),this},hide:function(){return kc(this._element).hide(),this.onHide(),this},show:function(){return kc(this._element).show(),this.onShow(),this},remove:function(){return this.onRemove(),kc(this._element).remove(),this},enable:function(){return kc(this._element).removeAttr("disabled"),this.onEnable(),this},disable:function(){return kc(this._element).attr("disabled","disabled"),this.onDisable(),this},focus:function(){return kc(this._element).focus(),this.onFocusIn(),this},blur:function(){return kc(this._element).blur(),this.onFocusOut(),this},onInitialize:function(){},onEnable:function(){},onDisable:function(){},onShow:function(){},onHide:function(){},onRemove:function(){},onFocusIn:function(){},onFocusOut:function(){}},m.extend=function(a){return a?(this.prototype._extend.call(this,a),this.prototype.initialize.call(a),a):void 0},j.BaseControl=m;var n=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.width=void 0,this.height=void 0},o={Tinkercad:{background:"#F9F9F9",backgroundLine:"#a5ddef",pathLine:"rgba(0,192,255,0.9)",controlPoint:"rgba(0,0,0,0.7)",controlPointBG:"rgba(255,255,255,1.0)",controlPointHitBG:"rgba(255,0,0,1.0)"},Andes:{background:"rgba(0,0,0,0.5)",backgroundLine:"rgba(255,255,255,0.5)",pathLine:"rgba(255,255,255,0.9)",controlPoint:"rgba(255,255,255,0.9)",controlPointBG:"rgba(0,0,0,1)",controlPointHitBG:"rgba(255,255,255,1)"},AndesVanilla:{background:"#F9F9F9",backgroundLine:"#E99C51",pathLine:"#e47911",controlPoint:"#e47911",controlPointBG:"#F9F9F9",controlPointHitBG:"#E75116"},DivineHammer:{background:"rgba(127,127,127,1)",backgroundLine:"rgba(255,255,255,0.5)",pathLine:"rgba(255,255,255,0.9)",controlPoint:"rgba(255,255,255,0.9)",controlPointBG:"rgba(255,255,255,1)",controlPointHitBG:"rgba(248,151,40,1)"},ContentBuilder:{background:"#F9F9F9",backgroundLine:"#88B3BE",pathLine:"#2e6270",controlPoint:"#2e6270",controlPointBG:"#ffffff",controlPointHitBG:"#ffffff"}},p=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a);var b="#"+kc(this._element).attr("id");this._chkSnap=B.bind(kc(this._element).find("input:checkbox")),this._canvas=kc(this._element).find(b+"Canvas")[0],this._canvasWidth=kc(this._canvas).width()||parseInt(kc(this._canvas).attr("width")),this._canvasHeight=kc(this._canvas).height()||parseInt(kc(this._canvas).attr("height")),this._ctx=this._canvas.getContext("2d"),this._sketch2D,Object.defineProperty(this,"value",{get:function(){return this._sketch2D},set:function(a){this._sketch2D=a,this._reset(),this.change.fire()},enumerable:!0}),this._tol=.5,this._snapValue,this._snapping=!1,this.refreshTheme(),Object.defineProperty(this,"snap",{get:function(){return this._snapping},set:function(a){this._snapping=a,this._chkSnap.checked=a},enumerable:!0}),this._dragging=!1,this._cX=this._canvasWidth/2,this._cY=this._canvasHeight/2,this.beginchange=new i.EventSource("beginchange"),this.change=new i.EventSource("change"),this.endchange=new i.EventSource("endchange"),this._initialize()};p.prototype._createControl=function(a){var b=a.id||"sketch",c=a.width||200,d=a.height||200,f=a.css||"",g={id:b,width:c+"px",height:d+"px",css:f,checkbox:{id:b+"Checkbox",text:"Snap"}},h=kc("body");return h="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),h.append(e.templates["2dsketch"](g)),h.find("#"+b)},p.prototype._initialize=function(){this._snapping=this._chkSnap.checked,this._bindEvents()},p.prototype.refreshTheme=function(){var a=o[l.currentTheme()];this._theme=a?a:o.Tinkercad,this._sketch2D&&this._draw()},p.prototype.resize=function(a){a&&(this._canvasWidth=parseInt(a),this._canvasHeight=this._canvasWidth,this._cX=this._canvasWidth/2,this._cY=this._canvasHeight/2,kc(this._canvas).attr("width",this._canvasWidth),kc(this._canvas).attr("height",this._canvasHeight),kc(this._element).width(this._canvasWidth),kc(this._element).height(this._canvasHeight),this._reset())},p.prototype.remove=function(){this._element.remove()},p.prototype._reset=function(){if(this._sketch2D){var a=this._sketch2D.bounds();if(a){var b=a.min,c=a.max;this._sX=b.x+(c.x-b.x)/2,this._sY=b.y+(c.y-b.y)/2,this._s2cScaleX=this._canvasWidth/(a.length()+20),this._s2cScaleY=-this._canvasHeight/(a.width()+20);var d=this._viewToSketch2D(0,0),e=this._viewToSketch2D(5,5);this._tol=d.distanceTo(e),d=this._sketch2DToView(0,0);var f=this._sketch2DToView(1,1);this._snapValue=d.distanceTo(f),this._draw()}}},p.prototype._bindEvents=function(){var a=this;this._chkSnap.change.bind(function(){a._snapping=a._chkSnap.checked});var b=function(a){return a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}},c=function(a){a=a||window.event;var c=d(),e=b(a);return{x:e.x-c.x,y:e.y-c.y}},d=function(){var b=kc(a._canvas).offset();return{x:b.left,y:b.top}};this._canvas.addEventListener("mousemove",function(b){if(!a._dragging){b=b||window.event;var d=c(b);a._hit=a._hitTest(d.x,d.y),a._draw()}},!1),this._canvas.addEventListener("contextmenu",function(a){a.preventDefault&&a.preventDefault()},!1),this._canvas.addEventListener("mousedown",function(b){b=b||window.event,b.preventDefault&&b.preventDefault(),document.activeElement.blur();var d=c(b);if(1===b.which&&null!==a._hit){a._dragStartX=d.x,a._dragStartY=d.y;var e=a._sketch2DToView(a._hit.position.x,a._hit.position.y);a._dragOrigX=e.x,a._dragOrigY=e.y,a._dragging=!0,a.beginchange.fire()}a._draw()},!1),this._element[0].addEventListener("mouseup",function(b){b=b||window.event,b.preventDefault&&b.preventDefault(),a._dragging&&a.endchange.fire(),a._dragging=!1,a._draw()},!1),this._element[0].addEventListener("mousemove",function(b){if(a._dragging){b=b||window.event;var d=c(b);if(null!==a._hit){var e=d.x-a._dragStartX,f=d.y-a._dragStartY,g;g=a._snapping?a._viewToSketch2D(Math.round((a._dragOrigX+e)/a._snapValue)*a._snapValue,Math.round((a._dragOrigY+f)/a._snapValue)*a._snapValue):a._viewToSketch2D(a._dragOrigX+e,a._dragOrigY+f);var h=!a._hit.position.equals(g);if(h){var j=a._sketch2DToView(a._hit.position.x,a._hit.position.y),k=a._sketch2DToView(g.x,g.y);e=k.x-j.x,f=k.y-j.y}a._hit.position=g;for(var l=a._sketch2D.paths.length,m=0;l>m;m++)if(a._sketch2D.paths[m]===a._hit.curve.path){var n=function(b,c,d){var e=a._sketch2D.paths[m].curveAt(b).controlPoints;e[c]=d,a._sketch2D.paths[m].curveAt(b).controlPoints=e};if(a._hit.curveStart||a._hit.curveEnd){if(a._hit.curveStart?a._sketch2D.paths[m].curveAt(a._hit.curve.index).start=g:a._sketch2D.paths[m].curveAt(a._hit.curve.index).end=g,a._hit.curve instanceof i.Bezier2D&&a._hit.controlPoint&&h){var o=function(b){var c=a._sketch2DToView(b.x,b.y).move(e,f);return a._viewToSketch2D(c.x,c.y)};if(2===a._hit.controlPoint.length){var p=o(a._hit.controlPoint[0]),q=o(a._hit.controlPoint[1]);if(a._hit.controlPoint[0]=p,a._hit.controlPoint[1]=q,a._hit.curveStart){n(a._hit.curve.index,0,p);var r;r=a._hit.curve.prev()?a._hit.curve.prev().index:a._sketch2D.paths[m].lastCurve().index,n(r,1,q)}else{n(a._hit.curve.index,1,p);var s;s=a._hit.curve.next()?a._hit.curve.next().index:a._sketch2D.paths[m].firstCurve().index,n(s,0,q)}}else if(1===a._hit.controlPoint.length){var p=o(a._hit.controlPoint[0]);a._hit.controlPoint[0]=p,n(a._hit.curve.index,0,p)}}}else if(a._hit.controlPoint&&(n(a._hit.curve.index,a._hit.controlPoint[0],g),!b.altKey&&2===a._hit.controlPoint.length)){var t,u;0===a._hit.controlPoint[0]?(u=a._hit.curve.prev()?a._hit.curve.prev():a._sketch2D.paths[m].lastCurve(),t=g.clone(),t.rotate(Math.PI,u.end.x,u.end.y)):(u=a._hit.curve.next()?a._hit.curve.next():a._sketch2D.paths[m].firstCurve(),t=g.clone(),t.rotate(Math.PI,u.start.x,u.start.y)),n(u.index,a._hit.controlPoint[1],t)}}}a._draw(),null!==a._hit&&a.change.fire()}},!1)},p.prototype._drawBG=function(){this._ctx.fillStyle=this._theme.background,this._ctx.fillRect(0,0,this._canvasWidth,this._canvasHeight),this._ctx.beginPath();for(var a=0;a<this._canvasWidth;a+=this._snapValue)this._ctx.moveTo(a+.5,0),this._ctx.lineTo(a+.5,this._canvasHeight);for(var a=0;a<this._canvasHeight;a+=this._snapValue)this._ctx.moveTo(0,a+.5),this._ctx.lineTo(this._canvasWidth,a+.5);this._ctx.lineWidth=.5,this._ctx.strokeStyle=this._theme.backgroundLine,this._ctx.closePath(),this._ctx.stroke(),this._ctx.beginPath(),this._ctx.moveTo(0,0),this._ctx.lineTo(this._canvasWidth,0),this._ctx.moveTo(this._canvasWidth,0),this._ctx.lineTo(this._canvasWidth,this._canvasHeight),this._ctx.moveTo(this._canvasWidth,this._canvasHeight),this._ctx.lineTo(0,this._canvasHeight),this._ctx.moveTo(0,this._canvasHeight),this._ctx.lineTo(0,0),this._ctx.lineWidth=2,this._ctx.closePath(),this._ctx.strokeStyle=this._theme.pathLine,this._ctx.stroke()},p.prototype._draw=function(){this._drawBG();for(var a=this._sketch2D.paths.length,b=this,c=function(a,c,d){b._ctx.fillStyle=b._theme.controlPoint,b._ctx.beginPath(),b._ctx.rect(a-4,c-4,8,8),b._ctx.closePath(),b._ctx.fill(),b._ctx.fillStyle=d?b._theme.controlPointHitBG:b._theme.controlPointBG,b._ctx.beginPath(),b._ctx.rect(a-2,c-2,4,4),b._ctx.closePath(),b._ctx.fill()},d=function(a,c,d){b._ctx.fillStyle=b._theme.controlPoint,b._ctx.beginPath(),b._ctx.arc(a,c,4,0,2*Math.PI,!0),b._ctx.closePath(),b._ctx.fill(),b._ctx.fillStyle=d?b._theme.controlPointHitBG:b._theme.controlPointBG,b._ctx.beginPath(),b._ctx.arc(a,c,2,0,2*Math.PI,!0),b._ctx.closePath(),b._ctx.fill()},e=function(){if(b._hit){var a=b._sketch2DToView(b._hit.position.x,b._hit.position.y);b._hit.curveStart||b._hit.curveEnd?c(a.x,a.y,!0):void 0!==b._hit.controlPoint&&d(a.x,a.y,!0)}},f=function(a){var c=[];a&&(c=[3]),b._ctx.setLineDash?b._ctx.setLineDash(c):b._ctx.mozDash=c},g=0;a>g;g++){for(var h=this._sketch2D.paths[g].toPolygons(),j=h.length,k=0;j>k;k++){var l=h[k],m=l.length/2;this._ctx.beginPath();for(var n=0;m>n;n++){var o=this._sketch2DToView(l[2*n+0],l[2*n+1]);0===n?this._ctx.moveTo(o.x,o.y):this._ctx.lineTo(o.x,o.y)}this._ctx.closePath(),this._ctx.lineWidth=2,this._ctx.strokeStyle=this._theme.pathLine,this._ctx.stroke()}for(var p=this._sketch2D.paths[g].firstCurve();p;){var q=this._sketch2DToView(p.start.x,p.start.y),r=this._sketch2DToView(p.end.x,p.end.y);if(p instanceof i.Bezier2D){var s=p.controlPoints;if(2===s.length)for(var t=s.length/2,u=0;t>u;u++){var v=this._sketch2DToView(s[u].x,s[u].y),w=this._sketch2DToView(s[u+1].x,s[u+1].y);f(!0),this._ctx.beginPath(),this._ctx.moveTo(v.x,v.y),this._ctx.lineTo(q.x,q.y),this._ctx.moveTo(w.x,w.y),this._ctx.lineTo(r.x,r.y),this._ctx.lineWidth=1,this._ctx.strokeStyle=this._theme.controlPoint,this._ctx.closePath(),this._ctx.stroke(),f(!1),d(v.x,v.y),d(w.x,w.y)}else if(1===s.length){var x=this._sketch2DToView(s[0].x,s[0].y);f(!0),this._ctx.beginPath(),this._ctx.moveTo(x.x,x.y),this._ctx.lineTo(q.x,q.y),this._ctx.moveTo(x.x,x.y),this._ctx.lineTo(r.x,r.y),this._ctx.lineWidth=1,this._ctx.strokeStyle=this._theme.controlPoint,this._ctx.closePath(),this._ctx.stroke(),f(!1),d(x.x,x.y)}}c(q.x,q.y),c(r.x,r.y),p=p.next()}}e()},p.prototype._sketch2DToView=function(a,b){var c=this._cX+(a-this._sX)*this._s2cScaleX,d=this._cY+(b-this._sY)*this._s2cScaleY;return new i.Point2D(c,d)},p.prototype._viewToSketch2D=function(a,b){var c=this._sX+(a-this._cX)/this._s2cScaleX,d=this._sY+(b-this._cY)/this._s2cScaleY;return new i.Point2D(c,d)},p.prototype._hitTest=function(a,b){for(var c={position:null,curve:null,curveStart:null,curveEnd:null,controlPoint:null},d=this._viewToSketch2D(a,b),e=new i.Point2D(d.x,d.y),f=this._sketch2D.paths.length,g=0;f>g;g++){for(var h=this._sketch2D.paths[g].curvesByPoint(e,this._tol),j=h.length-1;j>-1;j--){var k=h[j];if(e.distanceTo(k.start)<this._tol){if(c={position:k.start,curve:k,curveStart:!0},k instanceof i.Bezier2D)if(c.controlPoint||(c.controlPoint=[]),2===k.controlPoints.length){c.controlPoint.push(k.controlPoints[0]);var l;l=k.prev()?k.prev():this._sketch2D.paths[g].lastCurve(),l instanceof i.Bezier2D&&l.controlPoints&&2===l.controlPoints.length&&c.controlPoint.push(l.controlPoints[1])}else 1===k.controlPoints.length&&c.controlPoint.push(k.controlPoints[0]);break}if(e.distanceTo(k.end)<this._tol){if(c={position:k.end,curve:k,curveEnd:!0},k instanceof i.Bezier2D)if(c.controlPoint||(c.controlPoint=[]),2===k.controlPoints.length){c.controlPoint.push(k.controlPoints[1]);var m;m=k.next()?k.next():this._sketch2D.paths[g].firstCurve(),m instanceof i.Bezier2D&&m.controlPoints&&2===m.controlPoints.length&&c.controlPoint.push(m.controlPoints[0])}else 1===k.controlPoints.length&&c.controlPoint.push(k.controlPoints[0]);break}}for(var j=h.length-1;j>-1;j--){var k=h[j];if(k instanceof i.Bezier2D)for(var n=k.controlPoints,o=0;o<n.length;o++)if(e.distanceTo(n[o])<this._tol){if(c={position:n[o],curve:k},c.controlPoint||(c.controlPoint=[]),2===n.length)if(0===o){var l;l=k.prev()?k.prev():this._sketch2D.paths[g].lastCurve(),c.controlPoint=l instanceof i.Bezier2D&&l.controlPoints&&2===l.controlPoints.length?[o,o+1]:[o]}else{var m;m=k.next()?k.next():this._sketch2D.paths[g].firstCurve(),c.controlPoint=m instanceof i.Bezier2D&&m.controlPoints&&2===m.controlPoints.length?[o,o-1]:[o]}else 1===n.length&&(c.controlPoint=[o]);break}}}return c.position||(c=null),c},p.bind=function(a){return new p(a)},j.Sketch2D=p;var q=function(){this.id=void 0,this.parent=void 0,this.css=void 0},r=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._items=[],Object.defineProperty(this,"items",{get:function(){return this._items},enumerable:!0}),Object.defineProperty(this,"selectedItem",{get:function(){var a=this._element.find(".ui-accordion-item-header[selected=selected]");if(1===a.size()){var b=a.parent(),c=[b.index()];if(!b.parent().hasClass("ui-accordion"))for(var d=new Date;;){if((new Date-d)/1e3>5)break;if(b.parent().hasClass("ui-accordion"))break;b.parent().hasClass("ui-accordion-item-content")&&(c.push(b.parent().parent().index()),b=b.parent().parent())}for(var e=this._items,f,g=c.length-1;g>=0;g--)f=e[c[g]],0!==g&&(e=f.items);return f}},enumerable:!0,configurable:!0}),m.call(this),this.initialize(),this.change=new i.EventSource("change")};r.prototype=Object.create(m.prototype,{constructor:{value:r}}),r.prototype._createControl=function(a){var b=a.id||"accordion",c=a.css||"",d={id:b,css:c},f=kc("body");return f="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),f.append(e.templates.accordion(d)),f.find("#"+b)},r.prototype.onInitialize=function(){this._refresh()},r.prototype._refresh=function(){var a=this;this._element.on("click",".ui-accordion-item-header",function(){a._element.find(".ui-accordion-item-header").removeAttr("selected"),kc(this).attr("selected","selected"),a.change.fire()}),this._element.on("click",".ui-accordion-item-icon",function(){kc(this).hasClass("ui-accordion-item-icon-down")?kc(this).removeClass("ui-accordion-item-icon-down"):kc(this).addClass("ui-accordion-item-icon-down")})},r.prototype.add=function(a){if(a){a instanceof Array||(a=[a]);for(var b=a.length,c,d=0;b>d;d++)c=a[d].header&&a[d].content?new t({id:a[d].id?kc.trim(a[d].id):void 0,header:a[d].header,content:a[d].content}):new t({id:a[d].id?kc.trim(a[d].id):void 0,header:a[d].header?kc.trim(a[d].header):kc.trim(a[d])}),this._element.append(c.element),this._items.push(c)}},r.prototype.clear=function(a){void 0===a?(this._items=[],this._element.find(".ui-accordion-item").remove()):this._items.length>a&&this._items[a].clear()},r.prototype.remove=function(a){void 0===a?this._element.remove():this._items.length>a&&(this._items[a].element.remove(),this._items.splice(a,1)),this.onRemove()},j.Accordion=r;var s=function(){this.id=void 0,this.header=void 0,this.content=void 0},t=function(a){if(a instanceof HTMLElement||a.jquery)this._element=kc(a);else{var b=a.id||"",c={id:b,header:"string"==typeof a.header?a.header:"",content:"string"==typeof a.content?a.content:""};this._element=kc(e.templates.accordionitem(c)),a.header&&"string"!=typeof a.header&&this._element.find(".ui-accordion-item-header").append(kc(a.header)),a.content&&"string"!=typeof a.content&&this._element.find(".ui-accordion-item-content").append(kc(a.content))}this._items=[],Object.defineProperty(this,"items",{get:function(){return this._items},enumerable:!0}),Object.defineProperty(this,"element",{get:function(){return this._element},enumerable:!0}),Object.defineProperty(this,"header",{get:function(){return this._header},set:function(a){kc(this._header).html(""),kc(this._header).append(a)
},enumerable:!0}),Object.defineProperty(this,"content",{get:function(){return this._content},set:function(a){null===a?kc(this._content).html(""):kc(this._content).append(a),this._refresh()},enumerable:!0}),m.call(this),this.initialize(),this.change=new i.EventSource("change")};t.prototype=Object.create(m.prototype,{constructor:{value:t}}),t.prototype.onInitialize=function(){this._icon=this._element.find(".ui-accordion-item-icon"),this._header=this._element.find(".ui-accordion-item-header"),this._content=this._element.find(".ui-accordion-item-content"),this._refresh()},t.prototype._refresh=function(){""===this._content.html()?this._icon.addClass("ui-accordion-item-noicon"):this._icon.removeClass("ui-accordion-item-noicon")},t.prototype.add=function(a){if(a){a instanceof Array||(a=[a]);for(var b=a.length,c,d=0;b>d;d++)c=a[d].header&&a[d].content?new t({id:a[d].id?kc.trim(a[d].id):void 0,header:a[d].header,content:a[d].content}):new t({id:a[d].id?kc.trim(a[d].id):void 0,header:a[d].header?kc.trim(a[d].header):kc.trim(a[d])}),this._content.append(c.element),this._items.push(c);b>0&&this._refresh()}},t.prototype.clear=function(){void 0===index?(this._items=[],this._element.empty()):this._items.length>index&&this._items[index].clear()},t.prototype.remove=function(a){void 0===a?(this._items=[],this._element.remove()):this._items.length>a&&(this._items[a].element.remove(),this._items.splice(a,1))},t.bind=function(a){return new t(r)},j.AccordionItem=t;var u=function(a){this._element=a,this._mode=null,this._defaultClass=null,m.call(this),this.initialize()};u.prototype=Object.create(m.prototype,{constructor:{value:u}}),u.create=function(a,b,c){var d={};d.id=b;var e='<div id="'+b+'blockControl" class="blockUI '+c+'" style="display: none;"></div>',f=a||kc("body");return new u(kc(e).prependTo(f))},u.bind=function(a){return new u(a)};var v=function(){this._blockControl=null,this._activeControl=null,this._controlStack=[]};v.instance=function(){return v._instance||(v._instance=new v,v._instance._bind(u.create(null,"appBlockUI"))),v._instance},v.prototype={_bind:function(a){this._blockControl=a}},v.prototype._sortControlStack=function(a,b){return a.priority>b.priority},v.prototype._pushToStack=function(a){kc(a._element).css("z-index",""),kc(a._element).hide(),this._controlStack.push(a),this._controlStack.sort(this._sortControlStack)},v.prototype.unblock=function(a,b){var c=a._element;if(this._hide(a,b),0==this._controlStack.length)this._blockControl.hide(),this._activeControl=null;else if(this._activeControl==a)this._show(this._controlStack.pop());else{var d=this._controlStack.indexOf(a);d>=0&&this._controlStack.splice(d,1)}this.hideonclickfn&&kc(this._blockControl._element).unbind("click",this.hideonclickfn)},v.prototype.blockDialog=function(a,b,c){kc(a._element).addClass("blockUIDialog"),this.block(a,b,c)},v.prototype.block=function(a,b,c){if(null!=b&&1==b&&this._addCloseButton(a,c),null!=this._activeControl){if(!(this._activeControl.priority<=a.priority))return this._pushToStack(a),void 0;this._pushToStack(this._activeControl)}this._show(a)},v.prototype._show=function(a){if(this._activeControl=a,kc(a._element).css("z-index",a.priority),this._activeControl.hideonclick){var b=this;kc(this._blockControl._element).unbind("click"),kc(this._blockControl._element).bind("click",function(){b.unblock(a,!1),a.close.fire()})}else kc(this._blockControl._element).unbind("click");kc(a._element).show(),this._blockControl.show()},v.prototype._hide=function(a,b){kc(a._element).css("z-index",""),b===!0?kc(a._element).remove():kc(a._element).hide()},v.prototype._addCloseButton=function(a,b){var c=a._element,d="closeuidialog";if(null!=b&&1==b&&(d+=" closeuidialogexternal"),0==kc(c).find("#closeuidialogbutton").length){var e='<div id="closeuidialogbutton"></div>';kc(c).append(e)}var f=this,g=kc(c).find("#closeuidialogbutton");kc(g).attr("class",d),kc(g).click(function(){a.unblock()})};var w=function(a,b,c){this._element=a,this.hideonclick=c,this.priority=3e3+(null==b||isNaN(b)?1:b),this.close=new i.EventSource("additem")};w.create=function(a,b,c){return new w(a,b,c)},w.prototype.blockDialog=function(a,b){v.instance().blockDialog(this,a,b)},w.prototype.block=function(a,b){v.instance().block(this,a,b)},w.prototype.unblock=function(a){v.instance().unblock(this,a)},j.BlockControl=v,j.BlockUI=w;var x=function(){this.id=void 0,this.parent=void 0,this.text=void 0,this.css=void 0,this.icon=void 0},y=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),a.icon&&(this._iconParams=a.icon),Object.defineProperty(this,"text",{get:function(){return kc(this._element).text()},set:function(a){var b=kc(this._element).find("span");b.size()?b.text(a):kc(this._element).text(a)},enumerable:!0}),Object.defineProperty(this,"icon",{get:function(){return this._iconParams},set:function(a){this._iconParams=a;var b=kc(this._element).find("img");b.size()&&(a.position&&("top"===a.position||"left"===a.position?b.prependTo(this._element):b.appendTo(this._element)),a.url&&(b[0].src=a.url))},enumerable:!0}),m.extend(this)};y.prototype._createControl=function(a){var b=a.id||"button",c=a.text||"",d=a.css||"",f=a.icon||null;null!==f&&(f.position||(f.position="left"),f.width||(f.width=20),f.height||(f.height=20));var g={id:b,text:c,css:d,icon:f},h=kc("body");return h="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),h.append(e.templates.button(g)),h.find("#"+b)},y.prototype.onInitialize=function(){this._icon=this._element.find(".ui-button-icon")},y.bind=function(a){return new y(a)},j.Button=y;var z=function(){this.id=void 0,this.parent=void 0,this.text=void 0,this.css=void 0,this.checked=void 0,this.labelPosition=void 0,this.labelCss=void 0},A={Left:"left",Right:"right"},B=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._label=void 0,m.extend(this),Object.defineProperty(this,"checked",{get:function(){return kc(this._element).is(":checked")},set:function(a){a?kc(this._element).attr("checked","checked"):kc(this._element).removeAttr("checked")},enumerable:!0}),Object.defineProperty(this,"value",{get:function(){return kc(this._element).attr("value")},set:function(a){kc(this._element).attr("value",a)},enumerable:!0}),Object.defineProperty(this,"text",{get:function(){return kc(this._label).text()},set:function(a){kc(this._label).text(a)},enumerable:!0}),this.change=new i.EventSource("change"),this._bindEvent("change")};B.prototype._createControl=function(a){var b=a.id||"checkbox",c=a.text||"",d=a.css||"",f=a.labelCss||"",g=a.labelPosition||A.Right;d+=g==A.Left?" ui-checkbox-leftmargin":" ui-checkbox-rightmargin";var h={id:b,text:c,css:d,labelCss:f,labelPosition:g},i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.checkbox(h)),i.find("#"+b)},B.prototype.onInitialize=function(){var a=kc(this._element).next();if(a.attr("for")===this.id)this._label=a;else{var b=kc("body").find('[for="'+this.id+'"]');b.size()>0&&(this._label=b)}},B.prototype.onRemove=function(){this._label.remove()},B.bind=function(a){return new B(a)},j.Checkbox=B,j.CheckboxLabelPosition=A;var C=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.hideClose=void 0,this.hideFooter=void 0,this.isModel=void 0},D=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._items=[],this._isModel=void 0!==a.isModel?a.isModel:!0,m.call(this),this.initialize(),Object.defineProperty(this,"content",{get:function(){return this._content},set:function(a){this._content.empty().append(a)},enumerable:!0}),this.close=new i.EventSource("close")};D.prototype=Object.create(m.prototype,{constructor:{value:D}}),D.prototype._createControl=function(a){var b=a.id||"dialog",c=a.css||"",d=a.hideClose||!1,f=a.hideFooter||!1,g={id:b,css:c,hideClose:d,hideFooter:f},h=kc(e.templates.dialog(g));return kc("body").append(h),h},D.prototype.onInitialize=function(){var a=this;this._createBlockUI(),this._content=this._element.find(".ui-dialog-content"),this._close=this._element.find(".ui-dialog-close"),this._close.click(function(){a.hide(),a.close.fire()})},D.prototype.onShow=function(){this._createBlockUI()},D.prototype._createBlockUI=function(){if(this._isModel&&!this._blockid){var a=this;this._blockid=w.create(this._element,1,!0),this._blockid.blockDialog(),this._blockid.close.bind(function(){a.onRemove(),a.close.fire()})}},D.prototype._deleteBlockUI=function(){this._isModel&&this._blockid&&(this._blockid.unblock(),delete this._blockid)},D.prototype.onHide=function(){this._deleteBlockUI()},D.prototype.onRemove=function(){this._deleteBlockUI()},j.Dialog=D;var E=function(){this.id=void 0,this.parent=void 0,this.css=void 0},F=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this),this.resize=new i.EventSource("resize"),this._dockLocations={};var b={},c=kc(this._element).find(".ui-dock-layout-left"),d=kc(this._element).find(".ui-dock-layout-center"),e=kc(this._element).find(".ui-dock-layout-right"),f=kc(this._element).find(".ui-dock-layout-top"),g=kc(this._element).find(".ui-dock-layout-bottom"),h=kc(this._element).find(".ui-dock-layout-middle"),k=function(a,b){this.direction=a,this.control=b,this.handle=kc(b).children(".ui-dock-layout-"+a+"-resizer");var c=this;this.oldDimension=void 0,this.oldPosition=void 0};k.prototype={setDimension:function(a){var b=this.handle.width(),c=this.handle.height();switch(this.direction){case"left":this.control.width(this.oldDimension-(this.oldPosition-a.pageX)+b);break;case"right":this.control.width(this.oldDimension+(this.oldPosition-a.pageX)+b);break;case"top":this.control.height(this.oldDimension-(this.oldPosition-a.pageY)+c);break;case"bottom":this.control.height(this.oldDimension+(this.oldPosition-a.pageY)+c)}},storePositions:function(a){"left"==this.direction||"right"==this.direction?(this.oldDimension=this.control.width(),this.oldPosition=a.pageX):(this.oldDimension=this.control.height(),this.oldPosition=a.pageY)}};var l=this,n=function(a,b){var c=kc(b).children(".ui-dock-layout-"+a+"-resizer");if(c.size()){var d=new k(a,b),e=!1,f=function(a){e=!0,d.setDimension(a),l.update(),l.resize.fire()},g=function(a){var b=e;e=!1,kc(l._element).removeClass("ui-disable-selection"),kc(window).unbind("mousemove"),kc(window).unbind("mouseup"),b||l.update()};c.mousedown(function(a){kc(l._element).addClass("ui-disable-selection"),d.storePositions(a),kc(window).mousemove(f),kc(window).mouseup(g)})}};c.size()&&(this._dockLocations.left=c,b.left=new j.Panel({id:this.id+"-left-panel",parent:c,css:"ui-dock-layout-panel",suppressHeader:!0}),n("left",c),this.resize.bind(function(){b.left.resize.fire()})),d.size()&&(this._dockLocations.center=d),e.size()&&(this._dockLocations.right=e,b.right=new j.Panel({id:this.id+"-right-panel",parent:e,css:"ui-dock-layout-panel",suppressHeader:!0}),n("right",e),this.resize.bind(function(){b.right.resize.fire()})),f.size()&&(this._dockLocations.top=f,b.top=new j.Panel({id:this.id+"-top-panel",parent:f,css:"ui-dock-layout-panel",suppressHeader:!0}),n("top",f),this.resize.bind(function(){b.top.resize.fire()})),g.size()&&(this._dockLocations.bottom=g,b.bottom=new j.Panel({id:this.id+"-bottom-panel",parent:g,css:"ui-dock-layout-panel",suppressHeader:!0}),n("bottom",g),this.resize.bind(function(){b.bottom.resize.fire()})),h.size()&&(this._dockLocations.middle=h,b.fill=new j.Panel({id:this.id+"-middle-panel",parent:h,css:"ui-dock-layout-panel",suppressHeader:!0}),this.resize.bind(function(){b.fill.resize.fire()})),Object.defineProperty(this,"content",{get:function(){return b},enumerable:!0}),this.update()};F.prototype.update=function(a){var b=kc(this._element).width(),c=kc(this._element).height(),d=1;if(this._dockLocations.center){var e=0;this._dockLocations.left&&(e+=kc(this._dockLocations.left).outerWidth(!0)),this._dockLocations.right&&(e+=kc(this._dockLocations.right).outerWidth(!0));var f=Math.round(b-e),g=kc(this._dockLocations.center).width();Math.abs(f-g)>d&&kc(this._dockLocations.center).css("width",f)}if(this._dockLocations.middle){var h=0;this._dockLocations.top&&(h+=kc(this._dockLocations.top).outerHeight(!0)),this._dockLocations.bottom&&(h+=kc(this._dockLocations.bottom).outerHeight(!0));var i=Math.round(c-h),j=kc(this._dockLocations.middle).height();Math.abs(i-j)>d&&kc(this._dockLocations.middle).css("height",i)}},F.prototype._createControl=function(a){var b=a.id||"docklayout",c=a.css||"",d=a.dock,f={};d&&(f={left:d.left||!1,right:d.right||!1,center:d.top||d.bottom||d.fill?{top:d.top||!1,bottom:d.bottom||!1,middle:d.fill||!1}:!1});var g={id:b,css:c,dock:f},h=kc("body");return h="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),h.append(e.templates.docklayout(g)),h.find("#"+b)},j.DockLayout=F;var G=function(){this.id=void 0,this.parent=void 0,this.items=void 0,this.css=void 0,this.tabIndex=void 0},H=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this),this._items=a.items||[],Object.defineProperty(this,"selectedValue",{get:function(){return this._getValue()},set:function(a){a=kc.trim(a),""!==a&&this._setValue(a)},enumerable:!0}),Object.defineProperty(this,"selectedIndex",{get:function(){return""!==this.selectedText?kc(this._ullist).find('li[selected="selected"]').index():-1},set:function(a){a>=0&&this._setValue(kc(this._ullist).find("li:nth-child("+(a+1)+")").attr("tag"))},enumerable:!0}),Object.defineProperty(this,"selectedText",{get:function(){return kc.trim(kc(this._text).val())},set:function(a){a=kc.trim(a),""!==a&&this._setValue(kc(this._ullist).find("li").filter(function(){return kc(this).text()==a}).attr("tag"))},enumerable:!0}),Object.defineProperty(this,"items",{get:function(){return this._items},enumerable:!0}),this.change=new i.EventSource("change")};H.prototype._createControl=function(a){var b=a.id||"dropdown",c=a.css||"",d=a.tabIndex||1,f=a.title||"",g=a.items||[],h={id:b,items:g,css:c,tabindex:d,title:f},i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.dropdown(h)),i.find("#"+b)},H.prototype.onInitialize=function(){var a=this;this._text=this._element.find("input#ui-dropdown-input"+this.id),this._ullist=this._element.find("ul#ui-dropdown-list"+this.id),this._btnDown=this._element.find(".ui-dropdown-icon"),this._btnDown.click(function(){a._ullist.toggle()}),this._text.click(function(){a._ullist.toggle()}),this.hide(),this._ullist.find("li").click(function(){a._setValue(kc(this).attr("tag")),a.hide()}),kc("body").bind("click",function(b){kc(b.target).closest(a._element).length||a.hide()})},H.prototype._getValue=function(){return kc(this._ullist).find('li[selected="selected"]').attr("tag")},H.prototype._setValue=function(a){this.clear();var b=kc(this._ullist).find('li[tag="'+a+'"]');this._text.val(b.text()),b.attr("selected","selected"),this.change.fire()},H.prototype.clear=function(){kc(this._ullist).find('li[selected="selected"]').removeAttr("selected"),kc(this._text).val("")},H.prototype.onFocusIn=function(){this._text.focus()},H.prototype.hide=function(){this._ullist.hide()},H.prototype.show=function(){this._ullist.show()},H.bind=function(a){return new H(a)},j.Dropdown=H;var I=function(){this._element=null,this._description=null,this._title=null,this._refCount=0,Object.defineProperty(this,"title",{get:function(){return this._title.text()},set:function(a){this._title.text(kc.trim(a)).show()},enumerable:!0}),Object.defineProperty(this,"description",{get:function(){return this._descripton.text()},set:function(a){this._descripton.text(kc.trim(a))},enumerable:!0}),m.call(this),this.initialize()};I.prototype=Object.create(m.prototype,{constructor:{value:Error}}),I.prototype.onInitialize=function(){var a={};a.id="errorDialog",a.title="",a.description="";var b=this,c=e.templates.error(a);this._parent=kc("body");var d=kc(c).prependTo(this._parent);this._element=kc("#"+a.id),this._title=kc(this._element).find(".ui-error-title"),this._descripton=kc(this._element).find(".ui-error-desc"),this._btnClose=kc(this._element).find(".ui-dialog-close"),this._btnClose.bind("click",function(){b.hide()}),this.hide()},I.prototype.show=function(a){1==++this._refCount&&(this._blockid||(this._blockid=w.create(this._element,a.priority)),this._blockid.blockDialog(),kc(this._element).show(),a.title||""===kc.trim(a.title)?this.title=a.title:this._title.hide(),a.description&&(this.description=a.description)),this.onShow()},I.prototype.hide=function(){--this._refCount<=0&&(kc(this._element).hide(),this._refCount=0,this._blockid&&(this._blockid.unblock(),delete this._blockid)),this.onHide()};var J=function(){var a;return{instance:function(){return a||(a=new I),a}}}();j.ErrorDialog=J;var K=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.rating=void 0,this.comment=void 0,this.isEdit=void 0},L=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),void 0!==a.rating&&(this._rating=a.rating),void 0!==a.isEdit&&(this._isEdit=a.isEdit),m.extend(this),Object.defineProperty(this,"rating",{get:function(){return this._ratingControl.rating},set:function(a){this._ratingControl.rating=a,this._updateUIAndBindEvents()},enumerable:!0}),Object.defineProperty(this,"comment",{get:function(){return this._txtComment.text},set:function(a){this._txtComment.text=a,this._updateUIAndBindEvents()},enumerable:!0}),Object.defineProperty(this,"isEdit",{get:function(){return this._isEdit},set:function(a){this._isEdit=a,this._updateUIAndBindEvents()},enumerable:!0}),this.submit=new i.EventSource("submit"),this.delete=new i.EventSource("delete")};L.prototype._createControl=function(a){var b=a.id||"feedback",c=a.css||"",d,f;d=a.rating||0,f=kc.trim(a.comment)||"";var g={id:b,css:c,isEdit:this.isEdit},d={id:b+"rating",rating:d,max:5,readonly:!1};g.rating=d;var f={id:b+"txtComment",text:f};g.comment=f;var h=kc("body");return h="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),h.append(e.templates.feedback(g)),h.find("#"+b)},L.prototype.onInitialize=function(){var a=this;this._saveFeedbackButton=this._element.find("a#save"),this._clearFeedbackButton=this._element.find("a#clear"),this._pipeDiv=this._element.find(".ui-feedback-buttonpipe"),this._txtComment=hc.bind(this._element.find("#"+this.id+"txtComment")),this._ratingControl=Xb.bind(this._element.find("#"+this.id+"rating"),{rating:this._rating,readonly:!1});var b=function(){a._saveFeedbackButton.is(":visible")||(a._saveFeedbackButton.show(),a._pipeDiv.show(),a._isEdit||(a._element.find(".ui-feedback-label").hide(),a._element.find(".ui-feedback-button").show(),a._clearFeedbackButton.hide(),a._pipeDiv.hide()))};this._isEdit&&this._pipeDiv.hide(),this._ratingControl.change.bind(function(){b()}),this._txtComment.keyup.bind(function(){b()}),this._updateUIAndBindEvents()},L.prototype.onEnable=function(){this._txtComment.enable(),this._saveFeedbackButton.removeClass("ui-feedback-disable"),this._clearFeedbackButton.removeClass("ui-feedback-disable"),this._updateUIAndBindEvents(),this._rating.enable()},L.prototype.onDisable=function(){this._txtComment.disable(),this._saveFeedbackButton.unbind("click").addClass("ui-feedback-disable"),this._clearFeedbackButton.unbind("click").addClass("ui-feedback-disable"),this._rating.disable()},L.prototype._updateUIAndBindEvents=function(){var a=this;this._saveFeedbackButton.unbind("click").bind("click",function(b){a.submit.fire(),b.preventDefault()}),this._clearFeedbackButton.unbind("click").bind("click",function(b){a.delete.fire(),b.preventDefault()}),this._updateUIAndChangeMode()},L.prototype._updateUIAndChangeMode=function(){this._isEdit?(this._element.find(".ui-feedback-label").hide(),this._element.find(".ui-feedback-button").show(),this._clearFeedbackButton.show(),this._pipeDiv.hide(),this._saveFeedbackButton.hide()):(this._element.find(".ui-feedback-label").show(),this._element.find(".ui-feedback-button").hide(),this._clearFeedbackButton.hide(),this._saveFeedbackButton.hide())},L.bind=function(a,b){var c=new L(a);void 0!==b.rating&&(c._ratingControl.rating=b.rating);var d=kc.trim(b.comment);return""!==d&&(c._txtComment.text=d),void 0!==b.isEdit&&(c._isEdit=b.isEdit,c._updateUIAndChangeMode(),c._pipeDiv.hide()),c},j.Feedback=L;var M=function(){this._fileHandlers={}};M.prototype={_addFileHandler:function(a,b){var c=this._fileHandlers;c[a]=b},_removeFileHandler:function(a){var b=this._fileHandlers;void 0!==b[a]&&delete b[a]}};var N={File:"file",Image:"image"},O=function(){var a=new M,b=function(a){var b=new RegExp(/((.jpg|.jpeg|.png|.bmp)$)|(^image\/\*$)/),c=new RegExp(/\.[a-z]+$/);return b.test(a)?N.Image:c.test(a)?a.replace(/[^\w]/gi,""):"*.*"===a?"default":void 0};return{fileHandlers:function(){return kc.extend({},a._fileHandlers)},addFileHandler:function(c,d){a._addFileHandler(b(c),d)},removeFileHandler:function(c){a._removeFileHandler(b(c))},getFileHandler:function(c){var d=b(c);return void 0!==a._fileHandlers[d]?a._fileHandlers[d]:void 0!==d&&"default"!==c?a._fileHandlers["default"]:void 0}}}(),P=function(){this.id=void 0,this.parent=void 0,this.editorParent=void 0,this.accept=void 0,this.maxsize=void 0},Q=function(a){this._value=void 0,this._hander=void 0,this._handlerData={},Object.defineProperty(this,"value",{get:function(){return this._value},set:function(a){void 0!==a&&(this._value=a,void 0!==this._handlerData&&void 0!==this._handlerData.onValueChange&&this._handlerData.onValueChange(a))},enumerable:!0}),Object.defineProperty(this,"handlerData",{get:function(){return this._handlerData},enumerable:!0}),this.beginchange=new i.EventSource("beginchange"),this.change=new i.EventSource("change"),this.endchange=new i.EventSource("endchange"),this._create(a)};Q.prototype._create=function(a){var b=O.getFileHandler(a.accept);void 0!==b&&b.create(a,this)},Q.prototype.remove=function(){void 0!==this._handlerData&&void 0!==this._handlerData.removeControls&&this._handlerData.removeControls()},Q.prototype.resize=function(){void 0!==this._handlerData&&void 0!==this._handlerData.resize&&this._handlerData.resize()};var R=function(){};R.prototype.onValueChange=function(a){},R.prototype.removeControls=function(){},R.extend=function(a){for(var b=Object.getOwnPropertyNames(R.prototype),c=0,d=b.length;d>c;c++){var e=b[c];"function"==typeof R.prototype[e]&&"constructor"!==e&&void 0===a[e]&&(a[e]=R.prototype[e])}};var S=function(){R.extend(this)};S.prototype.create=function(b,c){var d=this,e=c.handlerData;e.fileManager=c,e.fileUpload=new Y({id:b.id+"fileUploadControl",parent:b.parent,accept:b.accept,maxsize:b.maxSize,uploadUrl:b.uploadUrl?b.uploadUrl:void 0}),e.fileUpload.complete.bind(function(a){return function(b){a.fileManager._value={url:a.fileUpload.value.url,fileURL:a.fileUpload.value.objectUrl+"#"+encodeURIComponent(a.fileUpload.fileName)},a.fileManager.endchange.fire()}}(e)),e.removeControls=function(a){return function(){a.fileUpload.remove(),delete a.fileUpload}}(e),e.onValueChange=function(b){return function(c){if(c.url||c.fileURL){var d=kc.extend({},c),e=a.creativePlatformRuntime.createFile(d),f=function(a){if(b.fileUpload){var c;try{c=new Blob([a])}catch(f){"InvalidStateError"==f.name&&(c=new Blob([a.buffer]))}var g=window.URL||window.webkitURL,h={fileName:e.name,objectUrl:g.createObjectURL(c),url:d.url};b.fileUpload.changeFile(h)}};e.readAsDataView(f)}}}(e)};var T=function(){R.extend(this)};T.prototype.create=function(b,c){var d=this,e=c.handlerData;e.value={url:"",fileURL:void 0,editor:{original:"",operations:[]}},e.params=b,e.fileUpload=new Y({id:b.id+"fileUploadControl",parent:b.parent,accept:b.accept,maxsize:b.maxSize,uploadUrl:b.uploadUrl?b.uploadUrl:void 0}),b.config&&b.config.mask&&(e.mask=new i.Sketch2D(b.config.mask)),e.fnEndEdit=function(a){return function(){a.value&&a.value.fileURL&&l.unloadFileFromMemory(a.value.fileURL),a.value.fileURL=a.imageEdit.image+"#"+encodeURIComponent(a.fileUpload.fileName),a.value.editor.operations.push({xform:a.imageEdit.transformMatrix.elements}),c._value=a.value,kc(a.params.editorParent).hide(),a.imageEdit.hide(),c.change.fire();var b=a.fileUpload.value;b.objectUrl=a.imageEdit.image,a.fileUpload.value=b,a.fileUpload.uploadFile()}}(e),e.fileUpload.uichange.bind(function(a){return function(b){b.data===V.SelectFile?c.beginchange.fire():b.data===V.BeginImageEdit&&a.imageEdit?(kc(a.params.editorParent).show(),a.imageEdit.show(),a.imageEdit.change.unbind(),a.imageEdit.change.bind(function(){a.fileUpload._onEndImageEdit(),a.fnEndEdit()}),c.beginchange.fire()):b.data===V.EndImageEdit&&a.imageEdit&&a.fnEndEdit()}}(e)),e.fileUpload.complete.bind(function(a){return function(b){a.fileUpload&&a.params.editorParent&&""!==a.params.editorParent&&(a.fileChanged?(a.imageEdit&&a.imageEdit.remove(),a.imageEdit=new _({id:a.params.id+"imageEditControl",parent:a.params.editorParent,width:"string"==typeof a.params.editorParent?kc("#"+a.params.editorParent).width():kc(a.params.editorParent).width(),height:"string"==typeof a.params.editorParent?kc("#"+a.params.editorParent).height():kc(a.params.editorParent).height(),mask:a.mask}),a.imageEdit.image=a.fileUpload.value.objectUrl,a.value.editor.original=a.params.uploadUrl?a.value.url=a.fileUpload.value.url:a.value.fileURL,kc(a.params.editorParent).hide(),a.imageEdit.hide(),a.fileChanged=!1):a.params.uploadUrl&&(a.value.url=a.fileUpload.value.url),c._value=a.value,c.endchange.fire())}}(e)),e.fileUpload.change.bind(function(a){return function(){a.fileChanged=!0,a.value={url:"",fileURL:a.fileUpload.value.objectUrl+"#"+encodeURIComponent(a.fileUpload.fileName),editor:{original:"",operations:[]}},c._value=a.value,c.change.fire()}}(e)),e.resize=function(a){return function(){a.imageEdit&&a.imageEdit.resize(kc(a.params.editorParent).width(),kc(a.params.editorParent).height())}}(e),e.removeControls=function(a){return function(){a.fileUpload.remove(),delete a.fileUpload,a.imageEdit&&a.imageEdit.remove(),kc(a.params.editorParent).hide()}}(e),e.onValueChange=function(b){return function(c){if(c&&c.editor&&c.editor.original&&""!==c.editor.original){var d={url:c.editor.original};b.value=kc.extend({},c);var e=a.creativePlatformRuntime.createFile(d),f=function(a){if(b.fileUpload){var d;try{d=new Blob([a])}catch(f){"InvalidStateError"==f.name&&(d=new Blob([a.buffer]))}var g=window.URL||window.webkitURL,h=b.fileUpload.value;h.fileName=e.name,h.objectUrl=g.createObjectURL(d),h.url=c.editor.original,b.fileUpload.changeFile(h);var j;b.params.config&&b.params.config.mask&&(j=new i.Sketch2D(b.params.config.mask)),b.imageEdit&&b.imageEdit.remove(),b.imageEdit=new _({id:b.params.id+"imageEditControl",parent:b.params.editorParent,width:"string"==typeof b.params.editorParent?kc("#"+b.params.editorParent).width():kc(b.params.editorParent).width(),height:"string"==typeof b.params.editorParent?kc("#"+b.params.editorParent).height():kc(b.params.editorParent).height(),mask:j}),b.imageEdit.image=h.objectUrl,b.imageEdit.change.bind(function(){if(0!==c.editor.operations.length)for(var a=0;a<c.editor.operations.length;a++)b.imageEdit.transformMatrix=new i.Matrix2D(c.editor.operations[a].xform)}),kc(b.params.editorParent).hide(),b.imageEdit.hide()}};e.readAsDataView(f)}}}(e)};var U=function(){O.addFileHandler("image/*",new T),O.addFileHandler("*.*",new S)};j.FileManager=Q,j.FileHandlers=O;var V={BeginImageEdit:0,EndImageEdit:1,SelectFile:2},W=function(){this.id=void 0,this.parent=void 0,this.accept=void 0,this.maxsize=void 0,this.uploadUrl=void 0},X={fileName:void 0,url:void 0,objectUrl:void 0},Y=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._maxSize=void 0!==a.maxsize&&parseInt(a.maxsize)&&a.maxsize?a.maxsize:10485760,this._accept=a.accept?kc.trim(a.accept):void 0,this._imagePattern=new RegExp(/((.jpg|.jpeg|.png|.bmp)$)|(^image\/\*$)/),this._imagePattern.test(this._accept)?(this._type=N.Image,this._browseText="Drag a picture here"):(this._type=N.File,this._browseText="Drag a file here"),this._value=kc.extend({},X),this._disconnected=!0,a.uploadUrl&&(this._uploadURL=a.uploadUrl,this._disconnected=!1),Object.defineProperty(this,"maxsize",{get:function(){return this._maxSize},enumerable:!0}),Object.defineProperty(this,"fileName",{get:function(){return this._value.fileName},enumerable:!0}),Object.defineProperty(this,"value",{get:function(){return this._value},set:function(a){this._value=a},enumerable:!0}),this.complete=new i.EventSource("complete"),this.change=new i.EventSource("change"),this.uichange=new i.EventSource("uichange"),this.error=new i.EventSource("error"),m.extend(this)};Y.prototype._createControl=function(a){var b=a.id||"fileUpload",c=a.css||"",d={id:b,css:c},f=kc("body");return f="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),f.append(e.templates.fileupload(d)),f.find("#"+b)},Y.prototype.onInitialize=function(){var a=this;this._content=this._element.find("#"+this.id+"content"),this._contentText=this._element.find("#"+this.id+"contenttext"),this._contentText.text(this._browseText),this._progress=this._element.find("#"+this.id+"progress"),this._message=this._element.find("#"+this.id+"message");var b=this._parseSizeAndDisplayuinit();this._type===N.Image?(this._btnAdjustImage=new y({id:this.id+"adjustImage",text:"Adjust",parent:this._element.find("#"+this.id+"buttonContainer")}),this._btnAdjustImage.hide(),this._btnAdjustImage.click.bind(function(b){a._adjustImage.call(a,b)}),this._btnDoneEditing=new y({id:this.id+"doneEditing",text:"Done Adjusting",parent:this._element.find("#"+this.id+"buttonContainer")}),this._btnDoneEditing.hide(),this._btnDoneEditing.click.bind(function(b){a._onEndImageEdit(),a.uichange.fire(V.EndImageEdit)}),this._message.text("Accepts .png .jpg .bmp under "+b.size+" "+b.displayUnit+" for best results")):this._message.text("Accepts "+this._accept+", under "+b.size+" "+b.displayUnit),this._btnBrowseFile=new y({id:this.id+"browsefile",text:"Or choose one",parent:this._element.find("#"+this.id+"buttonContainer")}),this._file=this._element.find("#"+this.id+"file"),this._accept&&this._file.attr("accept",this._accept),this._btnBrowseFile.click.bind(function(){a.uichange.fire(V.SelectFile),a._file.click()});var c=function(b){a._content.removeClass("ui-file-content-hover"),a._handleFileSelect.call(a,b)},d=function(b){a._handleDragOver.call(a,b)};this._file.change(c),this._content[0].addEventListener("dragover",d,!1),this._content[0].addEventListener("dragleave",d,!1),this._content[0].addEventListener("drop",function(b){a.uichange.fire(V.SelectFile),c(b)},!1),kc(document).bind("drop dragover",function(a){a.preventDefault()})},Y.prototype._parseSizeAndDisplayuinit=function(){var a=parseInt(this._maxSize/1048576),b="MB";return 1>a&&(a=parseInt(this._maxSize/1024),b="KB"),{size:a,displayUnit:b}},Y.prototype.reset=function(){this._file.wrap("<form>").closest("form").get(0).reset(),this._type===N.Image&&(this._btnAdjustImage.hide(),this._btnDoneEditing.hide()),this._content.html("").text(this._browseText).removeClass("ui-file-content-selected"),this.setError(!1)},Y.prototype._onBeginImageEdit=function(){this._btnAdjustImage.hide(),this._btnDoneEditing.show(),this._content.addClass("ui-file-content-thumb-blur")},Y.prototype._onEndImageEdit=function(){this._btnAdjustImage.show(),this._btnDoneEditing.hide(),this._content.removeClass("ui-file-content-thumb-blur")},Y.prototype._handleDragOver=function(a){a.stopPropagation(),a.preventDefault(),"dragover"==a.type?this._content.addClass("ui-file-content-hover"):this._content.removeClass("ui-file-content-hover")},Y.prototype._setContent=function(){if(this._type===N.Image){this._btnAdjustImage.show(),this._btnDoneEditing.hide(),this._btnBrowseFile.text="Change";var a=kc('<img class="ui-file-content-thumb" src="'+this._value.objectUrl+'" title="'+this._value.fileName+'"/>');this._content.addClass("ui-file-content-selected").html(a),a[0].onload=function(){a.height()<110&&a.css({height:"110px",width:"auto"})}}else this._content.html(this._value.fileName)},Y.prototype._createBlob=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(a){(200==this.status||0===this.status&&this.response)&&b(this.response)
},c.send()},Y.prototype._handleFileSelect=function(a){var b=this;if(a){a.stopPropagation(),a.preventDefault();var c=a.target.files||a.dataTransfer.files;if(c.length>0){if(!this._validate(c[0]))return;this._content.removeClass("ui-file-content-selected").removeClass("ui-file-content-thumb-blur"),this._value=kc.extend({},X),this._value.fileName=c[0].name;var d=new FileReader;d.onload=function(a){return function(a){var c=l.createObjectUrl(a.target.result);b._value.objectUrl=c,b._setContent(),b.change.fire(),b._disconnected?(b._value.url="",b.complete.fire()):b._createBlob(c,function(a){b._uploadFile.call(b,a).done(function(c){b._value.url=c,b.complete.fire(),a=null})})}}(c[0]),d.readAsDataURL(c[0])}}},Y.prototype.uploadFile=function(a){var b=this;this._disconnected?this.complete.fire():this._createBlob(this._value.objectUrl,function(a){b._uploadFile.call(b,a).done(function(c){b._value.url=c,b.complete.fire(),a=null})})},Y.prototype.changeFile=function(a){this._value=a,this._setContent()},Y.prototype.setError=function(a){a?this._message.addClass("ui-file-message-error"):this._message.removeClass("ui-file-message-error")},Y.prototype._validate=function(a){var b="",c=a.name.split(".")[a.name.split(".").length-1].toLowerCase();return this._type!==N.Image||new RegExp(/((jpg|jpeg|png|bmp)$)/).test(c)?this._type!==N.Image&&this._accept.indexOf(c)<0&&(b="Please select a valid file. Allowed files are: "+this._accept,b=new Error(b),b.name="FileTypeError"):(b="Please select an image",b=new Error(b),b.name="FileTypeError"),""===b&&parseInt(a.size)>this._maxSize&&(b=this._type===N.Image?"Please select image smaller than "+this._parseSizeAndDisplayuinit().size+" "+this._parseSizeAndDisplayuinit().displayUnit:"Please select file smaller than "+this._parseSizeAndDisplayuinit().size+" "+this._parseSizeAndDisplayuinit().displayUnit,b=new Error(b),b.name="FileSizeError"),b?(void 0===this._value.fileName&&this.reset(),this.error.fire(b),!1):!0},Y.prototype._adjustImage=function(){this._onBeginImageEdit(),this.uichange.fire(V.BeginImageEdit)},Y.prototype._uploadFile=function(a){var b=this,c=new FormData,d="";c.append("file",a,encodeURIComponent(this._value.fileName)),d=this._value.url&&""!==this._value.url?/(.*)\/[^\/]*\/[^\/]*/.exec(this._value.url)[1]:this._uploadURL+"/userdata/public";var e=new kc.Deferred;return kc.ajax({url:d,type:"POST",xhrFields:{withCredentials:!0},xhr:function(){var a=new XMLHttpRequest;return a.upload.addEventListener("progress",function(a){a.lengthComputable&&(a.loaded!==a.total?b._progress.width(parseInt(a.loaded/a.total)+"%"):b._progress.width("100%"))},!1),a},beforeSend:function(){b._progress.width("0%").show()},success:function(a,c,d){b._progress.fadeOut(1e3),e.resolve(b._uploadURL+d.getResponseHeader("location"))},error:function(a,b,c){e.reject()},data:c,cache:!1,contentType:!1,processData:!1}),e},j.FileUpload=Y,g.prototype={bind:function(a){var b=this,c=function(a){a.parent=a.parent||kc("body");var c=new h(a);b.items[a.id]=c,c.itemclick.bind(function(a){b.click.fire(a.data,a.originalEvent)}),c.itemhover.bind(function(a){b.hover.fire(a.data,a.originalEvent)})};if(a instanceof Array)for(var d=0,e=a.length;e>d;d++)c(a[d]);else c(a)},remove:function(a){this.items[a]&&(this.items[a].remove(),delete this.items[a])},clear:function(){for(var a in this.items)this.remove(a)},update:function(){for(var a in this.items){var b=this.items[a];b.update()}}};var Z=function(){this.id=void 0,this.parent=void 0,this.type=void 0,this.target=void 0,this.direction=void 0,this.iconcss=void 0,this.css=void 0};h.prototype={_absoluteParent:function(a,b){var c=kc(a).get(0),d=b?kc(b).get(0):kc(document).get(0);if(c.offsetParent){var e=c.offsetLeft,f=c.offsetTop;if(c.offsetParent!=d){var g=this._absoluteParent(c.offsetParent,b);g&&(e+=g.left,f+=g.top)}return{left:e,top:f}}},update:function(){this.direction&&"left"!==this.direction?"right"===this.direction?(this._element.addClass("ui-hoverarea-direction-horizontal"),this._element.find(".ui-hoverarea-icon").appendTo(this._element)):"top"===this.direction?this._element.addClass("ui-hoverarea-direction-vertical"):(this._element.addClass("ui-hoverarea-direction-vertical"),this._element.find(".ui-hoverarea-icon").appendTo(this._element)):this._element.addClass("ui-hoverarea-direction-horizontal");var a=this._absoluteParent(this.target,this.parent),b=this._element.find(".ui-hoverarea-direction"),c=this._element.width(),d=this._element.height(),e=this.target.width(),f=this.target.height();this.direction&&"left"!==this.direction?"right"===this.direction?(this._element.css("left",a.left+e),this._element.css("top",a.top+f/2)):"top"===this.direction?(this._element.css("top",a.top-d),this._element.css("left",a.left+e/2)):(this._element.css("top",a.top+f),this._element.css("left",a.left+e/2)):(this._element.css("left",a.left-c),this._element.css("top",a.top+f/2))},onRemove:function(){kc(this._element).unbind("click").unbind("hover"),this.itemhover.unbind(),this.itemclick.unbind()}},h.prototype._createControl=function(a){var b=a.id,c=a.css||"",d,f;f=a.iconcss||"";var g={id:b,css:c,iconcss:f,direction:d},h=kc("body");return h="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),h.append(e.templates.hoverarea(g)),h.find("#"+b)},j.HoverArea=g,j.HoverItem=h;var $=function(){this.id=void 0,this.parent=void 0,this.image=void 0,this.mask=void 0,this.width=void 0,this.height=void 0},_=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._width=a.width,this._height=a.height,this._matrix2d=new i.Matrix2D,this._cX=this._width/2,this._cY=this._height/2,this._image=a.image?a.image:void 0,a.mask&&(this._maskSketch=a.mask),a.transformMatrix?this._setTransformMatrix(a.transformMatrix):(this._currentScale=1,this._currentAngle=0),this._scaleDelta=.01,this._maskCanvas=document.createElement("canvas"),this._maskCanvas.width=this._width,this._maskCanvas.height=this._height,this._maskCtx=this._maskCanvas.getContext("2d"),Object.defineProperty(this,"image",{get:function(){return this._getDrawing(),this._image},set:function(a){this._image=a,this._initializeDraw()},enumerable:!0}),Object.defineProperty(this,"transformMatrix",{get:function(){return this._transformMatrix},set:function(a){this._setTransformMatrix(a),this._drawFromMatrix()},enumerable:!0}),this.change=new i.EventSource("change"),m.extend(this)};_.prototype._setTransformMatrix=function(a){a instanceof i.Matrix2D?a=a.clone():Array.isArray(a)&&9===a.length?a=new i.Matrix2D(a):Plugin.panic(ERROR_ARGUMENTS_MESSAGE),this._transformMatrix=a,this._currentScale=Math.sqrt(a.elements[0]*a.elements[0]+a.elements[3]*a.elements[3]),this._currentAngle=180*Math.atan2(-a.elements[3],a.elements[0])/Math.PI,this._scale&&(this._scale.value=this._currentScale),this._rorate&&(this._rorate.value=this._currentAngle)},_.prototype._createControl=function(a){var b=a.id||"imageEdit",c=a.css||"",d={id:b,css:c,width:a.width,height:a.height},f=kc("body");return f="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),f.append(e.templates.imageedit(d)),f.find("#"+b)},_.prototype.onInitialize=function(){var a=this;this._canvas=this._element.find("#"+this.id+"canvas"),this._ctx=this._canvas[0].getContext("2d"),this._imageElement=this._element.find("#"+this.id+"image"),this._rotateLeft=this._element.find("#"+this.id+"rotateLeft"),this._rotateRight=this._element.find("#"+this.id+"rotateRight"),this._close=this._element.find("#"+this.id+"close"),this._scale=new ac({id:"zoomSlider",parent:this.id+"zoomContainer",showText:!1,steps:this._scaleDelta,min:.5,max:2,orientation:bc.Vertical}),this._scale.value=this._currentScale,this._rorate=new ac({id:"rotateSlider",parent:this.id+"rotateContainer",showText:!1,steps:1,min:-180,max:180}),this._rorate.value=this._currentAngle,this._rotateLeft.click(function(){var b=a._currentAngle;-180==a._currentAngle||a._currentAngle<=180&&a._currentAngle>90?b=90:a._currentAngle<=90&&a._currentAngle>0?b=0:a._currentAngle<=0&&a._currentAngle>-90?b=-90:a._currentAngle<=-90&&a._currentAngle>-180&&(b=-180);var c=b-a._currentAngle;a._rorate.value=a._currentAngle=b,a._appendRotate(c)}),this._rotateRight.click(function(){var b=a._currentAngle;180==a._currentAngle||a._currentAngle>=-180&&a._currentAngle<-90?b=-90:a._currentAngle>=-90&&a._currentAngle<0?b=0:a._currentAngle>=0&&a._currentAngle<90?b=90:a._currentAngle>=90&&a._currentAngle<180&&(b=180);var c=b-a._currentAngle;a._rorate.value=a._currentAngle=b,a._appendRotate(c)}),this._close.click(function(){a.change.fire()}),this._bindEvents(),this._initializeDraw()},_.prototype.resize=function(a,b){a&&b&&(this._width=a,this._height=b,kc(this._element).width(this._width),kc(this._element).height(this._height),kc(this._maskCanvas).attr("width",this._width),kc(this._maskCanvas).attr("height",this._height),kc(this._canvas).attr("width",this._width),kc(this._canvas).attr("height",this._height),this._cX=this._width/2,this._cY=this._height/2,this._initializeDraw(!0))},_.prototype._initializeDraw=function(a){if(this._maskSketch){var b=this._maskSketch.bounds();if(b){var c=b.min,d=b.max;this._maskWidth=b.length(),this._maskHeight=b.width(),this._sX=c.x+(d.x-c.x)/2,this._sY=c.y+(d.y-c.y)/2,this._drawMask()}}if(this._image){var e=this;this._imageElement[0].src==this._image&&(this._imageElement[0].src="");var f=this._width,g=this._height;this._imageElement[0].src=this._image,this._imageElement[0].onload=function(b){if(f===e._width&&g===e._height){e._imageWidth=e._imageElement[0].width,e._imageHeight=e._imageElement[0].height;var c=e._maskWidth||e._width,d=e._maskHeight||e._height,h=Math.min(c/e._imageWidth,d/e._imageHeight);e._imageWidth=e._imageElement[0].width=e._imageWidth*h,e._imageHeight=e._imageElement[0].height=e._imageHeight*h,e._transformMatrix||(e._transformMatrix=new i.Matrix2D,e._transformMatrix.translation(e._width/2,e._height/2)),e._drawFromMatrix(),a||e.change.fire()}}}},_.prototype._appendScale=function(a){var b=new i.Matrix2D;b.scaling(a,a);var c=this._transformMatrix.elements[6],d=this._transformMatrix.elements[7];this._transformMatrix.elements[6]=0,this._transformMatrix.elements[7]=0,this._transformMatrix.transform(b),this._transformMatrix.elements[6]=c,this._transformMatrix.elements[7]=d,this._drawFromMatrix()},_.prototype._appendRotate=function(a){var b=new i.Matrix2D,c=Math.PI*a/180;b.rotation(c);var d=this._transformMatrix.elements[6],e=this._transformMatrix.elements[7];this._transformMatrix.elements[6]=0,this._transformMatrix.elements[7]=0,this._transformMatrix.transform(b),this._transformMatrix.elements[6]=d,this._transformMatrix.elements[7]=e,this._drawFromMatrix()},_.prototype._appendTranslate=function(a,b){var c=new i.Matrix2D;c.translation(a,b),this._transformMatrix.transform(c),this._drawFromMatrix()},_.prototype._bindEvents=function(){var a=this;this._scale.change.bind(function(){a._appendScale(a._scale.value/a._currentScale),a._currentScale=a._scale.value}),this._rorate.change.bind(function(){var b=a._rorate.value-a._currentAngle;a._currentAngle=a._rorate.value,a._appendRotate(b)}),this._canvas[0].onmousedown=function(b){kc("body").addClass("ui-image-edit-noselect");var c=a._getMousePos.call(a,b);a._startX=c.x,a._startY=c.y,a._isDown=!0},this._canvas[0].onmousemove=function(b){if(a._isDown===!0){var c=a._getMousePos.call(a,b),d=c.x,e=c.y,f=d-a._startX,g=e-a._startY;a._appendTranslate(f,g),a._startX=d,a._startY=e}},this._canvas[0].onmouseup=function(b){kc("body").removeClass("ui-image-edit-noselect"),a._isDown=!1},this._canvas[0].onmouseout=function(b){a._isDown=!1}},_.prototype._drawFromMatrix=function(){this._clear(),this._ctx.save();var a=this._transformMatrix.elements;this._ctx.transform(a[0],a[1],a[3],a[4],a[6],a[7]),this._ctx.drawImage(this._imageElement[0],-this._imageWidth/2,-this._imageHeight/2,this._imageWidth,this._imageHeight),this._ctx.restore(),this._maskSketch&&(this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.drawImage(this._maskCanvas,0,0),this._ctx.restore())},_.prototype._getDrawing=function(){var a=this._maskWidth?Math.min(this._maskWidth,this._width):this._width,b=this._maskHeight?Math.min(this._maskHeight,this._height):this._height;this._resultCanvas||(this._resultCanvas=document.createElement("canvas")),this._resultCanvas.width=a,this._resultCanvas.height=b;var c=this._resultCanvas.getContext("2d");c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,a,b),c.restore();var d=a/2,e=b/2,f=this,g=function(a,b){var c=d+(a-f._sX),g=e-(b-f._sY);return new i.Point2D(c,g)};if(this._maskSketch)for(var h=this._maskSketch.paths.length,j=0;h>j;j++)for(var k=this._maskSketch.paths[j].toPolygons(),m=k.length,n=0;m>n;n++){var o=k[n],p=o.length/2;c.beginPath();for(var q=0;p>q;q++){var r=g(o[2*q+0],o[2*q+1]);0===q?c.moveTo(r.x,r.y):c.lineTo(r.x,r.y)}c.closePath(),c.clip()}c.save();var s=new i.Matrix2D;s.translation((a-this._width)/2,(b-this._height)/2);var t=this._transformMatrix.clone().transform(s).elements;c.transform(t[0],t[1],t[3],t[4],t[6],t[7]),c.drawImage(this._imageElement[0],-this._imageWidth/2,-this._imageHeight/2,this._imageWidth,this._imageHeight),c.restore(),this._image=l.createObjectUrl(this._resultCanvas.toDataURL())},_.prototype._drawMask=function(){for(var a=this._maskSketch.paths.length,b=0;a>b;b++)for(var c=this._maskSketch.paths[b].toPolygons(),d=c.length,e=0;d>e;e++){var f=c[e],g=f.length/2;this._maskCtx.beginPath();for(var h=0;g>h;h++){var i=this._sketch2DToView(f[2*h+0],f[2*h+1]);0===h?this._maskCtx.moveTo(i.x,i.y):this._maskCtx.lineTo(i.x,i.y)}this._maskCtx.closePath(),this._maskCtx.fillStyle="rgba(230, 230, 230, 0.6)",this._maskCtx.rect(this._width,0,-this._width,this._height),this._maskCtx.fill()}},_.prototype._sketch2DToView=function(a,b){var c=this._cX+(a-this._sX),d=this._cY-(b-this._sY);return new i.Point2D(c,d)},_.prototype._clear=function(){this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._width,this._height),this._ctx.restore()},_.prototype._getMousePos=function(a){var b=this._canvas[0].getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}},j.ImageEdit=_;var ab=function(){this.id=void 0,this.parent=void 0,this.items=void 0,this.mainImage=void 0,this.mapImage=void 0,this.css=void 0},bb=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),a.items?this._items=a.items:[],this._mapimageurl=a.mapImage;var b=this,c=function(a){for(var c=b._items.length,d=0;c>d;d++){var e=b._items[d];if(e.value===a)return e}};Object.defineProperty(this,"value",{get:function(){return this._value},set:function(a){this._setValue(c(a))},enumerable:!0}),this._canvas=kc(this._element).find("canvas")[0],Object.defineProperty(this,"change",{writable:!1,enumerable:!0,configurable:!1,value:new i.EventSource("change")}),Object.defineProperty(this,"itemhover",{writable:!1,enumerable:!0,configurable:!1,value:new i.EventSource("itemhover")}),m.extend(this);for(var d=b._items.length,e=0;d>e;e++){var f=b._items[e];if(f.selected){this.value=f.value;break}}};bb.prototype._createControl=function(a){var b=a.id||"ImageMap",c=a.css||"",d=a.items||[],f=a.mainImage||"",g=a.mapImage||"",h={id:b,css:c,mainimage:f,mapimage:g},i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.imagemap(h)),i.find("#"+b)},bb.prototype.onInitialize=function(){var a=this,b=this._canvas.getContext("2d"),c=new Image;c.onload=function(){a._canvas.width=c.width,a._canvas.height=c.height,b.drawImage(c,0,0)},c.src=this._mapimageurl;var d=kc(this._element).find(".ui-imagemap-container");kc(d).bind("mousemove",function(b){var c=b.offsetX,d=b.offsetY;if(void 0===b.offsetX){var e=kc(this).offset();c=b.pageX-e.left,d=b.pageY-e.top}a._updateImage(c,d)}),kc(d).bind("mouseout",function(b){a._updateImage(-1,-1)}),kc(d).bind("click",function(){a._hoveredValue&&a._setValue(a._hoveredItem,!0)}),kc(this._element).find("#"+this.id+"-main-image").css("visibility","visible")},bb.prototype.clearSelection=function(){var a=kc(this._element).find(".ui-imagemap-selected-item");a.css("visibility","hidden").removeClass("ui-imagemap-selected-item"),kc(this._element).find("#"+this.id+"-main-image").css("visibility","visible"),delete me._value,delete me._hoveredItem,delete me._hoveredValue},bb.prototype._setValue=function(a,b){var c=kc(this._element).find("#"+this.id+"-active-image");if(a){var d=this._value;this._value=a.value;var e=a.activesrc;c.attr("src",e),c.css("visibility","visible"),b&&this.change.fire({oldValue:d,newValue:this._value,id:this.id})}},bb.prototype._updateImage=function(a,b){var c=this._getColorByPoint(a,b);c=c.toLowerCase();for(var d=this._items.length,e,f,g,h=0;d>h;h++){var i=this._items[h],j=i.value.toLowerCase();if(j===c){e=i,f=i.imagesrc,g=i.value;break}}var k=kc(this._element).find("#"+this.id+"-hover-image");if(e){k.css("visibility","visible"),k.attr("src",f);var l=this._hoveredValue;this._hoveredItem=e,this._hoveredValue=g,this.itemhover.fire({oldValue:l,newValue:this._hoveredValue,id:this.id})}else k.css("visibility","hidden"),kc(this._element).removeClass("ui-imagemap-hover"),this.itemhover.fire({oldValue:l,newValue:void 0,id:this.id}),delete this._hoveredItem,delete this._hoveredValue},bb.prototype._getColorByPoint=function(a,b){var c=this._canvas.getContext("2d"),d=c.getImageData(a,b,1,1).data,e=d[0],f=d[1],g=d[2];return((1<<24)+(e<<16)+(f<<8)+g).toString(16).slice(1)},j.ImageMap=bb;var cb=function(){this.id=void 0,this.value=void 0,this.imagesrc=void 0,this.cssclass=void 0},db=function(){this.id=void 0,this.parent=void 0,this.items=void 0,this.itemsPerSlide=void 0,this.itemCss=void 0,this.css=void 0},eb=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),a.items?this._items=a.items:[],this._itemsPerSlide=a.itemsPerSlide?a.itemsPerSlide:5,this._itemCss=a.itemCss?a.itemCss:1,this._currentSlideIndex=0,this._slides=[],this._hideNavigation=!1,this._slideContainer=void 0,this._nextNavigator=void 0,this._previousNavigator=void 0,this._selectedValue=void 0,Object.defineProperty(this,"selectedValue",{get:function(){return this._selectedValue},set:function(a){a=kc.trim(a),this._selectItem(a)},enumerable:!0}),Object.defineProperty(this,"slideIndex",{get:function(){return this._currentSlideIndex},set:function(a){a>=this._slides.length||this._selectSlide(a)},enumerable:!0}),Object.defineProperty(this,"hideNavigation",{get:function(){return this._hideNavigation},set:function(a){this._hideNavigation=a,a?(this._nextNavigator.hide(),this._previousNavigator.hide(),this._slideContainer.addClass("ui-itemnavigation-hide").removeClass("ui-itemnavigation-show")):(this._nextNavigator.show(),this._previousNavigator.show(),this._slideContainer.removeClass("ui-itemnavigation-hide").addClass("ui-itemnavigation-show"))},enumerable:!0}),this.change=new i.EventSource("change"),this.slidechange=new i.EventSource("slidechange"),m.extend(this)};eb.prototype._createControl=function(a){var b=a.id||"Itemslider",c=a.css||"",d={id:b,css:c},f=kc("body");return f="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),f.append(e.templates.itemslider(d)),f.find("#"+b)},eb.prototype.onInitialize=function(){var a=this;if(this._slideContainer=this._element.find(".ui-itemslidercontainer"),this._items.length>0){var b,c,d=[];for(b=0,c=this._items.length;c>b;b+=this._itemsPerSlide)d.push(this._items.slice(b,b+this._itemsPerSlide));for(var b=0;b<d.length;b++){var e=kc('<div id="'+b+'"></div>').addClass("ui-slide");0!=b&&e.hide();for(var c=0;c<d[b].length;c++){var f=kc("<div id="+d[b][c].id+"></div>").addClass("ui-slide-item").attr("value",d[b][c].value);"string"==typeof this._itemCss?f.addClass(this._itemCss):this._itemCss||"object"!=typeof this._itemCss||f.css(this._itemCss),void 0!==d[b][c].cssclass&&""!==d[b][c].cssclass&&f.addClass(d[b][c].cssclass),d[b][c].imagesrc&&("string"==typeof d[b][c].imagesrc?f.css({"background-image":"url("+d[b][c].imagesrc+")","background-repeat":"no-repeat","background-size":"contain"}):(f.data("imagesrc",d[b][c].imagesrc),f.css({"background-image":"url("+d[b][c].imagesrc.normal+")","background-repeat":"no-repeat","background-size":"contain"}),d[b][c].imagesrc.active&&d[b][c].imagesrc.hover&&(f.hover(function(){kc(this).data("imagesrc").hover&&kc(this).css("background-image","url("+kc(this).data("imagesrc").hover+")")}),f.mouseout(function(){void 0!=a._selectedValue&&kc(this).attr("value")==a._selectedValue?kc(this).css("background-image","url("+kc(this).data("imagesrc").active+")"):kc(this).css("background-image","url("+kc(this).data("imagesrc").normal+")")})))),e.append(f),f.click(function(b){a._itemClick(this)})}this._slideContainer.append(e),this._slides.push(e)}}this._nextNavigator=this._element.find("#nextSlide"),this._previousNavigator=this._element.find("#previousSlide"),this._nextNavigator.click(function(){a._navigatorClick(1)}),this._previousNavigator.click(function(){a._navigatorClick(0)}).addClass("ui-itemnavigationdisable"),this._items.length<=this._itemsPerSlide&&(this.hideNavigation=!0)},eb.prototype._itemClick=function(a){for(var b=0;b<this._slides.length;b++){var c=this._slides[b].find('.ui-slide-item[value="'+this._selectedValue+'"]');1===c.size()&&(c.removeClass("ui-slide-itemselected"),kc(c).data("imagesrc")&&kc(c).css("background-image","url("+kc(c).data("imagesrc").normal+")"))}kc(a).addClass("ui-slide-itemselected"),kc(a).data("imagesrc")&&kc(a).css("background-image","url("+kc(a).data("imagesrc").active+")");var d=kc(a).attr("value");this._selectedValue=d,this.change.fire(d)},eb.prototype._selectItem=function(a){for(var b=0;b<this._slides.length;b++){var c=this._slides[b].find('.ui-slide-item[value="'+a+'"]');1===c.size()?(c.addClass("ui-slide-itemselected"),kc(c).data("imagesrc")&&kc(c).css("background-image","url("+kc(c).data("imagesrc").active+")"),this._selectedValue=kc(c).attr("value"),this._slides[b].find('.ui-slide-item[value!="'+a+'"]').removeClass("ui-slide-itemselected"),this._selectSlide(b)):this._slides[b].find(".ui-slide-item").removeClass("ui-slide-itemselected")}this.change.fire(a)},eb.prototype._selectSlide=function(a){this._nextNavigator.removeClass("ui-itemnavigationdisable"),this._previousNavigator.removeClass("ui-itemnavigationdisable");for(var b=0;b<this._slides.length;b++)b===a?(this._slides[b].show(),0===a?this._previousNavigator.addClass("ui-itemnavigationdisable"):a===this._slides.length-1&&this._nextNavigator.addClass("ui-itemnavigationdisable"),a=b):this._slides[b].hide();a<this._currentSlideIndex?(this._currentSlideIndex=a,this.slidechange.fire(0)):(this._currentSlideIndex=a,this.slidechange.fire(1))},eb.prototype._navigatorClick=function(a){for(var b=0;b<this._slides.length;b++)this._slides[b].hide();this._nextNavigator.removeClass("ui-itemnavigationdisable"),this._previousNavigator.removeClass("ui-itemnavigationdisable"),0===a?(this._currentSlideIndex--,this._currentSlideIndex>0?this._slides[this._currentSlideIndex].show():(this._slides[0].show(),this._currentSlideIndex=0,this._previousNavigator.addClass("ui-itemnavigationdisable")),this.slidechange.fire(0)):1===a&&(this._currentSlideIndex++,this._currentSlideIndex<this._slides.length?(this._slides[this._currentSlideIndex].show(),this._currentSlideIndex===this._slides.length-1&&this._nextNavigator.addClass("ui-itemnavigationdisable")):(this._slides[this._slides.length-1].show(),this._currentSlideIndex=this._slides.length-1,this._nextNavigator.addClass("ui-itemnavigationdisable")),this.slidechange.fire(1))},eb.bind=function(a){return new a(a)},j.Itemslider=eb;var fb=function(){this._groupHandlers={},this._groupItemHandlers={}};fb.prototype={_addHandler:function(a,b,c,d){var e;e="group"===d?this._groupHandlers:this._groupItemHandlers,(void 0===e[a]||void 0===e[a].sealed)&&(e[a]=b,c&&(e[a].sealed=!0))},_addGroupHandler:function(a,b,c){this._addHandler(a,b,c,"group")},_addGroupItemHandler:function(a,b,c){this._addHandler(a,b,c,"control")}};var gb=function(){var a=new fb;return{group:function(){return kc.extend({},a._groupHandlers)},groupItem:function(){return kc.extend({},a._groupItemHandlers)},addGroupHandler:function(b,c,d){a._addGroupHandler(b,c,d)},addGroupItemHandler:function(b,c,d){a._addGroupItemHandler(b,c,d)}}}(),hb=function(){this.id=void 0,this.parent=void 0,this.css=void 0},ib=function(a,b){this.id=a.id,this.parent=a.parent;var c=a.width,d=a.height,e=a.css||"";this.content=new j.Panel({id:this.id,parent:this.parent,css:"ui-layout-manager "+e,suppressHeader:!0}),c&&this.content._element.css("width",c),d&&this.content._element.css("height",d);var f=this;kc(window).resize(function(){f.content.resize.fire()}),this.containers={}};ib.prototype={_createGroupItem:function(a){var c=gb.groupItem(),d=a.type,e;return void 0!==d?e=c[d]:b.log("A Control group requires a type"),e},_createControlGroup:function(a){var b=gb.group(),c=a.type,d;return d=void 0!==c?b[c]:b["default"]}};var jb=function(a,b){Object.defineProperty(this,"_impl",{writeable:!1,enumerable:!1,configurable:!1,value:new ib(a,b)});var c=this;Object.defineProperty(this,"contentArea",{get:function(){return c._impl.content.contentArea},enumerable:!0,writeable:!1});var d=b;this.createControlGroup({id:this._impl.id+"-child",parent:this._impl.content,config:d}),this.updateDockPanels()};jb.prototype={createGroupItem:function(a){var b=this._impl._createGroupItem(a.config);b.create(a,this)},createControlGroup:function(a){var b=this._impl._createControlGroup(a.config);b.create(a,this)},setContainer:function(a,b){var c={control:b,configuration:a},d=a.type;a.id&&(c.id=a.id),this._impl.containers[d]=this._impl.containers[d]||[],this._impl.containers[d].push(c)},removeContainer:function(a){var b=a.type,c=a.id,d=this._impl.containers[b];if(d)if(void 0!==c){for(var e=0,f=d.length;f>e;e++)if(d[e].id===c){d.splice(e,1);break}}else delete this._impl.containers[b]},updateDockPanels:function(a){this._impl.content&&this._impl.content.resize.fire()},findContainers:function(a){a&&a.type||b.error("A valid critera/type is required");var c=[],d=this._impl.containers[a.type],e=a.id;if(d)for(var f=d.length,g=0;f>g;g++){var h=d[g];e?h.id===e&&c.push({id:h.id,control:h.control,configuration:h.configuration}):c.push({id:h.id,control:h.control,configuration:h.configuration})}return c}};var kb={Left:"left",Right:"right",Top:"top",Bottom:"bottom",Fill:"fill"},lb=function(){};lb.prototype.initialize=function(a,b){var c=a.config;c.separated=c.separated===!1?!1:!0;var d=c.separated===!1?"":"ui-horizontal-separator",e=a.id+"-"+(c.id||"groupitem"),f=e+"-parent",g=new j.Panel({id:f,parent:a.parent.contentArea,css:"ui-layoutmanager-group-item "+d,suppressHeader:!0});return a.parent.resize.bind(function(a){return function(){a.resize.fire()}}(g)),{id:e,parent:a.parent,config:c,content:g}},lb.extend=function(a){kc.extend(a,lb.prototype)};var mb=function(){lb.extend(this)};mb.prototype.create=function(a,b){var c=this.initialize(a,b),d=c.id;c.control=new j.Panel({id:d,parent:c.content.contentArea,css:"ui-parameter-group-item"}),c.content.resize.bind(function(a){return function(){a.resize.fire()}}(c.control)),b.setContainer(a.config,c.control)};var nb=function(){lb.extend(this)};nb.prototype.create=function(a,b){void 0===a.config.separated&&(a.config.separated=!1);var c=a.config;c.separated=c.separated===!1?!1:!0;var d=c.separated===!1?"":"ui-horizontal-separator",e=a.id+"-"+(c.id||"groupitem"),f=new j.Panel({id:e,parent:a.parent.contentArea,css:"ui-layoutmanager-group-item "+d,suppressHeader:!0});a.parent.resize.bind(function(a){return function(){a.resize.fire()}}(f));var g=a.config.group;b.createControlGroup({id:e+"-child",parent:f,config:g})};var ob=function(){lb.extend(this)};ob.prototype.create=function(a,b){void 0===a.config.separated&&(a.config.separated=!1);var c=a.config;c.separated=c.separated===!1?!1:!0;var d=c.separated===!1?"":"ui-horizontal-separator",e=a.id+"-"+(c.id||"label-groupitem"),f=new j.Panel({id:e,parent:a.parent.contentArea,css:"ui-layoutmanager-group-item ui-label-group-item "+d,suppressHeader:!0});a.parent.resize.bind(function(a){return function(){a.resize.fire()}}(f));var g=c.label.text,h;if(f.addClass("ui-label-group-item"),c.label.fontSize&&f.addClass("ui-label-fontsize-"+c.label.fontSize),c.label.styleClass&&""!==c.label.styleClass&&f.contentArea.addClass(c.label.styleClass),c.label.iconStyleClass&&""!==c.label.iconStyleClass){var i=new j.Panel({id:e+"-icon",parent:f.contentArea,css:"ui-label-icon-item "+c.label.iconStyleClass,suppressHeader:!0});""!==g&&(h=new j.Panel({id:e+"-text",parent:f.contentArea,css:"ui-label-text-item",suppressHeader:!0}),h.contentArea.text(g))}else f.contentArea.text(g);f.text=function(a){h?h.contentArea.text(a):f.contentArea.text(a)},b.setContainer(a.config,f)};var pb=function(){lb.extend(this)};pb.prototype.create=function(a,b){var c=this.initialize(a,b);c.content.addClass("ui-randomizer-group-item");var d=a.config.parameters,e=f.imageURL("randomize-button.png"),g={url:e,position:"left"},h=new j.Button({id:c.id,parent:c.content.contentArea,icon:g});b.setContainer(a.config,h)};var qb=function(){};qb.prototype.initialize=function(a,b){var c=a.config,d=a.id;c.id&&(d=d+"_"+c.id||"group-child");var e=new j.Panel({id:d,parent:a.parent.contentArea,suppressHeader:!0});return c.background&&kc(e._element).css({"background-image":"url("+c.background+")","background-size":"cover"}),a.parent.resize.bind(function(a){return function(){a.resize.fire()}}(e)),{id:d+"-child",parent:a.parent,config:c,content:e}},qb.extend=function(a){kc.extend(a,qb.prototype)};var rb=function(){qb.extend(this)};rb.prototype.create=function(a,b){var c=this.initialize(a,b),d=c.config;if(d.children){for(var e=d.children.length,f,g=0;e>g;g++){var h=d.children[g];h.dock&&(f=f||{},f[h.dock]=h.resizable===!0?{resizable:!0}:!0)}var i=function(a){return function(){a.update&&a.update(),a.resize.fire()}};c.control=f?new j.DockLayout({id:"layout-"+c.id,parent:c.content.contentArea,dock:f}):d.title?new j.Panel({id:"panel-"+c.id,parent:c.content.contentArea,title:d.title}):new j.Panel({id:"panel-"+c.id,parent:c.content.contentArea,suppressHeader:!0}),a.parent.resize.bind(i(c.control));for(var g=0;e>g;g++){var h=d.children[g],k;k=h.dock?c.control.content[h.dock]:c.control,b.createGroupItem({id:c.id+"-child"+g,parent:k,config:h})}}};var sb=function(){qb.extend(this)};sb.prototype.create=function(a,b){for(var c=this.initialize(a,b),d=c.config,e=d.children.length,f={},g=0;e>g;g++){var h=d.children[g],i="tab-"+c.id+"-"+g;f[i]={tabid:i,headerText:h.group.name,headerImageStyle:h.group.headerImageClass}}c.control=new j.Tab({id:"tabcontrol-"+c.id,parent:c.parent.contentArea,tabs:f});var k=function(a){return function(){a.update&&a.update(),a.resize.fire()}},l=c.control.tabPages;for(g=0;e>g;g++){var m=l[g],n=new j.Panel({id:c.id+"-panel"+g,parent:m,suppressHeader:!0});b.createGroupItem({id:d.children[g].id||c.id+"-child"+g,parent:n,config:d.children[g]}),a.parent.resize.bind(k(n)),c.control.change.bind(k(n))}c.control.selectedTabIndex=0,b.setContainer(a.config,c.control)};var tb=function(){qb.extend(this)};tb.prototype.create=function(a,b){for(var c=this.initialize(a,b),d=c.config,e=d.map.legend.length,f=[],g=0;e>g;g++){var h=d.map.legend[g],i="map-"+c.id+"-"+g,k={id:i,value:h.color,imagesrc:h.highlight,activesrc:h.active};if(0===g&&(k.selected=!0),f.push(k),h.group){var l=new j.Panel({id:i+"-popup",parent:b.contentArea,css:"ui-layoutmanager-popup",suppressHeader:!0});b.createControlGroup({id:i+"-container",parent:l,config:h.group})}}c.control=new j.ImageMap({id:"mapcontrol"+c.id,parent:c.content.contentArea,items:f,mainImage:d.map.image,mapImage:d.map.map}),b.setContainer(a.config,c.control)};var ub=function(){qb.extend(this)};ub.prototype.create=function(a,b){var c=this.initialize(a,b),d=c.config,e=d.flyout,f=c.content,g=e.text;f.addClass("ui-flyout-label-group-item"),e.fontSize&&e.addClass("ui-flyout-label-fontsize-"+e.fontSize),e.styleClass&&""!==e.styleClass&&f.contentArea.addClass(e.styleClass);var h=new j.Panel({id:e.id+"-arrow",parent:f.contentArea,css:"ui-flyout-arrow",suppressHeader:!0});
if(e.iconStyleClass&&""!==e.iconStyleClass){var i=new j.Panel({id:e.id+"-icon",parent:f.contentArea,css:"ui-flyout-icon-item "+e.iconStyleClass,suppressHeader:!0});if(""!==g){var k=new j.Panel({id:e.id+"-text",parent:f.contentArea,css:"ui-flyout-text-item",suppressHeader:!0});k.contentArea.text(g)}}else f.contentArea.text(g);var l=function(){var a=kc("body").find(".ui-popup"),b=a.not("[id$="+e.id+"]");b.hide()},m,n=function(){c.control?(m&&clearTimeout(m),c.control.onInitialize(),l()):(p(),c.control.onInitialize(),l())},o=function(){m=setTimeout(function(){c.control.hide()},500)};f.contentArea.hover(n,o);var p=function(){if(c.control=new j.Popup({id:"flyoutcontrol-"+e.id||c.id,position:e.position},f.contentArea),c.control.content.hover(n,o),e.children&&e.children.length)for(var a=new j.Panel({id:"flyoutcontrol-"+(e.id||c.id)+"-child",parent:c.control.content,css:"",suppressHeader:!0}),d=e.children.length,g=0;d>g;g++){var h=e.children[g];b.createGroupItem({id:(e.id||c.id)+"-child"+g,parent:a,config:h})}};p(),c.control.hide(),f.onHide=function(){c.control.hide()},b.setContainer(a.config,f)};var vb=function(){qb.extend(this)};vb.prototype.create=function(a,b){var c=this.initialize(a,b)};var wb=function(){lb.extend(this)};wb.prototype.create=function(a,b){var c=this.initialize(a,b),d=a.config,e=new y({id:"button-"+c.id,parent:c.content.contentArea,text:d.button.text,css:d.button.css});b.setContainer(a.config,e)};var xb=function(){gb.addGroupHandler("default",new rb,"true"),gb.addGroupHandler("tabs",new sb,"true"),gb.addGroupHandler("map",new tb,"true"),gb.addGroupHandler("choice",new vb,"true"),gb.addGroupHandler("flyout",new ub,"true"),gb.addGroupItemHandler("group",new nb,"true"),gb.addGroupItemHandler("parameter",new mb,"true"),gb.addGroupItemHandler("label",new ob,"true"),gb.addGroupItemHandler("randomizer",new pb,"true"),gb.addGroupItemHandler("button",new wb,"true")};j.LayoutManager=jb,j.IGroupHandler=qb,j.IGroupItemHandler=lb,j.LayoutHandlers=gb;var yb=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.libraryid=void 0,this.version=void 0,this.userid=void 0},zb=function(a){if(void 0!==a.libraryid&&(this._libraryid=a.libraryid,void 0!==a.version)){this._version=a.version,void 0!==a.userid&&(this._userid=a.userid),this._isEdit=!1,this._utility=l,Object.defineProperty(this,"libraryId",{get:function(){return this._libraryid},enumerable:!0}),Object.defineProperty(this,"version",{get:function(){return this._version},enumerable:!0}),Object.defineProperty(this,"userId",{get:function(){return this._userid},enumerable:!0});var b=this;kc.when(this._getFeedback()).then(function(){b._element=b._createControl(a),m.extend(b),b._element.attr("libraryid",b.libraryId),b.done.fire()},function(){}),this.done=new i.EventSource("done")}};zb.prototype._createControl=function(a){var c=a.id||"libraryfeedback",d=a.css||"",f={id:c,css:d,isUserId:this._userid?!0:!1,isEdit:this._isEdit},g={id:c+"rating",rating:this._ratingAll,max:5-this._ratingAll,reviewCount:this._reviewCount,readonly:!0};f.rating=g;var h={id:c+"feedback",isEdit:this._isEdit,rating:{id:c+"feedbackrating",max:5,readonly:!1},comment:{id:c+"feedbacktxtComment",text:""}};f.feedback=h,b.log(f);var i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.libraryfeedback(f)),i.find("#"+c)},zb.prototype.onInitialize=function(){var a=this,b=function(b){a._feedbackControlContainer.show(),a._feedbackControlLinkContainer.hide(),b.preventDefault()},c=function(){a._feedbackControlContainer.hide(),a._feedbackControlLinkContainer.show()},d=function(){kc.when(a._getFeedback()).then(function(){a._ratingControl.rating=a._ratingAll,a._ratingControl.reviewCount=a._reviewCount},function(){})};this._feedbackControlContainer=this._element.find("#feedbackControl"),this._feedbackControlLinkContainer=this._element.find("#feedbackControlLinks"),this._lnkGiveFeedback=this._element.find(".ui-libraryfeedback-col2 > a.ui-libraryfeedback-give").bind("click",b),this._lnkupdateFeedback=this._element.find(".ui-libraryfeedback-col2 > a.ui-libraryfeedback-update").bind("click",b),this._ratingControl=Xb.bind(this._element.find("#"+this.id+"rating")),this._ratingControl.reviewclick.bind(function(){var b=new Bb({libraryid:a._libraryid,version:a._version},a._ratingControl._reviewLink)}),this._feedbackControl=this._isEdit?L.bind(this._element.find("#"+this.id+"feedback"),{rating:this._ratingUser,comment:this._commentUser,isEdit:!0}):L.bind(this._element.find("#"+this.id+"feedback"),{rating:5,comment:"",isEdit:!1});var e=function(){d(),c(),a._lnkGiveFeedback.hide(),a._lnkupdateFeedback.show(),a._feedbackControl.isEdit=!0,a._isEdit||(a._isEdit=!0)};this._feedbackControl.submit.bind(function(){a._isEdit?kc.when(a._updateFeedback()).then(e,function(){}):kc.when(a._addFeedback()).then(e,function(){})}),this._feedbackControl.delete.bind(function(){kc.when(a._deleteFeedback()).then(function(){d(),c(),a._lnkGiveFeedback.show(),a._lnkupdateFeedback.hide(),a._feedbackControl.isEdit=!1,a._isEdit=!1,a._feedbackControl.comment="",a._feedbackControl.rating=5},function(){})})},zb.prototype._getFeedback=function(){var a=new kc.Deferred,b={url:"/libraries/"+this.libraryId+"/"+this.version+"/feedback",dataType:"json"},c=this;return kc.when(this._utility.ajax(b)).then(function(b){var d=b.length;if(d){for(var e=0,f=0;d>f;f++){var g=b[f];e+=Number(g.stars||0),g.user===c._userid&&(c._ratingUser=g.stars,c._commentUser=g.comment,c._isEdit=!0)}e=Math.round(e/d),c._ratingAll=e,c._reviewCount=d}else c._ratingAll=0,c._reviewCount=0;a.resolve()},function(){a.reject()}),a},zb.prototype._addFeedback=function(){var a={url:"/libraries/"+this.libraryId+"/"+this.version+"/feedback",type:"POST",dataType:"json",data:JSON.stringify({comment:this._feedbackControl.comment,stars:this._feedbackControl.rating})};return this._utility.ajax(a)},zb.prototype._updateFeedback=function(){var a={url:"/libraries/"+this.libraryId+"/"+this.version+"/feedback",type:"PUT",dataType:"json",data:JSON.stringify({comment:this._feedbackControl.comment,stars:this._feedbackControl.rating})};return this._utility.ajax(a)},zb.prototype._deleteFeedback=function(){var a={url:"/libraries/"+this.libraryId+"/"+this.version+"/feedback",type:"DELETE",dataType:"json"};return this._utility.ajax(a)},j.LibraryFeedback=zb;var Ab=function(){this.libraryid=void 0,this.version=void 0,this.position=void 0},Bb=function(a,b){void 0!==a.libraryid&&(this._libraryid=a.libraryid,void 0!==a.version&&(this._version=a.version,this._position=void 0!==a.position?a.position:Qb.TOP,this._popupControl=void 0,this._target=kc(b),this._utility=l,this._createControl(),m.extend(this)))};Bb.prototype._createControl=function(a){var b=kc("<div>"),d=this;this._getFeedback().done(function(a){b.append(e.templates.libraryfeedbackpopup(a));var f=new Sb({id:"feedback"+d._libraryid,content:b.html(),position:d._position},d._target);f.onHide=function(){this.remove()},d._popupControl=f,d._popupControl.content.find("#lnkshowall").click(function(){var a=c.getVariable(["urls","api"])+"/libraries/"+d._libraryid+"/"+d._version+"/feedback.html";window.open(a,"newwindow","location=yes,status=yes,menubar=yes,scrollbars=yes,resizable=yes")})})},Bb.prototype.onInitialize=function(){},Bb.prototype._getFeedback=function(){var a=new kc.Deferred,b={url:"/libraries/"+this._libraryid+"/"+this._version+"/feedback",dataType:"json"},c=this;return kc.when(this._utility.ajax(b)).then(function(b){var d=[],e=b.length;if(e){e>5&&(e=5);for(var f=window.location.protocol+"//"+window.location.host,g=0;e>g;g++){var h={};h.avtar=f+"/users/"+b[g].user+"/avatar/t40.jpg",h.rating={id:b[g].user+"rating",rating:b[g].stars,max:5-b[g].stars,readonly:!0,hideReviewCount:!0},h.username=b[g].userName,h.userprofilelink=f+"/users/"+b[g].user,h.feedback=b[g].comment,h.datetime=c._timeAgo(b[g].date),d.push(h)}}a.resolve(d)},function(){a.reject()}),a},Bb.prototype._timeAgo=function(a){var b=Math.round(Date.now()-new Date(a)),c=Math.round(b/1e3),d=Math.round(c/60),e=Math.round(d/60),f=Math.round(e/24),g=Math.round(f/365);return 45>c?"less than a minute ago":120>c?"about a minute ago":45>d?d+" minutes ago":120>d?"about an hour ago":24>e?"about "+e+" hours ago":48>e?"a day ago":30>f?f+" days ago":60>f?"about a month ago":365>f?Math.round(f/30)+" months ago":2>g?"about a year ago":g+" years ago"},j.LibraryFeedbackPopup=Bb;var Cb=function(){this.id=void 0,this.parent=void 0,this.title=void 0,this.collapsible=void 0,this.suppressHeader=void 0,this.css=void 0},Db=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this);var b=this._element.find(".ui-panel-content");b.size()||(b=this._element);var c=this._element.find(".ui-panel-header"),d=c.find(".ui-panel-header-title"),e=this._element.find(".ui-panel-icon"),f=c.find(".ui-panel-header-collapse-button"),g=[];f.click(function(){f.hasClass("ui-panel-header-collapse-button-collapsed")?f.removeClass("ui-panel-header-collapse-button-collapsed"):f.addClass("ui-panel-header-collapse-button-collapsed"),b.toggle()}),Object.defineProperty(this,"contentArea",{get:function(){return b},enumerable:!0}),Object.defineProperty(this,"title",{get:function(){return d.text()},set:function(a){d.text(a),a?c.css("display","block"):c.css("display","none")},enumerable:!0}),Object.defineProperty(this,"icon",{set:function(a){e[0].src=a.icon,a.text&&(e[0].title=a.text),e.addClass("ui-panel-icon-visible")},enumerable:!0}),this.resize=new i.EventSource("resize")};Db.prototype._createControl=function(a){var b=a.id||"panel",c=a.css||"",d={id:b,css:c,title:a.title,collapsible:a.collapsible,suppressheader:a.suppressHeader},f=kc("body");return f="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),f.append(e.templates.panel(d)),f.find("#"+b)},j.Panel=Db;var Eb=function(){this._parameterHandlers={}};Eb.prototype={_addParameterHandler:function(a,b,c){var d=this._parameterHandlers;(void 0===d[a]||void 0===d[a].sealed)&&(d[a]=b,c&&(d[a].sealed=!0))}};var Fb=function(){var a=new Eb;return{parameterHandlers:function(){return kc.extend({},a._parameterHandlers)},addParameterHandler:function(b,c,d){a._addParameterHandler(b,c,d)}}}(),Gb=function(){this.id=void 0,this.parent=void 0,this.title=void 0,this.collapsible=void 0,this.css=void 0},Hb=function(){var a=[];this._parameters={};var c=this;Object.defineProperty(this,"parameterHandlers",{get:function(){return a},enumerable:!0}),Object.defineProperty(this,"value",{get:function(){if(c._parameters){var a={};for(var b in c._parameters)a[b]=c._parameters[b].control.param();return a}},enumerable:!0}),Object.defineProperty(this,"layoutManager",{set:function(a){void 0===c._layoutmanager?c._layoutmanager=a:b.log("The layout can not be modified")},enumerable:!0}),this.change=new i.EventSource("change"),this.beginchange=new i.EventSource("beginchange"),this.endchange=new i.EventSource("endchange")};Hb.prototype.isEmpty=function(){return this._parameters?kc.isEmptyObject(this._parameters):!0},Hb.prototype.clear=function(){for(var a in this._parameters){var b=this._parameters[a].control;b.remove()}this._parameters={}},Hb.prototype.setControl=function(a,b){var c=this,d=function(a){return function(b){var d=c._parameters[a],e=d.control.param(),f={oldValue:d.definition.default,newValue:e,id:a};d.definition.validate&&(f.validate=!0),d.definition.default=e,c.change.fire(f,b)}};if(this._parameters[a.id]={control:b,definition:a},b.change.bind(d(a.id)),b.beginchange){var e=function(a){return function(b){var d=c._parameters[a],e={oldValue:d.definition.default,newValue:d.control.param(),id:a};d.validate&&(e.validate=!0),c.beginchange.fire(e,b)}};b.beginchange.bind(e(a.id))}if(b.endchange){var f=function(a){return function(b){var d=c._parameters[a],e={oldValue:d.definition.default,newValue:d.control.param(),id:a};d.validate&&(e.validate=!0),c.endchange.fire(e,b)}};b.endchange.bind(f(a.id))}},Hb.prototype.updateParams=function(a){for(var c=Fb.parameterHandlers(),d=this,e=function(a,b){if(a&&b){var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(var f in a)if("object"==typeof a[f]){if(!e(a[f],b[f]))return!1}else if(b[f]!=a[f])return!1;return!0}return!1},f=function(a){var e=d._layoutmanager.findContainers({type:"parameter",id:a.id})[0].control,f=a.type,g;if(void 0===f||void 0===c[f])return b.error("A Parameter definition requires a valid type"),void 0;g=c[f],a.libraryId&&void 0!==a.version&&e.addClass("l"+a.libraryId+a.version);var h={parent:e,definition:a};g.create(h,d),void 0!==a.visible&&(a.visible?(d._parameters[a.id].control.show(),e.show()):(d._parameters[a.id].control.hide(),e.hide()))},g=function(a){var b=d._parameters[a.id].control.param(),c=d._parameters[a.id].definition,g=kc.extend({},c);g.default=b;var h=kc.extend({},g,a);e(h,g)||(d._parameters[a.id].control.remove(),delete d._parameters[a.id],f(h))},h=function(a){},i=a.length,j=0;i>j;j++){var k=a[j];void 0!==k.invalid?h(k):void 0===this._parameters[k.id]?f(k):g(k)}};var Ib=function(){};Ib.prototype.initialize=function(a,c){var d=a.parent,e=a.definition;if(d||b.log("Container not set for Parameter - "+e.id),e.displayIcon){var f={icon:e.displayIcon};e.displayName&&(f.text=e.displayName),d.icon=f}else e.displayName&&(d.title=e.displayName)},Ib.extend=function(a){kc.extend(a,Ib.prototype)};var Jb=function(){Ib.extend(this)};Jb.prototype.create=function(a,b){this.initialize(a,b);var c=a.definition,d=a.parent.contentArea,e=[],f=c.listLabels,g=c.listValues,h=f.length;if(c.listImages||c.listClasses){for(var i=c.listImages,k=c.listClasses,l=0;h>l;l++)e.push({id:c.id+l,value:g[l],imagesrc:i?i[l]:void 0,cssclass:k?k[l]:void 0});var m="ui-item-40",n=c.pageSize||e.length,o=new j.Itemslider({id:c.id,parent:d,items:e,itemCss:"ui-parameter-panel-item-slider-item "+m,itemsPerSlide:n});void 0!==c.default&&(o.selectedValue=c.default),o.param=function(a){return function(){return a.selectedValue}}(o),b.setControl(c,o)}else{for(var l=0;h>l;l++)e.push({value:g[l],text:f[l]});var p=new j.Dropdown({id:c.id,parent:d,items:e});void 0!==c.default&&(p.selectedValue=c.default),p.param=function(a){return function(){return a.selectedValue}}(p),b.setControl(c,p)}};var Kb=function(){Ib.extend(this)};Kb.prototype.create=function(a,c){this.initialize(a,c);var d=a.definition,e=a.parent.contentArea;if(void 0!==d.rangeMin&&void 0!==d.rangeMax){var f,g=d.displayUnit,h=void 0===d.displayValue?!0:d.displayValue;("int"==d.type||"angle"==d.type)&&(f=1),"angle"==d.type?g=g||"°":"length"==d.type&&(g=g||"mm");var i=new j.Slider({id:d.id,parent:e,min:d.rangeMin,max:d.rangeMax,steps:d.steps||f,ticks:d.ticks,showText:h,showInput:!0,displayUnit:g});void 0!==d.default&&(i.value=d.default),i.param=function(a){return function(){return a.value}}(i),c.setControl(d,i)}else b.error("RangeParameterHandler: rangeMin and rangeMax needs to be defined")};var Lb=function(){Ib.extend(this)};Lb.prototype.create=function(a,b){this.initialize(a,b),a.parent.title="";var c=a.definition,d=a.parent.contentArea,e=new j.Checkbox({id:c.id,parent:d,checked:c.default,text:c.displayName,labelPosition:j.CheckboxLabelPosition.Right});void 0!==c.default&&(e.checked=c.default),e.param=function(a){return function(){return a.checked}}(e),b.setControl(c,e)};var Mb=function(){Ib.extend(this)};Mb.prototype.create=function(a,b){this.initialize(a,b);var c=a.definition,d=a.parent.contentArea,e=!0;c.singleLine===!0&&(e=!1);var f,g={id:c.id,parent:d,text:c.default};c.maxLength&&(g.maxLength=c.maxLength),f=e?new j.Textarea(g):new j.Textbox(g),f.param=function(a){return function(){return a.text}}(f),b.setControl(c,f)};var Nb=function(){Ib.extend(this)};Nb.prototype.create=function(a,b){this.initialize(a,b);var c=a.definition,d=a.parent.contentArea;d.text(c.description)};var Ob=function(){Ib.extend(this)};Ob.prototype.create=function(a,b){this.initialize(a,b);var c=a.definition,d=a.parent.contentArea,e=.9*d.outerWidth(),f=new j.Sketch2D({id:c.id,parent:d,width:e,height:e,css:"sketchControl"});c.default&&(f.value=new i.Sketch2D(c.default)),f.param=function(a){return function(){return a.value.clone()}}(f),a.parent.resize.bind(function(a,b){return function(){var c=.9*a.outerWidth();b.resize(c)}}(d,f)),b.setControl(c,f)};var Pb=function(){var a=new Kb;Fb.addParameterHandler("angle",a),Fb.addParameterHandler("float",a),Fb.addParameterHandler("int",a),Fb.addParameterHandler("length",a),Fb.addParameterHandler("list",new Jb),Fb.addParameterHandler("bool",new Lb),Fb.addParameterHandler("sketch",new Ob),Fb.addParameterHandler("string",new Mb),Fb.addParameterHandler("label",new Nb)};j.ParameterManager=Hb,j.IParameterHandler=Ib,j.ParameterHandlers=Fb;var Qb={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3},Rb=function(){this.id=void 0,this.content=void 0,this.css=void 0,this.position=void 0},Sb=function(a,b){this._element=this._createControl(a),this._position=a.position||Qb.TOP,this._target=kc(b),m.extend(this),Object.defineProperty(this,"content",{get:function(){return this._element},enumerable:!0})};Sb.prototype._createControl=function(a){var b=a.id||"popupControl",c=a.content||"",d=a.css||"";d=d+" ui-popup-shadow-"+(a.position||Qb.TOP);var f="ui-popup-corner-"+(a.position||Qb.TOP),g={id:b,content:c,css:d,cornercss:f},h=kc("body");return h.append(e.templates.popup(g)),h.find("#"+b)},Sb.prototype.onInitialize=function(){var a=kc(this._target).offset(),b={};switch(this._position){case Qb.TOP:b={top:a.top-this._element.height()-10,left:a.left+this._target.width()/2-this._element.width()/2};break;case Qb.BOTTOM:b={top:a.top+this._target.height()+10,left:a.left+this._target.width()/2-this._element.width()/2};break;case Qb.LEFT:b={top:a.top-this._element.height()/2,left:a.left-this._element.width()-10};break;case Qb.RIGHT:b={top:a.top-this._element.height()/2,left:a.left+this._target.width()+10}}this._element.css(b),this.show()},Sb.prototype.onShow=function(){var a=this;kc(document).bind("mouseup.popupclick",function(b){a._element.is(b.target)||0!==a._element.has(b.target).length||a.hide()})},Sb.prototype.onHide=function(){kc(document).unbind("mouseup.popupclick")},j.Popup=Sb,j.PopupPositionEnum=Qb;var Tb={Infinite:0,Finite:1},Ub=function(){this._element=null,this._description=null,this._title=null,this._bar=null,this._infinitedialog=null,this._finitedialog=null,this._refCount=0,this._isFiniteProgress=!1,Object.defineProperty(this,"percent",{set:function(a){this._bar.css("width",a+"%")},enumerable:!0}),Object.defineProperty(this,"title",{get:function(){return this._title.text()},set:function(a){this._title.text(a)},enumerable:!0}),Object.defineProperty(this,"description",{get:function(){return this._descripton.text()},set:function(a){this._descripton.text(a)},enumerable:!0}),m.call(this),this.initialize()};Ub.prototype=Object.create(m.prototype,{constructor:{value:Vb}}),Ub.prototype.onInitialize=function(){var a={};a.id="progressdlg",a.progressTitle="",a.progressDesc="";var b=e.templates.progressbar(a);this._parent=kc("body");var c=kc(b).prependTo(this._parent);this._element=kc("#progressdlg"),this._infinitedialog=kc(this._element).find("#infinite"),this._finitedialog=kc(this._element).find("#finite"),this._title=kc(this._element).find(".ui-progressdialog-title"),this._descripton=kc(this._element).find(".ui-progressdialog-desc"),this._bar=kc(this._element).find(".ui-progressbar-fill"),this.hide()},Ub.prototype._changeDialogType=function(a){a==Tb.Finite?(this._element.addClass("ui-progressdialog-finite").removeClass("ui-progressdialog-infinite"),this._infinitedialog.hide(),this._finitedialog.show()):(this._element.addClass("ui-progressdialog-infinite").removeClass("ui-progressdialog-finite"),this._infinitedialog.show(),this._finitedialog.hide())},Ub.prototype.show=function(a){1==++this._refCount&&(a.blockUI?(this._blockid||(this._blockid=w.create(this._element,a.priority)),this._blockid.blockDialog(),kc(this._element).show()):kc(this._element).show(),this.title=a.title?a.title:"Please wait",this.description=a.description?a.description:"",a.percent?(this.percent=a.percent,this._changeDialogType(Tb.Finite)):this._changeDialogType(Tb.Infinite)),this.onShow()},Ub.prototype.hide=function(){--this._refCount<=0&&(kc(this._element).hide(),this._refCount=0,this._blockid&&(this._blockid.unblock(),delete this._blockid)),this.onHide()},Ub.prototype.setParent=function(a){if(a=kc(a),this._parent!=a){var b=kc(this._element).detach();b.appendTo(a),this._parent=a}};var Vb=function(){var a;return{instance:function(){return a||(a=new Ub),a}}}();j.Progressbar=Vb;var Wb=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.rating=void 0,this.max=void 0,this.reviewCount=void 0,this.readonly=void 0},Xb=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._rating=0,a.rating&&(this._rating=a.rating),this._reviewCount=0,a.reviewCount&&(this._reviewCount=a.reviewCount),this._readonly=!0,void 0!==a.readonly&&(this._readonly=a.readonly),m.extend(this),Object.defineProperty(this,"rating",{get:function(){return parseInt(this._rating)},set:function(a){this._rating=a,this._updateRatingUI()},enumerable:!0}),Object.defineProperty(this,"reviewCount",{get:function(){return this._reviewCount},set:function(a){this._reviewCount=a,this._updateReviewUI()},enumerable:!0}),Object.defineProperty(this,"readonly",{get:function(){return this._readonly},enumerable:!0}),this.change=new i.EventSource("change"),this._bindEvent("change"),this.reviewclick=new i.EventSource("reviewclick")};Xb.prototype._createControl=function(a){var b=a.id||"rating",c=a.css||"",d=a.readonly||!1,f,g,h;d?(f=a.rating||0,g=(a.max||5)-f,h=a.reviewCount||0):(g=a.max||5,f=a.rating||5);var i={id:b,css:c,rating:f,max:g,reviewCount:h,readonly:d},j=kc("body");return j="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),j.append(e.templates.rating(i)),j.find("#"+b)},Xb.prototype.onInitialize=function(){this._reviewLink=this._element.find(".rating-count > a"),this._bindRadioEvents()},Xb.prototype._bindRadioEvents=function(){var a=this;this._readonly||(this._element.find(":radio[value="+this._rating+"]").attr("checked","checked"),this._element.find('input[type="radio"]').bind("change",function(){a._rating=kc(this).val(),a.change.fire()})),this._reviewLink.bind("click",function(b){a.reviewclick.fire(),b.preventDefault(),b.stopPropagation()})},Xb.prototype._updateRatingUI=function(){if(this._readonly){var a=this,b=this._element.find(".rating-stars-marked, .rating-stars-unmarked");b.removeClass("rating-stars-marked").removeClass("rating-stars-unmarked").each(function(b,c){b<a._rating?kc(c).addClass("rating-stars-marked"):kc(c).addClass("rating-stars-unmarked")})}else this._element.find(":radio[value="+this._rating+"]").attr("checked","checked")},Xb.prototype._updateReviewUI=function(){this._reviewLink.text("("+this._reviewCount+(this._reviewCount<=1?" Review)":" Reviews)"))},Xb.prototype.onEnable=function(){this._element.find(":radio").removeAttr("disabled")},Xb.prototype.onDisable=function(){this._element.find(":radio").attr("disabled","disabled")},Xb.bind=function(a,b){var c=new Xb(a);return b&&void 0!==b.rating&&(c._rating=b.rating,c._updateRatingUI()),b&&void 0!==b.readonly&&(c._readonly=b.readonly,c._bindRadioEvents()),b&&void 0!==b.reviewCount&&(c._reviewCount=b.ratingCount),c},j.Rating=Xb;var Yb={North:"n",South:"s",East:"e",West:"w",NorthWest:"nw",NorthEast:"ne",SouthEast:"se",SouthWest:"sw"},Zb=function(){this.control=void 0,this.grips=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this.minWidth=void 0,this.minHeight=void 0},$b=function(a){this._element="string"==typeof a.control?kc("#"+a.control):kc(a.control),m.extend(this),this._animate=!1,void 0!=a.animate&&(this._animate=a.animate),this._grips=[Yb.South,Yb.East,Yb.SouthEast],a.grips&&(this._grips=a.grips),this._maxHeight=null,a.maxHeight&&(this._maxHeight=a.maxHeight),Object.defineProperty(this,"maxHeight",{get:function(){return this._maxHeight},set:function(a){this._maxHeight=a},enumerable:!0}),this._minHeight=10,a.minHeight&&(this._minHeight=a.minHeight),Object.defineProperty(this,"minHeight",{get:function(){return this._minHeight},set:function(a){this._minHeight=a},enumerable:!0}),this._maxWidth=null,a.maxWidth&&(this._maxWidth=a.maxWidth),Object.defineProperty(this,"maxWidth",{get:function(){return this._maxWidth},set:function(a){this._maxWidth=a},enumerable:!0}),this._minWidth=10,a.minWidth&&(this._minWidth=a.minWidth),Object.defineProperty(this,"minWidth",{get:function(){return this._minWidth},set:function(a){this._minWidth=a},enumerable:!0}),this._zIndex=10,a.zIndex&&(this._zIndex=a.zIndex),Object.defineProperty(this,"zIndex",{get:function(){return this._zIndex},set:function(a){this._zIndex=a},enumerable:!0}),this._resizing=!1,this._activeGrip=null,this._change={e:function(a,b){return{width:this._dragStartSize.width+b}},w:function(a,b){var c=this._dragStartSize,d=this._dragStartPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this._dragStartSize,e=this._dragStartPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this._dragStartSize.height+c}},se:function(a,b,c){return kc.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[a,b,c]))},sw:function(a,b,c){return kc.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[a,b,c]))},ne:function(a,b,c){return kc.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[a,b,c]))},nw:function(a,b,c){return kc.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[a,b,c]))}},this.resize=new i.EventSource("resize"),this.beginresize=new i.EventSource("beginresize"),this.endresize=new i.EventSource("endresize"),this._initialize()};$b.prototype._initialize=function(){this._element.addClass("ui-resizable"),this._addGrips(),this._bindEvents()},$b.prototype._addGrips=function(){for(var a=this._grips.length-1;a>=0;a--)this._element.append(kc('<div style="z-index:'+this._zIndex+'" />').addClass("ui-resizable-"+this._grips[a]+" grip").data("grip",this._grips[a]))},$b.prototype._bindEvents=function(){var a=this;this.mouseup.bind(function(b){a._stop()});var b=function(a){return parseInt(a,10)||0};this.mousedown.bind(function(c){var d=c._originalEvent;if(kc(d.target).hasClass("grip")){kc(document).bind("mousemove.resizableEvent",function(b){a._resizing&&(a._resize(b),a.resize.fire(),b.preventDefault())}).bind("keyup.resizableEvent",function(b){27===b.keyCode&&a._stop()}).bind("mouseup.resizableEvent",function(b){a._stop()}),a._resizing=!0,a._activeGrip=kc(d.target).data("grip"),a._dragStartSize={width:a._element.width(),height:a._element.height()};var e=/relative/.test(a._element.css("position"))?b(a._element.css("top")):a._element.offset().top,f=/relative/.test(a._element.css("position"))?b(a._element.css("left")):a._element.offset().left;a._dragStartPosition={left:f,top:e},a._dragStartMousePosition={x:d.pageX,y:d.pageY},a._resize(d),d.preventDefault(),a.beginresize.fire()}})},$b.prototype._stop=function(){this._resizing&&(this._resizing=!1,this._activeGrip=null,kc(document).unbind("keyup.resizableEvent").unbind("mousemove.resizableEvent").unbind("mouseup.resizableEvent"),this.endresize.fire())},$b.prototype._correctSize=function(a){var b=l;if(b.isNumber(this._minWidth)||b.isNumber(this._maxWidth)){var c=b.isNumber(a.width)&&this._maxWidth&&a.width>=this._maxWidth,d=b.isNumber(a.width)&&this._minWidth&&a.width<=this._minWidth,e=this._dragStartPosition.left+this._dragStartSize.width,f=/sw|nw|w/.test(this._activeGrip);d&&(a.width=this._minWidth),c&&(a.width=this._maxWidth),d&&f&&(a.left=e-this._minWidth),c&&f&&(a.left=e-this._maxWidth)}if(b.isNumber(this._minHeight)||b.isNumber(this._maxHeight)){var g=b.isNumber(a.height)&&this._maxHeight&&a.height>=this._maxHeight,h=b.isNumber(a.height)&&this._minHeight&&a.height<=this._minHeight,i=this._dragStartPosition.top+this._dragStartSize.height,j=/nw|ne|n/.test(this._activeGrip);h&&(a.height=this._minHeight),g&&(a.height=this._maxHeight),h&&j&&(a.top=i-this._minHeight),g&&j&&(a.top=i-this._maxHeight)}return a},$b.prototype._resize=function(a){var b=this._dragStartMousePosition,c=a.pageX-b.x||0,d=a.pageY-b.y||0;this._element.css(this._correctSize(this._change[this._activeGrip].apply(this,[a,c,d])))},$b.bind=function(a){return new $b(a)},j.Resizable=$b,j.ResizeGripEnum=Yb;var _b=function(){this.id=void 0,this.parent=void 0,this.showText=void 0,this.displayUnit=void 0,this.min=void 0,this.max=void 0,this.steps=void 0,this.ticks=void 0,this.showInput=void 0,this.orientation=void 0},ac=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this),this.beginchange=new i.EventSource("beginchange"),this.change=new i.EventSource("change"),this.endchange=new i.EventSource("endchange");var b=kc(this._element).find(".ui-slider-handle"),c=kc(this._element).find(".ui-slider-icon"),d=kc(this._element).find(".ui-slider-area"),e=kc(this._element).find(".ui-slider-background"),f=kc(this._element).find(".ui-slider-text"),g=kc(this._element).find(".ui-slider-input"),h=a.min||0,k=a.max||1,l=k-h,n=a.steps,o,p=a.ticks,q=a.showText,r=a.displayUnit?!0:!1,s=a.displayUnit||"mm";this.isVertical="vertical"===a.orientation?!0:!1;var t=this;this._value=h;var u=function(){t._inputTextbox.hide(),f.show()},v=function(a){if(13===a.originalEvent.keyCode||27===a.originalEvent.keyCode){var b=A(t._inputTextbox.text);I(D(b)),u()}};g.size()&&(this._inputTextbox=j.Textbox.bind(g),t._inputTextbox.keydown.bind(v),t._inputTextbox.focusout.bind(u)),f.bind("click",function(){t._inputTextbox&&(G(t._value),f.hide(),t._inputTextbox.show(),t._inputTextbox.select(),t._inputTextbox.focus())}),Object.defineProperty(this,"value",{get:function(){return Number(t._value.toFixed(12))},set:function(a){C(),I(D(a)),setTimeout(function(){B()},500)},enumerable:!0});var w,x,y;if(void 0!==n)if(n instanceof Array)o=n,o.indexOf(h)<0&&o.unshift(h),o.indexOf(k)<0&&o.push(k);else{o=[h];var z=h;do z+=n,o.push(z);while(k>z)}var A=function(a){switch(s){case"ft":a=304.8*a;break;case"in":a=25.4*a;break;case"m":a=1e3*a;break;case"cm":a=10*a}return a},B=function(){C();var a="left 0.5s ease-in-out",c="width 0.5s ease-in-out";t.isVertical&&(a="top 0.5s ease-in-out",c="height 0.5s ease-in-out"),b.css({transition:a,"-webkit-transition":a,"-moz-transition":a,"-o-transition":a}),e.css({transition:c,"-webkit-transition":c,"-moz-transition":c,"-o-transition":c})},C=function(){b.css({transition:"","-webkit-transition":"","-moz-transition":"","-o-transition":""}),e.css({transition:"","-webkit-transition":"","-moz-transition":"","-o-transition":""})},D=function(a){var b=d.width();return t.isVertical?(b=d.height(),b=b>0?b:10,(k+h-a-h)*b/l):(b=b>0?b:10,(a-h)*b/l)},E=function(a){var b=d.width();return t.isVertical&&(b=d.height()),b=b>0?b:10,100*(a/b)},F=function(a){if(!o||0===o.length)return a;for(var b=o.length,c,d,e=0;b>e;e++){var f=o[e],g=Math.abs(f-a);(void 0===d||d>=g)&&(d=g,c=f)}return c},G=function(a){if(q){switch(s){case"ft":a/=304.8;break;case"in":a/=25.4;break;case"m":a/=1e3;break;case"cm":a/=10}var b=Number(a.toFixed(2)),c;c=r?b+" "+s:b,f.text(c),t._inputTextbox&&(t._inputTextbox.text=b)}},H=function(){for(var a=p.length,b=0,c=0;a>c;c++){var e=E(D(p[c])),f=e-b,g;g=t.isVertical?kc('<div class="ui-slider-step" />').css({top:e+"%"}):kc('<div class="ui-slider-step" />').css({width:f+"%",left:b+"%"}),d.append(g),b+=f}};p&&H();var I=function(a){var c=d.width();t.isVertical&&(c=d.height()),c=c>0?c:10,0>a&&(a=0),a>c&&(a=c);var f,g,i;t.isVertical?(f=k+h-(h+a/c*l),i=F(f),t._value=i,g=E(D(i)),b.css("top",g+"%"),e.css("height",100-g+"%")):(f=h+a/c*l,i=F(f),t._value=i,g=E(D(i)),b.css("left",g+"%"),e.css("width",g+"%")),G(i)},J=function(a){if(y===!0){C(),a.preventDefault();var b;b=t.isVertical?a.clientY-x:a.clientX-x,I(b),t.change.fire()}},K=function(a){y===!0&&(y=!1,a.preventDefault(),document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",K),t.endchange.fire(),B())};b[0].addEventListener("mousedown",function(a){a=a||window.event;var c;t.isVertical?(c=b.outerHeight(!0)-b.outerHeight(!1),x=a.clientY-this.offsetTop+c):(c=b.outerWidth(!0)-b.outerWidth(!1),x=a.clientX-this.offsetLeft+c),y=!0,document.addEventListener("mousemove",J),document.addEventListener("mouseup",K),t.beginchange.fire()
}),d[0].addEventListener("click",function(a){var d;t.isVertical?(d=void 0===a.offsetY?a.layerY:a.offsetY,(kc(a.target).hasClass("ui-slider-step")||kc(a.target).hasClass("ui-slider-background"))&&(d+=kc(a.target).position().top)):(d=void 0===a.offsetX?a.layerX:a.offsetX,kc(a.target).hasClass("ui-slider-step")&&(d+=kc(a.target).position().left)),a.target!==b[0]&&a.target!==c[0]&&(t.beginchange.fire(),I(d))}),B(),b.bind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){t.change.fire(),t.endchange.fire()})};ac.prototype._createControl=function(a){var b=a.orientation||"horizontal",c=a.id||"slider",d=a.css||"",f=a.showText,g=a.showInput,h={id:c,showtext:f,css:d+" "+"ui-"+b+"-slider"};g&&(h.input={id:c+"-input",css:"ui-slider-input"});var i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.slider(h)),i.find("#"+c)};var bc={Horizontal:"horizontal",Vertical:"vertical"};j.Slider=ac,j.SliderOrientationEnum=bc;var cc=function(){this.id=void 0,this.parent=void 0,this.tabHeader=void 0,this.css=void 0,this.tabs=void 0},dc=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),this._selectedTab=void 0,this._tabHeaders=[],this._tabPages=[],Object.defineProperty(this,"selectedTabIndex",{get:function(){return kc(this._selectedTab).index()},set:function(a){a>=0&&this._selectTab(a)},enumerable:!0}),Object.defineProperty(this,"selectedTabId",{get:function(){return kc(this._selectedTab).attr("Tab")},set:function(a){if(a=kc.trim(a),""!=a)for(var b=this._tabHeaders.length,c=0;b>c;c++)if(kc(this._tabHeaders[c]).attr("Tab")===a){this._selectTab(kc(this._tabHeaders[c]).index());break}},enumerable:!0}),Object.defineProperty(this,"selectedTabContent",{get:function(){return this._element.find("#"+kc(this._selectedTab).attr("id"))[0]},enumerable:!0}),Object.defineProperty(this,"tabPages",{get:function(){return this._tabPages},enumerable:!0}),Object.defineProperty(this,"tabHeaders",{get:function(){return this._tabHeaders},enumerable:!0}),this.change=new i.EventSource("change"),m.extend(this)};dc.prototype._createControl=function(a){var b=a.id||"tab",c=a.tabHeader||"",d="",f="",g="";a.css&&("string"==typeof a.css?d=a.css:(d=a.css.tabCss?a.css.tabCss:"",f=a.css.headerCss?a.css.headerCss:"",g=a.css.contentCss?a.css.contentCss:""));var h=a.tabs||[];kc.each(h,function(){this.headerCss=f,this.contentCss=g});var i={id:b,tabs:h,css:d};""!==c&&(i.tabHeader=c);var j=kc("body");return j="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),j.append(e.templates.tab(i)),j.find("#"+b)},dc.prototype.onInitialize=function(){var a=this;this._tabHeaderArea=kc(this._element).find("> .ui-tabheadercontainer"),this._tabContentArea=kc(this._element).find("> .ui-tabcontainer"),this._tabHeaders=kc(this._tabHeaderArea).find(".ui-tabbutton");for(var b=this._tabHeaders.length,c=0;b>c;c++){var d=this._tabHeaders[c];kc(d).css("width",100/b+"%");var e=kc(d).attr("Tab");kc(d).attr("Selected")&&(this._selectedTab=kc(d)),this._tabPages.push(kc(this._element).find("#"+e)[0]),kc(d).bind("click",function(){a._selectTab(kc(this).index())})}},dc.prototype._selectTab=function(a){for(var b=this._tabPages.length,c=0;b>c;c++)c===a?(kc(this._tabPages[c]).show().addClass("ui-tabcontentborder"),""!==kc.trim(kc(this._tabPages[c]).html())?kc(this._tabPages[c]).addClass("ui-tabcontentborder"):kc(this._tabPages[c]).removeClass("ui-tabcontentborder"),this._selectedTab=kc(this._tabHeaders[c]).addClass("ui-tabbuttonselected"),this.change.fire()):(kc(this._tabPages[c]).removeClass("ui-tabcontentborder").hide(),kc(this._tabHeaders[c]).removeClass("ui-tabbuttonselected"))},dc.bind=function(a){return new dc(a)},j.Tab=dc;var ec=function(){this.id=void 0,this.parent=void 0,this.css=void 0,this.tags=void 0,this.initialTags=void 0},fc=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),a.tags&&(this._tags=a.tags),a.initialTags&&(this._initialTags=a.initialTags),this._backspaceCount=0,Object.defineProperty(this,"tags",{get:function(){return this._element.find("li.ui-tagitem").map(function(){return kc(this).attr("val")+""}).get()},enumerable:!0}),Object.defineProperty(this,"length",{get:function(){return this._element.find("li.ui-tagitem").size()},enumerable:!0}),m.extend(this),this.change=new i.EventSource("change",this)};fc.prototype._createControl=function(a){var b=a.id||"taglist",c=a.css||"",d=a.tags||null,f={id:b,css:c,tags:d},g=kc("body");return g="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),g.append(e.templates.taglist(f)),g.find("#"+b)},fc.prototype.addTags=function(a){if(a){if(a instanceof Array)for(var b=a.length,c=0;b>c;c++){var d;d=a[c].text&&a[c].value?this._getItem(a[c].text,a[c].value):this._getItem(a[c]),this._lastLi.before(d)}else this._lastLi.before(this._getItem(a));this._bindEvents()}},fc.prototype.tagText=function(a){var b="";return this._element.find("li.ui-tagitem").each(function(c,d){if(a===kc(d).index()){var e=kc.trim(kc(d).text());return b=e.substr(0,e.length-1),void 0}}),b},fc.prototype.tagValue=function(a){var b="";return this._element.find("li.ui-tagitem").each(function(c,d){a===kc(d).index()&&(b=kc.trim(kc(d).attr("val")))}),b},fc.prototype.tagIndex=function(a){var b=-1;return this._element.find("li.ui-tagitem").each(function(c,d){kc.trim(a)===kc(d).attr("val")&&(b=kc(d).index())}),b},fc.prototype.removeByIndex=function(a){this._element.find("li.ui-tagitem").each(function(b,c){a===b&&kc(c).remove()})},fc.prototype.removeByValue=function(a){this._element.find("li.ui-tagitem").each(function(b,c){a===kc(c).attr("val")&&kc(c).remove()})},fc.prototype._getItem=function(a,b){return a=kc.trim(a),b=b?kc.trim(b):a,kc('<li val="'+b+'" class="ui-tagitem">'+a+'<a class="ui-tagitem-close">x</a></li>')},fc.prototype._bindEvents=function(){var a=this;this._deleteCtrls=this._element.find(".ui-tagitem-close"),this._deleteCtrls.click(function(b){var c=kc(this).parent();c.parent().length&&(c.remove(),a.change.fire({removed:[c.attr("val")]}))})},fc.prototype.onInitialize=function(){this._txtNewTag=this._element.find(".ui-tag-input"),this._lastLi=this._element.find(".ui-tag-new");var a=this;this._element.click(function(b){a._txtNewTag.focus()}),this._txtNewTag.keyup(function(b){if(13==b.which){var c=kc.trim(a._txtNewTag.val());0==a.length&&a._initialTags&&a.addTags(a._initialTags),-1==a.tagIndex(c)&&a.addTags(c),a._txtNewTag.val(""),a.change.fire({added:[c]})}else if(8==b.which){if(""===a._txtNewTag.val()&&a.length>0)if(a._backspaceCount++,1===a._backspaceCount)a._element.find("li.ui-tagitem").removeClass("selected"),a._lastLi.prev().addClass("selected");else if(2===a._backspaceCount){var c=a._lastLi.prev().attr("val");a._lastLi.prev().remove(),a.change.fire({removed:[c]}),a._backspaceCount=0}}else a._element.find("li.ui-tagitem").removeClass("selected"),a._backspaceCount=0}).keydown(function(a){13==a.which&&a.preventDefault()}),this._bindEvents()},fc.bind=function(a){return new fc(a)},j.TagList=fc;var gc=function(){this.id=void 0,this.parent=void 0,this.text=void 0,this.css=void 0,this.placeholderText=void 0,this.maxLength=void 0},hc=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this),this._isValid=!0,this._changeTimeoutDelay=300,Object.defineProperty(this,"isValid",{get:function(){return this._isValid},set:function(a){a?kc(this._element).removeClass("ui-textarea-inputerror"):kc(this._element).addClass("ui-textarea-inputerror"),this._isValid=a},enumerable:!0}),Object.defineProperty(this,"text",{get:function(){return kc(this._element).val()},set:function(a){kc(this._element).val(a)},enumerable:!0}),Object.defineProperty(this,"maxLength",{get:function(){var a=parseInt(kc(this._element).attr("maxlength"));return 0/0!==a?a:void 0},set:function(a){a&&kc(this._element).attr("maxlength",a)},enumerable:!0}),this.beginchange=new i.EventSource("beginchange"),this.change=new i.EventSource("change"),this.endchange=new i.EventSource("endchange")};hc.prototype._createControl=function(a){var b=a.id||"textarea",c=a.text||"",d=a.css||"",f=a.placeholderText||"",g=a.maxLength||0,h={id:b,text:c,css:d,placeholder:f};g&&(h.maxlength=g);var i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.textarea(h)),i.find("#"+b)},hc.prototype.onInitialize=function(){var a=this;a._lastValue="",kc(this._element).bind("input",function(b){a._changeTimeoutID&&clearTimeout(a._changeTimeoutID),a._changeTimeoutFunc=function(){a._lastValue=a.text,a._changeTimeoutID=null,a.change.fire(null,b)},a._changeTimeoutID=setTimeout(a._changeTimeoutFunc,a._changeTimeoutDelay)}).focus(function(b){a.beginchange.fire(null,b)}).blur(function(b){a._changeTimeoutID&&clearTimeout(a._changeTimeoutID),a.endchange.fire(null,b)}).change(function(b){a._lastValue!==a.text&&a.change.fire(null,b)})},hc.bind=function(a){return new hc(a)},j.Textarea=hc;var ic=function(){this.id=void 0,this.parent=void 0,this.text=void 0,this.css=void 0,this.placeholderText=void 0,this.maxLength=void 0},jc=function(a){this._element=a instanceof HTMLElement||a.jquery?kc(a):this._createControl(a),m.extend(this),this._isValid=!0,this._changeTimeoutDelay=300,Object.defineProperty(this,"isValid",{get:function(){return this._isValid},set:function(a){a?kc(this._element).removeClass("ui-textbox-inputerror"):kc(this._element).addClass("ui-textbox-inputerror"),this._isValid=a},enumerable:!0}),Object.defineProperty(this,"text",{get:function(){return kc(this._element).val()},set:function(a){kc(this._element).val(a)},enumerable:!0}),Object.defineProperty(this,"maxLength",{get:function(){var a=parseInt(kc(this._element).attr("maxlength"));return 0/0!==a?a:void 0},set:function(a){a&&kc(this._element).attr("maxlength",a)},enumerable:!0}),this.beginchange=new i.EventSource("beginchange"),this.change=new i.EventSource("change"),this.endchange=new i.EventSource("endchange")};jc.prototype._createControl=function(a){var b=a.id||"textbox",c=a.text||"",d=a.css||"",f=a.placeholderText||"",g=a.maxLength||0,h={id:b,text:c,css:d,placeholder:f};g&&(h.maxlength=g);var i=kc("body");return i="string"==typeof a.parent?kc("#"+a.parent):kc(a.parent),i.append(e.templates.textbox(h)),i.find("#"+b)},jc.prototype.onInitialize=function(){var a=this;a._lastValue="",kc(this._element).bind("input",function(b){a._changeTimeoutID&&clearTimeout(a._changeTimeoutID),a._changeTimeoutFunc=function(){a._lastValue=a.text,a._changeTimeoutID=null,a.change.fire(null,b)},a._changeTimeoutID=setTimeout(a._changeTimeoutFunc,a._changeTimeoutDelay)}).focus(function(b){a.beginchange.fire(null,b)}).blur(function(b){a._changeTimeoutID&&clearTimeout(a._changeTimeoutID),a.endchange.fire(null,b)}).change(function(b){a._lastValue!==a.text&&a.change.fire(null,b)})},jc.prototype.select=function(){kc(this._element).select()},jc.bind=function(a){return new jc(a)},j.Textbox=jc;var kc=d.noConflict(!0);xb(),Pb(),U(),l.loadTheme(f.exports.Themes.Tinkercad),e.partials=e.templates,f.exports.jQuery=kc,f.exports.Handlebars=e,f.exports.Controls=j,f.exports.Utility=l,f.exports.CoreLibrary=i};a.creativePlatformLibraryaZS9YbvfqUXrev0=c}("undefined"==typeof k?window:k),function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(c,d){function e(a){if(a.data instanceof s){var b=a.data;void 0!==b.attributes.viewer&&void 0!==b.attributes.viewer.threemesh&&delete b.attributes.viewer.threemesh}}var g=c.libraryExports("1vxKXGNaLtr",0),h=c.libraryExports("aZS9YbvfqUX",0),i=a;d&&(d.name="Autodesk Creative Platform Viewer",d.description="A Viewer for Visualizing 3D Content",d.resources=[{id:"1kcFpptGphV",name:"background.jpg"},{id:"a6wt4yygZGy",name:"environment.jpg"},{id:"3b2rDlidSNr",name:"divbackground.jpg"},{id:"9Yq6GFiFqDo",name:"pandent.stl"},{id:"jvjXnFCV1jW",name:"belt.stl"},{id:"8CIOqdg99g0",name:"cufflink.stl"},{id:"7wid7QMe4BO",name:"text.stl"},{id:"bTaw4yr787B",name:"ring.stl"},{id:"6qnFEOBoljo",name:"helix.stl"},{id:"hkQ4b5ywGF4",name:"voronoi.stl"},{id:"f5GHsL9kmnI",name:"torus.stl"},{id:"kDR5ymFic8k",name:"idviz_irr.logluv.dds"},{id:"fidHcnHCMJr",name:"idviz_mipdrop.logluv.dds"},{id:"aVuGWY2mWWa",name:"riverbank_irr.logluv.dds"},{id:"gQNf0WWozpF",name:"riverbank_mipdrop.logluv.dds"},{id:"kjAdCcV87Kk",name:"infinitypool_irr.logluv.dds"},{id:"80M5uUPaNLt",name:"infinitypool_mipdrop.logluv.dds"},{id:"lX8VhtGkz8p",name:"scgeneric_irr.logluv.dds"},{id:"ewrQeLK1FK0",name:"scgeneric_mipdrop.logluv.dds"}]),f.ViewControls=function(a,b){function c(a){1===a.which&&r===f.ViewControls.STATE.ROTATE?l.set(a.clientX,a.clientY):3===a.which&&r===f.ViewControls.STATE.PAN?n.set(a.clientX,a.clientY):r=f.ViewControls.STATE.NONE}function d(a){if(s.autoRotate=!1,s.enabled!==!1){if(a.preventDefault(),a.stopPropagation(),0===a.button){if(s.noRotate===!0)return;r=f.ViewControls.STATE.ROTATE,l.set(a.clientX,a.clientY)}else if(1===a.button){if(s.noZoom===!0)return;r=f.ViewControls.STATE.DOLLY,p.set(a.clientX,a.clientY)}else if(2===a.button){if(s.noPan===!0)return;r=f.ViewControls.STATE.PAN,n.set(a.clientX,a.clientY)}s.domElement.addEventListener("mousemove",e,!1),s.domElement.addEventListener("mouseup",g,!1)}}function e(a){if(s.autoRotate=!1,s.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=s.domElement===document?s.domElement.body:s.domElement,c=new f.Vector2;if(r===f.ViewControls.STATE.ROTATE){if(s.noRotate===!0)return;m.set(a.clientX,a.clientY),c.subVectors(m,l),s.rotateLeft(2*Math.PI*c.x/b.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*c.y/b.clientHeight*s.rotateSpeed),l.copy(m)}else if(r===f.ViewControls.STATE.DOLLY){if(s.noZoom===!0)return;zoomEnd.set(a.clientX,a.clientY),c.subVectors(zoomEnd,p),c.y>0?s.zoomIn():s.zoomOut(),p.copy(zoomEnd)}else if(r===f.ViewControls.STATE.PAN){if(s.noPan===!0)return;o.set(a.clientX,a.clientY),c.subVectors(o,n),s.pan(c),n.copy(o)}s.update()}}function g(a){s.autoRotate=!1,s.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),s.domElement.removeEventListener("mousemove",e,!1),s.domElement.removeEventListener("mouseup",g,!1),r=f.ViewControls.STATE.NONE)}function h(a){if(s.autoRotate=!1,s.enabled!==!1&&s.noZoom!==!0){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?s.zoomOut():s.zoomIn()}}function i(a){if(s.enabled!==!1)switch(a.touches.length){case 1:if(s.noRotate===!0)return;r=f.ViewControls.STATE.TOUCH_ROTATE,l.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(s.noZoom===!0)return;r=f.ViewControls.STATE.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);p.set(0,d);break;case 3:if(s.noPan===!0)return;r=f.ViewControls.STATE.TOUCH_PAN,n.set(a.touches[0].pageX,a.touches[0].pageY);break;default:r=f.ViewControls.STATE.NONE}}function j(a){if(s.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=s.domElement===document?s.domElement.body:s.domElement,c=new f.Vector2;switch(a.touches.length){case 1:if(s.noRotate===!0)return;if(r!==f.ViewControls.STATE.TOUCH_ROTATE)return;m.set(a.touches[0].pageX,a.touches[0].pageY),c.subVectors(m,l),s.rotateLeft(2*Math.PI*c.x/b.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*c.y/b.clientHeight*s.rotateSpeed),l.copy(m);break;case 2:if(s.noZoom===!0)return;if(r!==f.ViewControls.STATE.TOUCH_DOLLY)return;var d=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY,g=Math.sqrt(d*d+e*e);zoomEnd.set(0,g),c.subVectors(zoomEnd,p),c.y>0?s.zoomOut():s.zoomIn(),p.copy(zoomEnd);break;case 3:if(s.noPan===!0)return;if(r!==f.ViewControls.STATE.TOUCH_PAN)return;o.set(a.touches[0].pageX,a.touches[0].pageY),c.subVectors(o,n),s.pan(c),n.copy(o);break;default:r=f.ViewControls.STATE.NONE}}}function k(){s.enabled!==!1&&(r=f.ViewControls.STATE.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new f.Vector3,this.pivot=new f.Vector3,this.noZoom=!1,this.zoomSpeed=1,this.scale=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=3,this.rotateLeftDelta=0,this.rotateUpDelta=0,this.noPan=!1,this.panDelta=new f.Vector3,this._autoRotate=!1,this.autoRotateSpeed=-3.5,Object.defineProperty(this,"autoRotate",{enumerable:!0,get:function(){return this._autoRotate},set:function(a){a!==this._autoRotate&&(this._autoRotate=a,"function"==typeof this.autoRotateChangedCallback&&this.autoRotateChangedCallback(this._autoRotate))}}),this.autoRotateChangedCallback=void 0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.orbitMode=f.ViewControls.OrbitMode.XY,this.lastPosition=new f.Vector3;var l=new f.Vector2,m=new f.Vector2,n=new f.Vector2,o=new f.Vector2,p=new f.Vector2,q=new f.Vector2,r=f.ViewControls.STATE.NONE,s=this;this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mouseenter",c,!1),this.domElement.addEventListener("mousedown",d,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1)},f.ViewControls.OrbitMode={XY:0,X:1,Y:2},f.ViewControls.STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},f.ViewControls.prototype=Object.create(f.EventDispatcher.prototype),f.ViewControls.prototype.rotateLeft=function(a){this.orbitMode!==f.ViewControls.OrbitMode.X&&(void 0===a&&(a=Math.PI/1800*this.autoRotateSpeed),this.rotateLeftDelta-=a)},f.ViewControls.prototype.rotateUp=function(a){this.orbitMode!==f.ViewControls.OrbitMode.Y&&(void 0===a&&(a=Math.PI/1800*this.autoRotateSpeed),this.rotateUpDelta-=a)},f.ViewControls.prototype.pan=function(a){var b=this.domElement===document?this.domElement.body:this.domElement,c=this,d=function(a){var b=new f.Vector3,d=c.object.matrix.elements;b.set(d[0],d[1],d[2]),b.multiplyScalar(-a),c.panDelta.add(b)},e=function(a){var b=new f.Vector3,d=c.object.matrix.elements;b.set(d[4],d[5],d[6]),b.multiplyScalar(a),c.panDelta.add(b)};if(void 0!==this.object.fov){var g=this.object.position,h=g.clone().sub(this.target),i=h.length();i*=Math.tan(this.object.fov/2*Math.PI/180),d(2*a.x*i/b.clientHeight),e(2*a.y*i/b.clientHeight)}else void 0!==this.object.top&&(d(a.x*(this.object.right-this.object.left)/b.clientWidth),e(a.y*(this.object.top-this.object.bottom)/b.clientHeight))},f.ViewControls.prototype.zoomIn=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale/=a},f.ViewControls.prototype.zoomOut=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale*=a},f.ViewControls.prototype.lookAt=function(a,b,c){this.autoRotate=!1,this.object.target=new f.Vector3(0,0,0);var d=this;this.tweenTarget=new j.Tween(d.object.target).to({x:a[0],y:a[1],z:a[2]}).easing(j.Easing.Linear.None).onUpdate(function(){d.object.lookAt(d.object.target)}).onComplete(function(){d.object.lookAt(new f.Vector3(a[0],a[1],a[2]))}).start();var e=this.object.position.length(),g=this.object.position.clone().sub(this.object.target).normalize(),h=new f.Vector3(b[0],b[1],b[2]);h.normalize(),d.tweenPos=new j.Tween(g).to({x:h.x,y:h.y,z:h.z}).easing(j.Easing.Linear.None).onUpdate(function(){var a=d.object.target.clone();a.add(g.clone().normalize().multiplyScalar(e)),d.object.position=a,d.object.lookAt(d.object.target)}).onComplete(function(){d.object.lookAt(new f.Vector3(a[0],a[1],a[2]))}).start()},f.ViewControls.prototype.update=function(){var a=!1,b=.001;j.update();var c=this.object.position,d=c.clone().sub(this.target),e=Math.atan2(d.x,d.z);this.autoRotate?(a=!0,this.rotateLeft()):this.tween&&(a=!0,this.tween.update()),e+=this.rotateLeftDelta;var g=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y);this.pivot?g+this.rotateUpDelta<this.maxPolarAngle-b&&g+this.rotateUpDelta>this.minPolarAngle+b?g+=this.rotateUpDelta:this.rotateUpDelta=0:(g+=this.rotateUpDelta,g=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,g)),g=Math.max(b,Math.min(Math.PI-b,g)));var h=d.length()*this.scale;if(h=Math.max(this.minDistance,Math.min(this.maxDistance,h)),this.target.add(this.panDelta),c.copy(this.target).add(d),this.object.lookAt(this.target),this.pivot){var i=c.clone().sub(this.pivot).normalize(),k=c.clone().sub(this.target).normalize(),l=this.object.up.clone().applyQuaternion(this.object.quaternion).normalize(),m=k.clone().cross(l).normalize(),n=c.distanceTo(this.pivot)*this.scale,o=c.distanceTo(this.target)*this.scale;if(this.rotateLeftDelta){a=!0;var p=new f.Quaternion,q;Math.abs(this.rotateLeftDelta)>.1*b*Math.PI?(q=.3*this.rotateLeftDelta,this.rotateLeftDelta=.7*this.rotateLeftDelta):(q=this.rotateLeftDelta,this.rotateLeftDelta=0),p.setFromAxisAngle(new f.Vector3(0,1,0),q),i.applyQuaternion(p).normalize(),k.applyQuaternion(p).normalize(),m.applyQuaternion(p).normalize()}if(this.rotateUpDelta){a=!0;var q;Math.abs(this.rotateUpDelta)>.1*b*Math.PI?(q=.3*this.rotateUpDelta,this.rotateUpDelta=.7*this.rotateUpDelta):(q=this.rotateUpDelta,this.rotateUpDelta=0);var r=new f.Vector3(0,0,1),s=new f.Vector3(1,0,0),t=r.multiplyScalar(r.dot(m)).add(s.multiplyScalar(s.dot(m)));t.normalize();var p=new f.Quaternion;p.setFromAxisAngle(t,-q),i.applyQuaternion(p).normalize(),k.applyQuaternion(p).normalize()}c.copy(this.pivot).add(i.multiplyScalar(n)),this.target.copy(c).add(k.negate().multiplyScalar(o)),this.object.lookAt(this.target)}else d.x=h*Math.sin(g)*Math.sin(e),d.y=h*Math.cos(g),d.z=h*Math.sin(g)*Math.cos(e),c.copy(this.target).add(d),this.object.lookAt(this.target);return this.scale=1,this.panDelta.set(0,0,0),this.lastPosition.distanceTo(this.object.position)>0&&(a=!0,this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.object.position)),a};var k={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=k.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};f.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},f.SSAOShader={uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},size:{type:"v2",value:new f.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},onlyAO:{type:"i",value:0},aoClamp:{type:"f",value:.5},lumInfluence:{type:"f",value:.5}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 8;","const float radius = 5.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float ao = 0.0;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","float pw = cos( l ) * r;","float ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","vec4 color4 = texture2D( tDiffuse, vUv );","vec3 color = color4.rgb;","float alpha = color4.a;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, alpha + 0.01);","}"].join("\n")},f.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new f.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec4 rgbA = (1.0/2.0) * (","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));","vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));","float lumaB = dot(rgbB, vec4(luma, 0.0));","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = rgbA;","} else {","gl_FragColor = rgbB;","}","}"].join("\n")},f.MaskPass=function(a,b){this.scene=a,this.camera=b,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},f.MaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.colorMask(!1,!1,!1,!1),e.depthMask(!1);var f,g;this.inverse?(f=0,g=1):(f=1,g=0),e.enable(e.STENCIL_TEST),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.stencilFunc(e.ALWAYS,f,4294967295),e.clearStencil(g),a.render(this.scene,this.camera,c,this.clear),a.render(this.scene,this.camera,b,this.clear),e.colorMask(!0,!0,!0,!0),e.depthMask(!0),e.stencilFunc(e.EQUAL,1,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}},f.ClearMaskPass=function(){this.enabled=!0},f.ClearMaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.disable(e.STENCIL_TEST)}},f.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse",this.uniforms=f.UniformsUtils.clone(a.uniforms),this.material=new f.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},f.ShaderPass.prototype={render:function(a,b,c,d){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c),f.EffectComposer.quad.material=this.material,this.renderToScreen?a.render(f.EffectComposer.scene,f.EffectComposer.camera):a.render(f.EffectComposer.scene,f.EffectComposer.camera,b,this.clear)}},f.EffectComposer=function(a,c){if(this.renderer=a,void 0===c){var d=window.innerWidth||1,e=window.innerHeight||1,g={minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBFormat,stencilBuffer:!1};c=new f.WebGLRenderTarget(d,e,g)}this.renderTarget1=c,this.renderTarget2=c.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===f.CopyShader&&b.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new f.ShaderPass(f.CopyShader)},f.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;
var b=!1,c,d,e=this.passes.length;for(d=0;e>d;d++)if(c=this.passes[d],c.enabled){if(c.render(this.renderer,this.writeBuffer,this.readBuffer,a,b),c.needsSwap){if(b){var g=this.renderer.context;g.stencilFunc(g.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),g.stencilFunc(g.EQUAL,1,4294967295)}this.swapBuffers()}c instanceof f.MaskPass?b=!0:c instanceof f.ClearMaskPass&&(b=!1)}},reset:function(a){void 0===a&&(a=this.renderTarget1.clone(),a.width=window.innerWidth,a.height=window.innerHeight),this.renderTarget1=a,this.renderTarget2=a.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(a,b){var c=this.renderTarget1.clone();c.width=a,c.height=b,this.reset(c)}},f.EffectComposer.camera=new f.OrthographicCamera(-1,1,1,-1,0,1),f.EffectComposer.quad=new f.Mesh(new f.PlaneGeometry(2,2),null),f.EffectComposer.scene=new f.Scene,f.EffectComposer.scene.add(f.EffectComposer.quad),f.RenderPass=function(a,b,c,d,e){this.scene=a,this.camera=b,this.overrideMaterial=c,this.clearColor=d,this.clearAlpha=void 0!==e?e:1,this.oldClearColor=new f.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},f.RenderPass.prototype={render:function(a,b,c,d){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(a.getClearColor()),this.oldClearAlpha=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),a.render(this.scene,this.camera,c,this.clear),this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}};var l="Unexpected arguments. Please refer to documentation.",m=d.resourceURL("negx.jpg"),n=d.resourceURL("negy.jpg"),o=d.resourceURL("negz.jpg"),p=d.resourceURL("posx.jpg"),q=d.resourceURL("posy.jpg"),r=d.resourceURL("posz.jpg"),s=g.Mesh3D,t=g.Plugin,u=h.jQuery,v={_materials:{},_initialized:!1,_initialize:function(){f.CustomizedPhongMaterial=function(a){f.ShaderMaterial.call(this),this.vertexShader=["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",f.ShaderChunk.map_pars_vertex,f.ShaderChunk.lightmap_pars_vertex,f.ShaderChunk.envmap_pars_vertex,f.ShaderChunk.lights_phong_pars_vertex,f.ShaderChunk.color_pars_vertex,f.ShaderChunk.morphtarget_pars_vertex,f.ShaderChunk.skinning_pars_vertex,f.ShaderChunk.shadowmap_pars_vertex,"void main() {",f.ShaderChunk.map_vertex,f.ShaderChunk.lightmap_vertex,f.ShaderChunk.color_vertex,f.ShaderChunk.morphnormal_vertex,f.ShaderChunk.skinbase_vertex,f.ShaderChunk.skinnormal_vertex,f.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",f.ShaderChunk.morphtarget_vertex,f.ShaderChunk.skinning_vertex,f.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",f.ShaderChunk.worldpos_vertex,f.ShaderChunk.envmap_vertex,f.ShaderChunk.lights_phong_vertex,f.ShaderChunk.shadowmap_vertex,"}"].join("\n"),this.fragmentShader=["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",f.ShaderChunk.color_pars_fragment,f.ShaderChunk.map_pars_fragment,f.ShaderChunk.lightmap_pars_fragment,f.ShaderChunk.envmap_pars_fragment,f.ShaderChunk.fog_pars_fragment,f.ShaderChunk.lights_phong_pars_fragment,f.ShaderChunk.shadowmap_pars_fragment,f.ShaderChunk.bumpmap_pars_fragment,f.ShaderChunk.normalmap_pars_fragment,f.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",f.ShaderChunk.map_fragment,f.ShaderChunk.alphatest_fragment,f.ShaderChunk.specularmap_fragment,f.ShaderChunk.lights_phong_fragment,f.ShaderChunk.lightmap_fragment,f.ShaderChunk.color_fragment,f.ShaderChunk.envmap_fragment,f.ShaderChunk.shadowmap_fragment,f.ShaderChunk.linear_to_gamma_fragment,f.ShaderChunk.fog_fragment,"}"].join("\n"),this.lights=[],this.shading=f.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.metal=!1,this.perPixel=!0,this.fog=!0,this.wrapAround=!1,this.color=new f.Color(16777215),this.ambient=new f.Color(16777215),this.emissive=new f.Color(0),this.specular=new f.Color(1118481),this.shininess=30,this.wrapRGB=new f.Vector3(1,1,1),this.bumpDensity=2,this.bumpAmplitude=.05,this.bumpType=1,this.envMap=null,this.combine=f.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.setValues(a),this.uniforms=f.UniformsUtils.clone(f.ShaderLib.phong.uniforms),this.uniforms.bumpDensity={type:"f",value:this.bumpDensity},this.uniforms.bumpAmplitude={type:"f",value:this.bumpAmplitude},this.uniforms.bumpType={type:"i",value:this.bumpType},this.uniforms.diffuse.value=this.color,this.uniforms.ambient.value=this.ambient,this.uniforms.emissive.value=this.emissive,this.uniforms.specular.value=this.specular,this.uniforms.shininess.value=this.shininess,this.uniforms.wrapRGB.value=this.wrapRGB,this.uniforms.envMap.value=this.envMap,this.uniforms.combine.value=this.combine,this.uniforms.reflectivity.value=this.reflectivity,this.uniforms.refractionRatio.value=this.refractionRatio,this.uniforms.opacity.value=this.opacity;var b=this;Object.defineProperty(this,"bumpDensity",{set:function(a){b.uniforms.bumpDensity.value=a},get:function(){return b.uniforms.bumpDensity.value}}),Object.defineProperty(this,"bumpAmplitude",{set:function(a){b.uniforms.bumpAmplitude.value=a},get:function(){return b.uniforms.bumpAmplitude.value}}),Object.defineProperty(this,"bumpType",{set:function(a){b.uniforms.bumpType.value=a},get:function(){return b.uniforms.bumpType.value}}),Object.defineProperty(this,"color",{set:function(a){b.uniforms.diffuse.value=a},get:function(){return b.uniforms.diffuse.value}}),Object.defineProperty(this,"ambient",{set:function(a){b.uniforms.ambient.value=a},get:function(){return b.uniforms.ambient.value}}),Object.defineProperty(this,"emissive",{set:function(a){b.uniforms.emissive.value=a},get:function(){return b.uniforms.emissive.value}}),Object.defineProperty(this,"specular",{set:function(a){b.uniforms.specular.value=a},get:function(){return b.uniforms.specular.value}}),Object.defineProperty(this,"shininess",{set:function(a){b.uniforms.shininess.value=a},get:function(){return b.uniforms.shininess.value}}),Object.defineProperty(this,"wrapRGB",{set:function(a){b.uniforms.wrapRGB.value=a},get:function(){return b.uniforms.wrapRGB.value}}),Object.defineProperty(this,"envMap",{set:function(a){b.uniforms.envMap.value=a},get:function(){return b.uniforms.envMap.value}}),Object.defineProperty(this,"combine",{set:function(a){b.uniforms.combine.value=a},get:function(){return b.uniforms.combine.value}}),Object.defineProperty(this,"reflectivity",{set:function(a){b.uniforms.reflectivity.value=a},get:function(){return b.uniforms.reflectivity.value}}),Object.defineProperty(this,"refractionRatio",{set:function(a){b.uniforms.refractionRatio.value=a},get:function(){return b.uniforms.refractionRatio.value}}),Object.defineProperty(this,"opacity",{set:function(a){b.uniforms.opacity.value=a},get:function(){return b.uniforms.opacity.value}})},f.CustomizedPhongMaterial.prototype=Object.create(f.ShaderMaterial.prototype),this._initialized=!0},_generateMaterial:function(a){var b=this._materials[a],c=function(){var a=navigator.userAgent.toLowerCase(),b=["iphone","ipad","android"],c="("+b.join("|")+")";return a.match(new RegExp(c,"i"))};if(this._initialized||this._initialize(),void 0!==b)return b;var d=function(a,b,c,d,e,f,g){a.dirLight1=b,a.dirLight2=c,a.skyLight=d,a.ambientLight=e,void 0!==f&&(a.pointLight1=f),void 0!==g&&(a.pointlight2=g)};switch(a){case"red plastic":b=new f.CustomizedPhongMaterial({color:10690862,ambient:10690862,bumpType:1});break;case"red polyamide":case"red polished plastic":b=new f.CustomizedPhongMaterial({color:10690862,specular:4473924,ambient:10690862,bumpType:1}),d(b,.65,.25,.05,"0x555555");break;case"white polyamide":case"white polished plastic":b=new f.CustomizedPhongMaterial({color:14869218,specular:3158064,ambient:14869218,bumpType:1}),d(b,.25,.1,.5,"0x111111");break;case"black polyamide":case"black polished plastic":b=new f.CustomizedPhongMaterial({color:4671303,specular:4210752,ambient:4671303,bumpType:1}),d(b,.3,.15,.1,"0x111111");break;case"blue polyamide":case"blue polished plastic":b=new f.CustomizedPhongMaterial({color:3690400,specular:3158064,ambient:3690400,bumpType:1}),d(b,.3,.7,.45,"0x222222");break;case"yellow polyamide":case"yellow polished plastic":b=new f.CustomizedPhongMaterial({color:16773129,specular:2105376,ambient:16773129,bumpType:1}),d(b,.25,.15,.4,"0x111111");break;case"beige polyamide":case"beige polished plastic":b=new f.CustomizedPhongMaterial({color:12892035,specular:2236962,ambient:12892035,bumpType:1}),d(b,.35,.15,.35,"0x111111");break;case"green polyamide":case"green polished plastic":b=new f.CustomizedPhongMaterial({color:8372802,specular:2105376,ambient:8372802,bumpType:1}),d(b,.25,.1,.25,"0x333333");break;case"brown polyamide":case"brown polished plastic":b=new f.CustomizedPhongMaterial({color:7295286,specular:3158064,ambient:7295286,bumpType:1}),d(b,.4,.15,.35,"0x111111");break;case"pink polyamide":case"pink polished plastic":b=new f.CustomizedPhongMaterial({color:15553932,specular:2105376,ambient:15553932,bumpType:1}),d(b,.25,.3,.2,"0x222222");break;case"orange polyamide":case"orange polished plastic":b=new f.CustomizedPhongMaterial({color:15354647,specular:4473924,ambient:15354647,bumpType:1}),d(b,.6,.2,.25,"0x151515");break;case"natrual white plastic":b=new f.CustomizedPhongMaterial({color:16578801,specular:3158064,ambient:14869218,bumpType:1,combine:f.MultiplyOperation,transparent:!0,opacity:.9}),d(b,.25,.1,.5,"0x111111");break;case"dremel blue plastic":b=new f.CustomizedPhongMaterial({color:1203879,specular:3158064,ambient:3690400,bumpType:1}),d(b,.3,.7,.45,"0x222222");break;case"cotton white plastic":b=new f.CustomizedPhongMaterial({color:16777215,specular:3158064,ambient:14869218,bumpType:1}),d(b,.25,.1,.5,"0x111111");break;case"deep black plastic":b=new f.CustomizedPhongMaterial({color:4210752,specular:4210752,ambient:4671303,bumpType:1}),d(b,.3,.15,.1,"0x111111");break;case"electric orange plastic":b=new f.CustomizedPhongMaterial({color:16095016,specular:4473924,ambient:15354647,bumpType:1}),d(b,.6,.2,.25,"0x151515");break;case"grass green plastic":b=new f.CustomizedPhongMaterial({color:625996,specular:2105376,ambient:8372802,bumpType:1}),d(b,.25,.1,.25,"0x333333");break;case"racecar red plastic":b=new f.CustomizedPhongMaterial({color:15409448,specular:4473924,ambient:10690862,bumpType:1}),d(b,.65,.25,.05,"0x555555");break;case"gold medal plastic":b=new f.CustomizedPhongMaterial({color:12289863,specular:2236962,ambient:12892035,bumpType:1}),d(b,.35,.15,.35,"0x111111");break;case"silver spoon plastic":b=new f.CustomizedPhongMaterial({color:6973796,specular:2236962,ambient:12892035,bumpType:1}),d(b,.35,.15,.35,"0x111111");break;case"purple orchid plastic":b=new f.CustomizedPhongMaterial({color:8400012,specular:2236962,ambient:12892035,bumpType:1}),d(b,.35,.15,.35,"0x111111");break;case"white ceramic":b=new f.MeshLambertMaterial({ambient:16777215,color:15263976,specular:16777215,reflectivity:.15}),d(b,.1,.25,.5,"0x111111"),b.useEnvMap=!0;break;case"yellow ceramic":b=new f.MeshLambertMaterial({ambient:16777215,color:16117616,specular:16777215,reflectivity:.2}),d(b,.25,.25,.35,"0x111111"),b.useEnvMap=!0;break;case"green ceramic":b=new f.MeshLambertMaterial({ambient:16777215,color:10995572,specular:16777215,reflectivity:.15}),d(b,.3,.2,.25,"0x333000"),b.useEnvMap=!0;break;case"aqua ceramic":b=new f.MeshLambertMaterial({ambient:16777215,color:10209494,specular:16777215,reflectivity:.15}),d(b,.3,.35,.25,"0x111111"),b.useEnvMap=!0;break;case"black ceramic":b=new f.MeshLambertMaterial({ambient:16777215,color:4671303,specular:16777215,reflectivity:.75}),d(b,.1,.2,.1,"0x222222"),b.useEnvMap=!0;break;case"orange ceramic":b=new f.MeshLambertMaterial({ambient:16752750,color:16752750,specular:16777215,reflectivity:.15}),d(b,.25,.25,.25,"0x333333"),b.useEnvMap=!0;break;case"polished silver":b=new f.CustomizedPhongMaterial({color:16711423,ambient:16777215,specular:16777215,reflectivity:.85,shininess:90,combine:f.MultiplyOperation,bumpType:4}),d(b,.1,.1,.45,"0x111111"),b.useEnvMap=!0,b.bumpDensity=10,b.useDefaultBumpDensity=!0;break;case"stainless steel antique bronze":b=new f.CustomizedPhongMaterial({color:8934216,specular:11184810,ambient:14869218,combine:f.MultiplyOperation,reflectivity:1,bumpType:3}),d(b,.7,.1,0,"0x000000",0,0);break;case"stainless steel polished":b=new f.CustomizedPhongMaterial({color:16705761,specular:5592405,ambient:14869218,combine:f.MultiplyOperation,reflectivity:.4,bumpType:3}),d(b,.6,.1,.1,"0x000000",0,0);break;case"stainless steel wheat penny":b=new f.CustomizedPhongMaterial({color:8416111,specular:11184810,ambient:14869218,combine:f.MultiplyOperation,reflectivity:1,bumpType:3}),d(b,.7,.1,0,"0x000000",0,0);break;case"alumide":b=new f.CustomizedPhongMaterial({color:10855845,ambient:10855845,specular:10066329,shininess:1e3,combine:f.MultiplyOperation,bumpType:1}),d(b,.4,.35,.1,"0x111111",.75,.25);break;case"titanium":b=new f.MeshPhongMaterial({color:14670030,ambient:14670030,specular:16777215,reflectivity:.25,combine:f.MultiplyOperation}),d(b,.35,.25,.35,"0x111111",.3,.3),b.useEnvMap=!0;break;case"platinum":b=new f.MeshPhongMaterial({color:14277081,ambient:14277081,specular:16777215,reflectivity:.45,shininess:100,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"brass":b=new f.MeshPhongMaterial({color:15523246,ambient:15523246,specular:14007155,reflectivity:.45,combine:f.MultiplyOperation}),d(b,.15,.25,.25,"0x795211",.2,.3),b.useEnvMap=!0;break;case"bronze":b=new f.MeshPhongMaterial({color:14262133,ambient:14262133,specular:12017158,reflectivity:.15,combine:f.MultiplyOperation}),d(b,.4,.2,.3,"0x222222",.25,.25),b.useEnvMap=!0;break;case"14k gold":b=new f.MeshPhongMaterial({color:15783081,ambient:15783081,specular:15184975,reflectivity:.45,shininess:90,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"14k rose gold":b=new f.MeshPhongMaterial({color:16111042,ambient:16111042,specular:9127432,reflectivity:.45,shininess:90,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"14k white gold":b=new f.MeshPhongMaterial({color:14277581,ambient:14277581,specular:16777215,reflectivity:.45,shininess:90,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"18k gold":b=new f.MeshPhongMaterial({color:16438887,ambient:16438887,specular:13281351,reflectivity:.5,shininess:90,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"18k rose gold":b=new f.MeshPhongMaterial({color:16434067,ambient:16434067,specular:16777215,reflectivity:.45,shininess:90,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3),b.useEnvMap=!0;break;case"orange wax":b=new f.MeshPhongMaterial({color:16615222,ambient:16615222,specular:4210752,shininess:200,combine:f.MultiplyOperation}),d(b,.3,.35,.3,"0x111111",.3,.3);break;case"black rubber":b=new f.MeshPhongMaterial({color:4671303,ambient:4671303,specular:4210752}),d(b,.3,.15,0,"0x111111");break;case"white resin":b=new f.MeshPhongMaterial({color:13027275,ambient:13027275,specular:16777215,reflectivity:.15,shininess:90,combine:f.MultiplyOperation}),d(b,.45,.35,.05,"0x828282"),b.useEnvMap=!0;break;case"black resin":b=new f.MeshPhongMaterial({color:2631721,ambient:2631721,specular:9474192,reflectivity:.15,shininess:90,combine:f.MultiplyOperation}),d(b,.2,1,.3,"0x111111"),b.useEnvMap=!0;break;case"translucent resin":b=new f.MeshPhongMaterial({color:14539994,ambient:14539994,specular:9474192,reflectivity:.15,shininess:90,combine:f.MultiplyOperation,transparent:!0,opacity:.9}),d(b,.45,.35,.25,"0x333333"),b.useEnvMap=!0;break;case"highlight":b=new f.MeshBasicMaterial({color:5906944,transparent:!0,opacity:1});break;case"white ceramic prism":b=F._prismOpaque({x:230/255,y:230/255,z:230/255},.45,.4);break;case"yellow ceramic prism":b=F._prismOpaque({x:245/255,y:238/255,z:133/255},.45,.4);break;case"green ceramic prism":b=F._prismOpaque({x:18/255,y:199/255,z:17/255},.45,.45);break;case"polished silver prism":b=F._prismMetal({x:.9672,y:.95555,z:.9137},.07746);break;case"14k gold prism":b=F._prismMetal({x:.905258349924144,y:.7840366658696786,z:.38656667340964346},.0746);break;case"default":b=new f.MeshLambertMaterial({color:10690862,ambient:16720384,shading:f.FlatShading,side:f.DoubleSide}),d(b,.25,.1,.5,"0x111111");break;default:b=null}return b&&(c()&&b.hasOwnProperty("bumpType")&&(b.bumpType=5,b.bumpDensity=10,b.bumpAmplitude=.02,b.useDefaultBumpDensity=!0),this._materials[a]=b),b}},w={material:function(a){return this._impl._generateMaterial(a)}};Object.defineProperty(w,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:v});var x=function(a){this.scene=a.scene,this.camera=a.camera,this.bounds=a.bounds,this.material=a.globalMaterial,this.initialized=!1,this.dirLight1=null,this.dirLight2=null,this.pointLight1=null,this.pointLight2=null,this.skyLight=null,this.ambientLight=null};x.prototype={initialize:function(){if(!this.initialized&&this.bounds&&this.scene){this.ambientLight=new f.AmbientLight(1118481),this.scene.add(this.ambientLight),this.skyLight=new f.HemisphereLight(16777215,16777215,.4),this.scene.add(this.skyLight);var a=this.bounds,b=a.radius;if(!this.dirLight1){this.dirLight1=new f.DirectionalLight(16777215,.85),this.dirLight1.intensity=.6,this.dirLight1.castShadow=!0,this.dirLight1.shadowCameraVisible=!1,this.dirLight1.shadowCameraNear=1,this.dirLight1.shadowCameraFov=45,this.dirLight1.shadowBias=-.001,this.dirLight1.shadowDarkness=.2,this.dirLight1.shadowMapWidth=1024,this.dirLight1.shadowMapHeight=1024,this.scene.add(this.dirLight1),this.dirLight1.shadowCameraFar=20*b,this.dirLight1.shadowCameraLeft=-b,this.dirLight1.shadowCameraRight=b,this.dirLight1.shadowCameraTop=b,this.dirLight1.shadowCameraBottom=-b,this.scene.add(this.dirLight1);var c=new f.Object3D;this.dirLight1.target=c,this.dirLight1.target.matrixWorld.setPosition(a.center)}if(!this.dirLight2){this.dirLight2=new f.DirectionalLight(16777215,.85),this.dirLight2.intensity=.1,this.dirLight2.castShadow=!1,this.scene.add(this.dirLight2);var c=new f.Object3D;this.dirLight2.target=c,this.dirLight2.target.matrixWorld.setPosition(a.center)}this.pointLight1||(this.pointLight1=new f.PointLight(16777215,.3,5*b),this.scene.add(this.pointLight1)),this.pointLight2||(this.pointLight2=new f.PointLight(16777215,.3,5*b),this.scene.add(this.pointLight2)),this.initialized=!0,this.globalMaterial(this.material),this.sceneBounds(this.bounds)}},globalMaterial:function(a){this.material=a,this.initialized&&this.initialized&&a&&(void 0!==a.dirLight1&&(this.dirLight1.intensity=a.dirLight1),void 0!==a.dirLight2&&(this.dirLight2.intensity=a.dirLight2),void 0!==a.skyLight&&(this.skyLight.intensity=a.skyLight),void 0!==a.ambientLight&&this.ambientLight.color.set(parseInt(a.ambientLight)),void 0!==a.pointLight1&&(this.pointLight1.intensity=a.pointLight1),void 0!==a.pointLight2&&(this.pointLight2.intensity=a.pointLight2))},sceneBounds:function(a){if(this.bounds=a,this.initialized){var b=this.bounds,c=b.radius,d=this.camera.up.clone().applyQuaternion(this.camera.quaternion),e=this.camera.position.clone().sub(b.center),f=e.clone().cross(d),g=b.center.clone(),h=g.clone().add(d.clone().normalize().multiplyScalar(.2*c));h.add(f.clone().normalize().multiplyScalar(c)),h.add(e.clone().normalize().multiplyScalar(c)),this.dirLight1.position=h;var i=g.clone().add(d.clone().normalize().multiplyScalar(c));i.add(f.clone().normalize().multiplyScalar(-c)),i.add(e.clone().normalize().multiplyScalar(c)),this.dirLight2.position=i,h=g.clone(),h.add(f.clone().normalize().multiplyScalar(2*c)),h.add(e.clone().normalize().multiplyScalar(2*c)),this.pointLight1.position=h,i=g.clone(),i.add(f.clone().normalize().multiplyScalar(-2*c)),i.add(e.clone().normalize().multiplyScalar(2*c)),this.pointLight2.position=i,this.globalMaterial(this.material)}}};var y=function(a){this.element=a.parent,this.globalMaterial=a.globalMaterial||"default",this.showDebugUI=!1,this.backgroundURL="",this.environment="",this.environmentTexture=null,this.shading="flat",this.position=new f.Vector3(0,0,0),this.turntable=!0,this.dataDirty=!0,this.cameraDirty=!0,this.suspended=!1,this.ssao=!1,this.bumpScale=1,this.camera=null,this.scene=null,this.renderer=null,this.rootObject=null,this.boundingBox=null,this.controls=null,this.viewDir=new f.Vector3(1,.7,1),this._errorText="",this._statusText="",this._highlightSet=new g.RefSet,this._renderingPipeline=null;try{this._initialize()}catch(b){t.panic("Failed to render in Viewer")}};y.prototype={_initialize:function(){if(E.initialize(),this.devicePixelRatio=a&&a.devicePixelRatio?a.devicePixelRatio:window&&window.devicePixelRatio?window.devicePixelRatio:1,this.showDebugUI){var b=this.element,c=544,d=478,e=200,h=d;this.element=this.element.ownerDocument.createElement("div"),this.debugUI=new C(b,e,h,this),b.appendChild(this.element),this.element.setAttribute("style","background-color:#FFA500;float:left; width:"+(c-e)+"px; height:"+d+"px;")}this.camera=new f.PerspectiveCamera(45,this._getViewportWidth()/this._getViewportHeight(),1,1e3),this.camera.position.y=0,this.camera.position.z=500,this.controls=new f.ViewControls(this.camera,this.element),this.controls.autoRotate=this.turntable,this.controls.rotateSpeed=1,this.controls.zoomSpeed=1,this.controls.panSpeed=.8,this.controls.noZoom=!0,this.controls.noPan=!0,this.controls.center=new f.Vector3(0,0,0);var i=this;this.controls.autoRotateChangedCallback=function(a){a||(i._statusText="",i._hideStatusText())},k.webgl?(this.renderer=new f.WebGLRenderer({preserveDrawingBuffer:!0,premultiplied:!0,antialias:!0,maxLights:6,alpha:!0}),this.renderer?(this.renderer.setSize(this._getElementWidth(),this._getElementHeight()),this.renderer.shadowMapEnabled=!1):g.Plugin.panic("WebGL is not supported.")):g.Plugin.panic("WebGL is not supported."),this.renderer.setClearColor(0,0),this.renderer.setSize(this._getElementWidth(),this._getElementHeight()),this.scene=new f.Scene,this.rootObject=new f.Object3D,this.rootObject.position=this.position,this.scene.add(this.rootObject),this.element.appendChild(this.renderer.domElement);var j={scene:this.scene,camera:this.camera};this.light=new x(j);var l=function(){if(!i._renderingPipeline){var a={rootObject:i.rootObject,bgCamera:i.bgCamera,bgScene:i.bgScene,camera:i.camera,scene:i.scene,renderer:i.renderer,width:i._getViewportWidth(),height:i._getViewportHeight(),highlightSet:i._highlightSet},b=new B(a);b.SSAO(i.ssao),i._renderingPipeline=b}return i._renderingPipeline},m=function(){if(requestAnimationFrame(m),i.cameraDirty=i.controls.update()||i.cameraDirty,i.cameraDirty){var a=i.camera.matrixWorldInverse.elements,b=w.material(i.globalMaterial);b.uniforms&&b.uniforms.viewDirection&&(b.uniforms.viewDirection.value=new f.Vector3(-1*a[2],-1*a[6],-1*a[10]))}if(i.suspended||!i.dataDirty&&!i.cameraDirty)i._monitor&&i._monitor.begin();else{if(i.light&&i.boundingBox){var c=i.boundingBox.getBoundingSphere();i.light.sceneBounds(c)}i.debugUI&&i.light.dirLight1&&i.light.dirLight2&&i.debugUI.createDebugUIControls();var d=l();d&&d.render(),i._monitor&&i._monitor.end()}i.dataDirty=!1,i.cameraDirty=!1};m(),this._setGlobalMaterial(this.globalMaterial);var n=function(a){if(a.data instanceof s){var b=a.data,c=b.attributes.viewer.threemesh;c&&(c._highlighted=!0,c.receiveShadow=!1,i.dataDirty=!0)}},o=function(a){if(a.data instanceof s){var b=a.data,c=b.attributes.viewer.threemesh;c&&(delete c._highlighted,c.receiveShadow=!0,i.dataDirty=!0)}};this._highlightSet.itemAdded.bind(n),this._highlightSet.itemRemoved.bind(o)},_getElementWidth:function(){return this.element.clientWidth},_getElementHeight:function(){return this.element.clientHeight},_getViewportWidth:function(){return this.devicePixelRatio*this.element.clientWidth},_getViewportHeight:function(){return this.devicePixelRatio*this.element.clientHeight},_enableSSAO:function(a){this.ssao=a,this._renderingPipeline&&this._renderingPipeline.SSAO(a),this.dataDirty=!0},_addMesh:function(a){a instanceof s||t.panic("The input mesh data is not a Mesh3D object.");var b=this,c=function(a){if(a.attributes.viewer&&a.attributes.viewer.threemesh)return a.attributes.viewer.threemesh.material=w.material(b.globalMaterial),a.attributes.viewer.threemesh;var c=a._impl._triangles,d=a._impl._vertices,g=f.BufferGeometryUtils.createBufferGeometry(d,c);f.BufferGeometryUtils.updateNormals(g,b.shading);var h=w.material(b.globalMaterial),i=new f.Mesh(g,h);return i.rotation.x=Math.PI*-.5,void 0===a.attributes.viewer&&(a.attributes.viewer={},a.change.bind(e)),a.attributes.viewer.threemesh=i,i},d=c(a);b.rootObject.add(d),d.castShadow=!0,d.receiveShadow=!0,this.boundingBox=void 0,this._computeBoundingBox(),this.dataDirty=!0},_removeAllMeshes:function(){var a=[];this.rootObject.getDescendants(a);for(var b=0,c=a.length;c>b;++b){var d=a[b];d instanceof f.Mesh&&this.rootObject.remove(d)}this.dataDirty=!0,this.boundingBox=void 0},_setGlobalMaterial:function(a){if(this.globalMaterial!==a){var b=w.material(a);b&&(this.globalMaterial=a,this.rootObject.traverse(function(a){a instanceof f.Mesh&&(a.material=b)}),this._updateMaterial(),this.light.globalMaterial(b),this.dataDirty=!0)}return this},_computeBumpDensityAndAmplitude:function(a){if(!a.useDefaultBumpDensity){var b=2,c=.02;if(-1!==this.globalMaterial.indexOf("stainless steel")){if(this.boundingBox&&!this.boundingBox.empty()){var d=this.boundingBox.max.x-this.boundingBox.min.x,e=this.boundingBox.max.y-this.boundingBox.min.y,f=this.boundingBox.max.z-this.boundingBox.min.z,g=d*e+e*f+f*d;b=1e4/g,c=.2/b,.3>c&&(c/=2)}}else if(this.boundingBox&&!this.boundingBox.empty()){var h=this.boundingBox.getBoundingSphere();b=50*(1/h.radius)}a.bumpDensity=b,a.bumpAmplitude=c}},_updateMaterial:function(){var a=w.material(this.globalMaterial);if(a){"smooth"===this.shading&&a.shading!==f.SmoothShading?a.shading=f.SmoothShading:"flat"===this.shading&&a.shading!==f.FlatShading&&(a.shading=f.FlatShading),a.useEnvMap&&a.envMap!=this.environmentTexture&&(this.environmentTexture&&this.environmentTexture.hasOwnProperty("loaded")?(a.envMap=this.environmentTexture,a.needsUpdate=!0):this.environmentTexture||(a.needsUpdate=!0,a.envMap=null));var b=w.material("highlight");if(b&&a.color){var c=new f.Color(f.ColorKeywords.orange),d=c.getHSL(),e=d.h,g=d.s,h=new f.Color(a.color),i=h.getHSL(),j=.3;i.l>.35&&(j=.15),g=.6*g,c.setHSL(e,g,j),b.color=c}if(this._computeBumpDensityAndAmplitude(a),this.dataDirty=!0,!a.uniforms)return;var k=a.uniforms.radianceLogLuvCube_samp;k&&(k.value=this.radianceMap),k=a.uniforms.glossLogLuvCube_samp,k&&(k.value=this.irradianceMap),k=a.uniforms.irradianceLogLuvCube_0_fiu_samp,k&&(k.value=this.irradianceMap);var l=this.camera.matrixWorldInverse.elements;if(k=a.uniforms.viewDirection,k&&(k.value=new f.Vector3(-1*l[2],-1*l[6],-1*l[10])),k=a.uniforms.WorldIT){var m=new f.Vector3(1,0,0),n=-Math.PI/2,o=(new f.Matrix4).makeRotationAxis(m,n);k.value=o}if(k=a.uniforms.World){var m=new f.Vector3(1,0,0),n=-Math.PI/2,o=(new f.Matrix4).makeRotationAxis(m,n);k.value=o}}},_windowResizeHandler:function(){var a=this,b=function(){a.camera.aspect=a._getViewportWidth()/a._getViewportHeight(),a.camera.updateProjectionMatrix(),a.renderer&&a.renderer.setSize(a._getElementWidth(),a._getElementHeight()),a._renderingPipeline&&delete a._renderingPipeline,a.dataDirty=!0};return b},_setBackground:function(a){if(this.backgroundURL!==a){if(this.renderer&&this.renderer.setClearColor(0,0),this.backgroundURL)this._renderingPipeline.background(null,null),this.dataDirty=!0;else{var b=this;f.ImageUtils.loadTexture(a,void 0,function(a){b.bgCamera=new f.Camera,b.bgScene=new f.Scene,b.bgScene.add(b.bgCamera),b.bg=new f.Mesh(new f.PlaneGeometry(2,2,0),new f.MeshBasicMaterial({map:a})),b.bgScene.add(b.bg),b._renderingPipeline&&(b._renderingPipeline.background(b.bgScene,b.bgCamera),b.dataDirty=!0)})}this.backgroundURL=a}},_setEnvironment:function(a){if("string"==typeof a&&this.environment!==a)if(this.environment=a,""!==a){this.environmentTexture=new f.Texture;var b=[];this.environmentTexture.flipY=!1,this.environmentTexture.image=b;var c=new Image,d=this;c.onload=function(a){var c=a.target,e=document.createElement("canvas");e.width=c.width/3,e.height=c.height/2;for(var f=e.getContext("2d"),g=null,h=0,i=0;2>i;++i)for(var j=0;3>j;++j)f.drawImage(c,j*e.width,i*e.height,e.width,e.height,0,0,e.width,e.height),g=new Image,g.onload=function(a){if(6==++h){d.environmentTexture.needsUpdate=!0,d.environmentTexture.loaded=!0;var b=w.material(d.globalMaterial);b&&b.useEnvMap&&(b.envMap=d.environmentTexture,b.needsUpdate=!0)}},g.src=e.toDataURL("image/jpeg"),b.push(g)},c.src=this.environment}else{this.environmentTexture=null;var e=w.material(this.globalMaterial);e.envMap&&(e.envMap=null,e.needsUpdate=!0)}if(a instanceof Array&&2===a.length){var g=a[0].split(".").pop(),h=a[1].split(".").pop();g===h&&"dds"===g&&(this.environment=a,this.irradianceURL=a[0],this.radianceURL=a[1],this._loadReflectionMaps())}return this.dataDirty=!0,this},_setShading:function(a){this.shading!=a&&(this.shading=a,this.rootObject.traverse(function(b){b instanceof f.Mesh&&f.BufferGeometryUtils.updateNormals(b.geometry,a)}),this._updateMaterial(),this.dataDirty=!0)},_setCamera:function(a){if(a){var b=a.direction;b&&3===b.length&&(this.viewDir.set(b[0],b[1],b[2]),this.dataDirty=!0)}},_setOrbitMode:function(a){this.controls&&("xy"===a?this.controls.orbitMode=f.ViewControls.OrbitMode.XY:"x"===a?this.controls.orbitMode=f.ViewControls.OrbitMode.X:"y"===a&&(this.controls.orbitMode=f.ViewControls.OrbitMode.Y)),this.dataDirty=!0},_setTurntable:function(a){this.controls&&(this.turntable=a,this.controls.autoRotate=a),this.dataDirty=!0},_setBumpDensity:function(a){this.bumpDensity=a,this.dataDirty=!0},_computeBoundingBox:function(){this.boundingBox||(this.boundingBox=new f.Box3,this.boundingBox.setFromObject(this.rootObject),this._updateMaterial(),this.light.sceneBounds(this.boundingBox.getBoundingSphere()))},_home:function(){this._computeBoundingBox();var a=this.boundingBox.getBoundingSphere();this.camera.position=a.center.clone();var b=a.radius,c=45,d=b,e=this.renderer.domElement.width,f=this.renderer.domElement.height;if(e>0&&f>0){var g=e/f;g>0&&1>g&&(d/=g)}var h=d/Math.tan(c/2*Math.PI/180),i=this.viewDir.clone().normalize();this.camera.position.z+=h*i.z,this.camera.position.y+=h*i.y,this.camera.position.x+=h*i.x,this.camera.lookAt(a.center.clone());var h=this.camera.position.distanceTo(a.center);this.camera.near=.001*h,this.camera.far=h+a.radius,this.camera.updateProjectionMatrix(),this.controls.target=a.center.clone(),this.controls.pivot=a.center.clone(),this.light.sceneBounds(a),this.light.initialize(),this.dataDirty=!0,this.cameraDirty=!0},_lookAt:function(a,b,c){this.controls.lookAt(a,b,c),this.dataDirty=!0},_imageURL:function(a,b){var c=this.camera,d=this.controls,e=this._getElementWidth(),g=this._getElementHeight();this.camera=c.clone(),this.camera.aspect=a/b,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,b),this.controls=new f.ViewControls(this.camera,this.element),this._home(),this.controls.autoRotate=!1,this.renderer.clear(!0,!0,!0),this.renderer.render(this.scene,this.camera);var h=this.renderer.domElement.toDataURL("image/png");return this.camera=c,this.controls=d,this.renderer.setSize(e,g),this.dataDirty=!0,h},_suspend:function(){this.suspended=!0},_resume:function(){this.suspended=!1},_showErrorText:function(a){var b="background: -moz-linear-gradient(left, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.35) 65%, rgba(255,255,255,0) 100%);background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0.4)), color-stop(65%,rgba(255,255,255,0.35)), color-stop(100%,rgba(255,255,255,0)));background: -webkit-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%); background: -o-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);background: -ms-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);background: linear-gradient(to right, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);",c="position: absolute;bottom: -1px;padding: 5px;width: 100%;color: red;text-align: center; font-size: 16px;"+b;
this._showTextElement(a,"viewer_error_text",c)},_hideErrorText:function(){this._hideTextElement("viewer_error_text")},_showStatusText:function(a){var b="background: -moz-linear-gradient(left, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.35) 65%, rgba(255,255,255,0) 100%);background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0.4)), color-stop(65%,rgba(255,255,255,0.35)), color-stop(100%,rgba(255,255,255,0)));background: -webkit-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%); background: -o-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);background: -ms-linear-gradient(left, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);background: linear-gradient(to right, rgba(255,255,255,0.4) 0%,rgba(255,255,255,0.35) 65%,rgba(255,255,255,0) 100%);",c="position: absolute;bottom: -1px;padding: 5px;width: 100%;color: #494641;text-align: center; font-size: 16px;"+b;this._showTextElement(a,"viewer_status_text",c)},_hideStatusText:function(){this._hideTextElement("viewer_status_text")},_showTextElement:function(a,b,c){var d=u("#"+b);if(0===d.length){var e='<div id="'+b+'" style="'+c+'">'+a+"</div>";d=u(e);var f=this.element;f&&d.appendTo(f)}else d.text(a),d.show()},_hideTextElement:function(a){var b=u("#"+a);0!==b.length&&b.hide()},_showLoadingElement:function(a){var b=u("#viewer_loading");if(a)if(0===b.length){var c='<div id="viewer_loading" style="position:absolute;left:50%;top:50%;margin-left:-44px;width:88px;height:24px;line-height:24px;color:rgba(255,255,255,0.9);text-align:center;font-size:16px;background-color: rgba(0,0,0,0.2);-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;"> Loading... </div>';b=u(c);var d=this.element;d&&b.appendTo(d)}else b.show();else 0!==b.length&&b.hide()},_setDebug:function(a){if(a&&!this._monitor){var b=new D;b.domElement.style.position="fixed",b.domElement.style.left="0px",b.domElement.style.top="0px",document.body.appendChild(b.domElement),this._monitor=b}!a&&this._monitor&&(document.body.removeChild(this._monitor.domElement),delete this._monitor)},_getDebug:function(){return void 0!=this._monitor},_getDebugInfo:function(){if(!this._monitor)return void 0;var a={};return a.averageFps=this._monitor.fpsSum/this._monitor.fpsCount,a.minFps=this._monitor.fpsMin,a.maxFps=this._monitor.fpsMax,a.timeCost=(this._monitor.fpsEnd-this._monitor.fpsStart)/1e3,a.rendererInfo=this.renderer.info,JSON.stringify(a)},_loadReflectionMaps:function(){var a=this,b=function(){a._updateMaterial(),a.dataDirty=!0};this.irradianceMap=f.ImageUtils.loadCompressedTextureCube(this.irradianceURL,new f.CubeReflectionMapping,b),this.radianceMap=f.ImageUtils.loadCompressedTextureCube(this.radianceURL,new f.CubeReflectionMapping,b)}};var z=function(){this.parent=void 0,this.globalMaterial=""},A=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new y(a)}),Object.defineProperty(this,"globalMaterial",{get:function(){return this._impl.globalMaterial},set:function(a){this._impl._setGlobalMaterial(a)},enumerable:!0}),Object.defineProperty(this,"background",{get:function(){return this._impl.backgroundURL},set:function(a){this._impl._setBackground(a)},enumerable:!0}),Object.defineProperty(this,"environment",{get:function(){return this._impl.environment},set:function(a){this._impl._setEnvironment(a)},enumerable:!0}),Object.defineProperty(this,"camera",{set:function(a){this._impl._setCamera(a)},enumerable:!0}),Object.defineProperty(this,"highlightSet",{get:function(){return this._impl._highlightSet},enumerable:!1,configurable:!1}),Object.defineProperty(this,"errorText",{enumerable:!0,get:function(){return this._impl._errorText},set:function(a){void 0!==a&&"string"==typeof a&&this._impl._errorText!==a&&(this._impl._errorText=a,""===a?(this._impl._hideErrorText(),this._impl._statusText&&this._impl._showStatusText()):(this._impl._showErrorText(a),this._impl._statusText&&this._impl._hideStatusText()))}}),Object.defineProperty(this,"statusText",{enumerable:!0,get:function(){return this._impl._statusText},set:function(a){void 0!==a&&"string"==typeof a&&this._impl._statusText!==a&&(this._impl._statusText=a,""===a?this._impl._hideStatusText():this._impl._errorText||this._impl._showStatusText(a))}}),Object.defineProperty(this,"turntable",{get:function(){return this._impl.turntable},set:function(a){this._impl._setTurntable(a)},enumerable:!0}),Object.defineProperty(this,"showLoading",{set:function(a){this._impl._showLoadingElement(a)},enumerable:!1,configurable:!1}),Object.defineProperty(this,"ssao",{set:function(a){this._impl._enableSSAO(a)},enumerable:!1,configurable:!1}),Object.defineProperty(this,"shading",{set:function(a){this._impl._setShading(a)},enumerable:!1,configurable:!1}),Object.defineProperty(this,"debug",{set:function(a){this._impl._setDebug(a)},get:function(){return this._impl._getDebug()},enumerable:!1,configurable:!1}),Object.defineProperty(this,"debugInfo",{get:function(){return this._impl._getDebugInfo()},enumerable:!1,configurable:!1})};A.prototype={addMesh:function(a){return this._impl._addMesh(a),this},removeAllMeshes:function(){return this._impl._removeAllMeshes(),this},home:function(){return this._impl._home(),this},lookAt:function(a,b,c){return this._impl._lookAt(a,b,c),this},imageURL:function(a,b){return this._impl._imageURL(a,b)},suspend:function(){return this._impl._suspend(),this},resume:function(){return this._impl._resume(),this},refresh:function(){var a=this._impl._windowResizeHandler();return a(),this}},d.exports.Viewer=A;var B=function(a){this._renderer=a.renderer,this._scene=a.scene,this._camera=a.camera,this._bgScene=a.bgScene,this._bgCamera=a.bgCamera,this._rootObject=a.rootObject,this._windowWidth=a.width,this._windowHeight=a.height,this._highlightSet=a.highlightSet,this._ssao=null,this._ssaoRenderer=null,this._highlightRenderer=null};B.prototype={_getSSAORenderer:function(){if(!this._windowWidth||!this._windowHeight)return void 0;if(this._ssaoRenderer)return this._ssaoRenderer;var a={},b={minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat},c={minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBFormat},d=new f.WebGLRenderTarget(this._windowWidth,this._windowHeight,b),e=new f.WebGLRenderTarget(this._windowWidth,this._windowHeight,b);a.depthTarget=d,a.colorTarget=e,a.ssaoComposer=new f.EffectComposer(this._renderer,e),a.effectSSAO=new f.ShaderPass(f.SSAOShader),a.effectSSAO.uniforms.tDepth.value=d,a.effectSSAO.uniforms.aoClamp.value=.5,a.effectSSAO.uniforms.onlyAO.value=0,a.effectSSAO.uniforms.lumInfluence.value=.2,a.effectSSAO.enabled=!0,a.ssaoComposer.addPass(a.effectSSAO),a.effectFxaa=new f.ShaderPass(f.FXAAShader),a.ssaoComposer.addPass(a.effectFxaa),this.depthPlugin||(this.depthPlugin=new f.DepthPassPlugin,this.depthPlugin.enabled=!1,this._renderer.addPrePlugin(this.depthPlugin)),this.depthPlugin.renderTarget=d,a.renderToScreen=!0,a.outputColorTarget=null;var g=this;return a.render=function(a,b){var c=g._renderer;this.effectSSAO.uniforms.cameraNear.value=b.near,this.effectSSAO.uniforms.cameraFar.value=b.far,this.effectSSAO.uniforms.size.value.set(g._windowWidth,g._windowHeight),this.effectFxaa.uniforms.resolution.value.set(1/g._windowWidth,1/g._windowHeight),this.effectFxaa.renderToScreen=this.renderToScreen,this.renderToScreen||(this.outputColorTarget=this.ssaoComposer.renderTarget2),g._bgScene&&g._bgCamera&&(c.render(g._bgScene,g._bgCamera,this.ssaoComposer.renderTarget2,!0),c.autoClearColor=!1),g.depthPlugin.enabled=!0,g._renderer.render(a,b,this.ssaoComposer.renderTarget2,!0),g.depthPlugin.enabled=!1,this.ssaoComposer.render(g.scene,g.camera)},this._ssaoRenderer=a,a},_getHighlightRenderer:function(){if(!this._windowWidth||!this._windowHeight)return void 0;if(this._highlightRenderer)return this._highlightRenderer;var a={},b={minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,stencilBuffer:!1};a.renderTarget=new f.WebGLRenderTarget(this._windowWidth,this._windowHeight,b),a.renderModelComposer=new f.EffectComposer(this._renderer,a.renderTarget);var c=new f.RenderPass(this._scene,this._camera);a.renderModelComposer.addPass(c),a.highlightComposer=new f.EffectComposer(this._renderer,a.renderTarget),a.highlightComposer.renderTarget2.shareDepthFrom=a.renderModelComposer.renderTarget2;var d=new f.RenderPass(this._scene,this._camera);d.overrideMaterial=w.material("highlight"),a.highlightComposer.addPass(d);var e=new f.ShaderPass(f.HorizontalBlurShader),g=new f.ShaderPass(f.VerticalBlurShader);a.effectHorizBlur=e,a.effectVertiBlur=g,a.highlightComposer.addPass(e),a.highlightComposer.addPass(g),a.finalComposer=new f.EffectComposer(this._renderer,a.renderTarget);var h=new f.ShaderPass(f.AdditiveBlendShader);h.uniforms.fOpacity.value=1,h.renderToScreen=!0,a.effectBlend=h,a.finalComposer.addPass(h),a.inputColorTarget=void 0;var i=this;return a.render=function(b,c){var d=i._renderer;this.effectHorizBlur.uniforms.h.value=.5/i._windowWidth,this.effectVertiBlur.uniforms.v.value=.5/i._windowHeight,i._bgScene&&i._bgCamera&&(d.render(i._bgScene,i._bgCamera,this.renderModelComposer.renderTarget2,!0),d.autoClearColor=!1),this.renderModelComposer.render(),d.autoClearColor=!0,d.autoClearDepth=!1,i._rootObject.traverse(function(a){a instanceof f.Mesh&&(a._highlighted||(a.visible=!1))}),d.setClearColor(0,0),this.highlightComposer.render(),this.effectBlend.uniforms.tDiffuse1.value=this.inputColorTarget?this.inputColorTarget:a.renderModelComposer.renderTarget2,this.effectBlend.uniforms.tDiffuse2.value=a.highlightComposer.renderTarget2,this.finalComposer.render(),d.autoClearDepth=!0,i._rootObject.traverse(function(a){a instanceof f.Mesh&&(a._highlighted||(a.visible=!0))})},this._highlightRenderer=a,a},render:function(){if(this._windowWidth&&this._windowHeight){var a=this._scene,b=this._camera,c=this._ssao,d=this._highlightSet&&this._highlightSet.size()>0,e=this._renderer,f=this._bgScene&&this._bgCamera;if(e.autoClearColor=!0,e.clear(!0,!0,!0),!c&&!d)return f&&(e.render(this._bgScene,this._bgCamera),e.autoClearColor=!1),e.render(a,b),void 0;if(c){var g=this._getSSAORenderer();g&&(g.renderToScreen=!d,g.render(a,b))}if(d){var h=this._getHighlightRenderer();h&&(h.inputColorTarget=c?g.outputColorTarget:null,h.render(a,b))}}},highlightSet:function(a){this._highlightSet=a},SSAO:function(a){this._ssao=a},background:function(a,b){this._bgScene=a,this._bgCamera=b}},f.AdditiveBlendShader={uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},fOpacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform float fOpacity;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","vec3 additiveColor = vec3(0.0);","float alpha = texel1.a;","if(alpha==0.0 && texel2.a != 0.0){","additiveColor = vec3(0.1);","alpha = 0.01;","}","gl_FragColor = vec4(texel1.rgb  + additiveColor + (texel2 * fOpacity).rgb, alpha);","}"].join("\n")},f.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},f.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")};var C=function(a,b,c,d){this.viewer=d,this.Div=a.ownerDocument.createElement("div"),a.appendChild(this.Div),this.Div.setAttribute("style","background-color:#FFA500;float:right; width:"+b+"px; height:"+c+"px;"),this.currentItemDiv=null};C.prototype={createDisplayItem:function(a,b,c,d,e){this.currentItemDiv=this.Div.ownerDocument.createElement("div");var f=this.Div.ownerDocument.createElement("label");if(f.innerHTML=a,this.currentItemDiv.appendChild(f),f.setAttribute("style","float: none;"),b){var g=this.Div.ownerDocument.createElement(b);if(c)for(var h in c)g.setAttribute(h,c[h]);this.currentItemDiv.appendChild(g);var i=null;e&&(i=this.Div.ownerDocument.createElement("label"),i.setAttribute("style","float: none;display:inline"),i.setAttribute("id",c.hasOwnProperty("id")?c.id+"Val":a+"Val"),c.hasOwnProperty("value")&&(i.innerHTML=c.value),this.currentItemDiv.appendChild(i)),g.onchange=function(){i&&(i.innerHTML=g.value),d&&d(g.value)}}return this.Div.appendChild(this.currentItemDiv),this.currentItemDiv},appendDisplayItem:function(a,b,c){var d=this.Div.ownerDocument.createElement(a);if(b)for(var e in b)d.setAttribute(e,b[e]);return this.currentItemDiv.appendChild(d),d.onchange=function(){c&&c(d.value)},d},createDebugUIControls:function(){if(!this.initialized){var a=this.viewer,b=function(){var b=w.material(a.globalMaterial);a._computeBumpDensityAndAmplitude(b),document.getElementById("dir1Intensity").value=b.dirLight1?b.dirLight1:a.light.dirLight1.intensity,document.getElementById("dir1IntensityVal").innerHTML=b.dirLight1?b.dirLight1:a.light.dirLight1.intensity,document.getElementById("dir2Intensity").value=b.dirLight2?b.dirLight2:a.light.dirLight2.intensity,document.getElementById("dir2IntensityVal").innerHTML=b.dirLight2?b.dirLight2:a.light.dirLight2.intensity,document.getElementById("pointLight1Intensity").value=b.pointLight1?b.pointLight1:a.light.pointLight1.intensity,document.getElementById("pointLight1IntensityVal").innerHTML=b.pointLight1?b.pointLight1:a.light.pointLight1.intensity,document.getElementById("pointLight2Intensity").value=b.pointLight2?b.pointLight2:a.light.pointLight2.intensity,document.getElementById("pointLight2IntensityVal").innerHTML=b.pointLight2?b.pointLight2:a.light.pointLight2.intensity,document.getElementById("sky").value=b.skyLight?b.skyLight:a.light.skyLight.intensity,document.getElementById("skyVal").innerHTML=b.skyLight?b.skyLight:a.light.skyLight.intensity,document.getElementById("ambientLight").value=b.ambientLight?b.ambientLight:"0x"+a.ambientLight.color.getHexString(),document.getElementById("color").value="0x"+(b.color?b.color.getHexString():""),document.getElementById("specular").value="0x"+(b.specular?b.specular.getHexString():""),document.getElementById("reflection").value=b&&b.useEnvMap?b.reflectivity:0,document.getElementById("reflectionVal").innerHTML=b&&b.useEnvMap?b.reflectivity:0,document.getElementById("bumpDensity").value=b.bumpDensity},c={id:"material",value:a.globalMaterial,size:"15"};this.createDisplayItem("material","input",c,function(c){a._setGlobalMaterial(c),b(),a.dataDirty=!0});var d={id:"dir1Intensity",type:"range",min:"0.0",max:"1.0",step:"0.05"};this.createDisplayItem("light1","input",d,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("dirLight1")&&(c.dirLight1=parseFloat(b)),a.light.dirLight1.intensity=parseFloat(b),a.dataDirty=!0},!0),d.id="dir2Intensity",this.createDisplayItem("light2","input",d,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("dirLight2")&&(c.dirLight2=parseFloat(b)),a.light.dirLight2.intensity=parseFloat(b),a.dataDirty=!0},!0),d.id="pointLight1Intensity",this.createDisplayItem("pointlight1","input",d,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("pointLight1")&&(c.pointLight1=parseFloat(b)),a.light.pointLight1.intensity=parseFloat(b),a.dataDirty=!0},!0),d.id="pointLight2Intensity",this.createDisplayItem("pointlight2","input",d,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("pointLight2")&&(c.pointLight2=parseFloat(b)),a.light.pointLight2.intensity=parseFloat(b),a.dataDirty=!0},!0),d.id="sky",this.createDisplayItem("sky","input",d,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("skyLight")&&(c.skyLight=parseFloat(b)),a.light.skyLight.intensity=parseFloat(b),a.dataDirty=!0},!0),c.id="color",c.size="15",this.createDisplayItem("color","input",c,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("color")&&(c.color.set(parseInt(b)),c.ambient.set(parseInt(b)),a.dataDirty=!0)}),c.id="ambientLight",c.size="15",this.createDisplayItem("ambient","input",c,function(b){var c=w.material(a.globalMaterial);c.hasOwnProperty("ambientLight")&&(c.ambientLight=b),a.light.ambientLight.color.set(parseInt(b)),a.dataDirty=!0}),c.id="specular",c.size="15",this.createDisplayItem("specular","input",c,function(b){var c=w.material(a.globalMaterial);c.specular.set(parseInt(b)),a.dataDirty=!0}),d.id="reflection",d.style="float: none;width: 100px",this.createDisplayItem("reflection","input",d,function(b){var c=w.material(a.globalMaterial);c.reflectivity=b,a.dataDirty=!0},!0),c.id="bumpDensity",c.size="15",this.createDisplayItem("bumpDensity","input",c,function(b){var c=w.material(a.globalMaterial);c.bumpDensity=parseFloat(b),a.dataDirty=!0}),b(),this.initialized=!0}}};var D=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);n.children.length<74;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);r.children.length<74;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o)}var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}},t=function(a,b){var c=a.appendChild(a.firstChild);c.style.height=b+"px"};return{REVISION:11,domElement:k,setMode:s,fpsCount:0,fpsSum:0,begin:function(){a=Date.now()},end:function(){var j=Date.now();return c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")",t(r,Math.min(30,30-30*(c/200))),this.fpsCount||(this.fpsStart=b),this.fpsEnd=j,i++,j>b+500&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),this.fpsCount++,this.fpsSum+=f,this.fpsMin=g,this.fpsMax=h,m.textContent=f+" FPS ("+g+"-"+h+")",t(n,Math.min(30,30-30*(f/100))),b=j,i=0),j},update:function(){a=this.end()}}},E={initialize:function(){E._patchShaderToSupportProcedureTexture(),E._patchGeometryToAddCustomizedNormals(),E._patchMesh3DToBufferGeometry(),E._patchImageUtils(),E._patchSetFromObject()},_patchShaderToSupportProcedureTexture:function(){f.ShaderChunk.lights_phong_pars_vertex=f.ShaderChunk.lights_phong_pars_vertex+["","varying vec3 vTexCoord3D;","varying vec3 vObjectNormal;"].join("\n"),f.ShaderChunk.lights_phong_vertex=f.ShaderChunk.lights_phong_vertex+["","vTexCoord3D = worldPosition.xyz;","vObjectNormal = normal;"].join("\n"),f.ShaderChunk.lights_phong_pars_fragment=f.ShaderChunk.lights_phong_pars_fragment+["","#ifndef USE_BUMPMAP","varying vec3 vTexCoord3D;","varying vec3 vObjectNormal;","uniform float bumpDensity;","uniform float bumpAmplitude;","uniform int bumpType;","#extension GL_OES_standard_derivatives : enable","vec3 mod289(vec3 x)","{","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x)","{"," return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x)","{","  return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","vec3 fade(vec3 t) {","  return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise(vec3 P, vec3 rep)","{"," vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period","vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period","Pi0 = mod289(Pi0);","Pi1 = mod289(Pi1);","vec3 Pf0 = fract(P); // Fractional part for interpolation","vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","vec4 iy = vec4(Pi0.yy, Pi1.yy);","vec4 iz0 = Pi0.zzzz;","vec4 iz1 = Pi1.zzzz;","vec4 ixy = permute(permute(ix) + iy);","vec4 ixy0 = permute(ixy + iz0);","vec4 ixy1 = permute(ixy + iz1);","vec4 gx0 = ixy0 * (1.0 / 7.0);","vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","gx0 = fract(gx0);","vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","vec4 sz0 = step(gz0, vec4(0.0));","gx0 -= sz0 * (step(0.0, gx0) - 0.5);","gy0 -= sz0 * (step(0.0, gy0) - 0.5);","vec4 gx1 = ixy1 * (1.0 / 7.0);","vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","gx1 = fract(gx1);","vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","vec4 sz1 = step(gz1, vec4(0.0));","gx1 -= sz1 * (step(0.0, gx1) - 0.5);","gy1 -= sz1 * (step(0.0, gy1) - 0.5);","vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","g000 *= norm0.x;","g010 *= norm0.y;","g100 *= norm0.z;","g110 *= norm0.w;","vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","g001 *= norm1.x;","g011 *= norm1.y;","g101 *= norm1.z;","g111 *= norm1.w;","float n000 = dot(g000, Pf0);","float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","float n111 = dot(g111, Pf1);","vec3 fade_xyz = fade(Pf0);","vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); ","return 2.2 * n_xyz;","}","float stripes( float x, float f) {","float PI = 3.14159265358979323846264;","float t = .5 + .5 * sin( f * 2.0 * PI * x);","return t * t - .5;","}","float turbulence( vec3 p, float scale ) {","   float w = 100.0;","   float t = -1.5;","   for (float f = 1.0 ; f <= 1.0 ; f++ ){","       float power = pow( 2.0, f ) * scale;","       t += abs( pnoise( vec3( power * p ), vec3(0, 0, 0 ) ) / power );","   }","   return t;","}","vec3 perturbNormalArbEx( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","float snoise(vec3 v) {","const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 =   v - i + dot(i, C.xxx) ;","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy;","vec3 x3 = x0 - D.yyy;","i = mod289(i);","vec4 p = permute( permute( permute( i.z + vec4(0.0, i1.z, i2.z, 1.0 )) + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857;","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ );","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","m = m * m;","return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}","float cnoise(vec3 P)","{","vec3 Pi0 = floor(P); // Integer part for indexing","vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1","Pi0 = mod289(Pi0);","Pi1 = mod289(Pi1);","vec3 Pf0 = fract(P); // Fractional part for interpolation","vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0","vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);","vec4 iy = vec4(Pi0.yy, Pi1.yy);","vec4 iz0 = Pi0.zzzz;","vec4 iz1 = Pi1.zzzz;","vec4 ixy = permute(permute(ix) + iy);","vec4 ixy0 = permute(ixy + iz0);","vec4 ixy1 = permute(ixy + iz1);","vec4 gx0 = ixy0 * (1.0 / 7.0);","vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;","gx0 = fract(gx0);","vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);","vec4 sz0 = step(gz0, vec4(0.0));","gx0 -= sz0 * (step(0.0, gx0) - 0.5);","gy0 -= sz0 * (step(0.0, gy0) - 0.5);","vec4 gx1 = ixy1 * (1.0 / 7.0);","vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;","gx1 = fract(gx1);","vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);","vec4 sz1 = step(gz1, vec4(0.0));","gx1 -= sz1 * (step(0.0, gx1) - 0.5);","gy1 -= sz1 * (step(0.0, gy1) - 0.5);","vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);","vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);","vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);","vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);","vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);","vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);","vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);","vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);","vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));","g000 *= norm0.x;","g010 *= norm0.y;","g100 *= norm0.z;","g110 *= norm0.w;","vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));","g001 *= norm1.x;","g011 *= norm1.y;","g101 *= norm1.z;","g111 *= norm1.w;","float n000 = dot(g000, Pf0);","float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));","float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));","float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));","float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));","float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));","float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));","float n111 = dot(g111, Pf1);","vec3 fade_xyz = fade(Pf0);","vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);","vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);","float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);","return 2.2 * n_xyz;","}","#endif"].join("\n");var a="#endif",b=f.ShaderChunk.lights_phong_fragment;f.ShaderChunk.lights_phong_fragment=b.substr(0,b.indexOf(a)+a.length)+["","float diffuseFactor = 1.0;","float reflectionFactor = 1.0;","vec3 diffuseColor = diffuse;","#ifndef USE_BUMPMAP","if (bumpType == 1) { // generate bumps for plastic","float tol = 0.01;","float ntol = 0.0;","float noise0 = turbulence(vTexCoord3D, bumpDensity);","float noise1 = turbulence(vec3(vTexCoord3D.x + tol, vTexCoord3D.y, vTexCoord3D.z), bumpDensity);","float noise2 = turbulence(vec3(vTexCoord3D.x, vTexCoord3D.y + tol, vTexCoord3D.z), bumpDensity);","float noise3 = turbulence(vec3(vTexCoord3D.x, vTexCoord3D.y, vTexCoord3D.z + tol), bumpDensity);","vec3 df = vec3(0.1 * (noise1-noise0)/tol, 0.1 * (noise2-noise0)/tol, 0.1 * (noise3-noise0)/tol);","normal = vec3(normal.x - df.x, normal.y - df.y, normal.z - df.z);","normal = normalize(normal);","}","else if (bumpType == 2) { //generate bumps for stainless steel","}","else if (bumpType == 3) {","float noise = min(1.0, 0.3 + pnoise(vTexCoord3D * vec3(bumpDensity,bumpDensity,bumpDensity),vec3(300.0))) * bumpAmplitude;","normal = perturbNormalArbEx(-vViewPosition, normal, vec2(noise, noise));","}","else if (bumpType == 4){","float noise = cnoise(vec3(vTexCoord3D.x * bumpDensity, vTexCoord3D.y * bumpDensity, vTexCoord3D.z * bumpDensity));","normal = perturbNormalArbEx(-vViewPosition, normal, vec2(noise * 0.005, noise * 0.005));","}","else if (bumpType == 5){","float noise = snoise(vec3(vTexCoord3D.x * bumpDensity, vTexCoord3D.y * bumpDensity, vTexCoord3D.z * bumpDensity)) * bumpAmplitude;","normal = perturbNormalArbEx(-vViewPosition, normal, vec2(noise * 0.005, noise * 0.005));","}","#endif",""].join("\n")+b.substr(b.indexOf(a)+a.length)},_patchGeometryToAddCustomizedNormals:function(){f.Geometry.prototype.computeCustomizedNormals=function(){var a,b,c,d,e,g;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),g=this.__tmpVertices,a=0,b=this.vertices.length;b>a;a++)g[a]=new f.Vector3,g[a].normals=[];for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],e.vertexNormals=[new f.Vector3,new f.Vector3,new f.Vector3]}else for(g=this.__tmpVertices,a=0,b=this.vertices.length;b>a;a++)g[a].set(0,0,0),g[a].normals=[];for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],g[e.a].add(e.normal),g[e.a].normals.push(e.normal.normalize()),g[e.b].add(e.normal),g[e.b].normals.push(e.normal.normalize()),g[e.c].add(e.normal),g[e.c].normals.push(e.normal.normalize());for(a=0,b=this.vertices.length;b>a;a++)g[a].normalize();var h=function(a,b){for(var c=a.clone(),d=!1,e=0,f=b.length;f>e;++e)if(d||!a.equals(b[e])){var g=Math.abs(a.angleTo(b[e]));(g<15*Math.PI/180&&g>=0||g>75*Math.PI/180&&g<105*Math.PI/180)&&c.add(b[e])}else d=!0;return c};for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],e.vertexNormals[0].copy(h(e.normal,g[e.a].normals)),e.vertexNormals[1].copy(h(e.normal,g[e.b].normals)),e.vertexNormals[2].copy(h(e.normal,g[e.c].normals))
}},_patchMesh3DToBufferGeometry:function(){f.BufferGeometryUtils={},f.BufferGeometryUtils.createBufferGeometry=function(a,b){var c=new f.BufferGeometry;c._vertices=a,c._triangles=b;var d=b.length/3;c.attributes={index:{itemSize:1,array:new Uint16Array(3*d)},position:{itemSize:3,array:new Float32Array(3*3*d)},normal:{itemSize:3,array:new Float32Array(3*3*d)}};for(var e=21845,g=c.attributes.index.array,h=0;h<g.length;h++)g[h]=h%(3*e);for(var i=c.attributes.position.array,j=c.attributes.normal.array,k=new f.Vector3,l=new f.Vector3,m=new f.Vector3,n=new f.Vector3,o=new f.Vector3,p=0,q=0,r,s,t,u,h=0;d>h;h+=1){p=3*3*h,q=3*h,u=b[q],r=a[3*u],s=a[3*u+1],t=a[3*u+2],k.set(r,s,t),i[p]=r,i[p+1]=s,i[p+2]=t,u=b[q+1],r=a[3*u],s=a[3*u+1],t=a[3*u+2],l.set(r,s,t),i[p+3]=r,i[p+4]=s,i[p+5]=t,u=b[q+2],r=a[3*u],s=a[3*u+1],t=a[3*u+2],m.set(r,s,t),i[p+6]=r,i[p+7]=s,i[p+8]=t,n.subVectors(m,l),o.subVectors(k,l),n.cross(o),n.normalize();var v=n.x,w=n.y,x=n.z;j[p]=v,j[p+1]=w,j[p+2]=x,j[p+3]=v,j[p+4]=w,j[p+5]=x,j[p+6]=v,j[p+7]=w,j[p+8]=x}c.offsets=[];for(var y=d/e,h=0;y>h;h++){var z={start:3*h*e,index:3*h*e,count:3*Math.min(d-h*e,e)};c.offsets.push(z)}return c},f.BufferGeometryUtils.computeVerticsNormal=function(a){for(var b=a._vertices,c=a._triangles,d=new Float32Array(b.length),e,g,h,i,j,k,l=new f.Vector3,m=new f.Vector3,n=new f.Vector3,o=new f.Vector3,p=new f.Vector3,q=0,r=c.length;r>q;q+=3)e=c[q],g=c[q+1],h=c[q+2],i=b[3*e],j=b[3*e+1],k=b[3*e+2],l.set(i,j,k),i=b[3*g],j=b[3*g+1],k=b[3*g+2],m.set(i,j,k),i=b[3*h],j=b[3*h+1],k=b[3*h+2],n.set(i,j,k),o.subVectors(n,m),p.subVectors(l,m),o.cross(p),o.normalize(),d[3*e]+=o.x,d[3*e+1]+=o.y,d[3*e+2]+=o.z,d[3*g]+=o.x,d[3*g+1]+=o.y,d[3*g+2]+=o.z,d[3*h]+=o.x,d[3*h+1]+=o.y,d[3*h+2]+=o.z;for(q=0,r=c.length;r>q;q+=3)o.set(d[q],d[q+1],d[q+2]),o.normalize(),d[q]=o.x,d[q+1]=o.y,d[q+2]=o.z;a._normals=d},f.BufferGeometryUtils.updateNormals=function(a,b){if("smooth"===b){a._normals||f.BufferGeometryUtils.computeVerticsNormal(a);for(var c=a.attributes.normal.array,d=a._normals,e=a._triangles,g,h,i=0,j=e.length;j>i;i+=3)g=9*Math.floor(i/3),h=e[i],c[g]=d[3*h],c[g+1]=d[3*h+1],c[g+2]=d[3*h+2],h=e[i+1],c[g+3]=d[3*h],c[g+4]=d[3*h+1],c[g+5]=d[3*h+2],h=e[i+2],c[g+6]=d[3*h],c[g+7]=d[3*h+1],c[g+8]=d[3*h+2];delete a._normals}else for(var k=a.attributes.position.array,c=a.attributes.normal.array,l=new f.Vector3,m=new f.Vector3,n=new f.Vector3,o=new f.Vector3,p=new f.Vector3,q=0,g=0,r,s,t,u,i=0,j=k.length/9;j>i;i+=1){q=3*3*i,r=k[q],s=k[q+1],t=k[q+2],l.set(r,s,t),r=k[q+3],s=k[q+4],t=k[q+5],m.set(r,s,t),r=k[q+6],s=k[q+7],t=k[q+8],n.set(r,s,t),o.subVectors(n,m),p.subVectors(l,m),o.cross(p),o.normalize();var v=o.x,w=o.y,x=o.z;c[q]=v,c[q+1]=w,c[q+2]=x,c[q+3]=v,c[q+4]=w,c[q+5]=x,c[q+6]=v,c[q+7]=w,c[q+8]=x}a.attributes.normal.needsUpdate=!0}},_patchImageUtils:function(){f.ImageUtils.loadCompressedTextureCube=function(a,b,c,d){var e=[];e.loadCount=0;var g=new f.CompressedTexture;g.image=e,void 0!==b&&(g.mapping=b),g.flipY=!1,g.generateMipmaps=!1;var h=function(a,b){return function(){var d=a.response,h=f.ImageUtils.parseDDS(d,!0);b.format=h.format,b.mipmaps=h.mipmaps,b.width=h.width,b.height=h.height,e.loadCount+=1,6===e.loadCount&&(g.format=h.format,g.needsUpdate=!0,1==h.mipmapCount&&(g.minFilter=f.LinearFilter),g.needsUpdate=!0,c&&c(g))}};if(a instanceof Array)for(var i=0,j=a.length;j>i;++i){var k={};e[i]=k;var l=new XMLHttpRequest;l.onload=h(l,k),l.onerror=d;var m=a[i];l.open("GET",m,!0),l.responseType="arraybuffer",l.send(null)}else{var m=a,l=new XMLHttpRequest;l.onload=function(){var a=l.response,b=f.ImageUtils.parseDDS(a,!0);if(b.isCubemap){for(var d=b.mipmaps.length/b.mipmapCount,h=0;d>h;h++){e[h]={mipmaps:[]};for(var i=0;i<b.mipmapCount;i++)e[h].mipmaps.push(b.mipmaps[h*b.mipmapCount+i]),e[h].format=b.format,e[h].width=b.width,e[h].height=b.height}g.format=b.format,g.needsUpdate=!0,1==b.mipmapCount&&(g.minFilter=f.LinearFilter),g.needsUpdate=!0,c&&c(g)}},l.onerror=d,l.open("GET",m,!0),l.responseType="arraybuffer",l.send(null)}return g},f.ImageUtils.loadDDSTexture=function(a,b,c,d){var e=[];e.loadCount=0;var g=new f.CompressedTexture;g.image=e,void 0!==b&&(g.mapping=b),g.flipY=!1,g.generateMipmaps=!1;var h=new XMLHttpRequest;return h.onload=function(){var a=h.response,b=f.ImageUtils.parseDDS(a,!0);if(b.isCubemap)for(var d=b.mipmaps.length/b.mipmapCount,i=0;d>i;i++){e[i]={mipmaps:[]};for(var j=0;j<b.mipmapCount;j++)e[i].mipmaps.push(b.mipmaps[i*b.mipmapCount+j]),e[i].format=b.format,e[i].width=b.width,e[i].height=b.height}else g.image.width=b.width,g.image.height=b.height,g.mipmaps=b.mipmaps;g.format=b.format,g.type=b.type,1==b.mipmapCount&&(g.minFilter=f.LinearFilter),g.needsUpdate=!0,c&&c(g)},h.onerror=d,h.open("GET",a,!0),h.responseType="arraybuffer",h.send(null),g}},_patchSetFromObject:function(){f.Box3.prototype.setFromObject=function(){var a=new f.Vector3;return function(b){var c=this;return b.updateMatrixWorld(!0),this.makeEmpty(),b.traverse(function(b){if(void 0!==b.geometry&&void 0!==b.geometry.vertices)for(var d=b.geometry.vertices,e=b.matrixWorld,f=0,g=d.length;g>f;f++)a.copy(d[f]),a.applyMatrix4(e),c.expandByPoint(a);else if(void 0!==b.geometry&&void 0!==b.geometry.attributes&&void 0!==b.geometry.attributes.position)for(var h=b.geometry._vertices?b.geometry._vertices:b.geometry.attributes.position.array,d=b.geometry.vertices,e=b.matrixWorld,f=0,i=h.length;i>f;f+=3)a.set(h[f],h[f+1],h[f+2]),a.applyMatrix4(e),c.expandByPoint(a)}),this}}()}},F={};F._prismOpaque=function(a,b,c){var d=["precision highp int;","","#define VTX_SHADER","//=========================================================","//         OGSFX Copyright (c) 2013 Autodesk, Inc. ","//=========================================================","","","//----------------","//Global block ","//----------------","","#ifdef PIX_SHADER","","    #extension GL_OES_standard_derivatives : enable","#endif",""," precision highp float;","","","//----------------","//OGS Standard Library Block ","#define lerp mix","#define atan2 atan","#ifndef GL_ES","#define texture2D  texture","#define texture1D  texture","#define textureCube texture","#define texture3D  texture","#define texture2DLod textureLod","#define texture1DLod textureLod","#define textureCubeLod textureLod","#define texture3DLod textureLod","#endif","vec4 mul (in vec4 matx[4],in vec4 v)","{","mat4 tmpMtx=mat4(matx[0],matx[1],matx[2],matx[3]);","return tmpMtx*v;","}","vec4 mul (in vec4 v,in vec4 matx[4])","{","vec4 retVal;","retVal.x=dot(matx[0],v);","retVal.y=dot(matx[1],v);","retVal.z=dot(matx[2],v);","retVal.w=dot(matx[3],v);","return retVal;","}","vec3 mul (in vec3 matx[3],in vec3 v)","{","mat3 tmpMtx=mat3(matx[0],matx[1],matx[2]);","return tmpMtx*v;","}","vec3 mul (in vec3 v,in vec3 matx[3])","{","vec3 retVal;","retVal.x=dot(matx[0],v);","retVal.y=dot(matx[1],v);","retVal.z=dot(matx[2],v);","return retVal;","}","vec3 mul (in vec4 matx[4],in vec3 v)","{","return mul(matx,vec4(v,0.0)).xyz;","}","vec3 mul (in vec3 v, in vec4 matx[4])","{","return mul(vec4(v,0.0),matx).xyz;","}","void transpose (in vec4 matx[4], out vec4 matOut[4])","{","matOut[0].x=matx[0].x;","matOut[0].y=matx[1].x;","matOut[0].z=matx[2].x;","matOut[0].w=matx[3].x;","matOut[1].x=matx[0].y;","matOut[1].y=matx[1].y;","matOut[1].z=matx[2].y;","matOut[1].w=matx[3].y;","matOut[2].x=matx[0].z;","matOut[2].y=matx[1].z;","matOut[2].z=matx[2].z;","matOut[2].w=matx[3].z;","matOut[3].x=matx[0].w;","matOut[3].y=matx[1].w;","matOut[3].z=matx[2].w;","matOut[3].w=matx[3].w;","}","void transpose (in vec3 matx[3], out vec3 matOut[3])","{","matOut[0].x=matx[0].x;","matOut[0].y=matx[1].x;","matOut[0].z=matx[2].x;","matOut[1].x=matx[0].y;","matOut[1].y=matx[1].y;","matOut[1].z=matx[2].y;","matOut[2].x=matx[0].z;","matOut[2].y=matx[1].z;","matOut[2].z=matx[2].z;","}","vec4 lit(in float NdotL , in float NdotH , in float m )","{","float spec = (NdotL > 0.0) ? pow(max(0.0, NdotH), m) : 0.0;","return vec4(1.0, max(0.0, NdotL), spec, 1.0);","}","float saturate (in float v)","{","return clamp(v,0.0,1.0);","}","vec3 saturate(in vec3 v)","{","#ifdef GL_ES","return vec3(saturate(v.x),saturate(v.y), saturate(v.z));","#else","return clamp(v,0.0,1.0);","#endif","}","float fmod(float x, float y)","{","return x - y * floor(x/y);","}","vec4 saturate (in vec4 v)","{","#ifdef GL_ES","return vec4(saturate(v.x),saturate(v.y), saturate(v.z),saturate(v.w));","#else","return clamp(v,0.0,1.0);","#endif","}","#ifdef PIX_SHADER","void clip( in float x )","{","if (x < 0.0)","discard;","}","void clip( in vec2 v )","{","bvec2 r=lessThan(v,vec2(0.0,0.0));","if(any(r)) discard;","}","void clip( in vec3 v )","{","bvec3 r=lessThan(v,vec3(0.0,0.0,0.0));","if(any(r)) discard;","}","void clip( in vec4 v )","{","bvec4 r=lessThan(v,vec4(0.0,0.0,0.0,0.0));","if(any(r)) discard;","}","const mat3 InverseM = mat3(6.0014, -2.7008, -1.7996,","-1.3320,  3.1029, -5.7721,","0.3008, -1.0882,  5.6268);","#endif","","//----------------","","//----------------","//Autogenerated uniform code:","//----------------","struct irradiance {vec3 diffuseI;","vec3 specularI;","vec3 L;","float shadowFrac;","};","uniform   mat4 World;","uniform   vec3 viewDirection;","uniform  bool localviewer;","uniform   mat4 WorldIT;","uniform   float DepthPriority;","uniform   vec3 SurfaceDiffuse_value;","uniform   int SurfaceNDF_value;","uniform   float SurfaceRough_value;","uniform   float SurfaceAniso_value;","uniform  bool flag;","uniform   float SurfaceRotation_value;","uniform   float SurfaceReflect_value;","uniform   vec3 SurfaceAlbedo_value;","uniform  samplerCube irradianceLogLuvCube_0_fiu_samp;","uniform   mat4 irradianceLogLuvCube_0_fiu_transform;","uniform  bool irradianceLogLuvCube_0_fiu_isLogLuv;","uniform   vec3 irradianceLogLuvCube_0_fiu_gain;","uniform  samplerCube glossLogLuvCube_samp;","uniform   mat4 glossLogLuvCube_transform;","uniform   float glossLogLuvCube_reflectionCoeff;","uniform  bool glossLogLuvCube_isLogLuv;","uniform   vec3 glossLogLuvCube_gain;","uniform  samplerCube radianceLogLuvCube_samp;","uniform   mat4 radianceLogLuvCube_transform;","uniform   float radianceLogLuvCube_reflectionCoeff;","uniform  bool radianceLogLuvCube_isLogLuv;","uniform   vec3 radianceLogLuvCube_gain;","uniform   float cutout;","uniform   float opacity;","uniform   int alphaTestFunc;","uniform   float alphaTestRef;","","//=============================","//      In attributes","//=============================","//=============================","//      Out attributes","//=============================","varying vec3 io_1188_VwLocal;","varying vec3 io_1191_Nw;","varying vec3 io_1192_Vw;","varying vec3 vWorldPosition;","//======================================","// FX file :MAINFX","// FX line :170","//======================================","// Vertex shader block:testShaderName_VS","","","","vec3 iVwLocal(in vec3 position, in vec3 Ew, in mat4 world, in vec3 viewDir, in bool localViewer )","{"," vec4 Pw = ( world * vec4(position,1.0) );"," return localViewer ? normalize( Ew - Pw.xyz ) : -viewDir;","}","","","vec3 iNw(in vec3 nm, in mat4 worldITC)","{"," return ( worldITC * vec4(nm,0.0) ).xyz;","}","","vec3 iVw( in vec3 position, in vec3 Ew, in mat4 world )","{"," vec4 Pw = ( world * vec4(position,1.0) );"," return Ew - Pw.xyz;","}","","vec4 iPcPriority(in vec3 pm, in float depthPriority, in mat4 worldViewProjectionC)","{"," vec4 P = ( worldViewProjectionC * vec4(pm,1.0) );"," P.z -= P.w * 2.0 * depthPriority;"," return P;","}","","",""," ","void main()"," {",""," "," io_1188_VwLocal = iVwLocal( position, cameraPosition, World, viewDirection, localviewer );"," io_1191_Nw = iNw( normal, WorldIT );"," io_1192_Vw = iVw( position, cameraPosition, World );"," vec4 pos = modelViewMatrix * vec4(position, 1.0); vWorldPosition = pos.xyz/pos.w;"," vec4 mvpPosition = projectionMatrix*(modelViewMatrix*vec4(position,1.0)); mvpPosition.z -= mvpPosition.w * 2.0 * DepthPriority; gl_Position = mvpPosition;"," "," }"].join("\n"),e=["precision highp int;","#define PIX_SHADER","//=========================================================","//         OGSFX Copyright (c) 2013 Autodesk, Inc. ","//=========================================================","","","//----------------","//Global block ","//----------------","","#ifdef PIX_SHADER","","    #extension GL_OES_standard_derivatives : enable","#endif",""," precision highp float;","","","//----------------","//OGS Standard Library Block ","#define lerp mix","#define atan2 atan","#ifndef GL_ES","#define texture2D  texture","#define texture1D  texture","#define textureCube texture","#define texture3D  texture","#define texture2DLod textureLod","#define texture1DLod textureLod","#define textureCubeLod textureLod","#define texture3DLod textureLod","#endif","","vec4 iPcPriority(in vec3 pm, in float depthPriority, in mat4 worldViewProjectionC)","{","vec4 P = worldViewProjectionC * vec4(pm,1.0);","P.z -= P.w * 2.0 * depthPriority;","return P;","}","vec4 mul (in vec4 matx[4],in vec4 v)","{","mat4 tmpMtx=mat4(matx[0],matx[1],matx[2],matx[3]);","return tmpMtx*v;","}","vec4 mul (in vec4 v,in vec4 matx[4])","{","vec4 retVal;","retVal.x=dot(matx[0],v);","retVal.y=dot(matx[1],v);","retVal.z=dot(matx[2],v);","retVal.w=dot(matx[3],v);","return retVal;","}","vec3 mul (in vec3 matx[3],in vec3 v)","{","mat3 tmpMtx=mat3(matx[0],matx[1],matx[2]);","return tmpMtx*v;","}","vec3 mul (in vec3 v,in vec3 matx[3])","{","vec3 retVal;","retVal.x=dot(matx[0],v);","retVal.y=dot(matx[1],v);","retVal.z=dot(matx[2],v);","return retVal;","}","vec3 mul (in vec4 matx[4],in vec3 v)","{","return mul(matx,vec4(v,0.0)).xyz;","}","vec3 mul (in vec3 v, in vec4 matx[4])","{","return mul(vec4(v,0.0),matx).xyz;","}","void transpose (in vec4 matx[4], out vec4 matOut[4])","{","matOut[0].x=matx[0].x;","matOut[0].y=matx[1].x;","matOut[0].z=matx[2].x;","matOut[0].w=matx[3].x;","matOut[1].x=matx[0].y;","matOut[1].y=matx[1].y;","matOut[1].z=matx[2].y;","matOut[1].w=matx[3].y;","matOut[2].x=matx[0].z;","matOut[2].y=matx[1].z;","matOut[2].z=matx[2].z;","matOut[2].w=matx[3].z;","matOut[3].x=matx[0].w;","matOut[3].y=matx[1].w;","matOut[3].z=matx[2].w;","matOut[3].w=matx[3].w;","}","void transpose (in vec3 matx[3], out vec3 matOut[3])","{","matOut[0].x=matx[0].x;","matOut[0].y=matx[1].x;","matOut[0].z=matx[2].x;","matOut[1].x=matx[0].y;","matOut[1].y=matx[1].y;","matOut[1].z=matx[2].y;","matOut[2].x=matx[0].z;","matOut[2].y=matx[1].z;","matOut[2].z=matx[2].z;","}","vec4 lit(in float NdotL , in float NdotH , in float m )","{","float spec = (NdotL > 0.0) ? pow(max(0.0, NdotH), m) : 0.0;","return vec4(1.0, max(0.0, NdotL), spec, 1.0);","}","float saturate (in float v)","{","return clamp(v,0.0,1.0);","}","vec3 saturate(in vec3 v)","{","#ifdef GL_ES","return vec3(saturate(v.x),saturate(v.y), saturate(v.z));","#else","return clamp(v,0.0,1.0);","#endif","}","float fmod(float x, float y)","{","return x - y * floor(x/y);","}","vec4 saturate (in vec4 v)","{","#ifdef GL_ES","return vec4(saturate(v.x),saturate(v.y), saturate(v.z),saturate(v.w));","#else","return clamp(v,0.0,1.0);","#endif","}","#ifdef PIX_SHADER","void clip( in float x )","{","if (x < 0.0)","discard;","}","void clip( in vec2 v )","{","bvec2 r=lessThan(v,vec2(0.0,0.0));","if(any(r)) discard;","}","void clip( in vec3 v )","{","bvec3 r=lessThan(v,vec3(0.0,0.0,0.0));","if(any(r)) discard;","}","void clip( in vec4 v )","{","bvec4 r=lessThan(v,vec4(0.0,0.0,0.0,0.0));","if(any(r)) discard;","}","const mat3 InverseM = mat3(6.0014, -2.7008, -1.7996,","-1.3320,  3.1029, -5.7721,","0.3008, -1.0882,  5.6268);","#endif","","//----------------","","//----------------","//Autogenerated uniform code:","//----------------","struct irradiance {vec3 diffuseI;","vec3 specularI;","vec3 L;","float shadowFrac;","};","uniform   mat4 World;","uniform   vec3 viewDirection;","uniform  bool localviewer;","uniform   mat4 WorldIT;","uniform   float DepthPriority;","uniform   vec3 SurfaceDiffuse_value;","uniform   int SurfaceNDF_value;","uniform   float SurfaceRough_value;","uniform   float SurfaceAniso_value;","uniform  bool flag;","uniform   float SurfaceRotation_value;","uniform   float SurfaceReflect_value;","uniform   vec3 SurfaceAlbedo_value;","uniform  samplerCube irradianceLogLuvCube_0_fiu_samp;","uniform   mat4 irradianceLogLuvCube_0_fiu_transform;","uniform  bool irradianceLogLuvCube_0_fiu_isLogLuv;","uniform   vec3 irradianceLogLuvCube_0_fiu_gain;","uniform  samplerCube glossLogLuvCube_samp;","uniform   mat4 glossLogLuvCube_transform;","uniform   float glossLogLuvCube_reflectionCoeff;","uniform  bool glossLogLuvCube_isLogLuv;","uniform   vec3 glossLogLuvCube_gain;","uniform  samplerCube radianceLogLuvCube_samp;","uniform   mat4 radianceLogLuvCube_transform;","uniform   float radianceLogLuvCube_reflectionCoeff;","uniform  bool radianceLogLuvCube_isLogLuv;","uniform   vec3 radianceLogLuvCube_gain;","uniform   float cutout;","uniform   float opacity;","uniform   int alphaTestFunc;","uniform   float alphaTestRef;","","//=============================","//      In attributes","//=============================","varying vec3 io_1188_VwLocal;","varying vec3 io_1191_Nw;","varying vec3 io_1192_Vw;","varying vec3 vWorldPosition;","","//=============================","//      Out attributes","//=============================","varying vec4 ColorOut;","//======================================","// FX file :MAINFX","// FX line :526","//======================================","// Pixel shader block:testShaderName","","","","vec3 PassFloat3( in vec3 value )","{"," return value;","}","","vec3 DiffuseLobe(in vec3 diffuseColor)","{"," const float PI = 3.141592654;"," return diffuseColor / PI;","}","","int PassInt( int value )","{"," return value;","}","","float PassFloat( float value )","{"," return value;","}","","vec3 RoughnessToAlpha(int ndfType, in float roughness, in float anisotropy)","{"," vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);"," alpha = alpha * alpha;"," float limit = ndfType == 0 ? 0.7 : 1.0;"," alpha = clamp(alpha, 0.001, limit);"," float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);"," return vec3(alpha, alpha2);","}","","irradiance nullLight( )","{"," irradiance irrad;"," irrad.diffuseI = vec3(0.0, 0.0, 0.0);"," irrad.specularI = vec3(0.0, 0.0, 0.0);"," irrad.L = vec3(0.0, 0.0, 1.0);"," irrad.shadowFrac = 1.0 ;"," return irrad;","}","","vec3 VwLocal( in vec3 iVwLocal )","{"," return normalize( iVwLocal );","}","","vec3 HVector( in vec3 L, in vec3 V )","{"," return normalize( L + V );","}","","vec3 Tw( in vec3 iTw )","{"," return normalize( iTw );","}","","vec3 Bw( in vec3 iBw )","{"," return normalize( iBw );","}","","vec3 Nw( in vec3 iNw )","{"," return normalize( iNw );","}","","vec3 faceForwardCond( in vec3 Nw, in vec3 Vw, in bool flag )","{"," return flag ? faceforward(Nw, -Vw, Nw) : Nw;","}","","vec4 shaderGeom2( in vec3 N, in vec3 L, in vec3 V, in vec3 H )","{"," float NL = dot(N, L);"," float NV = dot(N, V);"," float NH = dot(N, H);"," float VH = dot(V, H);"," return vec4( NL, NV, NH, VH );","}","","vec3 HVector_Local(in vec3 H, in vec3 Tw, in vec3 Bw, in vec4 NL_NV_NH_VH)","{"," float Hu = dot(H, Tw);"," float Hv = dot(H, Bw);"," return vec3(Hu, Hv, NL_NV_NH_VH.z);","}","","vec3 Rotate_Z(in vec3 vec, in float value)","{"," float s, c;"," s = sin(value);"," c = cos(value);"," return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);","}","","float NDF_GGX(in vec3 alpha, in vec3 normal)","{"," const float PI = 3.141592654;"," float nx2 = normal.x * normal.x;"," float ny2 = normal.y * normal.y;"," float nz2 = normal.z * normal.z;"," float scale = 1.0 / (alpha.x * alpha.y * PI);"," float xyz = nx2 / (alpha.x * alpha.x) + ny2 / (alpha.y * alpha.y) + nz2;"," return scale / (xyz * xyz);","}","","float xOfFloat4(in vec4 value)","{"," return value.x;","}","","float aSqrd(in vec3 alpha, in float cosTheta)","{"," float tan2 = 1.0 / (cosTheta * cosTheta) - 1.0;"," return alpha.z * tan2;","}","","float G1_GGX(float aSqrd)","{"," return 2.0 / (1.0 + sqrt(1.0 + aSqrd));","}","","float yOfFloat4(in vec4 value)","{"," return value.y;","}","","float EvaluateG(float g_NL, float g_NV)","{"," return g_NL * g_NV;","}","","vec3 f_to_f3(in float f)","{"," return vec3(f, f, f);","}","","float wOfFloat4(in vec4 value)","{"," return value.w;","}","","vec3 Fresnel_Schlick(in vec3 f0, in float cosAngle)","{"," float x = 1.0 - cosAngle;"," float x2 = x * x;"," vec3 f = f0 + (1.0 - f0) * (x * x2 * x2);"," return f;","}","","vec3 MicrofacetLobe(in float D, in float G, in vec3 F, in vec4 NL_NV_NH_VH)","{"," return D * G * F / (4.0 * NL_NV_NH_VH.x * NL_NV_NH_VH.y);","}","","vec3 BRDF_Opaque(in vec3 diffuse, in vec3 specular, in vec3 albedo, in vec3 radiance, in vec4 NL_NV_NH_VH)","{"," return radiance * NL_NV_NH_VH.x * (diffuse + specular * albedo);","}","","vec3 SampleCubeNormalLogLuv(samplerCube samp, mat4 transform, vec3 normal, bool isLogLuv)","{","if(isLogLuv){"," vec4 vLogLuv = textureCube(samp, (transform * vec4(normal,0.0)).xyz);","float Le = vLogLuv.b * 255.0 + vLogLuv.a;","vec3 Xp_Y_XYZp;","Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.g;","Xp_Y_XYZp.x = vLogLuv.r * Xp_Y_XYZp.z;","vec3 vRGB = InverseM * Xp_Y_XYZp;","return max(vRGB, vec3(0.0));","}","else{"," return textureCube(samp, (transform * vec4(normal,0.0)).xyz).xyz;","}","}","","vec3 adjustGain( in vec3 map, in vec3 gain )","{"," return map * gain;","}","","vec3 Vw( in vec3 iVw )","{"," return normalize( iVw );","}","","vec3 normalPassThrough( vec3 normal )","{"," return normal;","}","","vec3 SampleCubeReflectLogLuv( in samplerCube envCube, in mat4 transform, in float kr, in vec3 V, in vec3 N, in bool isLogLuv )","{"," if(isLogLuv){"," vec3 reflDir = (2.0 * dot(V, N)) * N - V;"," reflDir = (transform * vec4(reflDir,0.0)).xyz;"," vec4 vLogLuv = textureCube( envCube, reflDir );","float Le = vLogLuv.b * 255.0 + vLogLuv.a;","vec3 Xp_Y_XYZp;","Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.g;","Xp_Y_XYZp.x = vLogLuv.r * Xp_Y_XYZp.z;","vec3 vRGB = InverseM * Xp_Y_XYZp;","return kr * max(vRGB, vec3(0.0));","}","else{"," vec3 reflDir = (2.0 * dot(V, N)) * N - V;"," reflDir = (transform * vec4(reflDir,0.0)).xyz;"," return kr * textureCube( envCube, reflDir ).xyz;","}","}","","vec3 blendGlossyAndRadianceCubeEnvironment(float gloss, vec3 glossyEnv, vec3 radianceEnv)","{"," return lerp(glossyEnv, radianceEnv, gloss);","}","","float PassConstFloat( float value )","{"," return value;","}","","vec3 Fresnel_Rough(vec3 f0, float cosAngle, vec3 alpha)","{"," float x = 1.0 - cosAngle;"," float x2 = x * x;"," float x5 = x * x2 * x2;"," float temp = min(0.7, alpha.x) / 0.7;"," vec3 maxReflectance = lerp(vec3(1.0,1.0,1.0), f0, vec3(temp,temp,temp));"," return f0 + (maxReflectance - f0) * x5;","}","","vec3 Environment_Opaque(in vec3 envDiffColor, in vec3 envIrradiance, in vec3 envSpecular, in vec3 F, in vec3 albedo)","{"," vec3 diffuse = (1.0 - F) * envDiffColor * envIrradiance;"," vec3 specular = F * albedo * envSpecular;"," return diffuse + specular;","}","","vec4 PMCombine(in vec3 brdf, in vec4 NL_NV_NH_VH, in vec3 radianceEnv, float cutout, in float opacity)","{"," clip(cutout - 0.01);"," return vec4(brdf + radianceEnv, cutout*opacity);","}","","vec4 alphaTest(in vec4 value, in int functionSelected, in float reference)","{"," const float EPSILON = 1e-4;"," if (functionSelected == 1)"," {"," discard;"," }"," else if (functionSelected == 2)"," {"," clip(reference - EPSILON - value.a);"," }"," else if (functionSelected == 4)"," {"," clip(reference + EPSILON - value.a);"," }"," else if (functionSelected == 5)"," {"," clip(value.a - reference - EPSILON);"," }"," else if (functionSelected == 7)"," {"," clip(value.a - reference + EPSILON);"," }"," else if (functionSelected == 3)"," {"," clip(EPSILON - abs(value.a - reference));"," }"," else if (functionSelected == 6)"," {"," clip(abs(value.a - reference) - EPSILON);"," }"," return value;","}","",""," ","void main()","{"," "," float ANISO_ENV=0.000000;",""," "," vec3 v_PassFloat31132 = PassFloat3( SurfaceDiffuse_value );"," vec3 v_DiffuseLobe1133 = DiffuseLobe( v_PassFloat31132 );"," int v_PassInt1131 = PassInt( SurfaceNDF_value );"," float v_PassFloat1129 = PassFloat( SurfaceRough_value );"," float v_PassFloat1130 = PassFloat( SurfaceAniso_value );"," vec3 v_RoughnessToAlpha1138 = RoughnessToAlpha( v_PassInt1131, v_PassFloat1129, v_PassFloat1130 );"," irradiance s_irradiance1123;"," s_irradiance1123 = nullLight( );"," vec3 v_VwLocal1188 = VwLocal( io_1188_VwLocal );"," vec3 v_HVector1124 = HVector( s_irradiance1123.L, v_VwLocal1188 );"," vec3 v_Tw1189 = normalize(dFdx(vWorldPosition));// Tw( io_1189_Tw );"," vec3 v_Bw1190 = normalize(dFdy(vWorldPosition));//Bw( io_1190_Bw );"," vec3 v_Nw1191 = Nw( io_1191_Nw );"," vec3 v_faceForwardIntrinsicConditional1125 = faceForwardCond( v_Nw1191, v_VwLocal1188, flag );"," vec4 v_shaderGeom1126 = shaderGeom2( v_faceForwardIntrinsicConditional1125, s_irradiance1123.L, v_VwLocal1188, v_HVector1124 );"," vec3 v_HVector_Local1136 = HVector_Local( v_HVector1124, v_Tw1189, v_Bw1190, v_shaderGeom1126 );"," vec3 v_Rotate_Z1137 = Rotate_Z( v_HVector_Local1136, SurfaceRotation_value );"," float v_NDF_GGX1139 = NDF_GGX( v_RoughnessToAlpha1138, v_Rotate_Z1137 );"," float v_xOfFloat41140 = xOfFloat4( v_shaderGeom1126 );"," float v_aSqrd1141 = aSqrd( v_RoughnessToAlpha1138, v_xOfFloat41140 );"," float v_G1_GGX1144 = G1_GGX( v_aSqrd1141 );"," float v_yOfFloat41142 = yOfFloat4( v_shaderGeom1126 );"," float v_aSqrd1143 = aSqrd( v_RoughnessToAlpha1138, v_yOfFloat41142 );"," float v_G1_GGX1145 = G1_GGX( v_aSqrd1143 );"," float v_Evaluate_G1146 = EvaluateG( v_G1_GGX1144, v_G1_GGX1145 );"," float v_PassFloat1134 = PassFloat( SurfaceReflect_value );"," vec3 v_f31135 = f_to_f3( v_PassFloat1134 );"," float v_wOfFloat41147 = wOfFloat4( v_shaderGeom1126 );"," vec3 v_Fresnel_Schlick1148 = Fresnel_Schlick( v_f31135, v_wOfFloat41147 );"," vec3 v_MicrofacetLobe1149 = MicrofacetLobe( v_NDF_GGX1139, v_Evaluate_G1146, v_Fresnel_Schlick1148, v_shaderGeom1126 );"," vec3 v_PassFloat31128 = PassFloat3( SurfaceAlbedo_value );"," vec3 v_BRDF_Opaque1150 = BRDF_Opaque( v_DiffuseLobe1133, v_MicrofacetLobe1149, v_PassFloat31128, s_irradiance1123.diffuseI, v_shaderGeom1126 );"," "," vec3 v_sampleCubeNormalLogLuv1064 = SampleCubeNormalLogLuv( irradianceLogLuvCube_0_fiu_samp, irradianceLogLuvCube_0_fiu_transform, v_faceForwardIntrinsicConditional1125, irradianceLogLuvCube_0_fiu_isLogLuv );"," vec3 v_adjustGain1063 = adjustGain( v_sampleCubeNormalLogLuv1064, irradianceLogLuvCube_0_fiu_gain );"," float v_PassFloat1184 = PassFloat( SurfaceRough_value );"," vec3 v_Vw1192 = Vw( io_1192_Vw );"," vec3 v_normalPassThrough1083 = normalPassThrough( v_faceForwardIntrinsicConditional1125 );"," vec3 v_sampleCubeReflectLogLuv1082 = SampleCubeReflectLogLuv( glossLogLuvCube_samp, glossLogLuvCube_transform, glossLogLuvCube_reflectionCoeff, v_Vw1192, v_normalPassThrough1083, glossLogLuvCube_isLogLuv );"," vec3 v_adjustGain1081 = adjustGain( v_sampleCubeReflectLogLuv1082, glossLogLuvCube_gain );"," vec3 v_sampleCubeReflectLogLuv1087 = SampleCubeReflectLogLuv( radianceLogLuvCube_samp, radianceLogLuvCube_transform, radianceLogLuvCube_reflectionCoeff, v_Vw1192, v_normalPassThrough1083, radianceLogLuvCube_isLogLuv );"," vec3 v_adjustGain1086 = adjustGain( v_sampleCubeReflectLogLuv1087, radianceLogLuvCube_gain );"," vec3 v_blendSingleGlossyRadianceEnv1078 = blendGlossyAndRadianceCubeEnvironment( v_PassFloat1184, v_adjustGain1081, v_adjustGain1086 );"," float v_yOfFloat41127 = yOfFloat4( v_shaderGeom1126 );"," float v_PassConstFloat1152 = PassConstFloat( ANISO_ENV );"," vec3 v_RoughnessToAlpha1153 = RoughnessToAlpha( v_PassInt1131, v_PassFloat1129, v_PassConstFloat1152 );"," vec3 v_Fresnel_Rough1154 = Fresnel_Rough( v_f31135, v_yOfFloat41127, v_RoughnessToAlpha1153 );"," vec3 v_Environment_Opaque1155 = Environment_Opaque( v_PassFloat31132, v_adjustGain1063, v_blendSingleGlossyRadianceEnv1078, v_Fresnel_Rough1154, v_PassFloat31128 );"," vec4 v_PMCombiner1156 = PMCombine( v_BRDF_Opaque1150, v_shaderGeom1126, v_Environment_Opaque1155, cutout, opacity );"," vec4 v_alphaTest1157 = alphaTest( v_PMCombiner1156, alphaTestFunc, alphaTestRef );","","","gl_FragColor = v_alphaTest1157;","","","","}"].join("\n"),g={bitangent:{type:"v3",value:null}},h={DepthPriority:{type:"f",value:0},SurfaceAlbedo_value:{type:"v3",value:{x:1,y:1,z:1}},SurfaceAniso_value:{type:"f",value:1},SurfaceDiffuse_value:{type:"v3",value:a},SurfaceNDF_value:{type:"i",value:1},SurfaceReflect_value:{type:"f",value:b},SurfaceRotation_value:{type:"f",value:0},SurfaceRough_value:{type:"f",value:c},World:{type:"m4",value:{elements:{0:1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},WorldIT:{type:"m4",value:{elements:{0:1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},alphaTestFunc:{type:"i",value:8},alphaTestRef:{type:"f",value:0},cutout:{type:"f",value:1},environmentRadiance_0_fiu_gain:{type:null,value:{x:1,y:1,z:1}},environmentRadiance_0_fiu_samp:{type:null},environmentRadiance_0_fiu_transform:{type:null,value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},environmentRadiance_1_fiu_gain:{type:null,value:{x:1,y:1,z:1}},environmentRadiance_1_fiu_samp:{type:null},environmentRadiance_1_fiu_transform:{type:null,value:{elements:{0:1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},flag:{type:"i",value:!1},glossLogLuvCube_cube:{type:void 0,value:null},glossLogLuvCube_gain:{type:"v3",value:{x:"1.000000",y:"1.000000",z:"1.000000"}},glossLogLuvCube_isLogLuv:{type:"i",value:!0},glossLogLuvCube_reflectionCoeff:{type:"f",value:"1.000000"},glossLogLuvCube_samp:{type:"t",value:this.irradianceMap},glossLogLuvCube_transform:{type:"m4",value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},irradianceLogLuvCube_0_fiu_cube:{type:void 0,value:null},irradianceLogLuvCube_0_fiu_gain:{type:"v3",value:{x:1,y:1,z:1}},irradianceLogLuvCube_0_fiu_isLogLuv:{type:"i",value:!0},irradianceLogLuvCube_0_fiu_samp:{type:"t",value:this.irradianceMap},irradianceLogLuvCube_0_fiu_transform:{type:"m4",value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},localviewer:{type:"i",value:!1},opacity:{type:"f",value:1},radianceLogLuvCube_cube:{type:void 0,value:null},radianceLogLuvCube_gain:{type:"v3",value:{x:"1.000000",y:"1.000000",z:"1.000000"}},radianceLogLuvCube_isLogLuv:{type:"i",value:!0},radianceLogLuvCube_reflectionCoeff:{type:"f",value:"1.000000"},radianceLogLuvCube_samp:{type:"t",value:this.envMap},radianceLogLuvCube_transform:{type:"m4",value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},viewDirection:{type:"v3",value:{x:1,y:1,z:1}}},i;for(var j in h)if(i=h[j],"m4"===i.type){var k=new f.Matrix4;null!=i.value&&k.copy(i.value),i.value=k}var l=new f.ShaderMaterial({uniforms:h,attributes:g,vertexShader:d,fragmentShader:e});return l.defaultAttributeValues=null,l},F._prismMetal=function(a,b){var c="precision highp int;\n\n#define VTX_SHADER\n//=========================================================\n//         OGSFX Copyright (c) 2013 Autodesk, Inc. \n//=========================================================\n\n\n//----------------\n//Global block \n//----------------\n\n#ifdef PIX_SHADER\n\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\n\n precision highp float;\n\n\n//----------------\n//OGS Standard Library Block \n//----------------\n#define lerp mix\n#define atan2 atan\n#ifndef GL_ES\n#define texture2D	texture\n#define texture1D	texture\n#define textureCube texture\n#define texture3D	texture\n#define texture2DLod textureLod\n#define texture1DLod textureLod\n#define textureCubeLod textureLod\n#define texture3DLod textureLod\n#endif\n#define const\nvec4 mul (in vec4 matx[4],in vec4 v)\n{\nmat4 tmpMtx=mat4(matx[0],matx[1],matx[2],matx[3]);\nreturn tmpMtx*v;\n}\nvec4 mul (in mat4 matx,in vec4 v)\n{\nreturn matx*v;\n}\nvec4 mul (in vec4 v,in vec4 matx[4])\n{\nvec4 retVal;\nretVal.x=dot(matx[0],v);\nretVal.y=dot(matx[1],v);\nretVal.z=dot(matx[2],v);\nretVal.w=dot(matx[3],v);\nreturn retVal;\n}\nvec4 mul (in vec4 v,in mat4 matx)\n{\nreturn v*matx;\n}\nvec3 mul (in vec3 matx[3],in vec3 v)\n{\nmat3 tmpMtx=mat3(matx[0],matx[1],matx[2]);\nreturn tmpMtx*v;\n}\nvec3 mul (in mat3 matx,in vec3 v)\n{\nreturn matx*v;\n}\nvec3 mul (in vec3 v,in vec3 matx[3])\n{\nvec3 retVal;\nretVal.x=dot(matx[0],v);\nretVal.y=dot(matx[1],v);\nretVal.z=dot(matx[2],v);\nreturn retVal;\n}\nvec3 mul (in vec3 v,in mat3 matx)\n{\nreturn v*matx;\n}\nvec3 mul (in vec4 matx[4],in vec3 v)\n{\nreturn mul(matx,vec4(v,0.0)).xyz;\n}\nvec3 mul (in vec3 v, in vec4 matx[4])\n{\nreturn mul(vec4(v,0.0),matx).xyz;\n}\nvoid transpose (in vec4 matx[4], out vec4 matOut[4])\n{\nmatOut[0].x=matx[0].x;\nmatOut[0].y=matx[1].x;\nmatOut[0].z=matx[2].x;\nmatOut[0].w=matx[3].x;\nmatOut[1].x=matx[0].y;\nmatOut[1].y=matx[1].y;\nmatOut[1].z=matx[2].y;\nmatOut[1].w=matx[3].y;\nmatOut[2].x=matx[0].z;\nmatOut[2].y=matx[1].z;\nmatOut[2].z=matx[2].z;\nmatOut[2].w=matx[3].z;\nmatOut[3].x=matx[0].w;\nmatOut[3].y=matx[1].w;\nmatOut[3].z=matx[2].w;\nmatOut[3].w=matx[3].w;\n}\nvoid transpose (in vec3 matx[3], out vec3 matOut[3])\n{\nmatOut[0].x=matx[0].x;\nmatOut[0].y=matx[1].x;\nmatOut[0].z=matx[2].x;\nmatOut[1].x=matx[0].y;\nmatOut[1].y=matx[1].y;\nmatOut[1].z=matx[2].y;\nmatOut[2].x=matx[0].z;\nmatOut[2].y=matx[1].z;\nmatOut[2].z=matx[2].z;\n}\nvec4 lit(in float NdotL , in float NdotH , in float m )\n{\nfloat spec = (NdotL > 0.0) ? pow(max(0.0, NdotH), m) : 0.0;\nreturn vec4(1.0, max(0.0, NdotL), spec, 1.0);\n}\nfloat saturate (in float v)\n{\nreturn clamp(v,0.0,1.0);\n}\nvec3 saturate(in vec3 v)\n{\n#ifdef GL_ES\nreturn vec3(saturate(v.x),saturate(v.y), saturate(v.z));\n#else\nreturn clamp(v,0.0,1.0);\n#endif\n}\nfloat fmod(float x, float y)\n{\nreturn x - y * floor(x/y);\n}\nvec4 saturate (in vec4 v)\n{\n#ifdef GL_ES\nreturn vec4(saturate(v.x),saturate(v.y), saturate(v.z),saturate(v.w));\n#else\nreturn clamp(v,0.0,1.0);\n#endif\n}\n#ifdef PIX_SHADER\nvoid clip( in float x )\n{\nif (x < 0.0)\ndiscard;\n}\nvoid clip( in vec2 v )\n{\nbvec2 r=lessThan(v,vec2(0.0,0.0));\nif(any(r)) discard;\n}\nvoid clip( in vec3 v )\n{\nbvec3 r=lessThan(v,vec3(0.0,0.0,0.0));\nif(any(r)) discard;\n}\nvoid clip( in vec4 v )\n{\nbvec4 r=lessThan(v,vec4(0.0,0.0,0.0,0.0));\nif(any(r)) discard;\n}\nconst mat3 InverseM = mat3(6.0014, -2.7008, -1.7996,\n-1.3320,  3.1029, -5.7721,\n0.3008, -1.0882,  5.6268);\n#endif\n\n//----------------\n\n//----------------------------------\n//Autogenerated structure code:\n//----------------------------------\nstruct irradiance {\nvec3 diffuseI;\nvec3 specularI;\nvec3 L;\nfloat shadowFrac;\n};\n\n//----------------------------------\n//Autogenerated uniform code:\n//----------------------------------\nuniform   float gPointSize;\nuniform   mat4 World;\nuniform   vec3 viewDirection;\nuniform  bool localviewer;\nuniform   mat4 WorldIT;\nuniform   float DepthPriority;\nuniform   int SurfaceNDF_value;\nuniform   float SurfaceRough_value;\nuniform   float SurfaceAniso_value;\nuniform  bool flag;\nuniform   float SurfaceRotation_value;\nuniform   vec3 SurfaceReflect_value;\nuniform   vec3 SurfaceAlbedo_value;\nuniform  samplerCube glossLogLuvCube_samp;\nuniform   mat4 glossLogLuvCube_transform;\nuniform   float glossLogLuvCube_reflectionCoeff;\nuniform  bool glossLogLuvCube_isLogLuv;\nuniform   vec3 glossLogLuvCube_gain;\nuniform  samplerCube radianceLogLuvCube_samp;\nuniform   mat4 radianceLogLuvCube_transform;\nuniform   float radianceLogLuvCube_reflectionCoeff;\nuniform  bool radianceLogLuvCube_isLogLuv;\nuniform   vec3 radianceLogLuvCube_gain;\nuniform   float cutout;\nuniform   float opacity;\nuniform   int alphaTestFunc;\nuniform   float alphaTestRef;\n\n//=============================\n//      Vertex In attributes\n//=============================\n//=============================\n//      Vertex Out attributes\n//=============================\nvarying vec3 io_1157_VwLocal;\nvarying vec3 vWorldPosition;\nvarying vec3 io_1160_Nw;\nvarying vec3 io_1161_Vw;\n//======================================\n// FX file :MAINFX\n// FX line :161\n//======================================\n// Vertex shader block:testShaderName_VS\n\n\n\nvec3 iVwLocal(in vec3 position, in vec3 Ew, in mat4 world, in vec3 viewDir, in bool localViewer )\n{\n vec4 Pw = ( world * vec4(position,1.0) );\n return localViewer ? normalize( Ew - Pw.xyz ) : -viewDir;\n}\n\nvec3 iTw( in vec4 tangent, in mat4 world )\n{\n return ( world * tangent ).xyz;\n}\n\nvec3 iBw( in vec3 bitangent, in mat4 world )\n{\n return ( world * vec4(bitangent,0.0) ).xyz;\n}\n\nvec3 iNw(in vec3 nm, in mat4 worldITC)\n{\n return ( worldITC * vec4(nm,0.0) ).xyz;\n}\n\nvec3 iVw( in vec3 position, in vec3 Ew, in mat4 world )\n{\n vec4 Pw = ( world * vec4(position,1.0) );\n return Ew - Pw.xyz;\n}\n\nvec4 iPcPriority(in vec3 pm, in float depthPriority, in mat4 worldViewProjectionC)\n{\n vec4 P = ( worldViewProjectionC * vec4(pm,1.0) );\n P.z -= P.w * 2.0 * depthPriority;\n return P;\n}\n\n\n\n \nvoid main()\n {\n\n \n io_1157_VwLocal = iVwLocal( position, cameraPosition, World, viewDirection, localviewer );\n io_1160_Nw = iNw( normal, WorldIT );\n io_1161_Vw = iVw( position, cameraPosition, World );\n gl_PointSize=gPointSize;\nvec4 mvpPosition = projectionMatrix*(modelViewMatrix*vec4(position,1.0)); mvpPosition.z -= mvpPosition.w * 2.0 * DepthPriority; gl_Position = mvpPosition;vec4 pos = modelViewMatrix * vec4(position, 1.0); vWorldPosition = pos.xyz/pos.w;\n \n }\n\n",d="precision highp int;\n\n#define PIX_SHADER\n//=========================================================\n//         OGSFX Copyright (c) 2013 Autodesk, Inc. \n//=========================================================\n\n\n//----------------\n//Global block \n//----------------\n\n#ifdef PIX_SHADER\n\n    #extension GL_OES_standard_derivatives : enable\r\n#endif\n\n precision highp float;\n\n\n//----------------\n//OGS Standard Library Block \n//----------------\n#define lerp mix\n#define atan2 atan\n#ifndef GL_ES\n#define texture2D	texture\n#define texture1D	texture\n#define textureCube texture\n#define texture3D	texture\n#define texture2DLod textureLod\n#define texture1DLod textureLod\n#define textureCubeLod textureLod\n#define texture3DLod textureLod\n#endif\n#define const\n\nvec4 iPcPriority(in vec3 pm, in float depthPriority, in mat4 worldViewProjectionC)\n{\nvec4 P = worldViewProjectionC * vec4(pm,1.0);\nP.z -= P.w * 2.0 * depthPriority;\nreturn P;\n}\nvec4 mul (in vec4 matx[4],in vec4 v)\n{\nmat4 tmpMtx=mat4(matx[0],matx[1],matx[2],matx[3]);\nreturn tmpMtx*v;\n}\nvec4 mul (in mat4 matx,in vec4 v)\n{\nreturn matx*v;\n}\nvec4 mul (in vec4 v,in vec4 matx[4])\n{\nvec4 retVal;\nretVal.x=dot(matx[0],v);\nretVal.y=dot(matx[1],v);\nretVal.z=dot(matx[2],v);\nretVal.w=dot(matx[3],v);\nreturn retVal;\n}\nvec4 mul (in vec4 v,in mat4 matx)\n{\nreturn v*matx;\n}\nvec3 mul (in vec3 matx[3],in vec3 v)\n{\nmat3 tmpMtx=mat3(matx[0],matx[1],matx[2]);\nreturn tmpMtx*v;\n}\nvec3 mul (in mat3 matx,in vec3 v)\n{\nreturn matx*v;\n}\nvec3 mul (in vec3 v,in vec3 matx[3])\n{\nvec3 retVal;\nretVal.x=dot(matx[0],v);\nretVal.y=dot(matx[1],v);\nretVal.z=dot(matx[2],v);\nreturn retVal;\n}\nvec3 mul (in vec3 v,in mat3 matx)\n{\nreturn v*matx;\n}\nvec3 mul (in vec4 matx[4],in vec3 v)\n{\nreturn mul(matx,vec4(v,0.0)).xyz;\n}\nvec3 mul (in vec3 v, in vec4 matx[4])\n{\nreturn mul(vec4(v,0.0),matx).xyz;\n}\nvoid transpose (in vec4 matx[4], out vec4 matOut[4])\n{\nmatOut[0].x=matx[0].x;\nmatOut[0].y=matx[1].x;\nmatOut[0].z=matx[2].x;\nmatOut[0].w=matx[3].x;\nmatOut[1].x=matx[0].y;\nmatOut[1].y=matx[1].y;\nmatOut[1].z=matx[2].y;\nmatOut[1].w=matx[3].y;\nmatOut[2].x=matx[0].z;\nmatOut[2].y=matx[1].z;\nmatOut[2].z=matx[2].z;\nmatOut[2].w=matx[3].z;\nmatOut[3].x=matx[0].w;\nmatOut[3].y=matx[1].w;\nmatOut[3].z=matx[2].w;\nmatOut[3].w=matx[3].w;\n}\nvoid transpose (in vec3 matx[3], out vec3 matOut[3])\n{\nmatOut[0].x=matx[0].x;\nmatOut[0].y=matx[1].x;\nmatOut[0].z=matx[2].x;\nmatOut[1].x=matx[0].y;\nmatOut[1].y=matx[1].y;\nmatOut[1].z=matx[2].y;\nmatOut[2].x=matx[0].z;\nmatOut[2].y=matx[1].z;\nmatOut[2].z=matx[2].z;\n}\nvec4 lit(in float NdotL , in float NdotH , in float m )\n{\nfloat spec = (NdotL > 0.0) ? pow(max(0.0, NdotH), m) : 0.0;\nreturn vec4(1.0, max(0.0, NdotL), spec, 1.0);\n}\nfloat saturate (in float v)\n{\nreturn clamp(v,0.0,1.0);\n}\nvec3 saturate(in vec3 v)\n{\n#ifdef GL_ES\nreturn vec3(saturate(v.x),saturate(v.y), saturate(v.z));\n#else\nreturn clamp(v,0.0,1.0);\n#endif\n}\nfloat fmod(float x, float y)\n{\nreturn x - y * floor(x/y);\n}\nvec4 saturate (in vec4 v)\n{\n#ifdef GL_ES\nreturn vec4(saturate(v.x),saturate(v.y), saturate(v.z),saturate(v.w));\n#else\nreturn clamp(v,0.0,1.0);\n#endif\n}\n#ifdef PIX_SHADER\nvoid clip( in float x )\n{\nif (x < 0.0)\ndiscard;\n}\nvoid clip( in vec2 v )\n{\nbvec2 r=lessThan(v,vec2(0.0,0.0));\nif(any(r)) discard;\n}\nvoid clip( in vec3 v )\n{\nbvec3 r=lessThan(v,vec3(0.0,0.0,0.0));\nif(any(r)) discard;\n}\nvoid clip( in vec4 v )\n{\nbvec4 r=lessThan(v,vec4(0.0,0.0,0.0,0.0));\nif(any(r)) discard;\n}\nconst mat3 InverseM = mat3(6.0014, -2.7008, -1.7996,\n-1.3320,  3.1029, -5.7721,\n0.3008, -1.0882,  5.6268);\n#endif\n\n//----------------\n\n//----------------------------------\n//Autogenerated structure code:\n//----------------------------------\nstruct irradiance {\nvec3 diffuseI;\nvec3 specularI;\nvec3 L;\nfloat shadowFrac;\n};\n\n//----------------------------------\n//Autogenerated uniform code:\n//----------------------------------\nuniform   float gPointSize;\nuniform   mat4 World;\nuniform   vec3 viewDirection;\nuniform  bool localviewer;\nuniform   mat4 WorldIT;\nuniform   float DepthPriority;\nuniform   int SurfaceNDF_value;\nuniform   float SurfaceRough_value;\nuniform   float SurfaceAniso_value;\nuniform  bool flag;\nuniform   float SurfaceRotation_value;\nuniform   vec3 SurfaceReflect_value;\nuniform   vec3 SurfaceAlbedo_value;\nuniform  samplerCube glossLogLuvCube_samp;\nuniform   mat4 glossLogLuvCube_transform;\nuniform   float glossLogLuvCube_reflectionCoeff;\nuniform  bool glossLogLuvCube_isLogLuv;\nuniform   vec3 glossLogLuvCube_gain;\nuniform  samplerCube radianceLogLuvCube_samp;\nuniform   mat4 radianceLogLuvCube_transform;\nuniform   float radianceLogLuvCube_reflectionCoeff;\nuniform  bool radianceLogLuvCube_isLogLuv;\nuniform   vec3 radianceLogLuvCube_gain;\nuniform   float cutout;\nuniform   float opacity;\nuniform   int alphaTestFunc;\nuniform   float alphaTestRef;\n\n//=============================\n//      Pixel In attributes\n//=============================\nvarying vec3 io_1157_VwLocal;\nvarying vec3 vWorldPosition;\nvarying vec3 io_1160_Nw;\nvarying vec3 io_1161_Vw;\n\n//=============================\n//      Pixel Out attributes\n//=============================\nvarying vec4 ColorOut;\n//======================================\n// FX file :MAINFX\n// FX line :481\n//======================================\n// Pixel shader block:testShaderName\n\n\n\nint PassInt( int value )\n{\n return value;\n}\n\nfloat PassFloat( float value )\n{\n return value;\n}\n\nvec3 RoughnessToAlpha(int ndfType, in float roughness, in float anisotropy)\n{\n vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n alpha = alpha * alpha;\n float limit = ndfType == 0 ? 0.7 : 1.0;\n alpha = clamp(alpha, 0.001, limit);\n float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n return vec3(alpha, alpha2);\n}\n\nirradiance nullLight( )\n{\n irradiance irrad;\n irrad.diffuseI = vec3(0.0, 0.0, 0.0);\n irrad.specularI = vec3(0.0, 0.0, 0.0);\n irrad.L = vec3(0.0, 0.0, 1.0);\n irrad.shadowFrac = 1.0 ;\n return irrad;\n}\n\nvec3 VwLocal( in vec3 iVwLocal )\n{\n return normalize( iVwLocal );\n}\n\nvec3 HVector( in vec3 L, in vec3 V )\n{\n return normalize( L + V );\n}\n\nvec3 Tw( in vec3 iTw )\n{\n return normalize( iTw );\n}\n\nvec3 Bw( in vec3 iBw )\n{\n return normalize( iBw );\n}\n\nvec3 Nw( in vec3 iNw )\n{\n return normalize( iNw );\n}\n\nvec3 faceForwardCond( in vec3 Nw, in vec3 Vw, in bool flag )\n{\n return flag ? faceforward(Nw, -Vw, Nw) : Nw;\n}\n\nvec4 shaderGeom2( vec3 N, vec3 L, vec3 V, vec3 H )\n{\n float NL = dot(N, L);\n float NV = dot(N, V);\n float NH = dot(N, H);\n float VH = dot(V, H);\n return vec4( NL, NV, NH, VH );\n}\n\nvec3 HVector_Local(in vec3 H, in vec3 Tw, in vec3 Bw, in vec4 NL_NV_NH_VH)\n{\n float Hu = dot(H, Tw);\n float Hv = dot(H, Bw);\n return vec3(Hu, Hv, NL_NV_NH_VH.z);\n}\n\nvec3 Rotate_Z(in vec3 vec, in float value)\n{\n float s, c;\n s = sin(value);\n c = cos(value);\n return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\n\nfloat NDF_GGX(in vec3 alpha, in vec3 normal)\n{\n const float PI = 3.141592654;\n float nx2 = normal.x * normal.x;\n float ny2 = normal.y * normal.y;\n float nz2 = normal.z * normal.z;\n float scale = 1.0 / (alpha.x * alpha.y * PI);\n float xyz = nx2 / (alpha.x * alpha.x) + ny2 / (alpha.y * alpha.y) + nz2;\n return scale / (xyz * xyz);\n}\n\nfloat xOfFloat4(in vec4 value)\n{\n return value.x;\n}\n\nfloat aSqrd(in vec3 alpha, in float cosTheta)\n{\n float tan2 = 1.0 / (cosTheta * cosTheta) - 1.0;\n return alpha.z * tan2;\n}\n\nfloat G1_GGX(float aSqrd)\n{\n return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\n\nfloat yOfFloat4(in vec4 value)\n{\n return value.y;\n}\n\nfloat EvaluateG(float g_NL, float g_NV)\n{\n return g_NL * g_NV;\n}\n\nvec3 PassFloat3( in vec3 value )\n{\n return value;\n}\n\nfloat wOfFloat4(in vec4 value)\n{\n return value.w;\n}\n\nvec3 Fresnel_Schlick(in vec3 f0, in float cosAngle)\n{\n float x = 1.0 - cosAngle;\n float x2 = x * x;\n vec3 f = f0 + (1.0 - f0) * (x * x2 * x2);\n return f;\n}\n\nvec3 MicrofacetLobe(in float D, in float G, in vec3 F, in vec4 NL_NV_NH_VH)\n{\n return D * G * F / (4.0 * NL_NV_NH_VH.x * NL_NV_NH_VH.y);\n}\n\nvec3 BRDF_Metal(in vec3 specular, in vec3 albedo, in vec3 radiance, in vec4 NL_NV_NH_VH)\n{\n if (NL_NV_NH_VH.x <= 0.0 || NL_NV_NH_VH.y <= 0.0)\n return vec3(0.0, 0.0, 0.0);\n return radiance * NL_NV_NH_VH.x * specular * albedo;\n}\n\nvec3 Vw( in vec3 iVw )\n{\n return normalize( iVw );\n}\n\nvec3 normalPassThrough( vec3 normal )\n{\n return normal;\n}\n\nvec3 SampleCubeReflectLogLuv( in samplerCube envCube, in mat4 transform, in float kr, in vec3 V, in vec3 N, in bool isLogLuv )\n{\n if(isLogLuv){\n vec3 reflDir = (2.0 * dot(V, N)) * N - V;\n reflDir = (transform * vec4(reflDir,0.0)).xyz;\n vec4 vLogLuv = textureCube( envCube, reflDir );\nfloat Le = vLogLuv.b * 255.0 + vLogLuv.a;\nvec3 Xp_Y_XYZp;\nXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\nXp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.g;\nXp_Y_XYZp.x = vLogLuv.r * Xp_Y_XYZp.z;\nvec3 vRGB = InverseM * Xp_Y_XYZp;\nreturn kr * max(vRGB, vec3(0.0));\n}\nelse{\n vec3 reflDir = (2.0 * dot(V, N)) * N - V;\n reflDir = (transform * vec4(reflDir,0.0)).xyz;\n return kr * textureCube( envCube, reflDir ).xyz;\n}\n}\n\nvec3 adjustGain( in vec3 map, in vec3 gain )\n{\n return map * gain;\n}\n\nvec3 blendGlossyAndRadianceCubeEnvironment(float gloss, vec3 glossyEnv, vec3 radianceEnv)\n{\n return lerp(glossyEnv, radianceEnv, clamp((1.0-gloss)/0.8,0.0,1.0));\n}\n\nfloat PassConstFloat( float value )\n{\n return value;\n}\n\nvec3 Fresnel_Rough(vec3 f0, float cosAngle, vec3 alpha)\n{\n float x = 1.0 - cosAngle;\n float x2 = x * x;\n float x5 = x * x2 * x2;\n float temp = min(0.7, alpha.x) / 0.7;\n vec3 maxReflectance = lerp(vec3(1.0,1.0,1.0), f0, vec3(temp,temp,temp));\n return f0 + (maxReflectance - f0) * x5;\n}\n\nvec3 Environment_Metal(in vec3 envSpecular, in vec3 F, in vec3 albedo)\n{\n vec3 specular = F * albedo * envSpecular;\n return specular;\n}\n\nvec4 PMCombine(in vec3 brdf, in vec3 radianceEnv, float cutout, in float opacity)\n{\n clip(cutout - 0.01);\n return vec4(brdf + radianceEnv, cutout*opacity);\n}\n\nvec4 alphaTest(in vec4 value, in int functionSelected, in float reference)\n{\n const float EPSILON = 1e-4;\n if (functionSelected == 1)\n {\n discard;\n }\n else if (functionSelected == 2)\n {\n clip(reference - EPSILON - value.a);\n }\n else if (functionSelected == 4)\n {\n clip(reference + EPSILON - value.a);\n }\n else if (functionSelected == 5)\n {\n clip(value.a - reference - EPSILON);\n }\n else if (functionSelected == 7)\n {\n clip(value.a - reference + EPSILON);\n }\n else if (functionSelected == 3)\n {\n clip(EPSILON - abs(value.a - reference));\n }\n else if (functionSelected == 6)\n {\n clip(abs(value.a - reference) - EPSILON);\n }\n return value;\n}\n\n\n \nvoid main()\n{\n \n float ANISO_ENV=0.000000;\n\n \n int v_PassInt1103 = PassInt( SurfaceNDF_value );\n float v_PassFloat1101 = PassFloat( SurfaceRough_value );\n float v_PassFloat1102 = PassFloat( SurfaceAniso_value );\n vec3 v_RoughnessToAlpha1107 = RoughnessToAlpha( v_PassInt1103, v_PassFloat1101, v_PassFloat1102 );\n irradiance s_irradiance1095;\n s_irradiance1095 = nullLight( );\n vec3 v_VwLocal1157 = VwLocal( io_1157_VwLocal );\n vec3 v_HVector1096 = HVector( s_irradiance1095.L, v_VwLocal1157 );\n vec3 v_Tw1158 = normalize(dFdx(vWorldPosition));\n vec3 v_Bw1159 = normalize(dFdy(vWorldPosition));\n vec3 v_Nw1160 = Nw( io_1160_Nw );\n vec3 v_faceForwardIntrinsicConditional1097 = faceForwardCond( v_Nw1160, v_VwLocal1157, flag );\n vec4 v_shaderGeom1098 = shaderGeom2( v_faceForwardIntrinsicConditional1097, s_irradiance1095.L, v_VwLocal1157, v_HVector1096 );\n vec3 v_HVector_Local1105 = HVector_Local( v_HVector1096, v_Tw1158, v_Bw1159, v_shaderGeom1098 );\n vec3 v_Rotate_Z1106 = Rotate_Z( v_HVector_Local1105, SurfaceRotation_value );\n float v_NDF_GGX1108 = NDF_GGX( v_RoughnessToAlpha1107, v_Rotate_Z1106 );\n float v_xOfFloat41109 = xOfFloat4( v_shaderGeom1098 );\n float v_aSqrd1110 = aSqrd( v_RoughnessToAlpha1107, v_xOfFloat41109 );\n float v_G1_GGX1113 = G1_GGX( v_aSqrd1110 );\n float v_yOfFloat41111 = yOfFloat4( v_shaderGeom1098 );\n float v_aSqrd1112 = aSqrd( v_RoughnessToAlpha1107, v_yOfFloat41111 );\n float v_G1_GGX1114 = G1_GGX( v_aSqrd1112 );\n float v_Evaluate_G1115 = EvaluateG( v_G1_GGX1113, v_G1_GGX1114 );\n vec3 v_PassFloat31104 = PassFloat3( SurfaceReflect_value );\n float v_wOfFloat41116 = wOfFloat4( v_shaderGeom1098 );\n vec3 v_Fresnel_Schlick1117 = Fresnel_Schlick( v_PassFloat31104, v_wOfFloat41116 );\n vec3 v_MicrofacetLobe1118 = MicrofacetLobe( v_NDF_GGX1108, v_Evaluate_G1115, v_Fresnel_Schlick1117, v_shaderGeom1098 );\n vec3 v_PassFloat31100 = PassFloat3( SurfaceAlbedo_value );\n vec3 v_BRDF_Matel1119 = BRDF_Metal( v_MicrofacetLobe1118, v_PassFloat31100, s_irradiance1095.diffuseI, v_shaderGeom1098 );\n \n float v_PassFloat1153 = PassFloat( SurfaceRough_value );\n vec3 v_Vw1161 = Vw( io_1161_Vw );\n vec3 v_normalPassThrough1055 = normalPassThrough( v_faceForwardIntrinsicConditional1097 );\n vec3 v_sampleCubeReflectLogLuv1054 = SampleCubeReflectLogLuv( glossLogLuvCube_samp, glossLogLuvCube_transform, glossLogLuvCube_reflectionCoeff, v_Vw1161, v_normalPassThrough1055, glossLogLuvCube_isLogLuv );\n vec3 v_adjustGain1053 = adjustGain( v_sampleCubeReflectLogLuv1054, glossLogLuvCube_gain );\n vec3 v_sampleCubeReflectLogLuv1059 = SampleCubeReflectLogLuv( radianceLogLuvCube_samp, radianceLogLuvCube_transform, radianceLogLuvCube_reflectionCoeff, v_Vw1161, v_normalPassThrough1055, radianceLogLuvCube_isLogLuv );\n vec3 v_adjustGain1058 = adjustGain( v_sampleCubeReflectLogLuv1059, radianceLogLuvCube_gain );\n vec3 v_blendSingleGlossyRadianceEnv1050 = blendGlossyAndRadianceCubeEnvironment( v_PassFloat1153, v_adjustGain1053, v_adjustGain1058 );\n float v_yOfFloat41099 = yOfFloat4( v_shaderGeom1098 );\n float v_PassConstFloat1121 = PassConstFloat( ANISO_ENV );\n vec3 v_RoughnessToAlpha1122 = RoughnessToAlpha( v_PassInt1103, v_PassFloat1101, v_PassConstFloat1121 );\n vec3 v_Fresnel_Rough1123 = Fresnel_Rough( v_PassFloat31104, v_yOfFloat41099, v_RoughnessToAlpha1122 );\n vec3 v_Environment_Metal1124 = Environment_Metal( v_blendSingleGlossyRadianceEnv1050, v_Fresnel_Rough1123, v_PassFloat31100 );\n vec4 v_PMCombiner1125 = PMCombine( v_BRDF_Matel1119, v_Environment_Metal1124, cutout, opacity );\n vec4 v_alphaTest1126 = alphaTest( v_PMCombiner1125, alphaTestFunc, alphaTestRef );\n\n gl_FragColor = v_alphaTest1126;\n}\n\n",e={bitangent:{type:"v3",value:null}},g={SurfaceNDF_value:{type:"i",value:1},SurfaceAlbedo_value:{type:"v3",value:{x:1,y:1,z:1}},SurfaceRough_value:{type:"f",value:b},SurfaceAniso_value:{type:"f",value:0},SurfaceRotation_value:{type:"f",value:0},cutout:{type:"f",value:1},SurfaceReflect_value:{type:"v3",value:a},World:{type:"m4",value:{elements:{0:1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},WorldIT:{type:"m4",value:{elements:{0:1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},viewDirection:{type:"v3",value:{x:0,y:0,z:1}},localviewer:{type:"i",value:!1},DepthPriority:{type:"f",value:0},flag:{type:"i",value:!1},glossLogLuvCube_cube:{type:void 0,value:null},glossLogLuvCube_gain:{type:"v3",value:{x:"1.000000",y:"1.000000",z:"1.000000"}},glossLogLuvCube_isLogLuv:{type:"i",value:!0},glossLogLuvCube_reflectionCoeff:{type:"f",value:"1.000000"},glossLogLuvCube_samp:{type:"t",value:this.irradianceMap},glossLogLuvCube_transform:{type:"m4",value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},radianceLogLuvCube_cube:{type:void 0,value:null},radianceLogLuvCube_gain:{type:"v3",value:{x:"1.000000",y:"1.000000",z:"1.000000"}},radianceLogLuvCube_isLogLuv:{type:"i",value:!0},radianceLogLuvCube_reflectionCoeff:{type:"f",value:"1.000000"},radianceLogLuvCube_samp:{type:"t",value:this.envMap},radianceLogLuvCube_transform:{type:"m4",value:{elements:{0:-1,1:0,2:0,3:0,4:0,5:1,6:0,7:0,8:0,9:0,10:1,11:0,12:0,13:0,14:0,15:1}}},alphaTestFunc:{type:"i",value:8},alphaTestRef:{type:"f",value:0},opacity:{type:"f",value:1}},h;
for(var i in g)if(h=g[i],"m4"===h.type){var j=new f.Matrix4;null!=h.value&&j.copy(h.value),h.value=j}var k=new f.ShaderMaterial({uniforms:g,attributes:e,vertexShader:c,fragmentShader:d});return k.defaultAttributeValues=null,k}};a.creativePlatformLibraryc0HjtqUm7Wzrev0=c}("undefined"==typeof k?window:k),function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(b,c){function d(b){var c=b.data;if(c instanceof i&&c._paramManager){var d=c._paramManager.value;if(d){var e=d.materialAndColor,f=a.creativePlatformRuntime.environment.getVariable(["viewer","materialMapping"]);f&&f[e]&&(e=f[e]),e&&(c._viewer.globalMaterial=e)}}}var e=b.libraryExports("1vxKXGNaLtr",0),f=b.libraryExports("aZS9YbvfqUX",0),g=f.jQuery;c&&(c.name="Autodesk Creative Platform Player",c.description="The library to create the 3D customizers",c.resources=[]);var h=function(){this.parent=void 0,this.library=void 0},i=function(a){this._element=g(a.parent),this._library=a.library;var b=a.library&&a.library.exports?a.library.exports:void 0;b&&("function"==typeof b.shapeGenerator?this._shapeGenerator=b.shapeGenerator():"function"==typeof b.shapeConfigurator&&(this._shapeGenerator=new m(b.shapeConfigurator()))),this._cache={},this._viewer=void 0,this._paramManager=void 0,this._layoutManager=void 0,this._shown=!1,this._defaultParams=void 0,this._firstShow=!0,this._originalPanicCallback=void 0,this._generatedMeshes=[],Object.defineProperty(this,"_change",{writable:!1,enumerable:!0,configurable:!1,value:new e.EventSource("changed")})};i.prototype={_executeGenerator:function(a,c,d,e){var f=this;this._originalPanicCallback=b.getVariable(["callbacks","panic"]);var g=function(a){return function(b){throw a._errorText(b),new Error(b)}}(this);b.setVariable(["callbacks","panic"],g);var h=function(a){b.setVariable(["callbacks","panic"],f._originalPanicCallback),a&&f._errorText(""),e(a)};try{a[c](d,h)}catch(i){h()}},_errorText:function(a){if(this._viewer){if(void 0===a)return this._viewer.errorText;this._viewer.errorText=a}},_statusText:function(a){if(this._viewer){if(void 0===a)return this._viewer.statusText;this._viewer.statusText=a}},_bindViewerEventHandlers:function(a){for(var b=this,c=[],d=0,e=a.length;e>d;d++){var f=a[d];if(f.attributes.viewer&&f.attributes.viewer.lookAts)for(var g=f.attributes.viewer.lookAts,d=0;d<g.length;d++)c.push(g[d])}var h=c.length;if(h>0){var i=function(a){var d=function(d){for(var e=0;h>e;e++)c[e].id==d._data.id&&("image"===d._data.id&&"endchange"===a||"image"!==d._data.id&&"endchange"!==a)&&b._viewer.lookAt(c[e].lookAt.point,c[e].lookAt.normal,c[e].lookAt.right)};return d};this._paramManager.beginchange.bind(i("beginchange")),this._paramManager.change.bind(i("change")),this._paramManager.endchange.bind(i("endchange"))}},_updateViewer:function(a,b){b=b||function(){};var c=this._shapeGenerator,d=void 0,e=this;c&&"function"==typeof c.preview?(d="preview",e._executeGenerator(c,d,a,function(a){if(e._viewer&&a){if(e._viewer.removeAllMeshes(),e._generatedMeshes=[],Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c].mesh;if(d.attributes.viewer&&d.attributes.viewer.transform){var f=d.clone().transform(d.attributes.viewer.transform);e._viewer.addMesh(f)}else e._viewer.addMesh(d);e._generatedMeshes.push(d)}else{var d=a.mesh;if(d.attributes.viewer&&d.attributes.viewer.transform){var f=d.clone().transform(d.attributes.viewer.transform);e._viewer.addMesh(f)}else e._viewer.addMesh(d);e._generatedMeshes.push(d)}e._highlightMatchedMeshes([])}b()})):c&&"function"==typeof c.evaluate&&(d="evaluate",e._executeGenerator(c,d,a,function(a){if(e._viewer&&a){e._viewer.removeAllMeshes();var c=a.mesh;if(c.attributes.viewer&&c.attributes.viewer.transform){var d=c.clone().transform(c.attributes.viewer.transform);e._viewer.addMesh(d)}else e._viewer.addMesh(c);e._generatedMeshes=[],e._generatedMeshes.push(c)}b()})),d||b()},_createLayoutFromParamDef:function(a,b,c){var d=b.length,e={children:[]},f={dock:"right",type:"group",group:{children:[]}};if(c&&c.title){var g={type:"label",label:{text:c.title,fontSize:"large"},separated:!1};f.group.children.push(g)}if(c&&c.description){var h={type:"label",label:{text:c.description,fontSize:"small"},separated:!1};f.group.children.push(h)}for(var i=0;d>i;i++){var j=b[i],k={id:j.id,type:"parameter"};f.group.children.push(k)}return e.children.push(f),e.children.push(this._getDefault3DViewerLayout()),e},_getDefault3DViewerLayout:function(){return{dock:"fill",id:"threedviewer",type:"group",group:{type:"view3d",view:{material:{id:"default"},environment:"",modelPosition:[2,-1,-1]},background:{image:""}}}},_onChange:function(a,b){var c=this._shapeGenerator;if(c&&"function"==typeof c.validate){for(var d=this._paramManager.value,e={},f=this._layoutmanager.findContainers({type:"map"}),g=f.length,h,i=0;g>i;i++){var j=f[i];e[j.id]=j.control.value}var k={parameters:d,maps:e};k.changed={},"parametermanager"==a?(k.changed.parameters={},k.changed.parameters[b.data.id]=b.data.oldValue):"map"===a&&(k.changed.maps={},k.changed.maps[b.data.id]=b.data.oldValue,this._viewer.turntable=!1);var l=this;c.validate(k,function(a){a&&a.length>0&&(l._paramManager.updateParams(a),l.layoutmanager&&l.layoutmanager.updateDockPanels())})}},_onMapHover:function(a){if(void 0===a.data.newValue)return this._viewer.highlightSet.clear(),void 0;for(var b=this._layoutmanager.findContainers({type:"map"}),c=b.length,d,e=0;c>e;e++){var f=b[e];a.data.id===f.id&&(d=f.configuration)}if(d&&d.map&&d.map.legend)for(var g=d.map.legend,h=g.length,e=0;h>e;e++){var i=g[e];if(i.color===a.data.newValue){this._highlightMatchedMeshes(i.meshes);break}}},_onRandomize:function(a){var b=this._shapeGenerator;if(b&&"function"==typeof b.randomize){var c=this._paramManager.value,d={config:a,parameters:c},e=this;b.randomize(d,function(a){if(a){for(var b=Object.keys(a),c=b.length,d=[],f=0;c>f;f++){var g=b[f],h=a[g];d.push({id:g,"default":h})}d.length&&(e._paramManager.updateParams(d),e._updateViewer(e._paramManager.value),e.layoutmanager&&e.layoutmanager.updateDockPanels())}})}},_validate:function(){var a=this._layoutmanager.findContainers({type:"map"});if(a&&a.length>0)for(var b=a.length,c=0;b>c;c++){var d=a[c].control,e=a[c].id,f={data:{oldValue:void 0,newValue:d.value,id:e}};this._onChange("map",f)}},_highlightMatchedMeshes:function(a){if(this._viewer.highlightSet.clear(),a&&a.length>0){for(var b={},c=0;c<a.length;c++)b[a[c]]=!0;for(var d=0;d<this._generatedMeshes.length;d++){var e=this._generatedMeshes[d],f=e.attributes.id;b[f]===!0&&this._viewer.highlightSet.add(e)}}},_createParamPanel:function(){if(this._element){this._paramManager=new f.Controls.ParameterManager;var a=this,b=function(b){b.data&&b.data.validate&&a._onChange("parametermanager",b);var c=a._paramManager.value;a._updateViewer(c),a._change.fire(a)};this._paramManager.change.bind(b),this._paramManager.endchange.bind(b)}},_init:function(a){var b=this;if(g(this._element).addClass("hide-layout"),b._element){var c=b._shapeGenerator,d=function(a,c){var d=function(a){return function(c){c.data.id=a,b._onChange("map",c)}},e=function(a){return function(c){c.data.id=a,b._onMapHover(c)}},h=function(a){return function(){b._onRandomize(a)}},i={id:"layoutManager",parent:b._element};g(b._element).addClass("l"+b._library.id+b._library.version);var j;j=c&&c.layout?c.layout:b._createLayoutFromParamDef(i,a,{title:b._library.name,description:b._library.description}),b._layoutmanager=new f.Controls.LayoutManager(i,j),b._viewer=b._layoutmanager.findContainers({type:"view3d"})[0].control,b._viewer.showLoading=!0;var k=b._layoutmanager.findContainers({type:"map"});if(k&&k.length>0)for(var l=k.length,m=0;l>m;m++){var n=k[m].control;n.change.bind(d(k[m].id)),n.itemhover.bind(e(k[m].id))}var o=b._layoutmanager.findContainers({type:"randomizer"});if(o&&o.length>0)for(var p=o.length,m=0;p>m;m++){var q=o[m].control,r=o[m].configuration;q.click.bind(h(r.randomizer))}b._paramManager.layoutManager=b._layoutmanager},e=function(c){b._viewer&&b._updateViewer(c,function(){b._paramManager&&b._defaultParams&&(b._paramManager.updateParams(b._defaultParams),b._validate(),delete b._defaultParams),b._layoutmanager&&b._layoutmanager.updateDockPanels(),b._viewer.home(),b._bindViewerEventHandlers(b._generatedMeshes),a()})};c&&"function"==typeof c.parameters&&c.parameters(function(a){a=g.extend(!0,[],a);for(var f={},h=0;h<a.length;h++){var i=a[h];f[i.id]=i["default"],i.libraryId=b._library.id,i.version=b._library.version}var j=function(a){b._shown?(b._paramManager.updateParams(a),b._validate(),b.layoutmanager&&b.layoutmanager.updateDockPanels(),delete b._shown):b._defaultParams=a};"function"==typeof c.configuration?c.configuration(function(b){d(a,b),j(a),e(f)}):(d(a),j(a),e(f))})}},_show:function(){this._shown||(this._shown=!0,this._viewer&&(this._viewer.resume(),this._viewer.refresh()),this._layoutmanager&&this._layoutmanager.updateDockPanels(),this._firstShow&&this._viewer&&(this._viewer.home(),this._viewer.statusText="Click and drag object to rotate",this._viewer.showLoading=!1,this._firstShow=!1),g(this._element).removeClass("hide-layout"))},_hide:function(){this._shown&&(g(this._element).addClass("hide-layout"),this._shown=!1,this._viewer&&this._viewer.suspend())},_reset:function(){var a=this._shapeGenerator;if(a&&"function"==typeof a.parameters){var b=this;a.parameters(function(a){a=g.extend(!0,[],a),b._paramManager.updateParams(a),b._defaultParams=a,b._viewer&&b._updateViewer(b._paramManager.value,function(){b._viewer.home()}),b._change.fire(b)})}}};var j=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new i(a)}),Object.defineProperty(this,"errorText",{enumerable:!0,get:function(){this._impl._errorText()},set:function(a){this._impl._errorText(a)}}),Object.defineProperty(this,"statusText",{enumerable:!0,get:function(){this._impl._statusText()},set:function(a){this._impl._statusText(a)}}),Object.defineProperty(this,"change",{writable:!1,enumerable:!0,configurable:!1,value:this._impl._change}),f.Controls.BaseControl.extend(this)};j.prototype.onInitialize=function(){this._impl._createParamPanel(),this.change.bind(d)},j.prototype.init=function(a){this._impl._init(a)},j.prototype.onShow=function(){this._impl._show()},j.prototype.onHide=function(){this._impl._hide()},j.prototype.shapeGeneratorResult=function(a){if("function"==typeof a){var b=this.parameters();this._impl._shapeGenerator&&"function"==typeof this._impl._shapeGenerator.evaluate&&b?this._impl._executeGenerator(this._impl._shapeGenerator,"evaluate",b,a):a()}},j.prototype.imageURL=function(a,b){return this._impl._viewer?this._impl._viewer.imageURL(a,b):void 0},j.prototype.parameters=function(){return this._impl._paramManager?this._impl._paramManager.value||{}:{}},j.prototype.reset=function(){this._impl._reset()};var k=function(){f.Controls.IGroupHandler.extend(this)};k.prototype.create=function(a,c){var d=this.initialize(a,c),e=a.config,f=b.libraryExports("c0HjtqUm7Wz",0),g;try{g=new f.Viewer({parent:d.content.contentArea[0]})}catch(h){return}window.addEventListener("scroll",function(){d.content.contentArea[0].style.webkitTransform="rotateZ(0deg)",d.content.contentArea[0].offsetHeight,d.content.contentArea[0].style.webkitTransform="none"},!0);var i=e.view,j=e.background;i&&(i.material&&i.material.id&&(g.globalMaterial=i.material.id),"string"==typeof i.environment&&(g.environment=i.environment),"boolean"==typeof i.ssao&&(g.ssao=i.ssao),"string"==typeof i.shading&&(g.shading=i.shading)),j&&("string"==typeof j.image&&(g.background=j.image),"object"==typeof i.camera&&(g.camera=i.camera)),d.content.resize.bind(function(){g.refresh()}),c.setContainer(a.config,g)};var l=function(){f.Controls.IParameterHandler.extend(this)};l.prototype.create=function(b,c){this.initialize(b,c);var d=b.definition,e=b.parent.contentArea,h=a.creativePlatformRuntime,i,j=c._layoutmanager.findContainers({type:"view3d"});if(j&&j.length>0){var k=g(j[0].control._impl.element).parent();i=k.find(".ui-fileeditor-parent"),0===i.size()&&(i=g('<div class="ui-fileeditor-parent" style="display:none;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#ffffff;z-index:999"></div>'),i.appendTo(k)),i.empty()}var l=new f.Controls.FileManager({id:d.id,parent:e,editorParent:i,config:d.config,accept:d.accept,maxSize:d.maxSize});d.default&&(d.default.url||d.default.fileURL)&&(l.value=d.default),l.param=function(a){return function(){return a._file&&JSON.stringify(a._file._impl._json)==JSON.stringify(a.value)||a.value&&(a.value.url||a.value.fileURL)&&(delete a.value.url,a._file=h.createFile(a.value)),a._file}}(l),c.setControl(d,l)},f.Controls.LayoutHandlers.addGroupHandler("view3d",new k,"true"),f.Controls.ParameterHandlers.addParameterHandler("file",new l),c.exports.Player=j;var m=function(a){function b(b){a[b]&&(c[b]=function(){a[b].apply(a,arguments)})}this.configurator=a;var c=this;["parameters","presets","validate","configuration","randomize"].forEach(b)};m.prototype={evaluate:function(a,b){this._generateMesh(a,!1,b)},preview:function(a,b){this._generateMesh(a,!0,b)},_generateMesh:function(b,c,d){var f=this,g=function(b,d){b.isSub===!0&&e.Plugin.panic("The substraction shape is not supported.");var f=function(a,b){a instanceof e.Matrix3D||(a=new e.Matrix3D(a));for(var c=0;c<b.length;c++)b[c].transform(a)},h=function(a){return!a||a.length<1?!1:!0},i=function(b,c,d){function f(a,c){function e(a,b){var c=a.libraryId,d=a.libraryRev,e=a.params,f={id:c,version:d,executionMethod:"evaluate",scope:[{symbol:"shapeModifier",symbolIsMethod:!0}],executionAsynchronous:!0,executionParams:{instances:b,params:e}};return f}function f(b){if(h+=1,h===g)return d(b),void 0;var i=e(c[h],b);a(i,f)}var g=c?c.length:0,h=-1;f(b)}function g(b,c){a.creativePlatformRuntime.execute(b,function d(a){a=JSON.parse(JSON.stringify(a)),c(a.output)},function f(){e.Plugin.panic("Failed to exeucte shape modifier ("+b.id+","+b.version+")")})}f(g,c)},j=function(a,b){for(var c=[],d=0;d<a.length;d++){var g=a[d].mesh,h=new e.Mesh3D;h.indexedTriangles(g.vertices,g.triangles);var i=e.Solid.make(h);f(a[d].localToParent,[i]),c.push(i)}b(c)},k=b.children;if(!Array.isArray(k)||0===k.length){var l=b.geom&&b.geom.pluginType?b.geom.pluginType:"";l&&"library"!==l&&e.Plugin.panic("The pluginType "+l+" is not supported.");var m=b.geom.pluginId,n=b.geom.pluginRev,o={id:m,version:n,executionMethod:"evaluate",scope:[{symbol:"shapeGenerator",symbolIsMethod:!0}],executionAsynchronous:!0,executionParams:b.geom.params,environment:{execution:{scale:b.geom.scale}}};a.creativePlatformRuntime.execute(o,function u(a){var c=new e.Mesh3D;c.indexedTriangles(a.Verts,a.Tris);var g=new e.Matrix3D;g.transform(b.TM);var k=b.mods;if(!h(k)){var l=e.Solid.make(c);return f(g,[l]),d([l]),void 0}var m=[];m.push(new e.Instance(g,c)),i(m,k,function(a){j(a,d)})},function v(){e.Plugin.panic("Failed to exeucte shape generator ("+m+","+n+")")})}for(var p=k.length,q=p,r={},s=function(a,g){if(r[a]=g,q--,0===q){var k;if(c){var l=b.mods;if(h(l)){var m=new e.Matrix3D;m.transform(b.TM);for(var n=[],o=0;p>o;o++)for(var s=0;s<r[o].length;s++)n.push(new e.Instance(m,r[o][s].mesh));i(n,l,function(a){j(a,d)})}else{k=[];for(var o=0;p>o;o++)k=k.concat(r[o]);f(b.TM,k),d(k)}}else{for(var t=new e.Mesh3D,o=0;p>o;o++)for(var s=0;s<r[o].length;s++)t.combine(r[o][s].mesh);var l=b.mods;if(h(l)){var m=new e.Matrix3D;m.transform(b.TM);var n=[];n.push(new e.Instance(m,t)),i(n,l,function(a){j(a,d)})}else k=e.Solid.make(t),f(b.TM,[k]),d([k])}}},t=0;p>t;t++)g(k[t],function(a){return function(b){s(a,b)}}(t))},h=function(a,b){f.configurator.shape(function(c){var d={shape:c,params:a};b(d)})};h(b,function(a){f.configurator.evaluate(a,function(a){g(a.toJSON(),d)})})}}};a.creativePlatformLibrary0vW3XxB8WwNrev0=c,function(){var c=a.creativePlatformRuntime.environment,d=c.getVariable(["callbacks","panic"]);c.setVariable(["callbacks","panic"],function(a,e){var f=c.getVariable(["andes","initArgs"]);f&&f.failedCallback?f.failedCallback():b.log(a),d&&d(a)})}()}("undefined"==typeof k?window:k),function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(b,c){var d={},e=b.libraryExports("aZS9YbvfqUX",0),f=b.libraryExports("0vW3XxB8WwN",0),g=e.jQuery;c&&(c.name="Autodesk Distribute Connect",c.description="",c.resources=[{id:"7xS96PF92q8",name:"core.css"},{id:"5xtHw5PLnit",name:"openhand.cur"},{id:"7Vx01oJYm22",name:"background.png"}]);var h=function(){};h.prototype={init:function(a){},update:function(a){},show:function(a){},hide:function(a){},ready:function(a){},getData:function(a){}},c.exports.Connector={getConnector:function(a,b){return new d[a]}};var i=i||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e=!a.externalHost&&"download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=10,m=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var l=this,o=b.type,p=!1,q,r,s=function(){n(l,"writestart progress write writeend".split(" "))},t=function(){if((p||!q)&&(q=c().createObjectURL(b)),r)r.location.href=q;else{var d=a.open(q,"_blank");void 0==d&&"undefined"!=typeof safari&&(a.location.href=q)}l.readyState=l.DONE,s(),m(q)},u=function(a){return function(){return l.readyState!==l.DONE?a.apply(this,arguments):void 0}},v={create:!0,exclusive:!1},w;return l.readyState=l.INIT,i||(i="download"),e?(q=c().createObjectURL(b),d.href=q,d.download=i,f(d),l.readyState=l.DONE,s(),m(q),void 0):(a.chrome&&o&&o!==j&&(w=b.slice||b.webkitSlice,b=w.call(b,0,b.size,j),p=!0),g&&"download"!==i&&(i+=".download"),(o===j||g)&&(r=a),h?(k+=b.size,h(a.TEMPORARY,k,u(function(a){a.root.getDirectory("saved",v,u(function(a){var c=function(){a.getFile(i,v,u(function(a){a.createWriter(u(function(c){c.onwriteend=function(b){r.location.href=a.toURL(),l.readyState=l.DONE,n(l,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&t()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=l["on"+a]}),c.write(b),l.abort=function(){c.abort(),l.readyState=l.DONE},l.readyState=l.WRITING}),t)}),t)};a.getFile(i,{create:!1},u(function(a){a.remove(),c()}),u(function(a){a.code===a.NOT_FOUND_ERR?c():t()}))}),t)}),t),void 0):(t(),void 0))},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=i:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return i});var j=function(){};j.prototype=new h,j.prototype.constructor=j,j.prototype.init=function(a){this.args=a},j.prototype.ready=function(){g(this.args.parent).addClass("l"+c.id+c.version);var a={library:this.args.library,parent:this.args.parent},b=new f.Player(a),d=document.getElementById("loadingIndicator"),h=[];h.push(c.resourceURL("core.css"));for(var i=this.args.library.resources.length,j=0;i>j;j++){var l=this.args.library.resources[j].name;"default.css"===l&&h.push(this.args.library.resourceURL(l))}k.loadThemeAndCSS(e.Themes.Tinkercad,h,function(){b.init(function(){b.show(),d&&(d.style.display="none")})})},d["default"]=j;var k=function(){return{loadThemeAndCSS:function(a,b,c){var d=1;b&&b.length>0&&d++;var f=function(){d--,0===d&&c&&c()};e.Utility.loadTheme(a,f),e.Utility.loadCSS(b,f,a)},getData:function(b,c){c.shapeGeneratorResult(function(d){var e=c.imageURL(385,500),f=e.indexOf(",")+1,g=e.substr(f),h=e.indexOf(":")+1,i=e.indexOf(";"),j=e.substring(h,i),k=a.creativePlatformRuntime.environment.libraryExports("1vxKXGNaLtr",0),l=k.Conversions.toBinarySTLFromMesh3D(d.mesh),m=k.Conversions.toBase64FromArrayBuffer(l),n=c.parameters(),o=[];for(var p in n){var q=p+" "+n[p];o.push(q)}var r=o.join("-"),s={materialAndColor:n.materialAndColor,description:r,text:""},t={files:[{name:"3d.stl",content:m,"content-type":"text/plain","content-encoding":"base64"}],previews:[{name:"385x500",content:g,"content-type":j,"content-encoding":"base64"}],presets:c.parameters(),metaData:s};b.callback(t)})}}}();a.creativePlatformRuntime.environment.getVariable(["disconnected","enabled"])&&(window.creativePlatformRuntime=a.creativePlatformRuntime)};a.creativePlatformLibraryaLVZT9dTtGGrev0=c}("undefined"==typeof k?window:k),function(a){var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(a,b){function c(){return p}var d=a.libraryExports("1vxKXGNaLtr",0),e,f,g,h,i,c;b&&(b.name="Type",b.description="Moveable Type",b.resources=[{id:"k0MuKhGMkAV",name:"HussarBoldWeb.svg"},{id:"4yjV7zHrBm5",name:"aver.svg"},{id:"eq6NEjoIeFQ",name:"bebas.svg"},{id:"3Z7OEVV8rP9",name:"majorsnafu.svg"},{id:"lRQVk2gfdqw",name:"techniqu.svg"}]);var j=d.Mesh3D,k=d.Solid,l=d.Debug,m=d.Font,n=d.Creation,o=d.Conversions,p={parameters:function(a){for(var b={"Hussar Bold":"HussarBoldWeb.svg",Bebas:"bebas.svg",Majorsnafu:"majorsnafu.svg",Techniqu:"techniqu.svg",Aver:"aver.svg"},c=Object.keys(b),d=[],e=0;e<c.length;++e)d.push(b[c[e]]);var f=[{id:"font",displayName:"Font",type:"list",listLabels:c,listValues:d,"default":d[0]},{id:"char",displayName:"Character",type:"string",maxLength:32,singleLine:"true","default":"Q"},{id:"body",displayName:"Body Size",type:"float",rangeMin:10,rangeMax:72,"default":22},{id:"point",displayName:"Point Size",type:"float",rangeMin:10,rangeMax:72,"default":12},{id:"margin",displayName:"Set Width Margins",type:"float",rangeMin:0,rangeMax:5,"default":0},{id:"nickHeight",displayName:"Nick Height",type:"float",rangeMin:3,rangeMax:22,"default":5}];a(f)},evaluate:function(a,c){a.point=.3515*a.point;var d=a["char"],e=a.point,f=a.body,g=1.3172;d.trim()||(d="Q");var h=new j,i=[];b.resourceText(a.font,function(b){var h=32,i=new m(b,e*h),j=o.toSketch2DFromText(d,i);j||Plugin.panic("Sketch could not be generated.");var l=k.extrude(j,g);l.transform([1/h,0,0,0,0,1/h,0,0,0,0,1,0,0,0,0,1]);var n=l.mesh.bounds();l.transform([1,0,0,0,0,1,0,0,0,0,1,0,-n.center().x,0,f+.001,1]),a.width=n.length()+2*a.margin,p.createBody(a,function(a){l.mesh.combineByBoundaries(a,{ours:l.mesh.boundaries(),theirs:a.boundaries()}),c(l)})})},createBody:function(a,b){var c=1e3*a.point/750,d=a.body,e=a.width/2,f=a.nickHeight,g=.75,h=32,i=new j,k=[],l=[],m=[];k.push([e,0,0]),k.push([-e,0,0]),k.push([-e,-c,0]),k.push([e,-c,0]),k.push([e,0,d]),k.push([-e,0,d]),k.push([-e,-c,d]),k.push([e,-c,d]);for(var n=0;h>n;n++){var o=n*Math.PI/(h-1);l.push([-e,-c+g*Math.sin(o),f+g*Math.cos(o)]),m.push([e,-c+g*Math.sin(o),f+g*Math.cos(o)])}i.quad(k[3],k[2],k[1],k[0]),i.quad(k[5],k[4],k[0],k[1]),i.quad(k[4],k[5],k[6],k[7]),i.triangle(m[0],k[4],k[7]),i.triangle(l[0],k[6],k[5]),i.quad(k[7],k[6],l[0],m[0]),i.triangle(m[h-1],k[3],k[0]),i.triangle(l[h-1],k[1],k[2]),i.quad(k[2],k[3],m[h-1],l[h-1]);for(var p=k[4],q=k[5],n=0;h-1>n;n++)n==Math.floor(h/2)-1&&(p=k[0],q=k[1],i.triangle(p,k[4],m[n]),i.triangle(k[5],q,l[n])),i.triangle(m[n],m[n+1],p),i.triangle(l[n+1],l[n],q),i.quad(m[n],l[n],l[n+1],m[n+1]);b(i)},drawAxis:function(){l.color([1,192/255,203/255,.8]),l.point([0,0,0]),l.line([-20,0,0],[20,0,0]),l.line([0,-20,0],[0,20,0]),l.line([0,0,-20],[0,0,20])}};if("function"==typeof c)b.exports.shapeGenerator=c;else{var q,r;if("function"==typeof h?q=function(a){return function(b,c){a(b,c)}}(h):"function"==typeof f&&(q=function(a){return function(b,c){c(a(b))}}(f)),"function"==typeof i?r=function(a){return function(b){a(b)}}(i):"object"==typeof e&&(r=function(a){return function(b){b(a)}}(e)),q){var s={};r&&(s.parameters=r),q&&(s.evaluate=q),g&&(s.presets=function(a){return function(b){b(a)}}(g)),b.exports.shapeGenerator=function(a){return function(){return a}}(s)}}};a.creativePlatformLibrarycTLKjc2L7R7rev4=c}("undefined"==typeof k?window:k);var m=k.creativePlatformRuntime.environment.getVariable(["runtime","libraries"]);if(m instanceof Array)for(var n=0;n<m.length;n++)k.creativePlatformRuntime.loadLibrary(m[n])}([],easyXDM,Tess2,jQuery,Handlebars,THREE,UAParser,CSG,$,TWEEN);
//# sourceMappingURL=library.min.map