!function(e){"use strict";function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function n(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function i(e){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=e}function r(){var e=new t,r=new n,s=new i(0),o=new i(1);e.next=e.prev=e,e.anEdge=null,r.next=r.prev=r,r.anEdge=null,r.trail=null,r.marked=!1,r.inside=!1,s.next=s,s.Sym=o,s.Onext=null,s.Lnext=null,s.Org=null,s.Lface=null,s.winding=0,s.activeRegion=null,o.next=o,o.Sym=s,o.Onext=null,o.Lnext=null,o.Org=null,o.Lface=null,o.winding=0,o.activeRegion=null,this.vHead=e,this.fHead=r,this.eHead=s,this.eHeadSym=o}function s(){this.key=null,this.next=null,this.prev=null}function o(e,t){this.head=new s,this.head.next=this.head,this.head.prev=this.head,this.frame=e,this.leq=t}function d(){this.handle=null}function l(){this.key=null,this.node=null}function h(e,t){this.size=0,this.max=e,this.nodes=[],this.nodes.length=e+1;for(var n=0;n<this.nodes.length;n++)this.nodes[n]=new d;this.handles=[],this.handles.length=e+1;for(var n=0;n<this.handles.length;n++)this.handles[n]=new l;this.initialized=!1,this.freeList=0,this.leq=t,this.nodes[1].handle=1,this.handles[1].key=null}function a(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}function g(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=c.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}var c={};e.Tess2=c,c.WINDING_ODD=0,c.WINDING_NONZERO=1,c.WINDING_POSITIVE=2,c.WINDING_NEGATIVE=3,c.WINDING_ABS_GEQ_TWO=4,c.POLYGONS=0,c.CONNECTED_POLYGONS=1,c.BOUNDARY_CONTOURS=2,c.tesselate=function(e){for(var t=e.debug||!1,n=new g,i=0;i<e.contours.length;i++)n.addContour(e.vertexSize||2,e.contours[i]);return n.tesselate(e.windingRule||c.WINDING_ODD,e.elementType||c.POLYGONS,e.polySize||3,e.vertexSize||2,e.normal||[0,0,1]),{vertices:n.vertices,vertexIndices:n.vertexIndices,vertexCount:n.vertexCount,elements:n.elements,elementCount:n.elementCount,mesh:t?n.mesh:void 0}};var f=function(e){if(!e)throw"Assertion Failed!"};i.prototype={get Rface(){return this.Sym.Lface},set Rface(e){this.Sym.Lface=e},get Dst(){return this.Sym.Org},set Dst(e){this.Sym.Org=e},get Oprev(){return this.Sym.Lnext},set Oprev(e){this.Sym.Lnext=e},get Lprev(){return this.Onext.Sym},set Lprev(e){this.Onext.Sym=e},get Dprev(){return this.Lnext.Sym},set Dprev(e){this.Lnext.Sym=e},get Rprev(){return this.Sym.Onext},set Rprev(e){this.Sym.Onext=e},get Dnext(){return this.Sym.Onext.Sym},set Dnext(e){this.Sym.Onext.Sym=e},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(e){this.Sym.Lnext.Sym=e}},r.prototype={makeEdge_:function(e){var t=new i(0),n=new i(1);e.Sym.side<e.side&&(e=e.Sym);var r=e.Sym.next;return n.next=r,r.Sym.next=t,t.next=e,e.Sym.next=n,t.Sym=n,t.Onext=t,t.Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,n.Onext=n,n.Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},splice_:function(e,t){var n=e.Onext,i=t.Onext;n.Sym.Lnext=t,i.Sym.Lnext=e,e.Onext=i,t.Onext=n},makeVertex_:function(e,t,n){var i=e;f(null!==i);var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t;var s=t;do s.Org=i,s=s.Onext;while(s!==t)},makeFace_:function(e,t,n){var i=e;f(null!==i);var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t,i.trail=null,i.marked=!1,i.inside=n.inside;var s=t;do s.Lface=i,s=s.Lnext;while(s!==t)},killEdge_:function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,n=e.Sym.next;t.Sym.next=n,n.Sym.next=t},killVertex_:function(e,t){var n=e.anEdge,i=n;do i.Org=t,i=i.Onext;while(i!==n);var r=e.prev,s=e.next;s.prev=r,r.next=s},killFace_:function(e,t){var n=e.anEdge,i=n;do i.Lface=t,i=i.Lnext;while(i!==n);var r=e.prev,s=e.next;s.prev=r,r.next=s},makeEdge:function(){var e=new t,i=new t,r=new n,s=this.makeEdge_(this.eHead);return this.makeVertex_(e,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},splice:function(e,i){var r=!1,s=!1;if(e!==i){if(i.Org!==e.Org&&(s=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!s){var o=new t;this.makeVertex_(o,i,e.Org),e.Org.anEdge=e}if(!r){var d=new n;this.makeFace_(d,i,e.Lface),e.Lface.anEdge=e}}},"delete":function(e){var t=e.Sym,i=!1;if(e.Lface!==e.Rface&&(i=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!i){var r=new n;this.makeFace_(r,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},addEdgeVertex:function(e){var n=this.makeEdge_(e),i=n.Sym;this.splice_(n,e.Lnext),n.Org=e.Dst;var r=new t;return this.makeVertex_(r,i,n.Org),n.Lface=i.Lface=e.Lface,n},splitEdge:function(e){var t=this.addEdgeVertex(e),n=t.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,n),e.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=e.Rface,n.winding=e.winding,n.Sym.winding=e.Sym.winding,n},connect:function(e,t){var i=!1,r=this.makeEdge_(e),s=r.Sym;if(t.Lface!==e.Lface&&(i=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(r,e.Lnext),this.splice_(s,t),r.Org=e.Dst,s.Org=t.Org,r.Lface=s.Lface=e.Lface,e.Lface.anEdge=s,!i){var o=new n;this.makeFace_(o,r,e.Lface)}return r},zapFace:function(e){var t,n,i,r,s,o=e.anEdge;n=o.Lnext;do t=n,n=t.Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),i=t.Sym,i.Onext===i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t));while(t!=o);r=e.prev,s=e.next,s.prev=r,r.next=s},countFaceVerts_:function(e){var t=e.anEdge,n=0;do n++,t=t.Lnext;while(t!==e.anEdge);return n},mergeConvexFaces:function(e){var t,n,i,r,s,o,d;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(n=t.anEdge,s=n.Org;;){if(i=n.Lnext,r=n.Sym,r&&r.Lface&&r.Lface.inside&&(o=this.countFaceVerts_(t),d=this.countFaceVerts_(r.Lface),e>=o+d-2&&u.vertCCW(n.Lprev.Org,n.Org,r.Lnext.Lnext.Org)&&u.vertCCW(r.Lprev.Org,r.Org,n.Lnext.Lnext.Org)&&(i=r.Lnext,this.delete(r),n=null,r=null)),n&&n.Lnext.Org===s)break;n=i}return!0},check:function(){var e,t,n,i,r,s,o=this.fHead,d=this.vHead,l=this.eHead;for(t=o,t=o;(e=t.next)!==o;t=e){f(e.prev===t),r=e.anEdge;do f(r.Sym!==r),f(r.Sym.Sym===r),f(r.Lnext.Onext.Sym===r),f(r.Onext.Sym.Lnext===r),f(r.Lface===e),r=r.Lnext;while(r!==e.anEdge)}for(f(e.prev===t&&null===e.anEdge),i=d,i=d;(n=i.next)!==d;i=n){f(n.prev===i),r=n.anEdge;do f(r.Sym!==r),f(r.Sym.Sym===r),f(r.Lnext.Onext.Sym===r),f(r.Onext.Sym.Lnext===r),f(r.Org===n),r=r.Onext;while(r!==n.anEdge)}for(f(n.prev===i&&null===n.anEdge),s=l,s=l;(r=s.next)!==l;s=r)f(r.Sym.next===s.Sym),f(r.Sym!==r),f(r.Sym.Sym===r),f(null!==r.Org),f(null!==r.Dst),f(r.Lnext.Onext.Sym===r),f(r.Onext.Sym.Lnext===r);f(r.Sym.next===s.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)}};var u={};u.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},u.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},u.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},u.edgeGoesLeft=function(e){return u.vertLeq(e.Dst,e.Org)},u.edgeGoesRight=function(e){return u.vertLeq(e.Org,e.Dst)},u.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},u.edgeEval=function(e,t,n){f(u.vertLeq(e,t)&&u.vertLeq(t,n));var i=t.s-e.s,r=n.s-t.s;return i+r>0?r>i?t.t-e.t+(e.t-n.t)*(i/(i+r)):t.t-n.t+(n.t-e.t)*(r/(i+r)):0},u.edgeSign=function(e,t,n){f(u.vertLeq(e,t)&&u.vertLeq(t,n));var i=t.s-e.s,r=n.s-t.s;return i+r>0?(t.t-n.t)*i+(t.t-e.t)*r:0},u.transEval=function(e,t,n){f(u.transLeq(e,t)&&u.transLeq(t,n));var i=t.t-e.t,r=n.t-t.t;return i+r>0?r>i?t.s-e.s+(e.s-n.s)*(i/(i+r)):t.s-n.s+(n.s-e.s)*(r/(i+r)):0},u.transSign=function(e,t,n){f(u.transLeq(e,t)&&u.transLeq(t,n));var i=t.t-e.t,r=n.t-t.t;return i+r>0?(t.s-n.s)*i+(t.s-e.s)*r:0},u.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},u.interpolate=function(e,t,n,i){return e=0>e?0:e,n=0>n?0:n,n>=e?0==n?(t+i)/2:t+(i-t)*(e/(e+n)):i+(t-i)*(n/(e+n))},u.intersect=function(e,t,n,i,r){var s,o,d;u.vertLeq(e,t)||(d=e,e=t,t=d),u.vertLeq(n,i)||(d=n,n=i,i=d),u.vertLeq(e,n)||(d=e,e=n,n=d,d=t,t=i,i=d),u.vertLeq(n,t)?u.vertLeq(t,i)?(s=u.edgeEval(e,n,t),o=u.edgeEval(n,t,i),0>s+o&&(s=-s,o=-o),r.s=u.interpolate(s,n.s,o,t.s)):(s=u.edgeSign(e,n,t),o=-u.edgeSign(e,i,t),0>s+o&&(s=-s,o=-o),r.s=u.interpolate(s,n.s,o,i.s)):r.s=(n.s+t.s)/2,u.transLeq(e,t)||(d=e,e=t,t=d),u.transLeq(n,i)||(d=n,n=i,i=d),u.transLeq(e,n)||(d=e,e=n,n=d,d=t,t=i,i=d),u.transLeq(n,t)?u.transLeq(t,i)?(s=u.transEval(e,n,t),o=u.transEval(n,t,i),0>s+o&&(s=-s,o=-o),r.t=u.interpolate(s,n.t,o,t.t)):(s=u.transSign(e,n,t),o=-u.transSign(e,i,t),0>s+o&&(s=-s,o=-o),r.t=u.interpolate(s,n.t,o,i.t)):r.t=(n.t+t.t)/2},o.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){var t=this.head;do t=t.next;while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},insertBefore:function(e,t){do e=e.prev;while(null!==e.key&&!this.leq(this.frame,e.key,t));var n=new s;return n.key=t,n.next=e.next,e.next.prev=n,n.prev=e,e.next=n,n},"delete":function(e){e.next.prev=e.prev,e.prev.next=e.next}},h.prototype={floatDown_:function(e){var t,n,i,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if(i=e<<1,i<this.size&&this.leq(s[r[i+1].handle].key,s[r[i].handle].key)&&++i,f(i<=this.max),n=r[i].handle,i>this.size||this.leq(s[t].key,s[n].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=n,s[n].node=e,e=i}},floatUp_:function(e){var t,n,i,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if(i=e>>1,n=r[i].handle,0==i||this.leq(s[n].key,s[t].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=n,s[n].node=e,e=i}},init:function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){0===this.size},insert:function(e){var t,n;if(t=++this.size,2*t>this.max){this.max*=2;var i;i=this.nodes.length,this.nodes.length=this.max+1;for(var r=i;r<this.nodes.length;r++)this.nodes[r]=new d;i=this.handles.length,this.handles.length=this.max+1;for(var r=i;r<this.handles.length;r++)this.handles[r]=new l}return 0===this.freeList?n=t:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[t].handle=n,this.handles[n].node=t,this.handles[n].key=e,this.initialized&&this.floatUp_(t),n},extractMin:function(){var e=this.nodes,t=this.handles,n=e[1].handle,i=t[n].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),i},"delete":function(e){var t,n=this.nodes,i=this.handles;f(e>=1&&e<=this.max&&null!==i[e].key),t=i[e].node,n[t].handle=n[this.size].handle,i[n[t].handle].node=t,--this.size,t<=this.size&&(1>=t||this.leq(i[n[t>>1].handle].key,i[n[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),i[e].key=null,i[e].node=this.freeList,this.freeList=e}};var v={};v.regionBelow=function(e){return e.nodeUp.prev.key},v.regionAbove=function(e){return e.nodeUp.next.key},v.debugEvent=function(){},v.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},v.edgeLeq=function(e,t,n){var i,r,s=e.event,o=t.eUp,d=n.eUp;if(o.Dst===s)return d.Dst===s?u.vertLeq(o.Org,d.Org)?u.edgeSign(d.Dst,o.Org,d.Org)<=0:u.edgeSign(o.Dst,d.Org,o.Org)>=0:u.edgeSign(d.Dst,s,d.Org)<=0;if(d.Dst===s)return u.edgeSign(o.Dst,s,o.Org)>=0;var i=u.edgeEval(o.Dst,s,o.Org),r=u.edgeEval(d.Dst,s,d.Org);return i>=r},v.deleteRegion=function(e,t){t.fixUpperEdge&&f(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},v.fixUpperEdge=function(e,t,n){f(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t},v.topLeftRegion=function(e,t){var n,i=t.eUp.Org;do t=v.regionAbove(t);while(t.eUp.Org===i);if(t.fixUpperEdge){if(n=e.mesh.connect(v.regionBelow(t).eUp.Sym,t.eUp.Lnext),null===n)return null;v.fixUpperEdge(e,t,n),t=v.regionAbove(t)}return t},v.topRightRegion=function(e){var t=e.eUp.Dst,e=null;do e=v.regionAbove(e);while(e.eUp.Dst===t);return e},v.addRegionBelow=function(e,t,n){var i=new a;return i.eUp=n,i.nodeUp=e.dict.insertBefore(t.nodeUp,i),i.fixUpperEdge=!1,i.sentinel=!1,i.dirty=!1,n.activeRegion=i,i},v.isWindingInside=function(e,t){switch(e.windingRule){case c.WINDING_ODD:return 0!=(1&t);case c.WINDING_NONZERO:return 0!=t;case c.WINDING_POSITIVE:return t>0;case c.WINDING_NEGATIVE:return 0>t;case c.WINDING_ABS_GEQ_TWO:return t>=2||-2>=t}return f(!1),!1},v.computeWinding=function(e,t){t.windingNumber=v.regionAbove(t).windingNumber+t.eUp.winding,t.inside=v.isWindingInside(e,t.windingNumber)},v.finishRegion=function(e,t){var n=t.eUp,i=n.Lface;i.inside=t.inside,i.anEdge=n,v.deleteRegion(e,t)},v.finishLeftRegions=function(e,t,n){for(var i,r,s=null,o=t,r=t.eUp;o!==n;){if(o.fixUpperEdge=!1,s=v.regionBelow(o),i=s.eUp,i.Org!=r.Org){if(!s.fixUpperEdge){v.finishRegion(e,o);break}i=e.mesh.connect(r.Lprev,i.Sym),v.fixUpperEdge(e,s,i)}r.Onext!==i&&(e.mesh.splice(i.Oprev,i),e.mesh.splice(r,i)),v.finishRegion(e,o),r=s.eUp,o=s}return r},v.addRightEdges=function(e,t,n,i,r,s){var o,d,l,h,a=!0;l=n;do f(u.vertLeq(l.Org,l.Dst)),v.addRegionBelow(e,t,l.Sym),l=l.Onext;while(l!==i);for(null===r&&(r=v.regionBelow(t).eUp.Rprev),d=t,h=r;o=v.regionBelow(d),l=o.eUp.Sym,l.Org===h.Org;)l.Onext!==h&&(e.mesh.splice(l.Oprev,l),e.mesh.splice(h.Oprev,l)),o.windingNumber=d.windingNumber-l.winding,o.inside=v.isWindingInside(e,o.windingNumber),d.dirty=!0,!a&&v.checkForRightSplice(e,d)&&(v.addWinding(l,h),v.deleteRegion(e,d),e.mesh.delete(h)),a=!1,d=o,h=l;d.dirty=!0,f(d.windingNumber-l.winding===o.windingNumber),s&&v.walkDirtyRegions(e,d)},v.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)},v.vertexWeights=function(e,t,n){var i=u.vertL1dist(t,e),r=u.vertL1dist(n,e),s=.5*r/(i+r),o=.5*i/(i+r);e.coords[0]+=s*t.coords[0]+o*n.coords[0],e.coords[1]+=s*t.coords[1]+o*n.coords[1],e.coords[2]+=s*t.coords[2]+o*n.coords[2]},v.getIntersectData=function(e,t,n,i,r,s){t.coords[0]=t.coords[1]=t.coords[2]=0,t.idx=-1,v.vertexWeights(t,n,i),v.vertexWeights(t,r,s)},v.checkForRightSplice=function(e,t){var n=v.regionBelow(t),i=t.eUp,r=n.eUp;if(u.vertLeq(i.Org,r.Org)){if(u.edgeSign(r.Dst,i.Org,r.Org)>0)return!1;u.vertEq(i.Org,r.Org)?i.Org!==r.Org&&(e.pq.delete(i.Org.pqHandle),v.spliceMergeVertices(e,r.Oprev,i)):(e.mesh.splitEdge(r.Sym),e.mesh.splice(i,r.Oprev),t.dirty=n.dirty=!0)}else{if(u.edgeSign(i.Dst,r.Org,i.Org)<0)return!1;v.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(i.Sym),e.mesh.splice(r.Oprev,i)}return!0},v.checkForLeftSplice=function(e,t){var n,i=v.regionBelow(t),r=t.eUp,s=i.eUp;if(f(!u.vertEq(r.Dst,s.Dst)),u.vertLeq(r.Dst,s.Dst)){if(u.edgeSign(r.Dst,s.Dst,r.Org)<0)return!1;v.regionAbove(t).dirty=t.dirty=!0,n=e.mesh.splitEdge(r),e.mesh.splice(s.Sym,n),n.Lface.inside=t.inside}else{if(u.edgeSign(s.Dst,r.Dst,s.Org)>0)return!1;t.dirty=i.dirty=!0,n=e.mesh.splitEdge(s),e.mesh.splice(r.Lnext,s.Sym),n.Rface.inside=t.inside}return!0},v.checkForIntersect=function(e,n){var i,r,s,o,d=v.regionBelow(n),l=n.eUp,h=d.eUp,a=l.Org,g=h.Org,c=l.Dst,x=h.Dst,m=new t;if(f(!u.vertEq(x,c)),f(u.edgeSign(c,e.event,a)<=0),f(u.edgeSign(x,e.event,g)>=0),f(a!==e.event&&g!==e.event),f(!n.fixUpperEdge&&!d.fixUpperEdge),a===g)return!1;if(i=Math.min(a.t,c.t),r=Math.max(g.t,x.t),i>r)return!1;if(u.vertLeq(a,g)){if(u.edgeSign(x,a,g)>0)return!1}else if(u.edgeSign(c,g,a)<0)return!1;return v.debugEvent(e),u.intersect(c,a,x,g,m),f(Math.min(a.t,c.t)<=m.t),f(m.t<=Math.max(g.t,x.t)),f(Math.min(x.s,c.s)<=m.s),f(m.s<=Math.max(g.s,a.s)),u.vertLeq(m,e.event)&&(m.s=e.event.s,m.t=e.event.t),s=u.vertLeq(a,g)?a:g,u.vertLeq(s,m)&&(m.s=s.s,m.t=s.t),u.vertEq(m,a)||u.vertEq(m,g)?(v.checkForRightSplice(e,n),!1):!u.vertEq(c,e.event)&&u.edgeSign(c,e.event,m)>=0||!u.vertEq(x,e.event)&&u.edgeSign(x,e.event,m)<=0?x===e.event?(e.mesh.splitEdge(l.Sym),e.mesh.splice(h.Sym,l),n=v.topLeftRegion(e,n),l=v.regionBelow(n).eUp,v.finishLeftRegions(e,v.regionBelow(n),d),v.addRightEdges(e,n,l.Oprev,l,l,!0),TRUE):c===e.event?(e.mesh.splitEdge(h.Sym),e.mesh.splice(l.Lnext,h.Oprev),d=n,n=v.topRightRegion(n),o=v.regionBelow(n).eUp.Rprev,d.eUp=h.Oprev,h=v.finishLeftRegions(e,d,null),v.addRightEdges(e,n,h.Onext,l.Rprev,o,!0),!0):(u.edgeSign(c,e.event,m)>=0&&(v.regionAbove(n).dirty=n.dirty=!0,e.mesh.splitEdge(l.Sym),l.Org.s=e.event.s,l.Org.t=e.event.t),u.edgeSign(x,e.event,m)<=0&&(n.dirty=d.dirty=!0,e.mesh.splitEdge(h.Sym),h.Org.s=e.event.s,h.Org.t=e.event.t),!1):(e.mesh.splitEdge(l.Sym),e.mesh.splitEdge(h.Sym),e.mesh.splice(h.Oprev,l),l.Org.s=m.s,l.Org.t=m.t,l.Org.pqHandle=e.pq.insert(l.Org),v.getIntersectData(e,l.Org,a,c,g,x),v.regionAbove(n).dirty=n.dirty=d.dirty=!0,!1)},v.walkDirtyRegions=function(e,t){for(var n,i,r=v.regionBelow(t);;){for(;r.dirty;)t=r,r=v.regionBelow(r);if(!t.dirty&&(r=t,t=v.regionAbove(t),null==t||!t.dirty))return;if(t.dirty=!1,n=t.eUp,i=r.eUp,n.Dst!==i.Dst&&v.checkForLeftSplice(e,t)&&(r.fixUpperEdge?(v.deleteRegion(e,r),e.mesh.delete(i),r=v.regionBelow(t),i=r.eUp):t.fixUpperEdge&&(v.deleteRegion(e,t),e.mesh.delete(n),t=v.regionAbove(r),n=t.eUp)),n.Org!==i.Org)if(n.Dst===i.Dst||t.fixUpperEdge||r.fixUpperEdge||n.Dst!==e.event&&i.Dst!==e.event)v.checkForRightSplice(e,t);else if(v.checkForIntersect(e,t))return;n.Org===i.Org&&n.Dst===i.Dst&&(v.addWinding(i,n),v.deleteRegion(e,t),e.mesh.delete(n),t=v.regionAbove(r))}},v.connectRightVertex=function(e,t,n){var i,r=n.Onext,s=v.regionBelow(t),o=t.eUp,d=s.eUp,l=!1;return o.Dst!==d.Dst&&v.checkForIntersect(e,t),u.vertEq(o.Org,e.event)&&(e.mesh.splice(r.Oprev,o),t=v.topLeftRegion(e,t),r=v.regionBelow(t).eUp,v.finishLeftRegions(e,v.regionBelow(t),s),l=!0),u.vertEq(d.Org,e.event)&&(e.mesh.splice(n,d.Oprev),n=v.finishLeftRegions(e,s,null),l=!0),l?(v.addRightEdges(e,t,n.Onext,r,r,!0),void 0):(i=u.vertLeq(d.Org,o.Org)?d.Oprev:o,i=e.mesh.connect(n.Lprev,i),v.addRightEdges(e,t,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,v.walkDirtyRegions(e,t),void 0)},v.connectLeftDegenerate=function(e,t,n){var i,r,s,o,d;return i=t.eUp,u.vertEq(i.Org,n)?(f(!1),v.spliceMergeVertices(e,i,n.anEdge),void 0):u.vertEq(i.Dst,n)?(f(!1),t=v.topRightRegion(t),d=v.regionBelow(t),s=d.eUp.Sym,r=o=s.Onext,d.fixUpperEdge&&(f(r!==s),v.deleteRegion(e,d),e.mesh.delete(s),s=r.Oprev),e.mesh.splice(n.anEdge,s),u.edgeGoesLeft(r)||(r=null),v.addRightEdges(e,t,s.Onext,o,r,!0),void 0):(e.mesh.splitEdge(i.Sym),t.fixUpperEdge&&(e.mesh.delete(i.Onext),t.fixUpperEdge=!1),e.mesh.splice(n.anEdge,i),v.sweepEvent(e,n),void 0)},v.connectLeftVertex=function(e,t){var n,i,r,s,o,d,l=new a;if(l.eUp=t.anEdge.Sym,n=e.dict.search(l).key,i=v.regionBelow(n)){if(s=n.eUp,o=i.eUp,0===u.edgeSign(s.Dst,t,s.Org))return v.connectLeftDegenerate(e,n,t),void 0;if(r=u.vertLeq(o.Dst,s.Dst)?n:i,n.inside||r.fixUpperEdge){if(r===n)d=e.mesh.connect(t.anEdge.Sym,s.Lnext);else{var h=e.mesh.connect(o.Dnext,t.anEdge);d=h.Sym}r.fixUpperEdge?v.fixUpperEdge(e,r,d):v.computeWinding(e,v.addRegionBelow(e,n,d)),v.sweepEvent(e,t)}else v.addRightEdges(e,n,t.anEdge,t.anEdge,null,!0)}},v.sweepEvent=function(e,t){e.event=t,v.debugEvent(e);for(var n=t.anEdge;null===n.activeRegion;)if(n=n.Onext,n==t.anEdge)return v.connectLeftVertex(e,t),void 0;var i=v.topLeftRegion(e,n.activeRegion);f(null!==i);var r=v.regionBelow(i),s=r.eUp,o=v.finishLeftRegions(e,r,null);o.Onext===s?v.connectRightVertex(e,i,o):v.addRightEdges(e,i,o.Onext,s,s,!0)},v.addSentinel=function(e,t,n,i){var r=new a,s=e.mesh.makeEdge();s.Org.s=n,s.Org.t=i,s.Dst.s=t,s.Dst.t=i,e.event=s.Dst,r.eUp=s,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},v.initEdgeDict=function(e){e.dict=new o(e,v.edgeLeq);var t=e.bmax[0]-e.bmin[0],n=e.bmax[1]-e.bmin[1],i=e.bmin[0]-t,r=e.bmax[0]+t,s=e.bmin[1]-n,d=e.bmax[1]+n;v.addSentinel(e,i,r,s),v.addSentinel(e,i,r,d)},v.doneEdgeDict=function(e){for(var t,n=0;null!==(t=e.dict.min().key);)t.sentinel||(f(t.fixUpperEdge),f(1==++n)),f(0==t.windingNumber),v.deleteRegion(e,t)},v.removeDegenerateEdges=function(e){var t,n,i,r=e.mesh.eHead;for(t=r.next;t!==r;t=n)n=t.next,i=t.Lnext,u.vertEq(t.Org,t.Dst)&&t.Lnext.Lnext!==t&&(v.spliceMergeVertices(e,i,t),e.mesh.delete(t),t=i,i=t.Lnext),i.Lnext===t&&(i!==t&&((i===n||i===n.Sym)&&(n=n.next),e.mesh.delete(i)),(t===n||t===n.Sym)&&(n=n.next),e.mesh.delete(t))},v.initPriorityQ=function(e){var t,n,i,r=0;for(i=e.mesh.vHead,n=i.next;n!==i;n=n.next)r++;for(r+=8,t=e.pq=new h(r,u.vertLeq),i=e.mesh.vHead,n=i.next;n!==i;n=n.next)n.pqHandle=t.insert(n);return n!==i?!1:(t.init(),!0)},v.donePriorityQ=function(e){e.pq=null},v.removeDegenerateFaces=function(e,t){var n,i,r;for(n=t.fHead.next;n!==t.fHead;n=i)i=n.next,r=n.anEdge,f(r.Lnext!==r),r.Lnext.Lnext===r&&(v.addWinding(r.Onext,r),e.mesh.delete(r));return!0},v.computeInterior=function(e){var t,n;if(v.removeDegenerateEdges(e),!v.initPriorityQ(e))return!1;for(v.initEdgeDict(e);null!==(t=e.pq.extractMin());){for(;n=e.pq.min(),null!==n&&u.vertEq(n,t);)n=e.pq.extractMin(),v.spliceMergeVertices(e,t.anEdge,n.anEdge);v.sweepEvent(e,t)}return e.event=e.dict.min().key.eUp.Org,v.debugEvent(e),v.doneEdgeDict(e),v.donePriorityQ(e),v.removeDegenerateFaces(e,e.mesh)?(e.mesh.check(),!0):!1},g.prototype={dot_:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalize_:function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];f(t>0),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},longAxis_:function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},computeNormal_:function(e){var t,n,i,r,s,o,d,l=[0,0,0],h=[0,0,0],a=[0,0,0],g=[0,0,0],c=[0,0,0],f=[null,null,null],u=[null,null,null],v=this.mesh.vHead;for(t=v.next,d=0;3>d;++d)r=t.coords[d],h[d]=r,u[d]=t,l[d]=r,f[d]=t;for(t=v.next;t!==v;t=t.next)for(d=0;3>d;++d)r=t.coords[d],r<h[d]&&(h[d]=r,u[d]=t),r>l[d]&&(l[d]=r,f[d]=t);if(d=0,l[1]-h[1]>l[0]-h[0]&&(d=1),l[2]-h[2]>l[d]-h[d]&&(d=2),h[d]>=l[d])return e[0]=0,e[1]=0,e[2]=1,void 0;for(o=0,n=u[d],i=f[d],a[0]=n.coords[0]-i.coords[0],a[1]=n.coords[1]-i.coords[1],a[2]=n.coords[2]-i.coords[2],t=v.next;t!==v;t=t.next)g[0]=t.coords[0]-i.coords[0],g[1]=t.coords[1]-i.coords[1],g[2]=t.coords[2]-i.coords[2],c[0]=a[1]*g[2]-a[2]*g[1],c[1]=a[2]*g[0]-a[0]*g[2],c[2]=a[0]*g[1]-a[1]*g[0],s=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],s>o&&(o=s,e[0]=c[0],e[1]=c[1],e[2]=c[2]);0>=o&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(a)]=1)},checkOrientation_:function(){var e,t,n,i,r=this.mesh.fHead,s=this.mesh.vHead;for(e=0,t=r.next;t!==r;t=t.next)if(i=t.anEdge,!(i.winding<=0))do e+=(i.Org.s-i.Dst.s)*(i.Org.t+i.Dst.t),i=i.Lnext;while(i!==t.anEdge);if(0>e){for(n=s.next;n!==s;n=n.next)n.t=-n.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,t,n,i,r,s=this.mesh.vHead,o=[0,0,0],d=!1;for(o[0]=this.normal[0],o[1]=this.normal[1],o[2]=this.normal[2],0===o[0]&&0===o[1]&&0===o[2]&&(this.computeNormal_(o),d=!0),t=this.sUnit,n=this.tUnit,i=this.longAxis_(o),t[i]=0,t[(i+1)%3]=1,t[(i+2)%3]=0,n[i]=0,n[(i+1)%3]=0,n[(i+2)%3]=o[i]>0?1:-1,e=s.next;e!==s;e=e.next)e.s=this.dot_(e.coords,t),e.t=this.dot_(e.coords,n);for(d&&this.checkOrientation_(),r=!0,e=s.next;e!==s;e=e.next)r?(this.bmin[0]=this.bmax[0]=e.s,this.bmin[1]=this.bmax[1]=e.t,r=!1):(e.s<this.bmin[0]&&(this.bmin[0]=e.s),e.s>this.bmax[0]&&(this.bmax[0]=e.s),e.t<this.bmin[1]&&(this.bmin[1]=e.t),e.t>this.bmax[1]&&(this.bmax[1]=e.t))},addWinding_:function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},tessellateMonoRegion_:function(e,t){var n,i;for(n=t.anEdge,f(n.Lnext!==n&&n.Lnext.Lnext!==n);u.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;u.vertLeq(n.Org,n.Dst);n=n.Lnext);for(i=n.Lprev;n.Lnext!==i;)if(u.vertLeq(n.Dst,i.Org)){for(;i.Lnext!==n&&(u.edgeGoesLeft(i.Lnext)||u.edgeSign(i.Org,i.Dst,i.Lnext.Dst)<=0);){var r=e.connect(i.Lnext,i);i=r.Sym}i=i.Lprev}else{for(;i.Lnext!=n&&(u.edgeGoesRight(n.Lprev)||u.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);){var r=e.connect(n,n.Lprev);n=r.Sym}n=n.Lnext}for(f(i.Lnext!==n);i.Lnext.Lnext!==n;){var r=e.connect(i.Lnext,i);i=r.Sym}return!0},tessellateInterior_:function(e){var t,n;for(t=e.fHead.next;t!==e.fHead;t=n)if(n=t.next,t.inside&&!this.tessellateMonoRegion_(e,t))return!1;return!0},discardExterior_:function(e){var t,n;for(t=e.fHead.next;t!==e.fHead;t=n)n=t.next,t.inside||e.zapFace(t)},setWindingNumber_:function(e,t,n){var i,r;for(i=e.eHead.next;i!==e.eHead;i=r)r=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:n?e.delete(i):i.winding=0},getNeighbourFace_:function(e){return e.Rface?e.Rface.inside?e.Rface.n:-1:-1},outputPolymesh_:function(e,t,n,i){var r,s,o,d,l,h=0,a=0;for(n>3&&e.mergeConvexFaces(n),r=e.vHead.next;r!==e.vHead;r=r.next)r.n=-1;for(s=e.fHead.next;s!=e.fHead;s=s.next)if(s.n=-1,s.inside){o=s.anEdge,d=0;do r=o.Org,-1===r.n&&(r.n=a,a++),d++,o=o.Lnext;while(o!==s.anEdge);f(n>=d),s.n=h,++h}for(this.elementCount=h,t==c.CONNECTED_POLYGONS&&(h*=2),this.elements=[],this.elements.length=h*n,this.vertexCount=a,this.vertices=[],this.vertices.length=a*i,this.vertexIndices=[],this.vertexIndices.length=a,r=e.vHead.next;r!==e.vHead;r=r.next)if(-1!=r.n){var g=r.n*i;this.vertices[g+0]=r.coords[0],this.vertices[g+1]=r.coords[1],i>2&&(this.vertices[g+2]=r.coords[2]),this.vertexIndices[r.n]=r.idx}var u=0;for(s=e.fHead.next;s!==e.fHead;s=s.next)if(s.inside){o=s.anEdge,d=0;do r=o.Org,this.elements[u++]=r.n,d++,o=o.Lnext;while(o!==s.anEdge);for(l=d;n>l;++l)this.elements[u++]=-1;if(t==c.CONNECTED_POLYGONS){o=s.anEdge;do this.elements[u++]=this.getNeighbourFace_(o),o=o.Lnext;while(o!==s.anEdge);for(l=d;n>l;++l)this.elements[u++]=-1}}},outputContours_:function(e,t){var n,i,r,s=0,o=0;for(this.vertexCount=0,this.elementCount=0,n=e.fHead.next;n!==e.fHead;n=n.next)if(n.inside){r=i=n.anEdge;do this.vertexCount++,i=i.Lnext;while(i!==r);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var d=0,l=0,h=0;for(s=0,n=e.fHead.next;n!==e.fHead;n=n.next)if(n.inside){o=0,r=i=n.anEdge;do this.vertices[d++]=i.Org.coords[0],this.vertices[d++]=i.Org.coords[1],t>2&&(this.vertices[d++]=i.Org.coords[2]),this.vertexIndices[l++]=i.Org.idx,o++,i=i.Lnext;while(i!==r);this.elements[h++]=s,this.elements[h++]=o,s+=o}},addContour:function(e,t){var n,i;for(null===this.mesh&&(this.mesh=new r),2>e&&(e=2),e>3&&(e=3),n=null,i=0;i<t.length;i+=e)null==n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[i+0],n.Org.coords[1]=t[i+1],n.Org.coords[2]=e>2?t[i+2]:0,n.Org.idx=this.vertexIndexCounter++,n.winding=1,n.Sym.winding=-1},tesselate:function(e,t,n,i,r){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=e,2>i&&(i=2),i>3&&(i=3),!this.mesh)return!1;this.projectPolygon_(),v.computeInterior(this);var s=this.mesh;return t==c.BOUNDARY_CONTOURS?this.setWindingNumber_(s,1,!0):this.tessellateInterior_(s),s.check(),t==c.BOUNDARY_CONTOURS?this.outputContours_(s,i):this.outputPolymesh_(s,t,n,i),!0}}}("undefined"==typeof window?module.exports:window);